import{r as e,j as t,aS as n,aT as o,aU as i,aV as s,aW as r}from"./vendor-react-nG6Am_s0.js";import"./maplibre-gl-WBl_4I3M.js";import"./vendor-core-XI_xDZ-M.js";import"./deckgl-MTXp-Y3t.js";const a="#4F46E5",l="#F9D26F",d="#B49DFF",c="#39D98A",u="#B49DFF";function p(e,t,n,o=!1,i=!1,s=!1){let r;r=i?c:s?u:e?a:t?"#6366F1":n?"transparent":l;const p=e||t||!n||i||s;return`<div style="\n    width: 14px;\n    height: 14px;\n    background: ${r};\n    border-radius: 50%;\n    border: ${p?0:5}px solid ${p?"transparent":"#4338CA"};\n    box-sizing: border-box;\n    transition: box-shadow 0.15s ease;\n    ${o?`box-shadow: 0 0 0 3px ${d}40, 0 0 8px ${d}60;`:""}\n  "></div>`}const m={id:"path-line",type:"line",paint:{"line-color":"#3B3F4A","line-width":2,"line-opacity":.7},layout:{"line-cap":"round","line-join":"round"}};function x({resolvedPath:d,localNode:x,hubNodes:h=[],hoveredHopIndex:f,onHoverHop:g}){const b=e.useRef(null),y=e.useMemo(()=>new Set(h),[h]),[v,j]=e.useState(null),[k,C]=e.useState(0);e.useEffect(()=>{var e;const t=null==(e=b.current)?void 0:e.getMap();if(!t)return;const n=t.getCanvas();if(!n)return;const o=e=>{e.preventDefault()},i=()=>{C(e=>e+1)};return n.addEventListener("webglcontextlost",o),n.addEventListener("webglcontextrestored",i),()=>{n.removeEventListener("webglcontextlost",o),n.removeEventListener("webglcontextrestored",i)}},[k]);const{positions:N,markers:S,pathLineGeoJSON:F}=e.useMemo(()=>{const e=[],t=[],n=[];d.hops.forEach((o,i)=>{const s=o.candidates.filter(e=>{return t=e.latitude,n=e.longitude,0!==t||0!==n;var t,n});if(0===s.length)return;const r=[...s].sort((e,t)=>t.probability-e.probability)[0];n.push([r.longitude,r.latitude]);const a=!0===o.isSource,l=!0===o.isDestination;s.forEach((n,r)=>{const d=[n.latitude,n.longitude];e.push(d);const c=0===r;t.push({position:d,prefix:o.prefix,confidence:o.confidence,candidateCount:s.length,hopIndex:i,candidate:n,isHub:y.has(n.hash),isPrimary:c,isSource:a,isDestination:l})})});const o={type:"FeatureCollection",features:n.length>=2?[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:n}}]:[]};return{positions:e,markers:t,pathLineGeoJSON:o}},[d,y]),{initialBounds:L,center:B,zoom:w}=e.useMemo(()=>{if(0===N.length)return x?{initialBounds:null,center:[x.longitude,x.latitude],zoom:10}:{initialBounds:null,center:[0,0],zoom:2};let e=1/0,t=-1/0,n=1/0,o=-1/0;for(const[r,a]of N)r<e&&(e=r),r>t&&(t=r),a<n&&(n=a),a>o&&(o=a);const i=(e+t)/2,s=(n+o)/2;if(N.length>=2){const r=.15*(t-e)||.01,a=.15*(o-n)||.01;return{initialBounds:[[n-a,e-r],[o+a,t+r]],center:[s,i],zoom:10}}return{initialBounds:null,center:[s,i],zoom:12}},[N,x]),D=e.useCallback(e=>{j({longitude:e.position[1],latitude:e.position[0],marker:e})},[]);if(0===N.length)return t.jsx("div",{className:"h-[200px] flex items-center justify-center text-text-muted text-sm bg-bg-elevated",children:"No mappable path data"});const E=L?{bounds:L,fitBoundsOptions:{padding:30,maxZoom:16}}:{longitude:B[0],latitude:B[1],zoom:w};return t.jsxs(n,{ref:b,initialViewState:E,style:{height:"200px",width:"100%"},mapStyle:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",attributionControl:!1,children:[F.features.length>0&&t.jsx(o,{id:"path-line-source",type:"geojson",data:F,children:t.jsx(i,{...m})}),S.map(e=>{const n=f===e.hopIndex;return t.jsx(s,{longitude:e.position[1],latitude:e.position[0],anchor:"center",onClick:()=>D(e),children:t.jsx("div",{style:{cursor:"pointer",opacity:e.isPrimary?1:.5},onMouseEnter:()=>null==g?void 0:g(e.hopIndex),onMouseLeave:()=>null==g?void 0:g(null),dangerouslySetInnerHTML:{__html:p(e.candidate.isLocal||!1,e.isHub,e.isPrimary,n,e.isSource,e.isDestination)}})},`${e.hopIndex}-${e.candidate.hash}`)}),v&&t.jsx(r,{longitude:v.longitude,latitude:v.latitude,anchor:"bottom",offset:[0,-12],closeOnClick:!1,onClose:()=>j(null),className:"maplibre-popup",children:t.jsxs("div",{className:"text-xs",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"font-semibold",children:v.marker.candidate.name}),v.marker.isSource&&t.jsx("span",{className:"px-1 py-0.5 text-[8px] font-bold rounded",style:{backgroundColor:c,color:"#000"},children:"SRC"}),v.marker.isDestination&&t.jsx("span",{className:"px-1 py-0.5 text-[8px] font-bold rounded",style:{backgroundColor:u,color:"#000"},children:"DST"}),v.marker.isHub&&t.jsx("span",{className:"px-1 py-0.5 text-[8px] font-bold rounded",style:{backgroundColor:"#FBBF24",color:"#000"},children:"HUB"}),v.marker.candidate.isLocal&&t.jsx("span",{className:"px-1 py-0.5 text-[8px] font-bold rounded",style:{backgroundColor:a,color:"#fff"},children:"LOCAL"})]}),t.jsxs("div",{className:"text-text-muted font-mono text-[10px]",children:[v.marker.prefix," â€¢ ",v.marker.candidate.hash.slice(0,10),"..."]}),!v.marker.isPrimary&&v.marker.candidateCount>1&&t.jsxs("div",{style:{color:l},children:["Alternative (",(100*v.marker.candidate.probability).toFixed(0),"%)"]}),v.marker.isPrimary&&v.marker.candidateCount>1&&t.jsxs("div",{className:"text-text-muted",children:[v.marker.candidateCount," candidates"]})]})})]},k)}export{x as default};
