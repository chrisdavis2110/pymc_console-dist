const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PathMapMapLibre-D1FZPD1H.js","assets/vendor-react-CaAbI0Vq.js","assets/vendor-core-WoOfkQwm.js","assets/BasemapLayer-CsqsyYOE.js","assets/maplibre-gl-B1CfjdFi.css"])))=>i.map(i=>d[i]);
import{r as e,$ as t,a3 as s,D as a,a4 as l,_ as r,j as n,a5 as i,a6 as o,a7 as c,a8 as d,k as x,a9 as p,p as m,V as h,h as u,aa as f,b as y,X as g,ab as b,ac as j}from"./vendor-react-CaAbI0Vq.js";import{c as v}from"./recharts-gxAq7p2T.js";import{t as N,R as w,v as k,x as _,y as P,z as C,d as M,A as S,c as T,B as L,C as A,E as B}from"./index-DVxws6d_.js";import{S as R,g as H,a as E}from"./SignalIndicator-Bpfqqszb.js";import{D}from"./DataBox-hippEWRZ.js";import{g as U}from"./useScientificColormap-oyPuNx4E.js";import{_ as I}from"./deckgl-DTsmDcfs.js";function F(e){return null==e?"UNKNOWN":N[e]||`TYPE_${e}`}function O(e){return null==e?"UNKNOWN":w[e]||`ROUTE_${e}`}const V={REQ:k.REQ,RESPONSE:k.RESPONSE,TXT_MSG:k.TXT_MSG,ACK:k.ACK,ADVERT:k.ADVERT,GRP_TXT:k.GRP_TXT,GRP_DATA:k.GRP_DATA,ANON_REQ:k.ANON_REQ,PATH:k.PATH,TRACE:k.TRACE,MULTIPART:k.MULTIPART,RAW_CUSTOM:k.RAW_CUSTOM};function z(e,t){return(Math.max(e,t)+.05)/(Math.min(e,t)+.05)}function $(e){const t=function(e){const t=e.replace("#",""),s=parseInt(t.slice(0,2),16)/255,a=parseInt(t.slice(2,4),16)/255,l=parseInt(t.slice(4,6),16)/255,r=e=>e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4);return.2126*r(s)+.7152*r(a)+.0722*r(l)}(e);return z(t,1)>z(t,0)?"light":"dark"}const G={light:"rgba(255, 255, 255, 0.95)",dark:"rgba(0, 0, 0, 0.85)"};function W(e){const t=function(e){return U(V[e])}(e),s=$(t);return{bgColor:t,textColor:G[s]}}function K(e){return{FLOOD:"var(--route-flood)",DIRECT:"var(--route-direct)",TRANSPORT:"var(--route-transport)",T_FLOOD:"var(--route-flood)",T_DIRECT:"var(--route-direct)"}[e]||"var(--text-muted)"}function X(e){return 1===e||!0===e}const Q={light:"rgba(255, 255, 255, 0.95)",dark:"rgba(0, 0, 0, 0.85)"},q={rx:{icon:r,label:"RX",colorVar:"var(--accent-primary)"},tx:{icon:l,label:"TX",colorVar:"var(--accent-secondary)"},forward:{icon:a,label:"FWD",colorVar:"var(--accent-success)"},dropped:{icon:s,label:"DROP",colorVar:"var(--accent-danger)"},duplicate:{icon:t,label:"DUPE",colorVar:"var(--text-muted)"}},Y={rx:"#719CDF",tx:"#DFBC72",forward:"#719872",dropped:"#E12672",duplicate:"#727272"},J={sm:"w-3.5 h-3.5",md:"w-4 h-4"};function Z(e){return"tx_local"===e.packet_origin?"tx":"tx_forward"===e.packet_origin?"forward":e.is_duplicate?"duplicate":e.transmitted?"forward":e.drop_reason?"dropped":"rx"}const ee=e.memo(function({packet:t,showLabel:s=!0,size:a="sm"}){const l=Z(t),r=q[l],i=r.icon,o=e.useMemo(()=>{const e=$(Y[l]);return Q[e]},[l]);return n.jsxs("span",{className:"color-pill color-pill-filled",style:{"--pill-color":r.colorVar,"--pill-text":o},children:[n.jsx(i,{className:J[a]}),s&&r.label]})});function te(e){return"tx_local"===e.packet_origin?"Transmitted":"tx_forward"===e.packet_origin||e.transmitted?"Forwarded":e.is_duplicate?"Duplicate":"No transport keys configured"===e.drop_reason?"Monitor Only":e.drop_reason?e.drop_reason:"Received"}function se(e){return q[Z(e)].colorVar}function ae(e){const t=e.payload_type_name||F(e.payload_type??e.type);return{payloadType:t,routeType:e.route_type_name||O(e.route_type??e.route),typeColor:W(t)}}function le({packet:e,onClick:t,isFlashing:s=!1,isPending:a}){const{payloadType:l,routeType:r,typeColor:o}=ae(e),c="tx_local"===e.packet_origin,d=a??e.isPending;return n.jsxs("tr",{onClick:()=>t(e),className:v("cursor-pointer","hover:bg-bg-subtle",X(e.is_duplicate)&&"opacity-50",s&&"flash-row",d&&"opacity-70 bg-accent-secondary/5",c&&"ring-1 ring-inset ring-accent-primary/60 bg-accent-primary/5"),children:[n.jsx("td",{className:"py-2.5 px-3 whitespace-nowrap",children:n.jsxs("div",{className:"inline-flex items-center gap-1",children:[n.jsx(ee,{packet:e,showLabel:!0}),n.jsx("span",{className:"w-3 h-3 inline-flex items-center justify-center",children:d&&n.jsx(i,{className:"w-3 h-3 text-accent-secondary animate-spin"})})]})}),n.jsx("td",{className:"py-2.5 px-3 text-sm font-mono text-text-secondary whitespace-nowrap",children:P(e.timestamp)}),n.jsx("td",{className:"py-2.5 px-3 whitespace-nowrap",children:e.src_hash?n.jsx(D,{copy:!0,copyValue:e.src_hash_full,size:"compact",children:e.src_hash}):n.jsx("span",{className:"text-sm text-text-muted",children:"—"})}),n.jsx("td",{className:"py-2.5 px-3 whitespace-nowrap",children:n.jsx("span",{className:"color-pill color-pill-filled",style:{"--pill-color":o.bgColor,"--pill-text":o.textColor},children:l})}),n.jsx("td",{className:"py-2.5 px-3 whitespace-nowrap",children:n.jsx("span",{className:"color-pill",style:{"--pill-color":K(r)},children:r})}),n.jsx("td",{className:"py-2.5 px-3 pr-4 whitespace-nowrap",children:n.jsx("div",{className:"flex justify-end",children:n.jsx(R,{rssi:e.rssi,snr:e.snr,compact:!0,showValues:!0})})})]})}const re=e.memo(function(e){return n.jsx(le,{...e})}),ne=e.memo(function({packet:e,onClick:t,isFlashing:s=!1,isPending:a}){const{payloadType:l,routeType:r,typeColor:o}=ae(e),c="tx_local"===e.packet_origin,d=a??e.isPending;return n.jsx("div",{onClick:()=>t(e),className:v("packet-row px-3 py-2.5 cursor-pointer","hover:bg-bg-subtle","active:bg-bg-elevated",X(e.is_duplicate)&&"opacity-50",s&&"flash-row",d&&"opacity-70 bg-accent-secondary/5",c&&"ring-1 ring-inset ring-accent-primary/60 bg-accent-primary/5"),children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1",children:[n.jsx(ee,{packet:e,showLabel:!0,size:"sm"}),n.jsx("span",{className:"w-3 h-3 inline-flex items-center justify-center",children:d&&n.jsx(i,{className:"w-3 h-3 text-accent-secondary animate-spin"})})]}),n.jsx("span",{className:"text-[10px] font-mono text-text-muted flex-shrink-0",children:_(e.timestamp)}),n.jsx("div",{className:"flex-shrink-0",children:e.src_hash?n.jsx(D,{copy:!0,copyValue:e.src_hash_full,size:"compact",children:e.src_hash}):n.jsx("span",{className:"text-[10px] text-text-muted",children:"—"})}),n.jsx("div",{className:"flex-1 min-w-0"}),n.jsx("span",{className:"color-pill color-pill-filled flex-shrink-0",style:{"--pill-color":o.bgColor,"--pill-text":o.textColor},children:l}),n.jsx("span",{className:"color-pill flex-shrink-0",style:{"--pill-color":K(r)},children:r}),n.jsx("div",{className:"flex-shrink-0",children:n.jsx(R,{rssi:e.rssi,compact:!0,showValues:!0})})]})})});function ie(e){if(e.contact_type){const t=e.contact_type.toLowerCase();if("repeater"===t||"rep"===t)return!0;if("companion"===t||"client"===t||"cli"===t)return!1;if("room server"===t||"room_server"===t||"room"===t||"server"===t)return!1}return!0===e.is_repeater||(e.is_repeater,!1)}const oe=e.lazy(()=>I(()=>import("./PathMapMapLibre-D1FZPD1H.js"),__vite__mapDeps([0,1,2,3,4])));function ce(e){return`${(100*e).toFixed(0)}%`}function de(e,t){const s=document.documentElement,a=getComputedStyle(s),l={success:a.getPropertyValue("--accent-success").trim()||"#39D98A",secondary:a.getPropertyValue("--accent-secondary").trim()||"#F9D26F",poor:a.getPropertyValue("--signal-poor").trim()||"#FF8A5C",danger:a.getPropertyValue("--accent-danger").trim()||"#FF5C7A",muted:a.getPropertyValue("--text-muted").trim()||"#767688"};let r;return r=0===t?l.muted:e>=1?l.success:e>=.5?l.secondary:e>=.25?l.poor:e>0?l.danger:l.muted,{color:r}}class xe extends e.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?n.jsxs("div",{className:"h-[200px] flex items-center justify-center text-text-muted",children:[n.jsx(d,{className:"w-4 h-4 mr-2"}),"Map failed to load"]}):this.props.children}}function pe({path:t,neighbors:s,localNode:a,localHash:l,srcHash:r,dstHash:i,neighborAffinity:d,prefixLookup:x,hubNodes:p}){const[m,h]=e.useState(null),u=e.useMemo(()=>{if(!r)return null;const e=M(r),t=s[r];if((null==t?void 0:t.latitude)&&(null==t?void 0:t.longitude)&&(0!==t.latitude||0!==t.longitude))return{prefix:e,candidates:[{hash:r,name:t.node_name||t.name||"Source",latitude:t.latitude,longitude:t.longitude,probability:1,isLocal:!1,isDirectNeighbor:!0===t.zero_hop}],confidence:1,totalMatches:1,isSource:!0};const a=(null==t?void 0:t.node_name)||(null==t?void 0:t.name)||r.slice(0,8);return{prefix:e,candidates:[{hash:r,name:a,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isSource:!0}},[r,s]),f=e.useMemo(()=>{if(!i)return null;const e=M(i);if(l&&i===l&&a){const t=0!==a.latitude||0!==a.longitude;return{prefix:e,candidates:[{hash:i,name:a.name||"Local Node",latitude:t?a.latitude:0,longitude:t?a.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}const t=s[i];if((null==t?void 0:t.latitude)&&(null==t?void 0:t.longitude)&&(0!==t.latitude||0!==t.longitude))return{prefix:e,candidates:[{hash:i,name:t.node_name||t.name||"Destination",latitude:t.latitude,longitude:t.longitude,probability:1,isLocal:!1,isDirectNeighbor:!0===t.zero_hop}],confidence:1,totalMatches:1,isDestination:!0};const r=(null==t?void 0:t.node_name)||(null==t?void 0:t.name)||i.slice(0,8);return{prefix:e,candidates:[{hash:i,name:r,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isDestination:!0}},[i,s,a,l]),y=e.useMemo(()=>function(e,t,s,a,l,r){if(!e||0===e.length)return{hops:[],overallConfidence:0,hasValidPath:!1};const n=e.length-1,i=e.map((i,o)=>{const c=o===n,d=e.length-o,{candidates:x,totalMatches:p}=function(e,t,s,a,l=!1,r,n,i){const o=function(e){const t={};for(const[s,a]of Object.entries(e))ie(a)&&(t[s]=a);return t}(t);let c;if(n){const t=function(e,t,s){const a=t.toUpperCase(),l=e.get(a);if(!l||0===l.candidates.length)return{hash:null,confidence:0};if(null==s?void 0:s.isLastHop)return{hash:l.bestMatch,confidence:l.confidence};if(1===(null==s?void 0:s.position))return{hash:l.bestMatch,confidence:l.confidence};if((null==s?void 0:s.position)&&l.bestMatchForPosition.has(s.position)){const e=l.bestMatchForPosition.get(s.position),t=Math.max(e.confidence,l.confidence);return{hash:e.hash,confidence:t}}if((null==s?void 0:s.adjacentPrefixes)&&s.adjacentPrefixes.length>0){let e=l.bestMatch,t=0;for(const a of l.candidates){let l=0;for(const e of s.adjacentPrefixes)l+=a.adjacentPrefixCounts.get(e.toUpperCase())||0;const r=a.combinedScore+l/Math.max(1,a.totalAdjacentObservations)*.3;r>t&&(t=r,e=a.hash)}return{hash:e,confidence:l.confidence}}return{hash:l.bestMatch,confidence:l.confidence}}(n,e,{position:i,isLastHop:l});c=t.confidence}const{matches:d,probability:x}=function(e,t,s,a,l=!1){const r=e.toUpperCase(),n=[],i=s&&C(r,s);i&&n.push(s);for(const m of Object.keys(t))C(r,m)&&n.push(m);if(l&&i&&s&&1===n.length)return{matches:n,probability:1,bestMatch:s};if(l&&i&&n.length>1){const e=n.filter(e=>e!==s);if(1===e.length)return{matches:n,probability:1,bestMatch:e[0]}}const o=n.length>0?1/n.length:0,c=[...n].sort();let d=null,x=-1;if(1===c.length)d=c[0];else if(c.length>1&&a){for(const e of c){const t=a.get(e),s=t?"number"==typeof t?t:t.combinedScore:0;s>x&&(x=s,d=e)}d||(d=c[0])}else c.length>0&&(d=c[0]);let p=o;if(n.length>1&&a&&x>0){let e=0;for(const t of n){const s=a.get(t);e+=s?"number"==typeof s?s:s.combinedScore:0}e>0&&(p=Math.min(.95,x/e))}return{matches:n,probability:p,bestMatch:d}}(e,o,a,r,l),p=d.length,m=[],h=e.toUpperCase(),u=s&&void 0!==s.latitude&&void 0!==s.longitude&&(0!==s.latitude||0!==s.longitude);for(const y of d){if(a&&C(h,a)&&y===a&&u&&s){m.push({hash:y,name:s.name||"Local Node",latitude:s.latitude,longitude:s.longitude,probability:l?1:x,isLocal:!0});continue}const e=o[y];(null==e?void 0:e.latitude)&&(null==e?void 0:e.longitude)&&(0!==e.latitude||0!==e.longitude)&&m.push({hash:y,name:e.node_name||e.name||"Unknown",latitude:e.latitude,longitude:e.longitude,probability:x,isLocal:!1,isDirectNeighbor:!0===e.zero_hop})}const f=m.length;if(1===f)m[0].probability=c??1;else if(f>1)if(void 0!==c&&c>0){m[0].probability=c;const e=1-c,t=f-1;m.slice(1).forEach(s=>{s.probability=e/t})}else{let e=0;const t=m.map(t=>{if(t.isLocal)return{candidate:t,score:1};const a=null==r?void 0:r.get(t.hash);let l=.5;var n;let i;return u&&s&&(l=(n=function(e,t,s,a){const l=(s-e)*Math.PI/180,r=(a-t)*Math.PI/180,n=Math.sin(l/2)*Math.sin(l/2)+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n))*6371e3}(s.latitude,s.longitude,t.latitude,t.longitude))<100?1:n<500?.9:n<1e3?.7:n<5e3?.5:n<1e4?.3:.1),a?i=.3*l+.3*a.hopConsistencyScore+.4*a.frequencyScore:(i=l,t.isDirectNeighbor&&(i=Math.max(i,.8))),e+=i,{candidate:t,score:i}});if(e>0)t.forEach(({candidate:t,score:s})=>{t.probability=Math.min(.95,s/e)});else{const e=1/f;m.forEach(t=>t.probability=e)}}return{candidates:m,totalMatches:p}}(i,t,s,a,c,l,r,d),m=x.length>0?Math.max(...x.map(e=>e.probability)):0;return{prefix:i,candidates:x,confidence:m,totalMatches:p}}),o=i.reduce((e,t)=>0===t.confidence?0:e*t.confidence,1),c=i.some(e=>e.candidates.length>0);return{hops:i,overallConfidence:o,hasValidPath:c}}(t,s,a,l,d,x),[t,s,a,l,d,x]),g=e.useMemo(()=>{const e=[];u&&e.push(u),e.push(...y.hops),f&&e.push(f);const t=e.reduce((e,t)=>0===t.confidence?0:e*t.confidence,1),s=e.some(e=>e.candidates.some(e=>0!==e.latitude||0!==e.longitude));return{hops:e,overallConfidence:t,hasValidPath:s}},[u,y,f]);return g.hasValidPath?n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between text-xs",children:[n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx("span",{className:"text-text-muted",children:"Path Confidence:"}),n.jsx("span",{className:(b=g.overallConfidence,b>=1?"text-accent-success":b>=.5?"text-accent-secondary":b>=.25?"text-signal-poor":b>0?"text-accent-danger":"text-text-muted"),children:ce(g.overallConfidence)}),n.jsx("button",{className:"text-text-muted hover:text-text-secondary transition-colors",title:"Confidence is calculated based on how many known nodes match each path prefix. Multiple matches reduce confidence due to collision probability.",children:n.jsx(c,{className:"w-3 h-3"})})]}),n.jsxs("div",{className:"flex items-center gap-2 text-[10px]",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("div",{className:"w-2 h-2 rounded-full bg-accent-success"}),n.jsx("span",{className:"text-text-muted",children:"Exact"})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("div",{className:"w-2 h-2 rounded-full bg-accent-secondary"}),n.jsx("span",{className:"text-text-muted",children:"Multi"})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("div",{className:"w-2 h-2 rounded-full bg-text-muted"}),n.jsx("span",{className:"text-text-muted",children:"Unknown"})]})]})]}),n.jsx("div",{className:"rounded-lg overflow-hidden border border-border-subtle",children:n.jsx(xe,{children:n.jsx(e.Suspense,{fallback:n.jsx("div",{className:"h-[200px] bg-bg-elevated flex items-center justify-center text-text-muted text-sm",children:"Loading map..."}),children:n.jsx(oe,{resolvedPath:g,localNode:a,hubNodes:p,hoveredHopIndex:m,onHoverHop:h})})})}),n.jsx("div",{className:"flex flex-wrap items-center gap-1.5",children:g.hops.map((e,t)=>{var s,a,l;const r=!0===e.isSource,i=!0===e.isDestination,o=m===t;let c;return c=r?`Source: ${(null==(s=e.candidates[0])?void 0:s.name)||"Unknown"}`:i?`Destination: ${(null==(a=e.candidates[0])?void 0:a.name)||"Unknown"}`:0===e.totalMatches?"No matching nodes found":1===e.totalMatches?`Exact match: ${(null==(l=e.candidates[0])?void 0:l.name)||"Unknown"}`:`${e.totalMatches} possible matches (${(100*e.confidence).toFixed(0)}% confidence)`,n.jsxs("div",{className:v("flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-mono cursor-pointer transition-all",o?"bg-accent-primary/20 ring-1 ring-accent-primary/50":"bg-bg-elevated hover:bg-bg-subtle",r&&"border border-accent-success/30",i&&"border border-accent-primary/30"),title:c,onMouseEnter:()=>h(t),onMouseLeave:()=>h(null),children:[r&&n.jsx("span",{className:"text-accent-success text-[8px] mr-0.5",children:"SRC"}),i&&n.jsx("span",{className:"text-accent-primary text-[8px] mr-0.5",children:"DST"}),n.jsx("span",{style:de(e.confidence,e.totalMatches),children:e.prefix}),!r&&!i&&e.totalMatches>1&&n.jsxs("span",{className:"text-text-muted",children:["×",e.totalMatches]}),!r&&!i&&0===e.totalMatches&&n.jsx("span",{className:"text-text-muted",children:"?"})]},t)})})]}):n.jsxs("div",{className:"flex items-center justify-center text-text-muted text-xs py-4",children:[n.jsx(o,{className:"w-3.5 h-3.5 mr-1.5 opacity-50"}),"No location data available for path nodes"]});var b}function me(e){var t;const s=(null==(t=e.match(/.{2}/g))?void 0:t.map(e=>parseInt(e,16)))||[],a=new ArrayBuffer(4),l=new DataView(a);return s.forEach((e,t)=>l.setUint8(t,e)),l.getFloat32(0,!0)}function he({bits:e,field:t,value:s,binary:a}){return n.jsxs("tr",{className:"border-b border-border-subtle/50 last:border-0",children:[n.jsx("td",{className:"py-1.5 text-xs text-text-muted tabular-nums",children:e}),n.jsx("td",{className:"py-1.5 text-sm text-text-secondary",children:t}),n.jsx("td",{className:"py-1.5 text-sm text-text-primary",children:s}),n.jsx("td",{className:"py-1.5 font-mono text-xs text-sys-cyan",children:a})]})}function ue({title:e,pillClass:t,startByte:s,endByte:a,children:l}){return n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:`color-pill color-pill-filled ${t}`,children:e}),n.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:["Bytes ",s,"-",a]})]}),n.jsx("div",{className:"pl-1",children:l})]})}function fe({title:t,pillClass:s,startByte:a,endByte:l,children:r,defaultOpen:i=!1}){const[o,c]=e.useState(i);return n.jsxs("div",{className:"glass-card-inner overflow-hidden",children:[n.jsxs("button",{onClick:()=>c(!o),className:"w-full p-2 flex items-center justify-between text-left hover:bg-bg-subtle/50 transition-colors",children:[n.jsx("span",{className:`color-pill color-pill-filled color-pill-compact ${s}`,children:t}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:["Bytes ",a,"-",l]}),o?n.jsx(x,{className:"w-3.5 h-3.5 text-text-muted"}):n.jsx(p,{className:"w-3.5 h-3.5 text-text-muted"})]})]}),o&&n.jsx("div",{className:"px-2 pb-2 space-y-1",children:r})]})}const ye=e.memo(function({packet:t}){var s,a,l,r;const i=t.raw_packet||"",o=i.length/2,c=e.useMemo(()=>{if(i.length<4)return null;const e=i.slice(0,2),t=parseInt(e,16),s=function(e){const t=3&e,s=e>>2&15,a=e>>6&3,l=[{bits:"0-1",field:"Route Type",value:w[t]||`ROUTE_${t}`,binary:t.toString(2).padStart(2,"0")},{bits:"2-5",field:"Payload Type",value:N[s]||`TYPE_${s}`,binary:s.toString(2).padStart(4,"0")},{bits:"6-7",field:"Version",value:a.toString(),binary:a.toString(2).padStart(2,"0")}];return{routeType:t,payloadType:s,version:a,fields:l}}(t),a=i.slice(2,4),l=parseInt(a,16),r=4+2*l,n=i.slice(4,r),o=i.slice(r);let c=null;return 4===s.payloadType&&o.length>0&&(c=function(e){var t;if(e.length<200)return null;try{const s=e.slice(0,64),a=e.slice(64,72),l=parseInt((null==(t=a.match(/.{2}/g))?void 0:t.reverse().join(""))||"0",16),r=e.slice(72,200),n=e.slice(200,202),i=parseInt(n,16),o=i.toString(2).padStart(8,"0"),c=15&i,d=!!(16&i),x=!!(128&i),p={publicKey:s,timestamp:l,timestampHex:a,signature:r,appFlags:i,appFlagsBinary:o,role:{0:"Client",1:"Repeater",2:"Managed Repeater",3:"Room Server"}[c]||`Role ${c}`,hasLocation:d,hasName:x};let m=202;if(d&&e.length>=m+8){const t=e.slice(m,m+8);if(p.latitudeHex=t,p.latitude=me(t),m+=8,e.length>=m+8){const t=e.slice(m,m+8);p.longitudeHex=t,p.longitude=me(t),m+=8}}if(x&&e.length>m){const t=e.slice(m);p.nodeNameHex=t,p.nodeName=function(e){var t;const s=(null==(t=e.match(/.{2}/g))?void 0:t.map(e=>parseInt(e,16)))||[];return String.fromCharCode(...s.filter(e=>e>=32&&e<127))}(t)}return p}catch{return null}}(o)),{headerHex:e,headerByte:t,header:s,pathLengthHex:a,pathLength:l,pathDataHex:n,payloadHex:o,payloadStartByte:Math.floor(r/2),advertPayload:c}},[i]);if(!c||0===i.length)return n.jsx("div",{className:"p-4 text-center text-text-muted",children:n.jsx("p",{className:"text-sm",children:"No raw packet data available"})});const d=4===c.header.payloadType;return n.jsxs("div",{className:"space-y-3 font-mono",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h3",{className:"text-base font-semibold text-text-primary font-sans",children:"Packet Byte Breakdown"}),n.jsxs("span",{className:"text-xs text-text-muted",children:[o," bytes"]})]}),n.jsx("div",{className:"p-2 rounded-lg bg-bg-body/50",children:n.jsxs("div",{className:"text-xs leading-relaxed flex flex-wrap gap-0.5",children:[n.jsx("span",{className:"color-pill color-pill-filled color-pill-compact color-pill-red",children:c.headerHex.toUpperCase()}),n.jsx("span",{className:"color-pill color-pill-filled color-pill-compact color-pill-cyan",children:c.pathLengthHex.toUpperCase()}),c.pathDataHex&&n.jsx("span",{className:"color-pill color-pill-filled color-pill-compact color-pill-amber",children:c.pathDataHex.toUpperCase()}),n.jsx("span",{className:"color-pill color-pill-filled color-pill-compact color-pill-green break-all",children:c.payloadHex.toUpperCase()})]})}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs(ue,{title:"Header",pillClass:"color-pill-red",startByte:0,endByte:0,children:[n.jsx("div",{className:"mb-2",children:n.jsxs(D,{size:"standard",copy:!0,children:["0x",c.headerHex.toUpperCase()]})}),n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"text-[10px] uppercase tracking-wide text-text-muted border-b border-border-subtle font-sans",children:[n.jsx("th",{className:"py-1 font-medium",children:"Bits"}),n.jsx("th",{className:"py-1 font-medium",children:"Field"}),n.jsx("th",{className:"py-1 font-medium",children:"Value"}),n.jsx("th",{className:"py-1 font-medium",children:"Binary"})]})}),n.jsx("tbody",{children:c.header.fields.map(e=>n.jsx(he,{...e},e.bits))})]})]}),n.jsxs(ue,{title:"Path Length",pillClass:"color-pill-cyan",startByte:1,endByte:1,children:[n.jsx("div",{className:"mb-1",children:n.jsxs(D,{size:"standard",copy:!0,children:["0x",c.pathLengthHex.toUpperCase()]})}),n.jsxs("p",{className:"text-xs text-text-muted",children:[c.pathLength," bytes showing route taken (increases as packet floods)"]})]}),c.pathLength>0&&n.jsxs(ue,{title:"Path Data",pillClass:"color-pill-amber",startByte:2,endByte:1+c.pathLength,children:[n.jsx("div",{className:"mb-1",children:n.jsx(D,{size:"standard",copy:!0,children:c.pathDataHex.toUpperCase()})}),n.jsx("p",{className:"text-xs text-text-muted",children:"Historical route taken (bytes are added as packet floods through network)"})]}),n.jsxs(ue,{title:"Payload",pillClass:"color-pill-green",startByte:c.payloadStartByte,endByte:o-1,children:[n.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50",children:c.payloadHex.toUpperCase()}),n.jsx("p",{className:"text-xs text-text-muted mt-1",children:d?"Advert payload data":`${c.header.fields[1].value} payload data`})]})]}),d&&c.advertPayload&&n.jsxs("div",{className:"space-y-3 mt-4",children:[n.jsx("h4",{className:"text-sm font-semibold text-text-primary font-sans",children:"Advert Payload Breakdown"}),n.jsx("div",{className:"p-2 rounded-lg bg-bg-body/50",children:n.jsxs("div",{className:"text-[10px] leading-relaxed flex flex-wrap gap-0.5",children:[n.jsx("span",{className:"color-pill color-pill-filled color-pill-compact color-pill-pink break-all",children:c.advertPayload.publicKey.toUpperCase()}),n.jsx("span",{className:"color-pill color-pill-filled color-pill-compact color-pill-orange",children:c.advertPayload.timestampHex.toUpperCase()}),n.jsx("span",{className:"color-pill color-pill-filled color-pill-compact color-pill-teal break-all",children:c.advertPayload.signature.toUpperCase()}),n.jsx("span",{className:"color-pill color-pill-filled color-pill-compact color-pill-blue",children:c.advertPayload.appFlags.toString(16).padStart(2,"0").toUpperCase()}),c.advertPayload.latitudeHex&&n.jsx("span",{className:"color-pill color-pill-filled color-pill-compact color-pill-green",children:c.advertPayload.latitudeHex.toUpperCase()}),c.advertPayload.longitudeHex&&n.jsx("span",{className:"color-pill color-pill-filled color-pill-compact color-pill-purple",children:c.advertPayload.longitudeHex.toUpperCase()}),c.advertPayload.nodeNameHex&&n.jsx("span",{className:"color-pill color-pill-filled color-pill-compact color-pill-amber",children:c.advertPayload.nodeNameHex.toUpperCase()})]})}),n.jsxs(fe,{title:"Public Key",pillClass:"color-pill-pink",startByte:0,endByte:31,children:[n.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50",children:c.advertPayload.publicKey.toUpperCase()}),n.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Ed25519 public key"})]}),n.jsxs(fe,{title:"Timestamp",pillClass:"color-pill-orange",startByte:32,endByte:35,children:[n.jsx("div",{className:"mb-1",children:n.jsx(D,{size:"standard",copy:!0,children:c.advertPayload.timestampHex.toUpperCase()})}),n.jsxs("p",{className:"text-xs text-text-primary",children:[c.advertPayload.timestamp," (",S(c.advertPayload.timestamp),")"]})]}),n.jsxs(fe,{title:"Signature",pillClass:"color-pill-teal",startByte:36,endByte:99,children:[n.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50",children:c.advertPayload.signature.toUpperCase()}),n.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Ed25519 signature"})]}),n.jsxs(fe,{title:"App Flags",pillClass:"color-pill-blue",startByte:100,endByte:100,children:[n.jsx("div",{className:"mb-1",children:n.jsx(D,{size:"standard",copy:!0,children:c.advertPayload.appFlags.toString(16).padStart(2,"0").toUpperCase()})}),n.jsxs("p",{className:"text-xs text-text-primary",children:["Binary: ",c.advertPayload.appFlagsBinary," | Bits 0-3 (Role): ",c.advertPayload.role," | Bit 4 (Location): ",c.advertPayload.hasLocation?"Yes":"No"," | Bit 7 (Name): ",c.advertPayload.hasName?"Yes":"No"]})]}),void 0!==c.advertPayload.latitude&&n.jsxs(fe,{title:"Latitude",pillClass:"color-pill-green",startByte:101,endByte:104,children:[n.jsx("div",{className:"mb-1",children:n.jsx(D,{size:"standard",copy:!0,children:null==(s=c.advertPayload.latitudeHex)?void 0:s.toUpperCase()})}),n.jsxs("p",{className:"text-xs text-text-primary",children:[c.advertPayload.latitude.toFixed(6),"°"]})]}),void 0!==c.advertPayload.longitude&&n.jsxs(fe,{title:"Longitude",pillClass:"color-pill-purple",startByte:105,endByte:108,children:[n.jsx("div",{className:"mb-1",children:n.jsx(D,{size:"standard",copy:!0,children:null==(a=c.advertPayload.longitudeHex)?void 0:a.toUpperCase()})}),n.jsxs("p",{className:"text-xs text-text-primary",children:[c.advertPayload.longitude.toFixed(6),"°"]})]}),c.advertPayload.nodeName&&n.jsxs(fe,{title:"Node Name",pillClass:"color-pill-amber",startByte:109,endByte:109+((null==(l=c.advertPayload.nodeNameHex)?void 0:l.length)||0)/2-1,children:[n.jsx("div",{className:"mb-1",children:n.jsx(D,{size:"standard",copy:!0,children:null==(r=c.advertPayload.nodeNameHex)?void 0:r.toUpperCase()})}),n.jsxs("p",{className:"text-xs text-text-primary",children:['Node name: "',c.advertPayload.nodeName,'"']})]})]})]})});function ge(e){if(!e)return[];if(Array.isArray(e))return e;try{const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}}function be(e){return e?(e.startsWith("0x")?e.slice(2):e).slice(0,2).toUpperCase():""}function je(e){if(void 0===e)return"text-text-muted";switch(H(e)){case"excellent":return"text-signal-excellent";case"good":return"text-signal-good";case"fair":return"text-signal-fair";case"weak":return"text-signal-poor";case"poor":return"text-signal-critical";default:return"text-text-muted"}}function ve({hop:e,isLast:t}){var s,a,l,i,c,d,x,p;const y=!(!(null==(s=e.neighborInfo)?void 0:s.latitude)||!(null==(a=e.neighborInfo)?void 0:a.longitude)),g=void 0!==(null==(l=e.neighborInfo)?void 0:l.rssi);return n.jsxs("div",{className:"relative",children:[!t&&n.jsx("div",{className:"absolute left-[19px] top-[40px] bottom-[-20px] w-[2px] bg-border-subtle"}),n.jsxs("div",{className:v("glass-card-inner p-3",e.isLocal&&"ring-1 ring-sys-amber/50",e.isGhost&&"ring-1 ring-sys-cyan/50"),children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:v("w-9 h-9 rounded-full flex items-center justify-center flex-shrink-0",e.isLocal?"bg-sys-amber/20 text-sys-amber":e.isGhost?"bg-sys-cyan/20 text-sys-cyan":"bg-accent-primary/20 text-accent-primary"),children:e.isLocal?n.jsx(h,{className:"w-4 h-4"}):e.isGhost?n.jsx(u,{className:"w-4 h-4"}):n.jsx("span",{className:"text-xs font-semibold",children:e.position})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(D,{copy:!0,size:"compact",color:e.isGhost?"text-sys-cyan":void 0,children:e.prefix}),e.isLocal&&n.jsx("span",{className:"color-pill color-pill-filled color-pill-amber",children:"Local"}),e.isGhost&&n.jsx("span",{className:"color-pill color-pill-filled color-pill-cyan",children:"Ghost"}),void 0!==e.confidence&&n.jsxs("span",{className:v("text-[10px] font-mono",e.confidence>=.9?"text-accent-success":e.confidence>=.6?"text-accent-secondary":"text-accent-danger"),children:[(100*e.confidence).toFixed(0),"%"]})]}),(null==(i=e.neighborInfo)?void 0:i.name)&&n.jsx("p",{className:"text-sm text-text-primary truncate mt-0.5",children:e.neighborInfo.name}),e.fullHash&&n.jsx("p",{className:"text-[10px] font-mono text-text-muted truncate",children:e.fullHash})]})]}),(g||y||e.neighborInfo)&&n.jsxs("div",{className:"mt-3 pt-3 border-t border-border-subtle/50 space-y-2",children:[g&&n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(m,{className:"w-3.5 h-3.5 text-text-muted flex-shrink-0"}),n.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[n.jsx(R,{rssi:e.neighborInfo.rssi,snr:null==(c=e.neighborInfo)?void 0:c.snr,compact:!0}),n.jsxs("span",{className:"text-xs text-text-muted",children:[e.neighborInfo.rssi," dBm",null!=(null==(d=e.neighborInfo)?void 0:d.snr)&&` / ${e.neighborInfo.snr.toFixed(1)} dB`]})]})]}),y&&n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(o,{className:"w-3.5 h-3.5 text-text-muted flex-shrink-0"}),n.jsxs("span",{className:"text-xs font-mono text-text-secondary",children:[e.neighborInfo.latitude.toFixed(5),", ",e.neighborInfo.longitude.toFixed(5)]})]}),(null==(x=e.neighborInfo)?void 0:x.contact_type)&&n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-[10px] text-text-muted",children:"Type:"}),n.jsx("span",{className:"color-pill color-pill-compact",children:e.neighborInfo.contact_type})]}),(null==(p=e.neighborInfo)?void 0:p.last_seen)&&n.jsxs("div",{className:"text-[10px] text-text-muted",children:["Last seen: ",S(e.neighborInfo.last_seen)]})]}),!e.neighborInfo&&!e.isLocal&&!e.isGhost&&n.jsxs("div",{className:"mt-2 flex items-center gap-2 text-[10px] text-text-muted",children:[n.jsx(f,{className:"w-3 h-3"}),n.jsx("span",{children:"Unknown node - not in neighbor table"})]})]}),!t&&n.jsx("div",{className:"flex justify-center py-1",children:n.jsx(r,{className:"w-4 h-4 text-border-subtle"})})]})}const Ne=e.memo(function({packet:t,neighbors:s,localHash:a,neighborAffinity:l,ghostPrefixes:i}){const o=ge(t.original_path),c=ge(t.forwarded_path),d=c.length>0?c:o,x=be(a),p=e.useMemo(()=>d.map((e,t)=>{const a=e.toUpperCase(),r=a===x,n=(null==i?void 0:i.has(a))??!1,o=function(e,t,s){const a=e.toUpperCase();if(s){let e=null,l=0;if(s.forEach((t,s)=>{if(be(s)===a){const a=t.combinedScore??0;a>l&&(l=a,e=s)}}),e&&t[e])return{hash:e,info:t[e],confidence:l}}for(const[l,r]of Object.entries(t))if(be(l)===a)return{hash:l,info:r,confidence:void 0};return null}(a,s,l);return{prefix:a,fullHash:null==o?void 0:o.hash,neighborInfo:null==o?void 0:o.info,isLocal:r,isGhost:n,confidence:null==o?void 0:o.confidence,position:t+1}}),[d,s,l,x,i]);return 0===p.length?n.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-6 text-center",children:[n.jsx(m,{className:"w-8 h-8 text-text-muted mb-3"}),n.jsx("p",{className:"text-sm text-text-muted",children:"No path data available"}),n.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Direct packets have no intermediate hops"})]}):n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h3",{className:"text-base font-semibold text-text-primary",children:"Packet Path"}),n.jsxs("span",{className:"text-xs text-text-muted",children:[p.length," hop",1!==p.length?"s":""]})]}),t.src_hash&&n.jsxs("div",{className:"glass-card-inner p-3",children:[n.jsx("div",{className:"flex items-center gap-2 mb-1",children:n.jsx("span",{className:"text-[10px] uppercase tracking-wide text-text-muted",children:"Source"})}),n.jsx(D,{copy:!0,size:"compact",children:t.src_hash})]}),t.src_hash&&n.jsx("div",{className:"flex justify-center",children:n.jsx(r,{className:"w-4 h-4 text-accent-primary"})}),n.jsx("div",{className:"space-y-1",children:p.map((e,t)=>n.jsx(ve,{hop:e,isLast:t===p.length-1},`${e.prefix}-${t}`))}),t.dst_hash&&t.dst_hash!==a&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"flex justify-center",children:n.jsx(r,{className:"w-4 h-4 text-accent-primary"})}),n.jsxs("div",{className:"glass-card-inner p-3",children:[n.jsx("div",{className:"flex items-center gap-2 mb-1",children:n.jsx("span",{className:"text-[10px] uppercase tracking-wide text-text-muted",children:"Destination"})}),n.jsx(D,{copy:!0,size:"compact",children:t.dst_hash})]})]}),n.jsxs("div",{className:"glass-card-inner p-3 mt-4",children:[n.jsx("p",{className:"text-[10px] uppercase tracking-wide text-text-muted mb-2",children:"Reception Summary"}),n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx(R,{rssi:t.rssi,snr:t.snr}),n.jsxs("div",{className:"text-xs text-text-secondary",children:[n.jsxs("span",{className:je(t.rssi),children:[t.rssi," dBm"]}),void 0!==t.snr&&n.jsxs("span",{className:"text-text-muted",children:[" / ",t.snr.toFixed(1)," dB SNR"]})]})]})]})]})});function we(e){if(!e)return[];if(Array.isArray(e))return e;try{const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}}function ke({label:e,children:t,compact:s=!1}){return n.jsxs("div",{className:v("flex flex-col",s?"gap-0.5":"gap-1"),children:[n.jsx("span",{className:"text-[10px] text-text-muted uppercase tracking-wide",children:e}),n.jsx("span",{className:v("text-text-primary","text-sm"),children:t})]})}function _e({originalPath:e,forwardedPath:t,ghostPrefixes:s}){const l=t.length>0?t:e;if(0===l.length)return n.jsx("span",{className:"text-sm text-text-muted",children:"No path data"});const r=e=>null==s?void 0:s.has(e.toUpperCase());return n.jsx("div",{className:"flex items-center gap-1 flex-wrap",children:l.map((e,t)=>n.jsxs("div",{className:"flex items-center gap-1",children:[r(e)?n.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-accent-tertiary/20 text-accent-tertiary font-mono text-sm",children:[n.jsx(u,{className:"w-3 h-3"}),e.toUpperCase()]}):n.jsx(D,{copy:!0,size:"compact",children:e}),t<l.length-1&&n.jsx(a,{className:"w-3 h-3 text-text-muted flex-shrink-0"})]},t))})}const Pe=e.memo(function({packet:t,onClose:s}){const[a,l]=e.useState("analysis");e.useEffect(()=>{const e=e=>{"Escape"===e.key&&s()};window.addEventListener("keydown",e);const t=document.body.style.overflow,a=document.body.style.position,l=document.body.style.width,r=document.body.style.top,n=window.scrollY;return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.top=`-${n}px`,()=>{window.removeEventListener("keydown",e),document.body.style.overflow=t,document.body.style.position=a,document.body.style.width=l,document.body.style.top=r,window.scrollTo(0,n)}},[s]);const r=T(),i=L(),o=A(),c=B(),d=e.useMemo(()=>new Set(c.map(e=>e.prefix.toUpperCase())),[c]),x=t.payload_type_name||F(t.payload_type??t.type),p=t.route_type_name||O(t.route_type??t.route),h=t.payload_length??t.length??0,f=t.tx_delay_ms??0,N=we(t.original_path),w=we(t.forwarded_path),k=N.length>0||w.length>0,_=w.length>0?w:N,P=e.useMemo(()=>{var e;if(null==(e=null==r?void 0:r.config)?void 0:e.repeater)return{latitude:r.config.repeater.latitude,longitude:r.config.repeater.longitude,name:r.config.node_name||"Local Node"}},[r]),C=(null==r?void 0:r.neighbors)??{},M=o.size>0?o:void 0,H=t.raw_packet&&t.raw_packet.length>0,D=_.length>0;return y.createPortal(n.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-md z-[10010] flex items-end sm:items-center justify-center p-4",onClick:s,role:"dialog","aria-modal":"true","aria-labelledby":"packet-modal-title",children:n.jsxs("div",{className:v("glass-card-elevated w-full flex flex-col","max-h-[90vh]","rounded-t-2xl rounded-b-none","sm:max-w-[900px] sm:rounded-xl sm:aspect-[5/4] sm:max-h-[85vh]","pb-safe"),onClick:e=>e.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border-subtle flex-shrink-0",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(ee,{packet:t,showLabel:!0,size:"md"}),n.jsxs("div",{children:[n.jsx("h3",{id:"packet-modal-title",className:v("text-base font-semibold",(I=x,{ADVERT:"text-[var(--pkt-advert)]",FLOOD:"text-[var(--pkt-flood)]",TXT_MSG:"text-[var(--pkt-txt-msg)]",ACK:"text-[var(--pkt-ack)]",TRACE:"text-[var(--pkt-trace)]",REQ:"text-[var(--pkt-req)]",RESPONSE:"text-[var(--pkt-response)]",GRP_TXT:"text-[var(--pkt-grp-txt)]",GRP_DATA:"text-[var(--pkt-grp-data)]",PATH:"text-[var(--pkt-path)]",ANON_REQ:"text-[var(--pkt-anon)]"}[I]||"text-[var(--pkt-unknown)]")),children:x}),n.jsx("p",{className:"text-sm text-text-muted",children:S(t.timestamp)})]})]}),n.jsx("button",{onClick:s,className:"p-2 rounded-lg text-text-muted hover:text-text-primary hover:bg-bg-subtle transition-colors",children:n.jsx(g,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"hidden sm:flex items-center gap-1 px-4 pt-2 pb-1 border-b border-border-subtle/50 flex-shrink-0",children:[n.jsxs("button",{onClick:()=>l("map"),className:v("px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center gap-1.5","map"===a?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-secondary hover:bg-bg-subtle"),children:[n.jsx(m,{className:"w-3.5 h-3.5"}),"RF / Map"]}),(D||H)&&n.jsxs("button",{onClick:()=>l("analysis"),className:v("px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center gap-1.5","analysis"===a?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-secondary hover:bg-bg-subtle"),children:[n.jsx(b,{className:"w-3.5 h-3.5"}),"Path / Bytes"]})]}),n.jsxs("div",{className:"flex-1 min-h-0 flex flex-col overflow-hidden",children:[n.jsxs("div",{className:v("overflow-y-auto p-4 space-y-4 overscroll-contain","sm:hidden"),style:{WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[n.jsx("div",{className:"glass-card-inner p-3",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-text-muted mb-1",children:"Signal Quality"}),n.jsx("p",{className:"text-sm font-medium text-text-primary",children:E(t.rssi)})]}),n.jsx(R,{rssi:t.rssi,snr:t.snr,showValues:!0})]})}),k&&n.jsxs("div",{className:"glass-card-inner p-3",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("p",{className:"text-sm text-text-muted",children:"Packet Path"}),_.some(e=>d.has(e.toUpperCase()))&&n.jsxs("span",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-full bg-accent-tertiary/20 text-accent-tertiary text-[10px]",children:[n.jsx(u,{className:"w-3 h-3"}),n.jsx("span",{children:"Ghost Detected"})]})]}),n.jsx(_e,{originalPath:N,forwardedPath:w,ghostPrefixes:d})]}),D&&n.jsx(Ne,{packet:t,neighbors:C,localHash:null==r?void 0:r.local_hash,neighborAffinity:M,ghostPrefixes:d}),H&&n.jsx("div",{className:"pt-2 border-t border-border-subtle",children:n.jsx(ye,{packet:t})})]}),n.jsxs("div",{className:v("hidden overflow-y-auto p-4 space-y-4 overscroll-contain","map"===a?"sm:flex sm:flex-col sm:flex-1":"sm:hidden"),style:{WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[n.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[n.jsxs("div",{className:"glass-card-inner p-3",children:[n.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1",children:"Signal"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(R,{rssi:t.rssi,snr:t.snr}),n.jsx("div",{className:"text-sm",children:n.jsx("span",{className:"font-medium text-text-primary",children:E(t.rssi)})})]})]}),n.jsxs("div",{className:"glass-card-inner p-3",children:[n.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1",children:"RSSI"}),n.jsx("p",{className:"text-lg font-mono text-text-primary",children:null!=t.rssi?`${t.rssi} dBm`:"—"})]}),n.jsxs("div",{className:"glass-card-inner p-3",children:[n.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1",children:"SNR"}),n.jsx("p",{className:"text-lg font-mono text-text-primary",children:null!=t.snr?`${t.snr.toFixed(1)} dB`:"—"})]}),n.jsxs("div",{className:"glass-card-inner p-3",children:[n.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1",children:"Hops"}),n.jsx("p",{className:"text-lg font-mono text-text-primary",children:_.length>0?_.length:"0"})]})]}),n.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[n.jsx(ke,{label:"Route",children:n.jsx("span",{className:v("px-2 py-0.5 rounded text-sm border font-medium",(U=p,{FLOOD:"bg-[var(--route-flood)]/20 text-[var(--route-flood)] border-[var(--route-flood)]/30",DIRECT:"bg-[var(--route-direct)]/20 text-[var(--route-direct)] border-[var(--route-direct)]/30",TRANSPORT:"bg-[var(--route-transport)]/20 text-[var(--route-transport)] border-[var(--route-transport)]/30",T_FLOOD:"bg-[var(--route-flood)]/20 text-[var(--route-flood)] border-[var(--route-flood)]/30",T_DIRECT:"bg-[var(--route-direct)]/20 text-[var(--route-direct)] border-[var(--route-direct)]/30"}[U]||"bg-bg-subtle text-text-muted border-border-subtle")),children:p})}),n.jsx(ke,{label:"Size",children:n.jsxs("span",{className:"font-mono",children:[h,"B"]})}),n.jsx(ke,{label:"TX Delay",children:n.jsxs("span",{className:"font-mono",children:[f.toFixed(1),"ms"]})}),n.jsx(ke,{label:"Status",children:n.jsx("span",{className:se(t),children:te(t)})})]}),k&&_.length>0&&n.jsxs("div",{className:"flex-1 min-h-[280px] glass-card-inner overflow-hidden",children:[n.jsxs("div",{className:"p-3 border-b border-border-subtle/50 flex items-center gap-2",children:[n.jsx(j,{className:"w-4 h-4 text-accent-primary"}),n.jsx("span",{className:"text-sm text-text-secondary font-medium",children:"Path Visualization"})]}),n.jsx("div",{className:"p-3 h-[calc(100%-44px)]",children:n.jsx(pe,{path:_,neighbors:C,localNode:P,localHash:null==r?void 0:r.local_hash,srcHash:t.src_hash,dstHash:t.dst_hash,neighborAffinity:M,hubNodes:[...i]})})]}),(!k||0===_.length)&&n.jsx("div",{className:"flex-1 flex items-center justify-center glass-card-inner",children:n.jsxs("div",{className:"text-center text-text-muted",children:[n.jsx(j,{className:"w-12 h-12 mx-auto mb-2 opacity-30"}),n.jsx("p",{className:"text-sm",children:"No path data available for map visualization"})]})})]}),n.jsxs("div",{className:v("hidden overflow-hidden","analysis"===a?"sm:flex sm:flex-row sm:flex-1":"sm:hidden"),children:[D&&n.jsx("div",{className:"overflow-y-auto p-4 overscroll-contain border-r border-border-subtle/50 w-2/5",style:{WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:n.jsx(Ne,{packet:t,neighbors:C,localHash:null==r?void 0:r.local_hash,neighborAffinity:M,ghostPrefixes:d})}),H&&n.jsx("div",{className:v("overflow-y-auto p-4 overscroll-contain",D?"flex-1":"w-full"),style:{WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:n.jsx(ye,{packet:t})}),!D&&!H&&n.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:n.jsxs("div",{className:"text-center text-text-muted",children:[n.jsx(b,{className:"w-12 h-12 mx-auto mb-2 opacity-30"}),n.jsx("p",{className:"text-sm",children:"No path or raw packet data available"})]})})]})]})]})}),document.body);var U,I});export{re as P,ne as a,Pe as b,Z as c,$ as g};
