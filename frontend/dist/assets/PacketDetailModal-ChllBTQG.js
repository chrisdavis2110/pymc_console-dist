const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PathMapMapLibre-C1DfEqL1.js","assets/vendor-react-CACSLMuM.js","assets/vendor-core-WoOfkQwm.js","assets/BasemapLayer-B0Tjeqyi.js","assets/useThemeColors-Dy5x81kn.js","assets/maplibre-gl-B1CfjdFi.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,s,a)=>((t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a)(t,"symbol"!=typeof s?s+"":s,a);import{r as s,ai as a,aj as n,ae as r,V as l,ad as c,j as i,ak as o,al as d,am as x,an as h,e as p,m,ao as u,ap as y,w as f,aq as g,ar as j,as as b,at as N,au as v,x as w,av as k,aw as C,q as _,a4 as T,n as S,ax as H,b as B,X as P,ay as M}from"./vendor-react-CACSLMuM.js";import{c as U}from"./recharts-NJm5yh08.js";import{B as A,x as L,y as F,z as D,A as E,C as I,E as R,d as z,G as $,c as O,H as V,I as K,J as W}from"./index-CeD0afHn.js";import{D as G,S as q,R as X,P as J,a as Q,g as Y,b as Z}from"./SignalIndicator-DpSs-EbO.js";import{D as ee}from"./DataBox-C86Yoc9A.js";import{_ as te}from"./deckgl-DTsmDcfs.js";const se={rx:{icon:c,label:"RX",badgeColor:G.rx},forward:{icon:l,label:"FWD",badgeColor:G.forward},duplicate:{icon:r,label:"DUPE",badgeColor:G.duplicate},tx:{icon:n,label:"TX",badgeColor:G.tx},dropped:{icon:a,label:"DROP",badgeColor:G.dropped}},ae={sm:"w-3 h-3",md:"w-3.5 h-3.5",lg:"w-4 h-4"};function ne(e){return"tx_local"===e.packet_origin?"tx":"tx_forward"===e.packet_origin?"forward":e.is_duplicate?"duplicate":e.transmitted?"forward":e.drop_reason?"dropped":"rx"}const re=s.memo(function({packet:e,showLabel:t=!0,size:s="sm"}){const a=ne(e),n=se[a],r=n.icon;return i.jsxs(A,{color:n.badgeColor,children:[i.jsx(r,{className:ae[s]}),t&&n.label]})});function le(e){return"tx_local"===e.packet_origin?"Transmitted":"tx_forward"===e.packet_origin||e.transmitted?"Forwarded":e.is_duplicate?"Duplicate":"No transport keys configured"===e.drop_reason?"Monitor Only":e.drop_reason?e.drop_reason:"Received"}function ce(e){return se[ne(e)].badgeColor}function ie(e){const t=e.payload_type_name||E(e.payload_type??e.type),s=e.route_type_name||I(e.route_type??e.route);return{payloadType:t,routeType:s,payloadColor:J[t]??"zinc",routeColor:X[s]??"zinc"}}function oe({packet:e,onClick:t,isFlashing:s=!1,isPending:a}){const{payloadType:n,routeType:r,payloadColor:l,routeColor:c}=ie(e),d="tx_local"===e.packet_origin,x=a??e.isPending;return i.jsxs("tr",{onClick:()=>t(e),className:U("cursor-pointer","hover:bg-bg-subtle",F(e.is_duplicate)&&"opacity-50",s&&"flash-row",x&&"opacity-70 bg-accent-secondary/5",d&&"ring-1 ring-inset ring-accent-primary/60 bg-accent-primary/5"),children:[i.jsx("td",{className:"py-2.5 px-3 whitespace-nowrap",children:i.jsxs("div",{className:"inline-flex items-center gap-1",children:[i.jsx(re,{packet:e,showLabel:!0}),i.jsx("span",{className:"w-3 h-3 inline-flex items-center justify-center",children:x&&i.jsx(o,{className:"w-3 h-3 text-accent-secondary animate-spin"})})]})}),i.jsx("td",{className:"py-2.5 px-3 text-sm font-mono text-text-secondary whitespace-nowrap",children:D(e.timestamp)}),i.jsx("td",{className:"py-2.5 px-3 whitespace-nowrap",children:e.src_hash?i.jsx(ee,{copy:!0,copyValue:e.src_hash_full,size:"compact",children:e.src_hash}):i.jsx("span",{className:"text-sm text-text-muted",children:"—"})}),i.jsx("td",{className:"py-2.5 px-3 whitespace-nowrap",children:i.jsx(A,{color:l,children:n})}),i.jsx("td",{className:"py-2.5 px-3 whitespace-nowrap",children:i.jsx(A,{color:c,children:r})}),i.jsx("td",{className:"py-2.5 px-3 pr-4 whitespace-nowrap",children:i.jsx("div",{className:"flex justify-end",children:i.jsx(q,{rssi:e.rssi,snr:e.snr,compact:!0,showValues:!0})})})]})}const de=s.memo(function(e){return i.jsx(oe,{...e})}),xe=s.memo(function({packet:e,onClick:t,isFlashing:s=!1,isPending:a}){const{payloadType:n,routeType:r,payloadColor:l,routeColor:c}=ie(e),d="tx_local"===e.packet_origin,x=a??e.isPending;return i.jsx("div",{onClick:()=>t(e),className:U("packet-row px-3 py-2.5 cursor-pointer","hover:bg-bg-subtle","active:bg-bg-elevated",F(e.is_duplicate)&&"opacity-50",s&&"flash-row",x&&"opacity-70 bg-accent-secondary/5",d&&"ring-1 ring-inset ring-accent-primary/60 bg-accent-primary/5"),children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1",children:[i.jsx(re,{packet:e,showLabel:!0,size:"sm"}),i.jsx("span",{className:"w-3 h-3 inline-flex items-center justify-center",children:x&&i.jsx(o,{className:"w-3 h-3 text-accent-secondary animate-spin"})})]}),i.jsx("span",{className:"text-[10px] font-mono text-text-muted flex-shrink-0",children:L(e.timestamp)}),i.jsx("div",{className:"flex-shrink-0",children:e.src_hash?i.jsx(ee,{copy:!0,copyValue:e.src_hash_full,size:"compact",children:e.src_hash}):i.jsx("span",{className:"text-[10px] text-text-muted",children:"—"})}),i.jsx("div",{className:"flex-1 min-w-0"}),i.jsx(A,{color:l,className:"flex-shrink-0",children:n}),i.jsx(A,{color:c,className:"flex-shrink-0",children:r}),i.jsx("div",{className:"flex-shrink-0",children:i.jsx(q,{rssi:e.rssi,compact:!0,showValues:!0})})]})})});function he(e){if(e.contact_type){const t=e.contact_type.toLowerCase();if("repeater"===t||"rep"===t)return!0;if("companion"===t||"client"===t||"cli"===t)return!1;if("room server"===t||"room_server"===t||"room"===t||"server"===t)return!1}return!0===e.is_repeater||(e.is_repeater,!1)}const pe=s.lazy(()=>te(()=>import("./PathMapMapLibre-C1DfEqL1.js"),__vite__mapDeps([0,1,2,3,4,5])));function me(e){return`${(100*e).toFixed(0)}%`}function ue(e,t){const s=document.documentElement,a=getComputedStyle(s),n={success:a.getPropertyValue("--accent-success").trim()||"#39D98A",secondary:a.getPropertyValue("--accent-secondary").trim()||"#F9D26F",poor:a.getPropertyValue("--signal-poor").trim()||"#FF8A5C",danger:a.getPropertyValue("--accent-danger").trim()||"#FF5C7A",muted:a.getPropertyValue("--text-muted").trim()||"#767688"};let r;return r=0===t?n.muted:e>=1?n.success:e>=.5?n.secondary:e>=.25?n.poor:e>0?n.danger:n.muted,{color:r}}class ye extends s.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?i.jsxs("div",{className:"h-[200px] flex items-center justify-center text-text-muted",children:[i.jsx(h,{className:"w-4 h-4 mr-2"}),"Map failed to load"]}):this.props.children}}function fe({path:e,neighbors:t,localNode:a,localHash:n,srcHash:r,dstHash:l,neighborAffinity:c,prefixLookup:o,hubNodes:h}){const[p,m]=s.useState(null),u=s.useMemo(()=>{if(!r)return null;const e=z(r),s=t[r];if((null==s?void 0:s.latitude)&&(null==s?void 0:s.longitude)&&(0!==s.latitude||0!==s.longitude))return{prefix:e,candidates:[{hash:r,name:s.node_name||s.name||"Source",latitude:s.latitude,longitude:s.longitude,probability:1,isLocal:!1,isDirectNeighbor:!0===s.zero_hop}],confidence:1,totalMatches:1,isSource:!0};const a=(null==s?void 0:s.node_name)||(null==s?void 0:s.name)||r.slice(0,8);return{prefix:e,candidates:[{hash:r,name:a,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isSource:!0}},[r,t]),y=s.useMemo(()=>{if(!l)return null;const e=z(l);if(n&&l===n&&a){const t=0!==a.latitude||0!==a.longitude;return{prefix:e,candidates:[{hash:l,name:a.name||"Local Node",latitude:t?a.latitude:0,longitude:t?a.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}const s=t[l];if((null==s?void 0:s.latitude)&&(null==s?void 0:s.longitude)&&(0!==s.latitude||0!==s.longitude))return{prefix:e,candidates:[{hash:l,name:s.node_name||s.name||"Destination",latitude:s.latitude,longitude:s.longitude,probability:1,isLocal:!1,isDirectNeighbor:!0===s.zero_hop}],confidence:1,totalMatches:1,isDestination:!0};const r=(null==s?void 0:s.node_name)||(null==s?void 0:s.name)||l.slice(0,8);return{prefix:e,candidates:[{hash:l,name:r,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isDestination:!0}},[l,t,a,n]),f=s.useMemo(()=>function(e,t,s,a,n,r){if(!e||0===e.length)return{hops:[],overallConfidence:0,hasValidPath:!1};const l=e.length-1,c=e.map((c,i)=>{const o=i===l,d=e.length-i,{candidates:x,totalMatches:h}=function(e,t,s,a,n=!1,r,l,c){const i=function(e){const t={};for(const[s,a]of Object.entries(e))he(a)&&(t[s]=a);return t}(t);let o;if(l){const t=function(e,t,s){const a=t.toUpperCase(),n=e.get(a);if(!n||0===n.candidates.length)return{hash:null,confidence:0};if(null==s?void 0:s.isLastHop)return{hash:n.bestMatch,confidence:n.confidence};if(1===(null==s?void 0:s.position))return{hash:n.bestMatch,confidence:n.confidence};if((null==s?void 0:s.position)&&n.bestMatchForPosition.has(s.position)){const e=n.bestMatchForPosition.get(s.position),t=Math.max(e.confidence,n.confidence);return{hash:e.hash,confidence:t}}if((null==s?void 0:s.adjacentPrefixes)&&s.adjacentPrefixes.length>0){let e=n.bestMatch,t=0;for(const a of n.candidates){let n=0;for(const e of s.adjacentPrefixes)n+=a.adjacentPrefixCounts.get(e.toUpperCase())||0;const r=a.combinedScore+n/Math.max(1,a.totalAdjacentObservations)*.3;r>t&&(t=r,e=a.hash)}return{hash:e,confidence:n.confidence}}return{hash:n.bestMatch,confidence:n.confidence}}(l,e,{position:c,isLastHop:n});o=t.confidence}const{matches:d,probability:x}=function(e,t,s,a,n=!1){const r=e.toUpperCase(),l=[],c=s&&R(r,s);c&&l.push(s);for(const p of Object.keys(t))R(r,p)&&l.push(p);if(n&&c&&s&&1===l.length)return{matches:l,probability:1,bestMatch:s};if(n&&c&&l.length>1){const e=l.filter(e=>e!==s);if(1===e.length)return{matches:l,probability:1,bestMatch:e[0]}}const i=l.length>0?1/l.length:0,o=[...l].sort();let d=null,x=-1;if(1===o.length)d=o[0];else if(o.length>1&&a){for(const e of o){const t=a.get(e),s=t?"number"==typeof t?t:t.combinedScore:0;s>x&&(x=s,d=e)}d||(d=o[0])}else o.length>0&&(d=o[0]);let h=i;if(l.length>1&&a&&x>0){let e=0;for(const t of l){const s=a.get(t);e+=s?"number"==typeof s?s:s.combinedScore:0}e>0&&(h=Math.min(.95,x/e))}return{matches:l,probability:h,bestMatch:d}}(e,i,a,r,n),h=d.length,p=[],m=e.toUpperCase(),u=s&&void 0!==s.latitude&&void 0!==s.longitude&&(0!==s.latitude||0!==s.longitude);for(const f of d){if(a&&R(m,a)&&f===a&&u&&s){p.push({hash:f,name:s.name||"Local Node",latitude:s.latitude,longitude:s.longitude,probability:n?1:x,isLocal:!0});continue}const e=i[f];(null==e?void 0:e.latitude)&&(null==e?void 0:e.longitude)&&(0!==e.latitude||0!==e.longitude)&&p.push({hash:f,name:e.node_name||e.name||"Unknown",latitude:e.latitude,longitude:e.longitude,probability:x,isLocal:!1,isDirectNeighbor:!0===e.zero_hop})}const y=p.length;if(1===y)p[0].probability=o??1;else if(y>1)if(void 0!==o&&o>0){p[0].probability=o;const e=1-o,t=y-1;p.slice(1).forEach(s=>{s.probability=e/t})}else{let e=0;const t=p.map(t=>{if(t.isLocal)return{candidate:t,score:1};const a=null==r?void 0:r.get(t.hash);let n=.5;var l;let c;return u&&s&&(n=(l=function(e,t,s,a){const n=(s-e)*Math.PI/180,r=(a-t)*Math.PI/180,l=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3}(s.latitude,s.longitude,t.latitude,t.longitude))<100?1:l<500?.9:l<1e3?.7:l<5e3?.5:l<1e4?.3:.1),a?c=.3*n+.3*a.hopConsistencyScore+.4*a.frequencyScore:(c=n,t.isDirectNeighbor&&(c=Math.max(c,.8))),e+=c,{candidate:t,score:c}});if(e>0)t.forEach(({candidate:t,score:s})=>{t.probability=Math.min(.95,s/e)});else{const e=1/y;p.forEach(t=>t.probability=e)}}return{candidates:p,totalMatches:h}}(c,t,s,a,o,n,r,d),p=x.length>0?Math.max(...x.map(e=>e.probability)):0;return{prefix:c,candidates:x,confidence:p,totalMatches:h}}),i=c.reduce((e,t)=>0===t.confidence?0:e*t.confidence,1),o=c.some(e=>e.candidates.length>0);return{hops:c,overallConfidence:i,hasValidPath:o}}(e,t,a,n,c,o),[e,t,a,n,c,o]),g=s.useMemo(()=>{const e=[];u&&e.push(u),e.push(...f.hops),y&&e.push(y);const t=e.reduce((e,t)=>0===t.confidence?0:e*t.confidence,1),s=e.some(e=>e.candidates.some(e=>0!==e.latitude||0!==e.longitude));return{hops:e,overallConfidence:t,hasValidPath:s}},[u,f,y]);return g.hasValidPath?i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center justify-between text-xs",children:[i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx("span",{className:"text-text-muted",children:"Path Confidence:"}),i.jsx("span",{className:(j=g.overallConfidence,j>=1?"text-accent-success":j>=.5?"text-accent-secondary":j>=.25?"text-signal-poor":j>0?"text-accent-danger":"text-text-muted"),children:me(g.overallConfidence)}),i.jsx("button",{className:"text-text-muted hover:text-text-secondary transition-colors",title:"Confidence is calculated based on how many known nodes match each path prefix. Multiple matches reduce confidence due to collision probability.",children:i.jsx(x,{className:"w-3 h-3"})})]}),i.jsxs("div",{className:"flex items-center gap-2 text-[10px]",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("div",{className:"w-2 h-2 rounded-full bg-accent-success"}),i.jsx("span",{className:"text-text-muted",children:"Exact"})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("div",{className:"w-2 h-2 rounded-full bg-accent-secondary"}),i.jsx("span",{className:"text-text-muted",children:"Multi"})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("div",{className:"w-2 h-2 rounded-full bg-text-muted"}),i.jsx("span",{className:"text-text-muted",children:"Unknown"})]})]})]}),i.jsx("div",{className:"rounded-lg overflow-hidden border border-border-subtle",children:i.jsx(ye,{children:i.jsx(s.Suspense,{fallback:i.jsx("div",{className:"h-[200px] bg-bg-elevated flex items-center justify-center text-text-muted text-sm",children:"Loading map..."}),children:i.jsx(pe,{resolvedPath:g,localNode:a,hubNodes:h,hoveredHopIndex:p,onHoverHop:m})})})}),i.jsx("div",{className:"flex flex-wrap items-center gap-1.5",children:g.hops.map((e,t)=>{var s,a,n;const r=!0===e.isSource,l=!0===e.isDestination,c=p===t;let o;return o=r?`Source: ${(null==(s=e.candidates[0])?void 0:s.name)||"Unknown"}`:l?`Destination: ${(null==(a=e.candidates[0])?void 0:a.name)||"Unknown"}`:0===e.totalMatches?"No matching nodes found":1===e.totalMatches?`Exact match: ${(null==(n=e.candidates[0])?void 0:n.name)||"Unknown"}`:`${e.totalMatches} possible matches (${(100*e.confidence).toFixed(0)}% confidence)`,i.jsxs("div",{className:U("flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-mono cursor-pointer transition-all",c?"bg-accent-primary/20 ring-1 ring-accent-primary/50":"bg-bg-elevated hover:bg-bg-subtle",r&&"border border-accent-success/30",l&&"border border-accent-primary/30"),title:o,onMouseEnter:()=>m(t),onMouseLeave:()=>m(null),children:[r&&i.jsx("span",{className:"text-accent-success text-[8px] mr-0.5",children:"SRC"}),l&&i.jsx("span",{className:"text-accent-primary text-[8px] mr-0.5",children:"DST"}),i.jsx("span",{style:ue(e.confidence,e.totalMatches),children:e.prefix}),!r&&!l&&e.totalMatches>1&&i.jsxs("span",{className:"text-text-muted",children:["×",e.totalMatches]}),!r&&!l&&0===e.totalMatches&&i.jsx("span",{className:"text-text-muted",children:"?"})]},t)})})]}):i.jsxs("div",{className:"flex items-center justify-center text-text-muted text-xs py-4",children:[i.jsx(d,{className:"w-3.5 h-3.5 mr-1.5 opacity-50"}),"No location data available for path nodes"]});var j}const ge=0,je=1,be=2,Ne=3,ve={[ge]:"T_FLOOD",[je]:"FLOOD",[be]:"DIRECT",[Ne]:"T_DIRECT"},we=0,ke=1,Ce=2,_e=3,Te=4,Se=5,He=6,Be=7,Pe=8,Me=9,Ue=10,Ae=11,Le=15,Fe={[we]:"REQ",[ke]:"RESPONSE",[Ce]:"TXT_MSG",[_e]:"ACK",[Te]:"ADVERT",[Se]:"GRP_TXT",[He]:"GRP_DATA",[Be]:"ANON_REQ",[Pe]:"PATH",[Me]:"TRACE",[Ue]:"MULTIPART",[Ae]:"CONTROL",[Le]:"RAW_CUSTOM"};function De(e){return ve[e]??`UNKNOWN(${e})`}function Ee(e){return Fe[e]??`UNKNOWN(${e})`}function Ie(e){const t=e.replace(/^0x/i,"").replace(/\s/g,"");if(t.length%2!=0)throw new Error("Invalid hex string: odd number of characters");const s=new Uint8Array(t.length/2);for(let a=0;a<s.length;a++){const e=parseInt(t.substr(2*a,2),16);if(isNaN(e))throw new Error("Invalid hex character at position "+2*a);s[a]=e}return s}function Re(e,t=!0,s=!1){let a=Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join("");return t&&(a=a.toUpperCase()),s&&(a="0x"+a),a}function ze(e,t=!0){const s=(255&e).toString(16).padStart(2,"0");return t?s.toUpperCase():s}function $e(e,t,s,a){if(e+t>s)throw new Error(a)}function Oe(e){if(e>256)throw new Error(`payload too large: ${e} > 256`)}async function Ve(e){const t=new ArrayBuffer(e.length);new Uint8Array(t).set(e);const s=await crypto.subtle.digest("SHA-256",t);return new Uint8Array(s)}async function Ke(e,t){const s=new ArrayBuffer(e.length);new Uint8Array(s).set(e);const a=new ArrayBuffer(t.length);new Uint8Array(a).set(t);const n=await crypto.subtle.importKey("raw",s,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),r=await crypto.subtle.sign("HMAC",n,a);return new Uint8Array(r)}const We=new Uint8Array([99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22]),Ge=new Uint8Array([82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125]),qe=new Uint8Array([1,2,4,8,16,32,64,128,27,54]);function Xe(e,t){let s=0;for(let a=0;a<8;a++){1&t&&(s^=e);const a=128&e;e=e<<1&255,a&&(e^=27),t>>=1}return s}function Je(e){let t=e[13];e[13]=e[9],e[9]=e[5],e[5]=e[1],e[1]=t,t=e[2],e[2]=e[10],e[10]=t,t=e[6],e[6]=e[14],e[14]=t,t=e[3],e[3]=e[7],e[7]=e[11],e[11]=e[15],e[15]=t}function Qe(e){for(let t=0;t<16;t++)e[t]=Ge[e[t]]}function Ye(e,t){for(let s=0;s<16;s++)e[s]^=t[s]}function Ze(e){for(let t=0;t<4;t++){const s=4*t,a=e[s],n=e[s+1],r=e[s+2],l=e[s+3];e[s]=Xe(14,a)^Xe(11,n)^Xe(13,r)^Xe(9,l),e[s+1]=Xe(9,a)^Xe(14,n)^Xe(11,r)^Xe(13,l),e[s+2]=Xe(13,a)^Xe(9,n)^Xe(14,r)^Xe(11,l),e[s+3]=Xe(11,a)^Xe(13,n)^Xe(9,r)^Xe(14,l)}}function et(e,t){const s=new Uint8Array(e);Ye(s,t[10]);for(let a=9;a>=1;a--)Je(s),Qe(s),Ye(s,t[a]),Ze(s);return Je(s),Qe(s),Ye(s,t[0]),s}function tt(e,t){const s=function(e){const t=[],s=new Uint8Array(176);s.set(e.slice(0,16));for(let a=16;a<176;a+=4){let e=s[a-4],t=s[a-3],n=s[a-2],r=s[a-1];if(a%16==0){const s=e;e=We[t]^qe[a/16-1],t=We[n],n=We[r],r=We[s]}s[a]=s[a-16]^e,s[a+1]=s[a-15]^t,s[a+2]=s[a-14]^n,s[a+3]=s[a-13]^r}for(let a=0;a<11;a++)t.push(s.slice(16*a,16*(a+1)));return t}(e),a=new Uint8Array(t.length);for(let n=0;n<t.length;n+=16){const e=t.slice(n,Math.min(n+16,t.length)),r=new Uint8Array(16);r.set(e);const l=et(r,s);a.set(l.slice(0,e.length),n)}return a}async function st(e,t,s){const a=[e];9===e&&a.push(t);const n=new Uint8Array(a.length+s.length);return n.set(a),n.set(s,a.length),(await Ve(n)).slice(0,32)}async function at(e,t,s,a){const n=Re(await st(e,t,s),!0);return void 0!==a?n.slice(0,a):n}async function nt(e,t,s){const a=await st(e,t,s);return(a[0]|a[1]<<8|a[2]<<16|a[3]<<24)>>>0}function rt(e,t){return e[t]|e[t+1]<<8}function lt(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function ct(e,t,s){t[s]=255&e,t[s+1]=e>>8&255}function it(e,t){const s=e[t];return s>127?s-256:s}function ot(e){return(e instanceof Uint8Array?Array.from(e):e).map(e=>ze(e,!0)).join("->")}const dt=Object.freeze(Object.defineProperty({__proto__:null,aesDecryptEcb:tt,byteToHex:ze,bytesToHex:Re,calculatePacketCRC:nt,calculatePacketHash:st,calculatePacketHashString:at,decryptChannelMessage:async function(e,t,s,a){const n=await Ke(e,a);return s[0]!==n[0]||s[1]!==n[1]?null:tt(t,a)},formatPathString:ot,hexToBytes:Ie,hmacSha256:Ke,readInt8:it,readUint16LE:rt,readUint32LE:lt,sha256:Ve,validatePacketBounds:$e,validatePayloadSize:Oe,writeUint16LE:ct},Symbol.toStringTag,{value:"Module"}));class xt{constructor(){t(this,"header",0),t(this,"transportCodes",[0,0]),t(this,"pathLen",0),t(this,"path",new Uint8Array(0)),t(this,"payload",new Uint8Array(0)),t(this,"decrypted",{}),t(this,"_rssi",0),t(this,"_snr",0)}static fromBytes(e){const t=new xt;try{return t.readFrom(e),{success:!0,packet:t}}catch(s){return{success:!1,error:s instanceof Error?s.message:String(s)}}}static fromHex(e){try{const t=Ie(e);return xt.fromBytes(t)}catch(t){return{success:!1,error:t instanceof Error?t.message:String(t)}}}get routeType(){return 3&this.header}get routeTypeName(){return ve[this.routeType]??`UNKNOWN(${this.routeType})`}get payloadType(){return this.header>>2&15}get payloadTypeName(){return Fe[this.payloadType]??`UNKNOWN(${this.payloadType})`}get payloadVersion(){return this.header>>6&3}hasTransportCodes(){return 0===(e=this.routeType)||3===e;var e}isFlood(){return 1===(e=this.routeType)||0===e;var e}isDirect(){return 2===(e=this.routeType)||3===e;var e}get pathBytes(){return Array.from(this.path)}get pathString(){return ot(this.path)}get pathHexArray(){return Array.from(this.path).map(e=>ze(e,!0))}get payloadLen(){return this.payload.length}get payloadHex(){return Re(this.payload,!0)}getPayloadAppData(){return this.payload.length>=100?this.payload.slice(100):new Uint8Array(0)}get rssi(){return this._rssi}set rssi(e){this._rssi=e}get snr(){return this._snr}set snr(e){this._snr=e}readFrom(e){let t=0;const s=e.length;$e(t,1,s,"Missing header byte"),this.header=e[t++];const a=this.payloadVersion;if(a>1)throw new Error(`Unsupported packet version: ${a}`);if(this.hasTransportCodes()?($e(t,4,s,"Missing transport codes"),this.transportCodes=[rt(e,t),rt(e,t+2)],t+=4):this.transportCodes=[0,0],$e(t,1,s,"Missing path_len"),this.pathLen=e[t++],this.pathLen>64)throw new Error(`path_len too large: ${this.pathLen} > 64`);return $e(t,this.pathLen,s,"Truncated path"),this.path=e.slice(t,t+this.pathLen),t+=this.pathLen,this.payload=e.slice(t),Oe(this.payload.length),!0}writeTo(){let e=1;this.hasTransportCodes()&&(e+=4),e+=1,e+=this.path.length,e+=this.payload.length;const t=new Uint8Array(e);let s=0;return t[s++]=this.header,this.hasTransportCodes()&&(ct(this.transportCodes[0],t,s),ct(this.transportCodes[1],t,s+2),s+=4),t[s++]=this.path.length,t.set(this.path,s),s+=this.path.length,t.set(this.payload,s),t}toHex(){return Re(this.writeTo(),!0)}async calculateHash(){return st(this.payloadType,this.pathLen,this.payload)}async calculateHashString(e){return at(this.payloadType,this.pathLen,this.payload,e)}async calculateCRC(){return nt(this.payloadType,this.pathLen,this.payload)}getRawLength(){let e=2+this.pathLen+this.payload.length;return this.hasTransportCodes()&&(e+=4),e}getSummary(){return{header:ze(this.header,!0),routeType:this.routeTypeName,payloadType:this.payloadTypeName,version:this.payloadVersion,pathLen:this.pathLen,pathStr:this.pathString,transportCodes:this.hasTransportCodes()?[this.transportCodes[0].toString(16).toUpperCase().padStart(4,"0"),this.transportCodes[1].toString(16).toUpperCase().padStart(4,"0")]:null,payloadLen:this.payload.length,payloadHex:this.payloadHex,rawLength:this.getRawLength()}}toString(){const e=[`[${this.routeTypeName}/${this.payloadTypeName} v${this.payloadVersion}]`,`path=${this.pathString||"(empty)"}`,`payload=${this.payload.length}B`];return this.hasTransportCodes()&&e.push(`transport=[${this.transportCodes[0]},${this.transportCodes[1]}]`),e.join(" ")}}function ht(e,t,s){return{type:"generic",payloadType:t,payloadTypeName:s,rawHex:Re(e),length:e.length}}function pt(e){if(!e||e.length<4)return null;const t=xt.fromHex(e);if(!t.success||!t.packet)return null;const s=t.packet,a=function(e){const t=3&e,s=e>>2&15,a=e>>6&3;return[{bits:"0-1",field:"Route Type",value:De(t),binary:(3&t).toString(2).padStart(2,"0")},{bits:"2-5",field:"Payload Type",value:Ee(s),binary:(15&s).toString(2).padStart(4,"0")},{bits:"6-7",field:"Version",value:a.toString(),binary:(3&a).toString(2).padStart(2,"0")}]}(s.header),n=e.slice(0,2);let r=2,l="";s.hasTransportCodes()&&(l=e.slice(2,10),r=10);const c=e.slice(r,r+2),i=r+2,o=i+2*s.pathLen,d=e.slice(i,o),x=e.slice(o),h=function(e){const{payload:t,payloadType:s,payloadTypeName:a}=e;switch(s){case 4:return function(e){if(e.length<101)return null;let t=0;const s=Re(e.slice(t,t+32));t+=32;const a=lt(e,t);t+=4;const n=Re(e.slice(t,t+64));t+=64;const r=e[t++],l=function(e){const t=[];switch(15&e){case 1:t.push("is chat node");break;case 2:t.push("is repeater");break;case 3:t.push("is room server");break;case 4:t.push("is sensor")}return 16&e&&t.push("has location"),32&e&&t.push("has feature 1"),64&e&&t.push("has feature 2"),128&e&&t.push("has name"),t.join(", ")||"none"}(r);let c="unknown";switch(15&r){case 1:c="chat";break;case 2:c="repeater";break;case 3:c="room_server";break;case 4:c="sensor"}const i={type:"advert",publicKey:s,timestamp:a,signature:n,flags:r,flagsDescription:l,nodeType:c,rawAppData:Re(e.slice(100))};if(16&r&&t+8<=e.length){const s=e.slice(t,t+8),a=new ArrayBuffer(8);new Uint8Array(a).set(s);const n=new DataView(a),r=n.getInt32(0,!0),l=n.getInt32(4,!0);i.latitude=r/1e6,i.longitude=l/1e6,t+=8}if(128&r&&t<e.length){let s=t;for(;s<e.length&&0!==e[s];)s++;s>t&&(i.name=(new TextDecoder).decode(e.slice(t,s)))}return i}(t)??ht(t,s,a);case 3:return function(e){if(e.length<4)return null;const t=lt(e,0);return{type:"ack",crc:t.toString(16).toUpperCase().padStart(8,"0"),crcValue:t}}(t)??ht(t,s,a);case 8:return function(e){if(0===e.length)return{type:"path",path:[],pathString:""};const t=Array.from(e).map(e=>ze(e,!0)),s=t.join("->");return{type:"path",path:t,pathString:s}}(t)??ht(t,s,a);case 9:return function(e){if(0===e.length)return{type:"trace",targetHash:"",path:[],pathString:"",snrValues:[]};const t=[],s=[];for(let a=0;a<e.length;a+=2)t.push(ze(e[a],!0)),a+1<e.length&&s.push(it(e,a+1));return{type:"trace",targetHash:t.length>0?t[0]:"",path:t,pathString:t.join("->"),snrValues:s}}(t)??ht(t,s,a);case 2:return function(e){if(e.length<2)return null;const t=ze(e[0],!0),s=ze(e[1],!0),a=e.slice(2);let n="",r=!0;try{const e=new TextDecoder("utf-8",{fatal:!0}).decode(a);/^[\x20-\x7E\u00A0-\uFFFF\n\r\t]*$/.test(e)&&(n=e,r=!1)}catch{}return r&&(n=Re(a)),{type:"txt_msg",destHash:t,srcHash:s,timestamp:0,text:n,encrypted:r}}(t)??ht(t,s,a);case 5:return function(e){if(e.length<4)return null;const t=ze(e[0],!0),s=e.slice(1,3),a=e.slice(3);return{type:"grp_txt",channelHash:t,text:Re(a),decrypted:!1,ciphertextHex:Re(a),macHex:Re(s)}}(t)??ht(t,s,a);case 6:return function(e){if(e.length<4)return null;const t=ze(e[0],!0),s=e.slice(1,3),a=e.slice(3);return{type:"grp_data",channelHash:t,dataHex:Re(a),dataLength:a.length,decrypted:!1,macHex:Re(s)}}(t)??ht(t,s,a);case 10:return function(e){return e.length<4?null:{type:"multipart",messageId:Re(e.slice(0,2)),partNumber:e[2],totalParts:e[3],partData:Re(e.slice(4))}}(t)??ht(t,s,a);default:return ht(t,s,a)}}(s);return{packet:s,headerHex:n,headerFields:a,transportCodesHex:l,pathLengthHex:c,pathDataHex:d,payloadHex:x,payloadStartByte:Math.floor(o/2),decoded:h}}const mt=[{name:"Public",secret:"8b3387e9c5cdea6ac9e5edbaa115cd72"},{name:"#Test",secret:"9cd8fcf22a47333b591d96a2b848b73f"},{name:"#Wardrive",secret:"4076c315c1ef385fa93f066027320fe5"}];async function ut(e){const t=function(e){const t=new Uint8Array(e.length/2);for(let s=0;s<t.length;s++)t[s]=parseInt(e.substr(2*s,2),16);return t}(e.secret),s=(await Ve(t))[0];let a;t.length<32?(a=new Uint8Array(32),a.set(t)):a=t.length>32?t.slice(0,32):t;const n=a.slice(0,16),r=a;return{name:e.name,channelHash:s,aesKey:n,hmacKey:r}}let yt=null,ft=null;async function gt(){yt||(ft||(ft=async function(){if(!yt){yt=new Map;for(const t of mt)try{const e=await ut(t);yt.set(e.channelHash,e)}catch(e){}}}()),await ft)}gt().catch(e=>{});const jt=Object.freeze(Object.defineProperty({__proto__:null,getChannelKeys:async function(e){return await gt(),(null==yt?void 0:yt.get(e))??null}},Symbol.toStringTag,{value:"Module"}));function bt(e){return e.match(/.{1,2}/g)||[]}function Nt(e){return null!==e&&e.startsWith("payload:")}const vt={red:"var(--sys-red)",orange:"var(--sys-orange)",amber:"var(--sys-amber)",yellow:"var(--sys-yellow)",lime:"var(--sys-green)",green:"var(--sys-green)",emerald:"var(--sys-green)",teal:"var(--sys-teal)",cyan:"var(--sys-cyan)",sky:"var(--sys-cyan)",blue:"var(--sys-blue)",indigo:"var(--sys-indigo)",violet:"var(--sys-indigo)",purple:"var(--sys-purple)",fuchsia:"var(--sys-pink)",pink:"var(--sys-pink)",rose:"var(--sys-red)",brown:"var(--sys-brown)",zinc:"var(--text-muted)"};function wt({segments:e,selectedSegment:t,onSegmentClick:a}){const[n,r]=s.useState(null),[l,c]=s.useState(null),o=e.some(e=>void 0!==e.id)&&a,d=[];for(const s of e){const e=bt(s.hex);for(const t of e)d.push({byte:t.toUpperCase(),color:s.color,id:s.id})}const x=[];for(let s=0;s<d.length;s+=16)x.push(d.slice(s,s+16));return i.jsx("div",{className:"space-y-1",children:x.map((e,s)=>{const d=e.length<16;return i.jsx("div",{className:"grid rounded-md overflow-hidden",style:{gridTemplateColumns:"repeat(16, minmax(0, 1fr))"},children:e.map(({byte:s,color:x,id:h},p)=>{const m=p===e.length-1,u=d&&m,y=vt[x],f=(h?n===h:l===x)||h&&t===h;return i.jsx("span",{className:"text-xs text-center px-1.5 py-0.5 font-mono font-medium select-none "+(o?"cursor-pointer":""),style:{backgroundColor:f?y:`color-mix(in srgb, ${y} 15%, transparent)`,color:f?"rgba(255,255,255,0.95)":y,transition:f?"none":"background-color 0.15s ease-out, color 0.15s ease-out",...u?{borderRadius:"0 0.375rem 0.375rem 0"}:{}},onMouseEnter:()=>{h?r(h):c(x)},onMouseLeave:()=>{r(null),c(null)},onClick:()=>h&&(null==a?void 0:a(h)),onTouchStart:()=>{h?r(h):c(x)},onTouchEnd:()=>{r(null),c(null)},children:s},p)})},s)})})}function kt({bits:e,field:t,value:s,binary:a}){return i.jsxs("tr",{children:[i.jsx("td",{className:"py-1.5 text-xs text-text-muted tabular-nums",children:e}),i.jsx("td",{className:"py-1.5 text-sm text-text-secondary",children:t}),i.jsx("td",{className:"py-1.5",children:(()=>{if("Payload Type"===t){const e=J[s]||"zinc";return i.jsx(A,{color:e,children:s})}if("Route Type"===t){const e=X[s]||"zinc";return i.jsx(A,{color:e,children:s})}return i.jsx("span",{className:"text-sm text-text-primary",children:s})})()}),i.jsx("td",{className:"py-1.5 font-mono text-xs text-sys-cyan",children:a})]})}function Ct({id:e,title:t,color:s,hexBytes:a,startByte:n,endByte:r,isSelected:l,children:c,customLayoutId:o}){const d=a?bt(a):[],x=vt[s];return i.jsxs(m.div,{layout:!0,layoutId:o??`section-${e}`,className:"rounded-2xl p-6 space-y-4 relative",style:{backgroundColor:l?`color-mix(in srgb, ${x} 8%, transparent)`:void 0,boxShadow:l?`inset 0 0 0 2px ${x}`:void 0},initial:!1,transition:{layout:{type:"spring",stiffness:500,damping:35}},children:[!l&&i.jsx("div",{className:"absolute inset-0 rounded-2xl bg-black/[0.03] dark:bg-white/[0.03] pointer-events-none"}),i.jsxs("div",{className:"flex items-start justify-between gap-4 relative",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-0.5",children:[i.jsx(A,{color:s,children:t}),d.length>0&&d.length<=16&&d.map((e,t)=>i.jsx(A,{color:s,className:"font-mono",children:e.toUpperCase()},t))]}),i.jsxs("span",{className:"text-[10px] text-text-muted font-mono flex-shrink-0",children:["Bytes ",n,"-",r]})]}),i.jsx("div",{className:"relative",children:c})]})}function _t({advert:e,timestamp:t}){const s=$(t||e.timestamp);return i.jsx("div",{className:"mb-4",children:i.jsxs("div",{className:"rounded-2xl overflow-hidden bg-purple-500/10 dark:bg-purple-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[i.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-purple) 0%, var(--sys-blue) 100%)"},children:i.jsx(w,{className:"w-6 h-6 text-white"})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:e.name||"Unknown Node"}),i.jsx("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:e.nodeType})]})]}),i.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),i.jsxs("div",{className:"px-4 py-3 space-y-2",children:[void 0!==e.latitude&&void 0!==e.longitude&&i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(d,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 flex-shrink-0"}),i.jsxs("span",{className:"text-sm text-text-secondary font-mono",children:[e.latitude.toFixed(5),"°, ",e.longitude.toFixed(5),"°"]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(f,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 flex-shrink-0"}),i.jsx("span",{className:"text-sm text-text-secondary font-sans",children:s})]})]})]})})}function Tt({decoded:e,timestamp:t}){const s=t?$(t):"Unknown";return i.jsx("div",{className:"mb-4",children:i.jsxs("div",{className:"rounded-2xl overflow-hidden bg-teal-500/10 dark:bg-teal-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[i.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-teal) 0%, var(--sys-cyan) 100%)"},children:i.jsx(v,{className:"w-6 h-6 text-white"})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:e.channelName||"Channel Data"}),i.jsxs("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:[e.dataLength," bytes • ",e.decrypted?"Decrypted":"Encrypted"]})]})]}),i.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),i.jsxs("div",{className:"px-4 py-3 space-y-2",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(y,{className:"w-4 h-4 text-teal-600 dark:text-teal-400 flex-shrink-0"}),i.jsxs("span",{className:"text-sm text-text-secondary font-sans",children:["Channel: ",i.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(f,{className:"w-4 h-4 text-teal-600 dark:text-teal-400 flex-shrink-0"}),i.jsx("span",{className:"text-sm text-text-secondary font-sans",children:s})]}),e.decrypted&&e.decryptedHex&&i.jsxs("div",{className:"mt-2 pt-2 border-t border-black/10 dark:border-white/10",children:[i.jsx("p",{className:"text-[10px] uppercase tracking-wide text-text-muted mb-1 font-sans",children:"Decrypted Data"}),i.jsx("div",{className:"max-w-full overflow-x-auto",children:i.jsx(ee,{size:"compact",copy:!0,className:"inline-block",children:i.jsx("span",{className:"break-all text-xs",children:e.decryptedHex.toUpperCase()})})})]})]})]})})}function St({decoded:e}){return e.decrypted?i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.senderName&&i.jsxs("span",{className:"text-[11px] text-text-muted font-sans",children:["From ",i.jsx("span",{className:"text-text-secondary font-medium",children:e.senderName})]}),e.channelName&&i.jsxs("span",{className:"text-[11px] text-text-muted font-sans",children:["in ",i.jsx("span",{className:"text-sys-cyan font-medium",children:e.channelName})]})]}),i.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tl-md",style:{background:"linear-gradient(135deg, var(--sys-blue) 0%, color-mix(in srgb, var(--sys-blue) 85%, var(--sys-cyan)) 100%)"},children:i.jsx("p",{className:"text-sm text-white font-sans leading-relaxed whitespace-pre-wrap break-words",children:e.text})})]}):null}function Ht({decoded:e,timestamp:t}){const s=t?$(t):"Unknown";return i.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:"linear-gradient(135deg, var(--sys-green) 0%, var(--sys-teal) 100%)"},children:i.jsx(N,{className:"w-5 h-5 text-white"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-semibold text-text-primary font-sans",children:"Acknowledgment"}),i.jsxs("p",{className:"text-xs text-text-muted font-sans mt-0.5",children:["CRC: ",i.jsxs("span",{className:"font-mono text-sys-green",children:["0x",e.crc]})," · ",s]})]})]})}function Bt({decoded:e,timestamp:t}){const s=t?$(t):"Unknown",a=e.path.length;return i.jsx("div",{className:"mb-4",children:i.jsxs("div",{className:"rounded-2xl overflow-hidden bg-amber-500/10 dark:bg-amber-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[i.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-amber) 0%, var(--sys-orange) 100%)"},children:i.jsx(b,{className:"w-6 h-6 text-white"})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:"Path Response"}),i.jsxs("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:[a," ",1===a?"hop":"hops"]})]})]}),i.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),i.jsxs("div",{className:"px-4 py-3 space-y-2",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(f,{className:"w-4 h-4 text-amber-600 dark:text-amber-400 flex-shrink-0"}),i.jsx("span",{className:"text-sm text-text-secondary font-sans",children:s})]}),e.path.length>0&&i.jsx("div",{className:"mt-2 pt-2 border-t border-black/10 dark:border-white/10",children:i.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.path.map((e,t)=>i.jsxs("div",{className:"flex items-center gap-2",children:[t>0&&i.jsx(l,{className:"w-4 h-4 text-amber-500 dark:text-amber-400"}),i.jsx(A,{color:"amber",className:"font-mono",children:e})]},t))})})]})]})})}function Pt({decoded:e,timestamp:t}){const s=t?$(t):"Unknown",a=e.path.length;return i.jsx("div",{className:"mb-4",children:i.jsxs("div",{className:"rounded-2xl overflow-hidden bg-blue-500/10 dark:bg-blue-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[i.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-blue) 0%, var(--sys-indigo) 100%)"},children:i.jsx(j,{className:"w-6 h-6 text-white"})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("h3",{className:"text-lg font-medium text-text-primary truncate leading-tight",children:"Trace Response"}),i.jsxs("p",{className:"text-sm text-text-muted mt-0.5",children:[a," ",1===a?"hop":"hops"," with SNR"]})]})]}),i.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),i.jsxs("div",{className:"px-4 py-3 space-y-3",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(f,{className:"w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0"}),i.jsx("span",{className:"text-sm text-text-secondary",children:s})]}),e.path.length>0&&i.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.path.map((t,s)=>{const a=e.snrValues[s],n=void 0!==a?(e=>e>=7?"green":e>=0?"yellow":e>=-7?"orange":"red")(a):"blue";return i.jsxs("div",{className:"flex items-center gap-2",children:[s>0&&i.jsx(l,{className:"w-4 h-4 text-blue-500 dark:text-blue-400 flex-shrink-0"}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(A,{color:"blue",className:"font-mono",children:t}),void 0!==a&&i.jsxs(A,{color:n,className:"font-mono",children:[a>=0?"+":"",a,"dB"]})]})]},s)})})]})]})})}function Mt({decoded:e,timestamp:t}){const s=t?$(t):"Unknown";return e.encrypted?i.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:"linear-gradient(135deg, var(--sys-purple) 0%, var(--sys-indigo) 100%)"},children:i.jsx(g,{className:"w-5 h-5 text-white"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-semibold text-text-primary font-sans",children:"Encrypted Message"}),i.jsxs("p",{className:"text-xs text-text-muted font-sans mt-0.5",children:[e.srcHash," → ",e.destHash," · ",s]})]})]}):i.jsxs("div",{className:"mb-4",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1.5 px-1",children:[i.jsxs("span",{className:"text-[11px] text-text-muted font-sans",children:[i.jsx("span",{className:"font-mono text-text-secondary",children:e.srcHash})," → ",i.jsx("span",{className:"font-mono text-text-secondary",children:e.destHash})]}),i.jsxs("span",{className:"text-[11px] text-text-muted font-sans",children:["· ",s]})]}),i.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tr-md ml-auto",style:{background:"linear-gradient(135deg, var(--sys-green) 0%, var(--sys-teal) 100%)"},children:i.jsx("p",{className:"text-sm text-white font-sans leading-relaxed whitespace-pre-wrap break-words",children:e.text})})]})}function Ut({decoded:e,timestamp:t}){const s=t?$(t):"Unknown",a=(e.partNumber+1)/e.totalParts*100;return i.jsx("div",{className:"mb-4",children:i.jsxs("div",{className:"rounded-2xl overflow-hidden bg-yellow-500/10 dark:bg-yellow-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[i.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-yellow) 0%, var(--sys-amber) 100%)"},children:i.jsx(u,{className:"w-6 h-6 text-white"})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:"Multipart Segment"}),i.jsxs("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:["Part ",e.partNumber+1," of ",e.totalParts]})]})]}),i.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),i.jsxs("div",{className:"px-4 py-3 space-y-3",children:[i.jsx("div",{children:i.jsx("div",{className:"h-2 bg-black/10 dark:bg-white/10 rounded-full overflow-hidden",children:i.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${a}%`,background:"linear-gradient(90deg, var(--sys-yellow), var(--sys-amber))"}})})}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(y,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400 flex-shrink-0"}),i.jsxs("span",{className:"text-sm text-text-secondary font-sans",children:["Message ID: ",i.jsx("span",{className:"font-mono",children:e.messageId})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(f,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400 flex-shrink-0"}),i.jsx("span",{className:"text-sm text-text-secondary font-sans",children:s})]})]})]})})}function At({decoded:e,timestamp:t,payloadType:s}){const a=t?$(t):"Unknown",n=(()=>{switch(s){case 0:return{icon:_,gradient:"var(--sys-orange), var(--sys-red)",bg:"rgba(249, 115, 22, 0.15)",label:"Request"};case 1:return{icon:C,gradient:"var(--sys-green), var(--sys-teal)",bg:"rgba(34, 197, 94, 0.15)",label:"Response"};case 7:return{icon:g,gradient:"var(--sys-purple), var(--sys-pink)",bg:"rgba(168, 85, 247, 0.15)",label:"Anonymous Request"};default:return{icon:k,gradient:"var(--sys-gray), var(--sys-slate)",bg:"rgba(107, 114, 128, 0.15)",label:e.payloadTypeName}}})(),r=n.icon;return i.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:`linear-gradient(135deg, ${n.gradient})`},children:i.jsx(r,{className:"w-5 h-5 text-white"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-semibold text-text-primary font-sans",children:n.label}),i.jsxs("p",{className:"text-xs text-text-muted font-sans mt-0.5",children:[e.length," bytes · ",a]})]})]})}function Lt({pathHex:e}){if(!e)return null;const t=bt(e);return i.jsx("div",{className:"flex flex-wrap items-center gap-2 py-2",children:t.map((e,t)=>i.jsxs("div",{className:"flex items-center gap-2",children:[t>0&&i.jsx(l,{className:"w-4 h-4 text-sys-amber flex-shrink-0"}),i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx(ee,{size:"compact",copy:!0,children:e.toUpperCase()}),i.jsx("span",{className:"text-[10px] text-text-muted font-sans tabular-nums w-4 text-left",children:t+1})]})]},t))})}function Ft({decoded:e,payloadType:t}){var s;const a=Fe[t]||`TYPE_${t}`;switch(e.type){case"advert":return i.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[i.jsxs("p",{children:[i.jsx("span",{className:"text-text-muted",children:"Type:"})," ",e.nodeType]}),e.name&&i.jsxs("p",{children:[i.jsx("span",{className:"text-text-muted",children:"Name:"})," ",e.name]}),void 0!==e.latitude&&i.jsxs("p",{children:[i.jsx("span",{className:"text-text-muted",children:"Location:"})," ",e.latitude.toFixed(4),"°, ",null==(s=e.longitude)?void 0:s.toFixed(4),"°"]}),i.jsxs("p",{children:[i.jsx("span",{className:"text-text-muted",children:"Time:"})," ",$(e.timestamp)]}),i.jsxs("p",{children:[i.jsx("span",{className:"text-text-muted",children:"Flags:"})," ",e.flagsDescription]})]});case"ack":return i.jsx("div",{className:"text-xs text-text-primary space-y-0.5",children:i.jsxs("p",{children:[i.jsx("span",{className:"text-text-muted",children:"CRC:"})," 0x",e.crc]})});case"path":case"trace":return i.jsxs("div",{className:"text-xs text-text-primary space-y-1",children:[i.jsxs("p",{children:[i.jsx("span",{className:"text-text-muted",children:"Path:"})," ",e.pathString||"(empty)"]}),"trace"===e.type&&e.snrValues.length>0&&i.jsxs("p",{children:[i.jsx("span",{className:"text-text-muted",children:"SNR:"})," ",e.snrValues.map(e=>`${e}dB`).join(" → ")]})]});case"txt_msg":return i.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[i.jsxs("p",{children:[i.jsx("span",{className:"text-text-muted",children:"Dest:"})," ",e.destHash]}),i.jsxs("p",{children:[i.jsx("span",{className:"text-text-muted",children:"Src:"})," ",e.srcHash]}),e.encrypted?i.jsx("p",{className:"text-text-muted italic",children:"Encrypted content"}):i.jsxs("p",{children:[i.jsx("span",{className:"text-text-muted",children:"Text:"})," ",e.text]})]});case"grp_txt":return i.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[i.jsxs("p",{children:[i.jsx("span",{className:"text-text-muted",children:"Channel:"})," ",e.channelName?i.jsx("span",{className:"text-accent-success",children:e.channelName}):i.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]}),e.decrypted?i.jsxs(i.Fragment,{children:[e.senderName&&i.jsxs("p",{children:[i.jsx("span",{className:"text-text-muted",children:"From:"})," ",e.senderName]}),i.jsxs("p",{children:[i.jsx("span",{className:"text-text-muted",children:"Text:"})," ",e.text]})]}):i.jsx("p",{className:"text-text-muted italic",children:"Encrypted (unknown channel)"})]});case"grp_data":return i.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[i.jsxs("p",{children:[i.jsx("span",{className:"text-text-muted",children:"Channel:"})," ",e.channelName?i.jsx("span",{className:"text-sys-teal",children:e.channelName}):i.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]}),i.jsxs("p",{children:[i.jsx("span",{className:"text-text-muted",children:"Data:"})," ",e.dataLength," bytes ",e.decrypted?"(decrypted)":"(encrypted)"]})]});case"multipart":return i.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[i.jsxs("p",{children:[i.jsx("span",{className:"text-text-muted",children:"Part:"})," ",e.partNumber+1,"/",e.totalParts]}),i.jsxs("p",{children:[i.jsx("span",{className:"text-text-muted",children:"Message ID:"})," ",e.messageId]})]});default:return i.jsxs("p",{className:"text-xs text-text-secondary",children:[a," (",e.length," bytes)"]})}}const Dt=s.memo(function({packet:e}){const t=e.raw_packet||"",a=t.length/2,[n,r]=s.useState(null),[c,o]=s.useState(null),[d,x]=s.useState(null),h=s.useCallback(e=>{x(t=>t===e?null:e)},[]),u=s.useMemo(()=>pt(t),[t]);if(s.useEffect(()=>{if(!(null==u?void 0:u.packet)||5!==u.packet.payloadType)return void r(null);let e=!1;return async function(e){if(e.length<4)return null;const t=e[0],s=ze(t,!0),a=e.slice(1,3),n=e.slice(3),r={type:"grp_txt",channelHash:s,text:Re(n),decrypted:!1,ciphertextHex:Re(n),macHex:Re(a)};try{const{getChannelKeys:e}=await te(async()=>{const{getChannelKeys:e}=await Promise.resolve().then(()=>jt);return{getChannelKeys:e}},void 0),s=await e(t);if(s){r.channelName=s.name;const{decryptChannelMessage:e}=await te(async()=>{const{decryptChannelMessage:e}=await Promise.resolve().then(()=>dt);return{decryptChannelMessage:e}},void 0),t=await e(s.hmacKey,s.aesKey,a,n);if(t&&t.length>=5){const e=lt(t,0),s=t[4],a=new TextDecoder("utf-8",{fatal:!1}).decode(t.slice(5));r.decrypted=!0,r.timestamp=e,r.flags=s;const n=a.indexOf(": ");n>0?(r.senderName=a.slice(0,n),r.text=a.slice(n+2)):r.text=a}}}catch(l){}return r}(u.packet.payload).then(t=>{!e&&t&&r(t)}),()=>{e=!0}},[null==u?void 0:u.packet]),s.useEffect(()=>{if(!(null==u?void 0:u.packet)||6!==u.packet.payloadType)return void o(null);let e=!1;return async function(e){if(e.length<4)return null;const t=e[0],s=ze(t,!0),a=e.slice(1,3),n=e.slice(3),r={type:"grp_data",channelHash:s,dataHex:Re(n),dataLength:n.length,decrypted:!1,macHex:Re(a)};try{const{getChannelKeys:e}=await te(async()=>{const{getChannelKeys:e}=await Promise.resolve().then(()=>jt);return{getChannelKeys:e}},void 0),s=await e(t);if(s){r.channelName=s.name;const{decryptChannelMessage:e}=await te(async()=>{const{decryptChannelMessage:e}=await Promise.resolve().then(()=>dt);return{decryptChannelMessage:e}},void 0),t=await e(s.hmacKey,s.aesKey,a,n);t&&(r.decrypted=!0,r.decryptedHex=Re(t))}}catch(l){}return r}(u.packet.payload).then(t=>{!e&&t&&o(t)}),()=>{e=!0}},[null==u?void 0:u.packet]),!u||0===t.length)return i.jsx("div",{className:"p-4 text-center text-text-muted",children:i.jsx("p",{className:"text-sm",children:"No raw packet data available"})});const{packet:y}=u;let f=u.decoded;n&&"grp_txt"===u.decoded.type?f=n:c&&"grp_data"===u.decoded.type&&(f=c);const g=s.useMemo(()=>function(e,t){switch(e.type){case"advert":return function(e,t){const s=[];let a=0;const n=t.slice(0,64);s.push({id:"payload:publicKey",title:"Public Key",color:"pink",hex:n,startByte:a,endByte:a+31,decoded:i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:e.publicKey.toUpperCase()}),i.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Ed25519 public key (32 bytes)"})]})}),a+=32;const r=t.slice(64,72);s.push({id:"payload:timestamp",title:"Timestamp",color:"orange",hex:r,startByte:a,endByte:a+3,decoded:i.jsxs(i.Fragment,{children:[i.jsx(ee,{size:"standard",copy:!0,children:r.toUpperCase()}),i.jsxs("p",{className:"text-xs text-text-primary mt-1",children:[e.timestamp," (",$(e.timestamp),")"]})]})}),a+=4;const l=t.slice(72,200);s.push({id:"payload:signature",title:"Signature",color:"teal",hex:l,startByte:a,endByte:a+63,decoded:i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:e.signature.toUpperCase()}),i.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Ed25519 signature (64 bytes)"})]})}),a+=64;const c=t.slice(200,202);if(s.push({id:"payload:flags",title:"Flags",color:"blue",hex:c,startByte:a,endByte:a,decoded:i.jsxs(i.Fragment,{children:[i.jsxs(ee,{size:"standard",copy:!0,children:["0x",e.flags.toString(16).padStart(2,"0").toUpperCase()]}),i.jsx("p",{className:"text-xs text-text-primary mt-1",children:e.flagsDescription}),i.jsxs("p",{className:"text-xs text-text-muted",children:["Node Type: ",e.nodeType]})]})}),a+=1,void 0!==e.latitude){const n=t.slice(2*a,2*a+8);s.push({id:"payload:latitude",title:"Latitude",color:"green",hex:n,startByte:a,endByte:a+3,decoded:i.jsxs(i.Fragment,{children:[i.jsx(ee,{size:"standard",copy:!0,children:n.toUpperCase()}),i.jsxs("p",{className:"text-xs text-text-primary mt-1",children:[e.latitude.toFixed(6),"°"]})]})}),a+=4}if(void 0!==e.longitude){const n=t.slice(2*a,2*a+8);s.push({id:"payload:longitude",title:"Longitude",color:"purple",hex:n,startByte:a,endByte:a+3,decoded:i.jsxs(i.Fragment,{children:[i.jsx(ee,{size:"standard",copy:!0,children:n.toUpperCase()}),i.jsxs("p",{className:"text-xs text-text-primary mt-1",children:[e.longitude.toFixed(6),"°"]})]})}),a+=4}if(e.name){const n=t.slice(2*a),r=n.length/2;s.push({id:"payload:name",title:"Name",color:"amber",hex:n,startByte:a,endByte:a+r-1,decoded:i.jsxs(i.Fragment,{children:[i.jsx(ee,{size:"standard",copy:!0,children:n.toUpperCase()}),i.jsxs("p",{className:"text-xs text-text-primary mt-1",children:['"',e.name,'"']})]})})}return s}(e,t);case"ack":return function(e,t){return[{id:"payload:crc",title:"CRC",color:"green",hex:t.slice(0,8),startByte:0,endByte:3,decoded:i.jsxs(i.Fragment,{children:[i.jsxs(ee,{size:"standard",copy:!0,children:["0x",e.crc]}),i.jsx("p",{className:"text-xs text-text-muted mt-1",children:"CRC32 of acknowledged packet"})]})}]}(e,t);case"grp_txt":return function(e,t){const s=[];s.push({id:"payload:channelHash",title:"Channel Hash",color:"blue",hex:t.slice(0,2),startByte:0,endByte:0,decoded:i.jsxs(i.Fragment,{children:[i.jsxs(ee,{size:"standard",copy:!0,children:["0x",e.channelHash]}),e.channelName&&i.jsxs("p",{className:"text-xs text-text-primary mt-1",children:["Channel: ",e.channelName]})]})}),e.macHex&&s.push({id:"payload:mac",title:"MAC",color:"purple",hex:t.slice(2,6),startByte:1,endByte:2,decoded:i.jsxs(i.Fragment,{children:[i.jsx(ee,{size:"standard",copy:!0,children:e.macHex.toUpperCase()}),i.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Truncated HMAC-SHA256"})]})});const a=t.slice(6);return a&&s.push({id:"payload:ciphertext",title:e.decrypted?"Message":"Ciphertext",color:e.decrypted?"green":"zinc",hex:a,startByte:3,endByte:3+a.length/2-1,decoded:e.decrypted?i.jsxs(i.Fragment,{children:[i.jsxs("p",{className:"text-sm text-text-primary",children:['"',e.text,'"']}),e.senderName&&i.jsxs("p",{className:"text-xs text-text-muted mt-1",children:["From: ",e.senderName]})]}):i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:a.toUpperCase()}),i.jsx("p",{className:"text-xs text-text-muted mt-1",children:"AES-128-ECB encrypted"})]})}),s}(e,t);case"grp_data":return function(e,t){const s=[];s.push({id:"payload:channelHash",title:"Channel Hash",color:"blue",hex:t.slice(0,2),startByte:0,endByte:0,decoded:i.jsxs(i.Fragment,{children:[i.jsxs(ee,{size:"standard",copy:!0,children:["0x",e.channelHash]}),e.channelName&&i.jsxs("p",{className:"text-xs text-text-primary mt-1",children:["Channel: ",e.channelName]})]})}),e.macHex&&s.push({id:"payload:mac",title:"MAC",color:"purple",hex:t.slice(2,6),startByte:1,endByte:2,decoded:i.jsxs(i.Fragment,{children:[i.jsx(ee,{size:"standard",copy:!0,children:e.macHex.toUpperCase()}),i.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Truncated HMAC-SHA256"})]})});const a=t.slice(6);return a&&s.push({id:"payload:ciphertext",title:e.decrypted?"Decrypted Data":"Encrypted Data",color:e.decrypted?"green":"zinc",hex:a,startByte:3,endByte:3+a.length/2-1,decoded:i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:(e.decryptedHex||a).toUpperCase()}),i.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[e.dataLength," bytes",e.decrypted?"":" (AES-128-ECB encrypted)"]})]})}),s}(e,t);case"path":return function(e,t){return[{id:"payload:path",title:"Path Hops",color:"amber",hex:t,startByte:0,endByte:t.length/2-1,decoded:i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"flex flex-wrap items-center gap-1",children:e.path.map((e,t)=>i.jsxs("span",{className:"flex items-center gap-1",children:[t>0&&i.jsx(l,{className:"w-3 h-3 text-text-muted"}),i.jsx(A,{color:"amber",className:"font-mono",children:e})]},t))}),i.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[e.path.length," hops"]})]})}]}(e,t);case"trace":return function(e,t){return[{id:"payload:path",title:"Trace Path",color:"indigo",hex:t,startByte:0,endByte:t.length/2-1,decoded:i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"flex flex-wrap items-center gap-1",children:e.path.map((t,s)=>{const a=e.snrValues[s],n=void 0!==a?a>=5?"green":a>=0?"yellow":a>=-5?"orange":"red":"zinc";return i.jsxs("span",{className:"flex items-center gap-1",children:[s>0&&i.jsx(l,{className:"w-3 h-3 text-text-muted"}),i.jsx(A,{color:"indigo",className:"font-mono",children:t}),void 0!==a&&i.jsxs(A,{color:n,className:"font-mono",children:[a>=0?"+":"",a,"dB"]})]},s)})}),i.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[e.path.length," hops with SNR data"]})]})}]}(e,t);case"multipart":return function(e,t){const s=[];s.push({id:"payload:msgId",title:"Message ID",color:"blue",hex:t.slice(0,4),startByte:0,endByte:1,decoded:i.jsxs(i.Fragment,{children:[i.jsx(ee,{size:"standard",copy:!0,children:e.messageId.toUpperCase()}),i.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Unique message identifier"})]})}),s.push({id:"payload:partNum",title:"Part Number",color:"amber",hex:t.slice(4,6),startByte:2,endByte:2,decoded:i.jsxs(i.Fragment,{children:[i.jsx(ee,{size:"standard",copy:!0,children:e.partNumber}),i.jsx("p",{className:"text-xs text-text-muted mt-1",children:"0-indexed part number"})]})}),s.push({id:"payload:totalParts",title:"Total Parts",color:"orange",hex:t.slice(6,8),startByte:3,endByte:3,decoded:i.jsxs(i.Fragment,{children:[i.jsx(ee,{size:"standard",copy:!0,children:e.totalParts}),i.jsxs("p",{className:"text-xs text-text-muted mt-1",children:["Part ",e.partNumber+1," of ",e.totalParts]})]})});const a=t.slice(8);return a&&s.push({id:"payload:partData",title:"Part Data",color:"cyan",hex:a,startByte:4,endByte:4+a.length/2-1,decoded:i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:a.toUpperCase()}),i.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[a.length/2," bytes"]})]})}),s}(e,t);default:return[{id:"payload:ciphertext",title:"Raw Data",color:"zinc",hex:t,startByte:0,endByte:t.length/2-1,decoded:i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:t.toUpperCase()}),i.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[t.length/2," bytes"]})]})}]}}(f,u.payloadHex),[f,u.payloadHex]),j="payload"===d||Nt(d),b=s.useMemo(()=>{const e=[{id:"header",hex:u.headerHex,color:"red"},...u.transportCodesHex?[{id:"transportCodes",hex:u.transportCodesHex,color:"purple"}]:[],{id:"pathLength",hex:u.pathLengthHex,color:"green"},...u.pathDataHex?[{id:"pathData",hex:u.pathDataHex,color:"amber"}]:[]];return j?[...e,...(t=g,t.map(e=>({id:e.id,hex:e.hex,color:e.color})))]:[...e,{id:"payload",hex:u.payloadHex,color:"cyan"}];var t},[u,j,g]);return i.jsxs("div",{className:"font-mono space-y-8",children:[(()=>{switch(f.type){case"advert":return i.jsx(_t,{advert:f,timestamp:e.timestamp});case"grp_data":return i.jsx(Tt,{decoded:f,timestamp:e.timestamp});case"grp_txt":return f.decrypted?i.jsx(St,{decoded:f}):null;case"ack":return i.jsx(Ht,{decoded:f,timestamp:e.timestamp});case"path":return i.jsx(Bt,{decoded:f,timestamp:e.timestamp});case"trace":return i.jsx(Pt,{decoded:f,timestamp:e.timestamp});case"txt_msg":return i.jsx(Mt,{decoded:f,timestamp:e.timestamp});case"multipart":return i.jsx(Ut,{decoded:f,timestamp:e.timestamp});case"generic":return 0===y.payloadType||1===y.payloadType||7===y.payloadType?i.jsx(At,{decoded:f,timestamp:e.timestamp,payloadType:y.payloadType}):null;default:return null}})(),i.jsx("div",{className:"bg-black/[0.03] dark:bg-white/[0.03] rounded-2xl p-6",children:i.jsx(wt,{segments:b,selectedSegment:d,onSegmentClick:h})}),i.jsx(p,{children:i.jsx("div",{className:"space-y-4 relative",children:(()=>{var e,t,s,n;const r=[{id:"header",title:"Header",color:"red",startByte:0,endByte:0,hexBytes:`0x${u.headerHex.toUpperCase()}`,condition:!0,content:i.jsxs("table",{className:"w-full text-left",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"text-[10px] uppercase tracking-wide text-text-muted border-b border-border-subtle font-sans",children:[i.jsx("th",{className:"py-1 font-medium",children:"Bits"}),i.jsx("th",{className:"py-1 font-medium",children:"Field"}),i.jsx("th",{className:"py-1 font-medium",children:"Value"}),i.jsx("th",{className:"py-1 font-medium",children:"Binary"})]})}),i.jsx("tbody",{children:u.headerFields.map(e=>i.jsx(kt,{...e},e.bits))})]})},{id:"transportCodes",title:"Transport Codes",color:"purple",startByte:1,endByte:4,hexBytes:(null==(e=u.transportCodesHex)?void 0:e.toUpperCase())||"",condition:!!u.transportCodesHex,content:i.jsxs(i.Fragment,{children:[i.jsx("p",{className:"text-xs text-text-muted",children:"Two 16-bit transport codes for encrypted routing"}),i.jsxs("div",{className:"mt-1 text-xs text-text-secondary",children:["Code 1: 0x",null==(t=u.transportCodesHex)?void 0:t.slice(0,4).toUpperCase()," | Code 2: 0x",null==(s=u.transportCodesHex)?void 0:s.slice(4,8).toUpperCase()]})]})},{id:"pathLength",title:"Path Length",color:"green",startByte:u.transportCodesHex?5:1,endByte:u.transportCodesHex?5:1,hexBytes:`0x${u.pathLengthHex.toUpperCase()}`,condition:!0,content:i.jsxs("p",{className:"text-xs text-text-muted",children:[y.pathLen," bytes showing route taken (increases as packet floods)"]})},{id:"pathData",title:"Path Data",color:"amber",startByte:u.transportCodesHex?6:2,endByte:(u.transportCodesHex?5:1)+y.pathLen,hexBytes:(null==(n=u.pathDataHex)?void 0:n.toUpperCase())||"",condition:y.pathLen>0,content:i.jsxs(i.Fragment,{children:[i.jsx(Lt,{pathHex:u.pathDataHex}),i.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Historical route taken (bytes are added as packet floods through network)"})]})},{id:"payload",title:"Payload",color:"cyan",startByte:u.payloadStartByte,endByte:a-1,hexBytes:u.payloadHex.toUpperCase(),condition:!0,content:i.jsxs(i.Fragment,{children:[!Nt(d)&&i.jsxs("div",{className:"mb-3 p-2 rounded bg-bg-elevated/50 border border-border-subtle",children:[i.jsx("p",{className:"text-[10px] uppercase tracking-wide text-text-muted mb-1 font-sans",children:"Decoded"}),i.jsx(Ft,{decoded:f,payloadType:y.payloadType})]}),!Nt(d)&&i.jsx("p",{className:"text-[10px] uppercase tracking-wide text-text-muted mb-2 font-sans",children:"Click a field below to highlight its bytes"}),Nt(d)&&i.jsx("p",{className:"text-[10px] uppercase tracking-wide text-text-muted font-sans",children:"↑ Selected field above • Other fields below ↓"})]})}].filter(e=>e.condition),l=Nt(d)?g.find(e=>e.id===d):null,c=Nt(d)?[...r].sort((e,t)=>"payload"===e.id?-1:"payload"===t.id?1:0):[...r].sort((e,t)=>e.id===d?-1:t.id===d?1:0),o=Nt(d)?g.filter(e=>e.id!==d):[];return i.jsxs(i.Fragment,{children:[l&&i.jsx(Ct,{id:l.id,title:l.title,color:l.color,startByte:u.payloadStartByte+l.startByte,endByte:u.payloadStartByte+l.endByte,hexBytes:l.hex.toUpperCase(),isSelected:!0,customLayoutId:`subfield-${l.id}`,children:l.decoded},l.id),c.map(e=>i.jsx(Ct,{id:e.id,title:e.title,color:e.color,startByte:e.startByte,endByte:e.endByte,hexBytes:e.hexBytes,isSelected:e.id===d,children:e.content},e.id)),o.map(e=>i.jsxs(m.div,{layout:!0,layoutId:`subfield-${e.id}`,initial:!1,transition:{layout:{type:"spring",stiffness:500,damping:35}},className:"rounded-2xl p-6 space-y-4 relative",style:{backgroundColor:"transparent"},children:[i.jsx("div",{className:"absolute inset-0 rounded-2xl bg-black/[0.03] dark:bg-white/[0.03] pointer-events-none"}),i.jsxs("div",{className:"flex items-start justify-between gap-4 relative",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-0.5",children:[i.jsx(A,{color:e.color,children:e.title}),e.hex.length<=32&&bt(e.hex).map((t,s)=>i.jsx(A,{color:e.color,className:"font-mono",children:t.toUpperCase()},s))]}),i.jsxs("span",{className:"text-[10px] text-text-muted font-mono flex-shrink-0",children:["Bytes ",u.payloadStartByte+e.startByte,"-",u.payloadStartByte+e.endByte]})]}),i.jsx("div",{className:"relative p-3 rounded-lg",style:{backgroundColor:"var(--bg-body)",boxShadow:"inset 0 0 0 1px var(--border-subtle)"},children:e.decoded})]},e.id))]})})()})})]})});function Et(e){if(!e)return[];if(Array.isArray(e))return e;try{const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}}function It(e){return e?(e.startsWith("0x")?e.slice(2):e).slice(0,2).toUpperCase():""}function Rt(e){if(void 0===e)return"text-text-muted";switch(Y(e)){case"excellent":return"text-signal-excellent";case"good":return"text-signal-good";case"fair":return"text-signal-fair";case"weak":return"text-signal-poor";case"poor":return"text-signal-critical";default:return"text-text-muted"}}function zt({hop:e,isLast:t}){var s,a,n,r,l,o,x,h;const p=!(!(null==(s=e.neighborInfo)?void 0:s.latitude)||!(null==(a=e.neighborInfo)?void 0:a.longitude)),m=void 0!==(null==(n=e.neighborInfo)?void 0:n.rssi);return i.jsxs("div",{className:"relative",children:[!t&&i.jsx("div",{className:"absolute left-[19px] top-[40px] bottom-[-20px] w-[2px] bg-border-subtle"}),i.jsxs("div",{className:U("glass-card-inner p-3",e.isLocal&&"ring-1 ring-sys-amber/50",e.isGhost&&"ring-1 ring-sys-cyan/50"),children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:U("w-9 h-9 rounded-full flex items-center justify-center flex-shrink-0",e.isLocal?"bg-sys-amber/20 text-sys-amber":e.isGhost?"bg-sys-cyan/20 text-sys-cyan":"bg-accent-primary/20 text-accent-primary"),children:e.isLocal?i.jsx(T,{className:"w-4 h-4"}):e.isGhost?i.jsx(S,{className:"w-4 h-4"}):i.jsx("span",{className:"text-xs font-semibold",children:e.position})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(ee,{copy:!0,size:"compact",color:e.isGhost?"text-sys-cyan":void 0,children:e.prefix}),e.isLocal&&i.jsx(A,{color:Q.local,children:"Local"}),e.isGhost&&i.jsx(A,{color:Q.ghost,children:"Ghost"}),void 0!==e.confidence&&i.jsxs("span",{className:U("text-[10px] font-mono",e.confidence>=.9?"text-accent-success":e.confidence>=.6?"text-accent-secondary":"text-accent-danger"),children:[(100*e.confidence).toFixed(0),"%"]})]}),(null==(r=e.neighborInfo)?void 0:r.name)&&i.jsx("p",{className:"text-sm text-text-primary truncate mt-0.5",children:e.neighborInfo.name}),e.fullHash&&i.jsx("p",{className:"text-[10px] font-mono text-text-muted truncate",children:e.fullHash})]})]}),(m||p||e.neighborInfo)&&i.jsxs("div",{className:"mt-3 pt-3 border-t border-border-subtle/50 space-y-2",children:[m&&i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(w,{className:"w-3.5 h-3.5 text-text-muted flex-shrink-0"}),i.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[i.jsx(q,{rssi:e.neighborInfo.rssi,snr:null==(l=e.neighborInfo)?void 0:l.snr,compact:!0}),i.jsxs("span",{className:"text-xs text-text-muted",children:[e.neighborInfo.rssi," dBm",null!=(null==(o=e.neighborInfo)?void 0:o.snr)&&` / ${e.neighborInfo.snr.toFixed(1)} dB`]})]})]}),p&&i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(d,{className:"w-3.5 h-3.5 text-text-muted flex-shrink-0"}),i.jsxs("span",{className:"text-xs font-mono text-text-secondary",children:[e.neighborInfo.latitude.toFixed(5),", ",e.neighborInfo.longitude.toFixed(5)]})]}),(null==(x=e.neighborInfo)?void 0:x.contact_type)&&i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-[10px] text-text-muted",children:"Type:"}),i.jsx(A,{compact:!0,children:e.neighborInfo.contact_type})]}),(null==(h=e.neighborInfo)?void 0:h.last_seen)&&i.jsxs("div",{className:"text-[10px] text-text-muted",children:["Last seen: ",$(e.neighborInfo.last_seen)]})]}),!e.neighborInfo&&!e.isLocal&&!e.isGhost&&i.jsxs("div",{className:"mt-2 flex items-center gap-2 text-[10px] text-text-muted",children:[i.jsx(H,{className:"w-3 h-3"}),i.jsx("span",{children:"Unknown node - not in neighbor table"})]})]}),!t&&i.jsx("div",{className:"flex justify-center py-1",children:i.jsx(c,{className:"w-4 h-4 text-border-subtle"})})]})}const $t=s.memo(function({packet:e,neighbors:t,localHash:a,neighborAffinity:n,ghostPrefixes:r}){const l=Et(e.original_path),o=Et(e.forwarded_path),d=o.length>0?o:l,x=It(a),h=s.useMemo(()=>d.map((e,s)=>{const a=e.toUpperCase(),l=a===x,c=(null==r?void 0:r.has(a))??!1,i=function(e,t,s){const a=e.toUpperCase();if(s){let e=null,n=0;if(s.forEach((t,s)=>{if(It(s)===a){const a=t.combinedScore??0;a>n&&(n=a,e=s)}}),e&&t[e])return{hash:e,info:t[e],confidence:n}}for(const[n,r]of Object.entries(t))if(It(n)===a)return{hash:n,info:r,confidence:void 0};return null}(a,t,n);return{prefix:a,fullHash:null==i?void 0:i.hash,neighborInfo:null==i?void 0:i.info,isLocal:l,isGhost:c,confidence:null==i?void 0:i.confidence,position:s+1}}),[d,t,n,x,r]);return 0===h.length?i.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-6 text-center",children:[i.jsx(w,{className:"w-8 h-8 text-text-muted mb-3"}),i.jsx("p",{className:"text-sm text-text-muted",children:"No path data available"}),i.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Direct packets have no intermediate hops"})]}):i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h3",{className:"text-base font-semibold text-text-primary",children:"Packet Path"}),i.jsxs("span",{className:"text-xs text-text-muted",children:[h.length," hop",1!==h.length?"s":""]})]}),e.src_hash&&i.jsxs("div",{className:"glass-card-inner p-3",children:[i.jsx("div",{className:"flex items-center gap-2 mb-1",children:i.jsx("span",{className:"text-[10px] uppercase tracking-wide text-text-muted",children:"Source"})}),i.jsx(ee,{copy:!0,size:"compact",children:e.src_hash})]}),e.src_hash&&i.jsx("div",{className:"flex justify-center",children:i.jsx(c,{className:"w-4 h-4 text-accent-primary"})}),i.jsx("div",{className:"space-y-1",children:h.map((e,t)=>i.jsx(zt,{hop:e,isLast:t===h.length-1},`${e.prefix}-${t}`))}),e.dst_hash&&e.dst_hash!==a&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"flex justify-center",children:i.jsx(c,{className:"w-4 h-4 text-accent-primary"})}),i.jsxs("div",{className:"glass-card-inner p-3",children:[i.jsx("div",{className:"flex items-center gap-2 mb-1",children:i.jsx("span",{className:"text-[10px] uppercase tracking-wide text-text-muted",children:"Destination"})}),i.jsx(ee,{copy:!0,size:"compact",children:e.dst_hash})]})]}),i.jsxs("div",{className:"glass-card-inner p-3 mt-4",children:[i.jsx("p",{className:"text-[10px] uppercase tracking-wide text-text-muted mb-2",children:"Reception Summary"}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(q,{rssi:e.rssi,snr:e.snr}),i.jsxs("div",{className:"text-xs text-text-secondary",children:[i.jsxs("span",{className:Rt(e.rssi),children:[e.rssi," dBm"]}),void 0!==e.snr&&i.jsxs("span",{className:"text-text-muted",children:[" / ",e.snr.toFixed(1)," dB SNR"]})]})]})]})]})});function Ot(e){if(!e)return[];if(Array.isArray(e))return e;try{const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}}function Vt({label:e,children:t,compact:s=!1}){return i.jsxs("div",{className:U("flex flex-col",s?"gap-0.5":"gap-1"),children:[i.jsx("span",{className:"text-[10px] text-text-muted uppercase tracking-wide",children:e}),i.jsx("span",{className:U("text-text-primary","text-sm"),children:t})]})}function Kt({originalPath:e,forwardedPath:t,ghostPrefixes:s}){const a=t.length>0?t:e;if(0===a.length)return i.jsx("span",{className:"text-sm text-text-muted",children:"No path data"});const n=e=>null==s?void 0:s.has(e.toUpperCase());return i.jsx("div",{className:"flex items-center gap-1 flex-wrap",children:a.map((e,t)=>i.jsxs("div",{className:"flex items-center gap-1",children:[n(e)?i.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-accent-tertiary/20 text-accent-tertiary font-mono text-sm",children:[i.jsx(S,{className:"w-3 h-3"}),e.toUpperCase()]}):i.jsx(ee,{copy:!0,size:"compact",children:e}),t<a.length-1&&i.jsx(l,{className:"w-3 h-3 text-text-muted flex-shrink-0"})]},t))})}const Wt=s.memo(function({packet:e,onClose:t}){const[a,n]=s.useState("analysis");s.useEffect(()=>{const e=e=>{"Escape"===e.key&&t()};window.addEventListener("keydown",e);const s=document.body.style.overflow,a=document.body.style.position,n=document.body.style.width,r=document.body.style.top,l=window.scrollY;return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.top=`-${l}px`,()=>{window.removeEventListener("keydown",e),document.body.style.overflow=s,document.body.style.position=a,document.body.style.width=n,document.body.style.top=r,window.scrollTo(0,l)}},[t]);const r=O(),l=V(),c=K(),o=W(),d=s.useMemo(()=>new Set(o.map(e=>e.prefix.toUpperCase())),[o]),x=e.payload_type_name||E(e.payload_type??e.type),h=e.route_type_name||I(e.route_type??e.route),p=e.payload_length??e.length??0,m=e.tx_delay_ms??0,y=Ot(e.original_path),f=Ot(e.forwarded_path),g=y.length>0||f.length>0,j=f.length>0?f:y,b=s.useMemo(()=>{var e;if(null==(e=null==r?void 0:r.config)?void 0:e.repeater)return{latitude:r.config.repeater.latitude,longitude:r.config.repeater.longitude,name:r.config.node_name||"Local Node"}},[r]),N=(null==r?void 0:r.neighbors)??{},v=c.size>0?c:void 0,k=e.raw_packet&&e.raw_packet.length>0,C=j.length>0;return B.createPortal(i.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-md z-[10010] flex items-end sm:items-center justify-center p-4",onClick:t,role:"dialog","aria-modal":"true","aria-labelledby":"packet-modal-title",children:i.jsxs("div",{className:U("glass-card-elevated w-full flex flex-col","max-h-[90vh]","rounded-t-2xl rounded-b-none","sm:max-w-[900px] sm:rounded-xl sm:aspect-[5/4] sm:max-h-[85vh]","pb-safe"),onClick:e=>e.stopPropagation(),children:[i.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border-subtle flex-shrink-0",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(re,{packet:e,showLabel:!0,size:"lg"}),i.jsx(A,{color:J[x]??"zinc",children:x}),i.jsx("span",{className:"text-sm font-mono text-text-secondary",children:$(e.timestamp)})]}),i.jsx("button",{onClick:t,className:"p-2 rounded-lg text-text-muted hover:text-text-primary hover:bg-bg-subtle transition-colors",children:i.jsx(P,{className:"w-5 h-5"})})]}),i.jsxs("div",{className:"hidden sm:flex items-center gap-1 px-4 pt-2 pb-1 border-b border-border-subtle/50 flex-shrink-0",children:[i.jsxs("button",{onClick:()=>n("map"),className:U("px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center gap-1.5","map"===a?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-secondary hover:bg-bg-subtle"),children:[i.jsx(w,{className:"w-3.5 h-3.5"}),"RF / Map"]}),(C||k)&&i.jsxs("button",{onClick:()=>n("analysis"),className:U("px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center gap-1.5","analysis"===a?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-secondary hover:bg-bg-subtle"),children:[i.jsx(u,{className:"w-3.5 h-3.5"}),"Path / Bytes"]})]}),i.jsxs("div",{className:"flex-1 min-h-0 flex flex-col overflow-hidden",children:[i.jsxs("div",{className:U("overflow-y-auto p-4 space-y-4 overscroll-contain","sm:hidden"),style:{WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[i.jsx("div",{className:"glass-card-inner p-3",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-text-muted mb-1",children:"Signal Quality"}),i.jsx("p",{className:"text-sm font-medium text-text-primary",children:Z(e.rssi)})]}),i.jsx(q,{rssi:e.rssi,snr:e.snr,showValues:!0})]})}),g&&i.jsxs("div",{className:"glass-card-inner p-3",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("p",{className:"text-sm text-text-muted",children:"Packet Path"}),j.some(e=>d.has(e.toUpperCase()))&&i.jsxs("span",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-full bg-accent-tertiary/20 text-accent-tertiary text-[10px]",children:[i.jsx(S,{className:"w-3 h-3"}),i.jsx("span",{children:"Ghost Detected"})]})]}),i.jsx(Kt,{originalPath:y,forwardedPath:f,ghostPrefixes:d})]}),C&&i.jsx($t,{packet:e,neighbors:N,localHash:null==r?void 0:r.local_hash,neighborAffinity:v,ghostPrefixes:d}),k&&i.jsx("div",{className:"pt-2 border-t border-border-subtle",children:i.jsx(Dt,{packet:e})})]}),i.jsxs("div",{className:U("hidden overflow-y-auto p-4 space-y-4 overscroll-contain","map"===a?"sm:flex sm:flex-col sm:flex-1":"sm:hidden"),style:{WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[i.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[i.jsxs("div",{className:"glass-card-inner p-3",children:[i.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1",children:"Signal"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(q,{rssi:e.rssi,snr:e.snr}),i.jsx("div",{className:"text-sm",children:i.jsx("span",{className:"font-medium text-text-primary",children:Z(e.rssi)})})]})]}),i.jsxs("div",{className:"glass-card-inner p-3",children:[i.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1",children:"RSSI"}),i.jsx("p",{className:"text-lg font-mono text-text-primary",children:null!=e.rssi?`${e.rssi} dBm`:"—"})]}),i.jsxs("div",{className:"glass-card-inner p-3",children:[i.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1",children:"SNR"}),i.jsx("p",{className:"text-lg font-mono text-text-primary",children:null!=e.snr?`${e.snr.toFixed(1)} dB`:"—"})]}),i.jsxs("div",{className:"glass-card-inner p-3",children:[i.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1",children:"Hops"}),i.jsx("p",{className:"text-lg font-mono text-text-primary",children:j.length>0?j.length:"0"})]})]}),i.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[i.jsx(Vt,{label:"Route",children:i.jsx(A,{color:"DIRECT"===h||"T_DIRECT"===h?"cyan":"amber",children:h})}),i.jsx(Vt,{label:"Size",children:i.jsxs("span",{className:"font-mono",children:[p,"B"]})}),i.jsx(Vt,{label:"TX Delay",children:i.jsxs("span",{className:"font-mono",children:[m.toFixed(1),"ms"]})}),i.jsx(Vt,{label:"Status",children:i.jsx(A,{color:ce(e),children:le(e)})})]}),g&&j.length>0&&i.jsxs("div",{className:"flex-1 min-h-[280px] glass-card-inner overflow-hidden",children:[i.jsxs("div",{className:"p-3 border-b border-border-subtle/50 flex items-center gap-2",children:[i.jsx(M,{className:"w-4 h-4 text-accent-primary"}),i.jsx("span",{className:"text-sm text-text-secondary font-medium",children:"Path Visualization"})]}),i.jsx("div",{className:"p-3 h-[calc(100%-44px)]",children:i.jsx(fe,{path:j,neighbors:N,localNode:b,localHash:null==r?void 0:r.local_hash,srcHash:e.src_hash,dstHash:e.dst_hash,neighborAffinity:v,hubNodes:[...l]})})]}),(!g||0===j.length)&&i.jsx("div",{className:"flex-1 flex items-center justify-center glass-card-inner",children:i.jsxs("div",{className:"text-center text-text-muted",children:[i.jsx(M,{className:"w-12 h-12 mx-auto mb-2 opacity-30"}),i.jsx("p",{className:"text-sm",children:"No path data available for map visualization"})]})})]}),i.jsxs("div",{className:U("hidden overflow-hidden","analysis"===a?"sm:flex sm:flex-row sm:flex-1":"sm:hidden"),children:[C&&i.jsx("div",{className:"overflow-y-auto p-4 overscroll-contain border-r border-border-subtle/50 w-2/5",style:{WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:i.jsx($t,{packet:e,neighbors:N,localHash:null==r?void 0:r.local_hash,neighborAffinity:v,ghostPrefixes:d})}),k&&i.jsx("div",{className:U("overflow-y-auto p-4 overscroll-contain",C?"flex-1":"w-full"),style:{WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:i.jsx(Dt,{packet:e})}),!C&&!k&&i.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:i.jsxs("div",{className:"text-center text-text-muted",children:[i.jsx(u,{className:"w-12 h-12 mx-auto mb-2 opacity-30"}),i.jsx("p",{className:"text-sm",children:"No path or raw packet data available"})]})})]})]})]})}),document.body)});export{de as P,xe as a,Wt as b,ne as g};
