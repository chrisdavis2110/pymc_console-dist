const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PathMapMapLibre-CKO2fNHB.js","assets/vendor-react-LAbPDfrQ.js","assets/vendor-core-WoOfkQwm.js","assets/BasemapLayer-D6Rvk89s.js","assets/useThemeColors-BZADUK_r.js","assets/index-DSST4Vwq.js","assets/maplibre-gl-B1CfjdFi.css","assets/index-CAsRFGLe.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,s,a)=>((t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a)(t,"symbol"!=typeof s?s+"":s,a);import{j as s,r as a,am as n,an as r,ai as i,_ as l,ah as c,ao as o,ap as d,m as x,aq as h,ar as p,as as m,e as u,at as g,au as f,D as y,av as j,aw as b,ax as N,ay as v,az as w,E as k,aA as C,aB as S,t as T,aC as _,a8 as H,A as P,aD as B,V as M,a6 as L,aE as A,a2 as F}from"./vendor-react-LAbPDfrQ.js";import{c as U}from"./recharts-D38YBQhj.js";import{v as D,B as z,x as $,y as E,z as R,A as I,C as V,k as O,E as Q,G as W,c as G,H as K,I as q,J as Y,K as J,M as X,N as Z,O as ee,Q as te,U as se}from"./index-DSST4Vwq.js";import{_ as ae}from"./deckgl-DTsmDcfs.js";import{D as ne,S as re,R as ie,P as le,g as ce}from"./SignalIndicator-C8enCXLL.js";import{D as oe}from"./DataBox-ChCyaBc1.js";import{g as de,s as xe}from"./useThemeColors-BZADUK_r.js";function he({"aria-label":e="Page navigation",className:t,...a}){return s.jsx("nav",{"aria-label":e,...a,className:U("flex gap-x-2",t)})}function pe({onClick:e,disabled:t=!1,className:a,children:n="Previous"}){return s.jsx("span",{className:U("grow basis-0",a),children:s.jsxs(D,{plain:!0,onClick:e,disabled:t,"aria-label":"Previous page",className:U("gap-1",t&&"invisible"),children:[s.jsx("svg",{className:"size-4 stroke-current",viewBox:"0 0 16 16",fill:"none","aria-hidden":"true",children:s.jsx("path",{d:"M2.75 8H13.25M2.75 8L5.25 5.5M2.75 8L5.25 10.5",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})}),n]})})}function me({onClick:e,disabled:t=!1,className:a,children:n="Next"}){return s.jsx("span",{className:U("flex grow basis-0 justify-end",a),children:s.jsxs(D,{plain:!0,onClick:e,disabled:t,"aria-label":"Next page",className:U("gap-1",t&&"invisible"),children:[n,s.jsx("svg",{className:"size-4 stroke-current",viewBox:"0 0 16 16",fill:"none","aria-hidden":"true",children:s.jsx("path",{d:"M13.25 8L2.75 8M13.25 8L10.75 10.5M13.25 8L10.75 5.5",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})})]})})}function ue({className:e,...t}){return s.jsx("span",{...t,className:U("hidden items-baseline gap-x-2 sm:flex",e)})}function ge({page:e,current:t=!1,onClick:a,className:n,children:r}){return s.jsx(D,{plain:!t,outline:t,onClick:()=>null==a?void 0:a(e),"aria-label":`Page ${e}`,"aria-current":t?"page":void 0,className:U("min-w-[2.25rem] before:absolute before:-inset-px before:rounded-lg",t&&"before:bg-white/5",n),children:r??e})}function fe({className:e,...t}){return s.jsx("span",{"aria-hidden":"true",...t,className:U("w-[2.25rem] select-none text-center text-sm text-text-muted",e),children:"…"})}const ye=0,je=1,be=2,Ne=3,ve={[ye]:"T_FLOOD",[je]:"FLOOD",[be]:"DIRECT",[Ne]:"T_DIRECT"},we=0,ke=1,Ce=2,Se=3,Te=4,_e=5,He=6,Pe=7,Be=8,Me=9,Le=10,Ae=11,Fe=15,Ue={[we]:"REQ",[ke]:"RESPONSE",[Ce]:"TXT_MSG",[Se]:"ACK",[Te]:"ADVERT",[_e]:"GRP_TXT",[He]:"GRP_DATA",[Pe]:"ANON_REQ",[Be]:"PATH",[Me]:"TRACE",[Le]:"MULTIPART",[Ae]:"CONTROL",[Fe]:"RAW_CUSTOM"};function De(e){return ve[e]??`UNKNOWN(${e})`}function ze(e){return Ue[e]??`UNKNOWN(${e})`}function $e(e){const t=e.replace(/^0x/i,"").replace(/\s/g,"");if(t.length%2!=0)throw new Error("Invalid hex string: odd number of characters");const s=new Uint8Array(t.length/2);for(let a=0;a<s.length;a++){const e=parseInt(t.substr(2*a,2),16);if(isNaN(e))throw new Error("Invalid hex character at position "+2*a);s[a]=e}return s}function Ee(e,t=!0,s=!1){let a=Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join("");return t&&(a=a.toUpperCase()),s&&(a="0x"+a),a}function Re(e,t=!0){const s=(255&e).toString(16).padStart(2,"0");return t?s.toUpperCase():s}function Ie(e,t,s,a){if(e+t>s)throw new Error(a)}async function Ve(e){const t=new ArrayBuffer(e.length);new Uint8Array(t).set(e);const s=await crypto.subtle.digest("SHA-256",t);return new Uint8Array(s)}const Oe=new Uint8Array([99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22]),Qe=new Uint8Array([82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125]),We=new Uint8Array([1,2,4,8,16,32,64,128,27,54]);function Ge(e,t){let s=0;for(let a=0;a<8;a++){1&t&&(s^=e);const a=128&e;e=e<<1&255,a&&(e^=27),t>>=1}return s}function Ke(e){let t=e[13];e[13]=e[9],e[9]=e[5],e[5]=e[1],e[1]=t,t=e[2],e[2]=e[10],e[10]=t,t=e[6],e[6]=e[14],e[14]=t,t=e[3],e[3]=e[7],e[7]=e[11],e[11]=e[15],e[15]=t}function qe(e){for(let t=0;t<16;t++)e[t]=Qe[e[t]]}function Ye(e,t){for(let s=0;s<16;s++)e[s]^=t[s]}function Je(e){for(let t=0;t<4;t++){const s=4*t,a=e[s],n=e[s+1],r=e[s+2],i=e[s+3];e[s]=Ge(14,a)^Ge(11,n)^Ge(13,r)^Ge(9,i),e[s+1]=Ge(9,a)^Ge(14,n)^Ge(11,r)^Ge(13,i),e[s+2]=Ge(13,a)^Ge(9,n)^Ge(14,r)^Ge(11,i),e[s+3]=Ge(11,a)^Ge(13,n)^Ge(9,r)^Ge(14,i)}}function Xe(e,t){const s=new Uint8Array(e);Ye(s,t[10]);for(let a=9;a>=1;a--)Ke(s),qe(s),Ye(s,t[a]),Je(s);return Ke(s),qe(s),Ye(s,t[0]),s}function Ze(e,t){const s=function(e){const t=[],s=new Uint8Array(176);s.set(e.slice(0,16));for(let a=16;a<176;a+=4){let e=s[a-4],t=s[a-3],n=s[a-2],r=s[a-1];if(a%16==0){const s=e;e=Oe[t]^We[a/16-1],t=Oe[n],n=Oe[r],r=Oe[s]}s[a]=s[a-16]^e,s[a+1]=s[a-15]^t,s[a+2]=s[a-14]^n,s[a+3]=s[a-13]^r}for(let a=0;a<11;a++)t.push(s.slice(16*a,16*(a+1)));return t}(e),a=new Uint8Array(t.length);for(let n=0;n<t.length;n+=16){const e=t.slice(n,Math.min(n+16,t.length)),r=new Uint8Array(16);r.set(e);const i=Xe(r,s);a.set(i.slice(0,e.length),n)}return a}async function et(e,t,s){const a=[e];9===e&&a.push(t);const n=new Uint8Array(a.length+s.length);return n.set(a),n.set(s,a.length),(await Ve(n)).slice(0,32)}function tt(e,t){return e[t]|e[t+1]<<8}function st(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function at(e,t,s){t[s]=255&e,t[s+1]=e>>8&255}class nt{constructor(){t(this,"header",0),t(this,"transportCodes",[0,0]),t(this,"pathLen",0),t(this,"path",new Uint8Array(0)),t(this,"payload",new Uint8Array(0)),t(this,"decrypted",{}),t(this,"_rssi",0),t(this,"_snr",0)}static fromBytes(e){const t=new nt;try{return t.readFrom(e),{success:!0,packet:t}}catch(s){return{success:!1,error:s instanceof Error?s.message:String(s)}}}static fromHex(e){try{const t=$e(e);return nt.fromBytes(t)}catch(t){return{success:!1,error:t instanceof Error?t.message:String(t)}}}get routeType(){return 3&this.header}get routeTypeName(){return ve[this.routeType]??`UNKNOWN(${this.routeType})`}get payloadType(){return this.header>>2&15}get payloadTypeName(){return Ue[this.payloadType]??`UNKNOWN(${this.payloadType})`}get payloadVersion(){return this.header>>6&3}hasTransportCodes(){return 0===(e=this.routeType)||3===e;var e}isFlood(){return 1===(e=this.routeType)||0===e;var e}isDirect(){return 2===(e=this.routeType)||3===e;var e}get pathBytes(){return Array.from(this.path)}get pathString(){return((e=this.path)instanceof Uint8Array?Array.from(e):e).map(e=>Re(e,!0)).join("->");var e}get pathHexArray(){return Array.from(this.path).map(e=>Re(e,!0))}get payloadLen(){return this.payload.length}get payloadHex(){return Ee(this.payload,!0)}getPayloadAppData(){return this.payload.length>=100?this.payload.slice(100):new Uint8Array(0)}get rssi(){return this._rssi}set rssi(e){this._rssi=e}get snr(){return this._snr}set snr(e){this._snr=e}readFrom(e){let t=0;const s=e.length;Ie(t,1,s,"Missing header byte"),this.header=e[t++];const a=this.payloadVersion;if(a>1)throw new Error(`Unsupported packet version: ${a}`);if(this.hasTransportCodes()?(Ie(t,4,s,"Missing transport codes"),this.transportCodes=[tt(e,t),tt(e,t+2)],t+=4):this.transportCodes=[0,0],Ie(t,1,s,"Missing path_len"),this.pathLen=e[t++],this.pathLen>64)throw new Error(`path_len too large: ${this.pathLen} > 64`);return Ie(t,this.pathLen,s,"Truncated path"),this.path=e.slice(t,t+this.pathLen),t+=this.pathLen,this.payload=e.slice(t),function(e){if(e>256)throw new Error(`payload too large: ${e} > 256`)}(this.payload.length),!0}writeTo(){let e=1;this.hasTransportCodes()&&(e+=4),e+=1,e+=this.path.length,e+=this.payload.length;const t=new Uint8Array(e);let s=0;return t[s++]=this.header,this.hasTransportCodes()&&(at(this.transportCodes[0],t,s),at(this.transportCodes[1],t,s+2),s+=4),t[s++]=this.path.length,t.set(this.path,s),s+=this.path.length,t.set(this.payload,s),t}toHex(){return Ee(this.writeTo(),!0)}async calculateHash(){return et(this.payloadType,this.pathLen,this.payload)}async calculateHashString(e){return async function(e,t,s,a){const n=Ee(await et(e,t,s),!0);return void 0!==a?n.slice(0,a):n}(this.payloadType,this.pathLen,this.payload,e)}async calculateCRC(){return async function(e,t,s){const a=await et(e,t,s);return(a[0]|a[1]<<8|a[2]<<16|a[3]<<24)>>>0}(this.payloadType,this.pathLen,this.payload)}getRawLength(){let e=2+this.pathLen+this.payload.length;return this.hasTransportCodes()&&(e+=4),e}getSummary(){return{header:Re(this.header,!0),routeType:this.routeTypeName,payloadType:this.payloadTypeName,version:this.payloadVersion,pathLen:this.pathLen,pathStr:this.pathString,transportCodes:this.hasTransportCodes()?[this.transportCodes[0].toString(16).toUpperCase().padStart(4,"0"),this.transportCodes[1].toString(16).toUpperCase().padStart(4,"0")]:null,payloadLen:this.payload.length,payloadHex:this.payloadHex,rawLength:this.getRawLength()}}toString(){const e=[`[${this.routeTypeName}/${this.payloadTypeName} v${this.payloadVersion}]`,`path=${this.pathString||"(empty)"}`,`payload=${this.payload.length}B`];return this.hasTransportCodes()&&e.push(`transport=[${this.transportCodes[0]},${this.transportCodes[1]}]`),e.join(" ")}}function rt(e){if(e.length<101)return null;let t=0;const s=Ee(e.slice(t,t+32));t+=32;const a=st(e,t);t+=4;const n=Ee(e.slice(t,t+64));t+=64;const r=e[t++],i=function(e){const t=[];switch(15&e){case 1:t.push("is companion");break;case 2:t.push("is repeater");break;case 3:t.push("is room server");break;case 4:t.push("is sensor")}return 16&e&&t.push("has location"),32&e&&t.push("has feature 1"),64&e&&t.push("has feature 2"),128&e&&t.push("has name"),t.join(", ")||"none"}(r);let l="unknown";switch(15&r){case 1:l="chat";break;case 2:l="repeater";break;case 3:l="room_server";break;case 4:l="sensor"}const c={type:"advert",publicKey:s,timestamp:a,signature:n,flags:r,flagsDescription:i,nodeType:l,rawAppData:Ee(e.slice(100))};if(16&r&&t+8<=e.length){const s=e.slice(t,t+8),a=new ArrayBuffer(8);new Uint8Array(a).set(s);const n=new DataView(a),r=n.getInt32(0,!0),i=n.getInt32(4,!0);c.latitude=r/1e6,c.longitude=i/1e6,t+=8}if(128&r&&t<e.length){let s=t;for(;s<e.length&&0!==e[s];)s++;s>t&&(c.name=(new TextDecoder).decode(e.slice(t,s)))}return c}function it(e,t){const s=function(e){if(e.length<9)return{type:"trace",traceTag:"00000000",traceTagValue:0,authCode:0,flags:0,pathHashes:[],pathString:"",snrValues:[],isComplete:!1,path:[],targetHash:""};const t=st(e,0),s=t.toString(16).toUpperCase().padStart(8,"0"),a=st(e,4),n=e[8],r=e.slice(9),i=Array.from(r).map(e=>Re(e,!0)),l=i.join("->");return{type:"trace",traceTag:s,traceTagValue:t,authCode:a,flags:n,pathHashes:i,pathString:l,snrValues:[],isComplete:!1,path:i,targetHash:i.length>0?i[0]:""}}(e);if(!s)return null;const a=[],n=t instanceof Uint8Array?Array.from(t):t;for(let i=0;i<n.length;i++){let e=n[i];e>127&&(e-=256),a.push(e/4)}const r=a.length>=s.pathHashes.length;return{...s,snrValues:a,isComplete:r}}function lt(e,t,s){return{type:"generic",payloadType:t,payloadTypeName:s,rawHex:Ee(e),length:e.length}}function ct(e){if(!e||e.length<4)return null;const t=nt.fromHex(e);if(!t.success||!t.packet)return null;const s=t.packet,a=function(e){const t=3&e,s=e>>2&15,a=e>>6&3;return[{bits:"0-1",field:"Route Type",value:De(t),binary:(3&t).toString(2).padStart(2,"0")},{bits:"2-5",field:"Payload Type",value:ze(s),binary:(15&s).toString(2).padStart(4,"0")},{bits:"6-7",field:"Version",value:a.toString(),binary:(3&a).toString(2).padStart(2,"0")}]}(s.header),n=e.slice(0,2);let r=2,i="";s.hasTransportCodes()&&(i=e.slice(2,10),r=10);const l=e.slice(r,r+2),c=r+2,o=c+2*s.pathLen,d=e.slice(c,o),x=e.slice(o),h=function(e){const{payload:t,payloadType:s,payloadTypeName:a}=e;switch(s){case 4:return rt(t)??lt(t,s,a);case 3:return function(e){if(e.length<4)return null;const t=st(e,0);return{type:"ack",crc:t.toString(16).toUpperCase().padStart(8,"0"),crcValue:t}}(t)??lt(t,s,a);case 8:return function(e){if(0===e.length)return{type:"path",path:[],pathString:""};const t=Array.from(e).map(e=>Re(e,!0)),s=t.join("->");return{type:"path",path:t,pathString:s}}(t)??lt(t,s,a);case 9:return it(t,e.path)??lt(t,s,a);case 2:return function(e){if(e.length<2)return null;const t=Re(e[0],!0),s=Re(e[1],!0),a=e.slice(2);let n="",r=!0;try{const e=new TextDecoder("utf-8",{fatal:!0}).decode(a);/^[\x20-\x7E\u00A0-\uFFFF\n\r\t]*$/.test(e)&&(n=e,r=!1)}catch{}return r&&(n=Ee(a)),{type:"txt_msg",destHash:t,srcHash:s,timestamp:0,text:n,encrypted:r}}(t)??lt(t,s,a);case 5:return function(e){if(e.length<4)return null;const t=Re(e[0],!0),s=e.slice(1,3),a=e.slice(3);return{type:"grp_txt",channelHash:t,text:Ee(a),decrypted:!1,ciphertextHex:Ee(a),macHex:Ee(s)}}(t)??lt(t,s,a);case 6:return function(e){if(e.length<4)return null;const t=Re(e[0],!0),s=e.slice(1,3),a=e.slice(3);return{type:"grp_data",channelHash:t,dataHex:Ee(a),dataLength:a.length,decrypted:!1,macHex:Ee(s)}}(t)??lt(t,s,a);case 10:return function(e){return e.length<4?null:{type:"multipart",messageId:Ee(e.slice(0,2)),partNumber:e[2],totalParts:e[3],partData:Ee(e.slice(4))}}(t)??lt(t,s,a);default:return lt(t,s,a)}}(s);return{packet:s,headerHex:n,headerFields:a,transportCodesHex:i,pathLengthHex:l,pathDataHex:d,payloadHex:x,payloadStartByte:Math.floor(o/2),decoded:h}}const ot={name:"Public",secret:"8b3387e9c5cdea6ac9e5edbaa115cd72"},dt=["southbay","bot","ventura","weather","wardrive","test","general","public","main","default","chat","local","mesh","emergency","sos","help","news","info","status","alerts","meshcore","meshtastic","lora","radio","ham","amateur","socal","norcal","bayarea","losangeles","sandiego","sanfrancisco","sanjose","santabarbara","santacruz","monterey","fresno","sacramento","seattle","portland","denver","austin","boston","chicago","miami","atlanta","phoenix","dallas","houston","philly","detroit","minneapolis","tampa","orlando","lasvegas","saltlake","london","toronto","canada","sydney","australia","berlin","germany","paris","france","tokyo","japan","gps","location","tracking","sensor","sensors","telemetry","aprs","beacon","ping","debug","admin",...function(){const e="abcdefghijklmnopqrstuvwxyz0123456789",t=[];for(const s of e)t.push(s);for(const s of e)for(const a of e)t.push(s+a);return t}()];async function xt(e,t=!1){const s=$e(e.secret),a=(await Ve(s))[0],n=new Uint8Array(32);return n.set(s.slice(0,32)),{name:e.name,channelHash:a,aesKey:n.slice(0,16),hmacKey:n,autoDiscovered:t}}async function ht(e){const t=`#${e}`,s=(new TextEncoder).encode(t);return xt({name:`#${e}`,secret:Ee((await Ve(s)).slice(0,16),!1)},!0)}let pt=null,mt=null;const ut=new Map;let gt=null;async function ft(e,t,s){const a=await async function(e,t){const s=new ArrayBuffer(e.length);new Uint8Array(s).set(e);const a=new ArrayBuffer(t.length);new Uint8Array(a).set(t);const n=await crypto.subtle.importKey("raw",s,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),r=await crypto.subtle.sign("HMAC",n,a);return new Uint8Array(r)}(e,s);return t[0]===a[0]&&t[1]===a[1]}const yt=Object.freeze(Object.defineProperty({__proto__:null,tryDecryptGroupMessage:async function(e,t,s){await async function(){pt||(mt||(mt=(async()=>{const e=new Map;for(const t of dt)try{const s=await ht(t),a=e.get(s.channelHash)||[];a.push(s),e.set(s.channelHash,a)}catch{}pt=e})()),await mt)}();const a=await async function(){return gt||(gt=await xt(ot)),gt}();if(a.channelHash===e&&await ft(a.hmacKey,t,s))return{channelName:"Public",plaintext:Ze(a.aesKey,s),keys:a};const n=ut.get(e);if(n&&await ft(n.hmacKey,t,s)){const e=Ze(n.aesKey,s);return{channelName:n.name,plaintext:e,keys:n}}const r=(null==pt?void 0:pt.get(e))||[];for(const i of r)if(await ft(i.hmacKey,t,s)){ut.set(e,i);const t=Ze(i.aesKey,s);return{channelName:i.name,plaintext:t,keys:i}}return null}},Symbol.toStringTag,{value:"Module"}));function jt(e){if(!e||e.length<8)return null;const t=parseInt(e.slice(0,2),16),s=parseInt(e.slice(2,4),16),a=parseInt(e.slice(4,6),16),n=parseInt(e.slice(6,8),16);return isNaN(t)||isNaN(s)||isNaN(a)||isNaN(n)?null:((t|s<<8|a<<16|n<<24)>>>0).toString(16).toUpperCase().padStart(8,"0")}function bt(e){return e>=10?"excellent":e>=5?"good":e>=0?"fair":e>=-5?"poor":"critical"}function Nt(e){if(!e.payload)return null;try{const t=$e(e.payload),s=function(e){const t=e.original_path||e.forwarded_path||[];if("string"==typeof t)try{const e=JSON.parse(t);if(Array.isArray(e))return e.map(e=>parseInt(e,16))}catch{return[]}else if(Array.isArray(t))return t.map(e=>parseInt(e,16));return[]}(e),a=it(t,s);return a?{packet:e,decoded:a,timestamp:e.timestamp??0,hopCount:a.snrValues.length,rssi:e.rssi,snr:e.snr}:null}catch{return null}}const vt={rx:{icon:c,label:"Rx",badgeColor:ne.rx,avatarBg:"bg-emerald-500/15",avatarText:"text-emerald-400"},forward:{icon:l,label:"Fwd",badgeColor:ne.forward,avatarBg:"bg-sky-500/15",avatarText:"text-sky-400"},duplicate:{icon:i,label:"Dupe",badgeColor:ne.duplicate,avatarBg:"bg-zinc-500/15",avatarText:"text-zinc-400"},tx:{icon:r,label:"Tx",badgeColor:ne.tx,avatarBg:"bg-violet-500/15",avatarText:"text-violet-400"},dropped:{icon:n,label:"Drop",badgeColor:ne.dropped,avatarBg:"bg-amber-500/15",avatarText:"text-amber-400"}},wt={sm:"w-3 h-3",md:"w-3.5 h-3.5",lg:"w-4 h-4"},kt={sm:"w-7 h-7",md:"w-8 h-8",lg:"w-9 h-9"};function Ct(e){return"tx_local"===e.packet_origin?"tx":"tx_forward"===e.packet_origin?"forward":e.is_duplicate?"duplicate":e.transmitted?"forward":e.drop_reason?"dropped":"rx"}const St=a.memo(function({packet:e,showLabel:t=!0,variant:a="avatar",size:n="sm"}){const r=Ct(e),i=vt[r],l=i.icon;return"avatar"===a?s.jsx("div",{className:U("flex items-center justify-center rounded-full flex-shrink-0",i.avatarBg,kt[n]),children:s.jsx(l,{className:U(wt[n],i.avatarText)})}):s.jsxs(z,{color:i.badgeColor,children:[s.jsx(l,{className:wt[n]}),t&&i.label]})}),Tt=a.memo(function({path:e,localHash:t,className:a}){if(!e||0===e.length)return s.jsx("span",{className:U("text-white/30 text-[10px]",a),children:"—"});const n=t?(t.startsWith("0x")?t.slice(2,4):t.slice(0,2)).toUpperCase():null;return s.jsx("span",{className:U("flex items-center gap-0.5 font-mono text-[10px] overflow-hidden",a),children:e.map((t,a)=>{const r=a===e.length-1,i=n&&t.toUpperCase()===n;return s.jsxs("span",{className:"flex items-center flex-shrink-0",children:[i?s.jsx("span",{className:"px-1 py-0.5 rounded bg-amber-500/20 text-amber-400 text-[9px] font-medium",children:"You"}):s.jsx("span",{className:"px-1 py-0.5 rounded bg-white/[0.06] text-white/60",children:t.toUpperCase()}),!r&&s.jsx(o,{className:"w-2.5 h-2.5 text-white/20 mx-0.5 flex-shrink-0"})]},`${t}-${a}`)})})}),_t=a.memo(function({count:e,className:t}){const a=e>=2;return s.jsxs("span",{className:U("font-mono text-xs tabular-nums",a?"text-white/70":"text-white/30",t),children:[e,s.jsx("span",{className:"text-white/20",children:"→"})]})});function Ht(e){const t=e.payload_type_name||R(e.payload_type??e.type),s=e.route_type_name||I(e.route_type??e.route);return{payloadType:t,routeType:s,payloadColor:le[t]??"zinc",routeColor:ie[s]??"zinc"}}function Pt(e){if(!e)return[];if(Array.isArray(e))return e;try{const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}}function Bt(e,t){if(!e||!t)return null;const s=e.startsWith("0x")?e.slice(2):e;for(const[a,n]of Object.entries(t))if((a.startsWith("0x")?a.slice(2):a).toLowerCase().startsWith(s.toLowerCase()))return n.name||n.node_name||null;return null}const Mt=a.memo(function({packet:e,onClick:t,localHash:n,neighbors:r,isFlashing:i=!1,isPending:l,isTraceHighlighted:c,onTraceHover:o,traceTag:h,onViewTraceReport:p,dupeGroupPosition:m,isDupeGroupHovered:u=!1,onDupeGroupHover:g}){var f;const y=a.useRef(null),[j,b]=a.useState(!1),N=$(e.is_duplicate),v=void 0!==m,w=j||v&&u,{payloadType:k,routeType:C,payloadColor:S,routeColor:T}=Ht(e),_="tx_local"===e.packet_origin,H=l??e.isPending,P="TRACE"===k,B=Pt(e.original_path),M=Pt(e.forwarded_path),L=M.length>0?M:B,A=L.length,F=e.src_hash?(e.src_hash.startsWith("0x")?e.src_hash.slice(2,6):e.src_hash.slice(0,4)).toUpperCase():null,D=Bt(e.src_hash,r),R=e.payload_length??e.length??0,I=e.lbt_attempts??0,V=I>0||e.lbt_channel_busy,O=a.useCallback(()=>{b(!0),P&&h&&o&&o(h),v&&g&&e.packet_hash&&g(e.packet_hash)},[P,h,o,v,g,e.packet_hash]),Q=a.useCallback(()=>{b(!1),P&&o&&o(null),v&&g&&g(null)},[P,o,v,g]);a.useEffect(()=>{if(!j)return;const e=setTimeout(()=>{y.current&&!y.current.matches(":hover")&&(b(!1),P&&o&&o(null),v&&g&&g(null))},100);return()=>clearTimeout(e)},[j,P,o,v,g]);const W=w?{duration:0}:{duration:.12,ease:"easeOut"},G={lime:"rgb(132, 204, 22)",cyan:"rgb(34, 211, 238)",amber:"rgb(251, 191, 36)",violet:"rgb(167, 139, 250)",rose:"rgb(251, 113, 133)",emerald:"rgb(52, 211, 153)",sky:"rgb(56, 189, 248)",orange:"rgb(251, 146, 60)",pink:"rgb(244, 114, 182)",zinc:"rgb(161, 161, 170)",purple:"rgb(168, 85, 247)",indigo:"rgb(129, 140, 248)",teal:"rgb(45, 212, 191)",fuchsia:"rgb(232, 121, 249)",blue:"rgb(59, 130, 246)",green:"rgb(34, 197, 94)",yellow:"rgb(250, 204, 21)",red:"rgb(239, 68, 68)",brown:"rgb(168, 133, 107)"},K=G[S]||G.zinc;return s.jsx("div",{ref:y,onPointerEnter:O,onPointerLeave:Q,className:U("group relative",N&&!w&&"opacity-40",i&&"flash-row",H&&"opacity-70"),style:{zIndex:w?10:"auto"},"data-hovered":w?"true":void 0,children:s.jsxs("div",{onClick:()=>{P&&h&&p?p(h):t(e)},className:"cursor-pointer relative",children:[s.jsx("div",{className:"absolute pointer-events-none",style:{...(()=>{const e=w?1:0;return"first"===m?{inset:"-2px",borderTop:`2px solid ${K}`,borderLeft:`2px solid ${K}`,borderRight:`2px solid ${K}`,borderBottom:"none",borderRadius:"8px 8px 0 0",opacity:e}:"middle"===m?{inset:"-2px",borderTop:"none",borderLeft:`2px solid ${K}`,borderRight:`2px solid ${K}`,borderBottom:"none",borderRadius:0,opacity:e}:"last"===m?{inset:"-2px",borderTop:"none",borderLeft:`2px solid ${K}`,borderRight:`2px solid ${K}`,borderBottom:`2px solid ${K}`,borderRadius:"0 0 8px 8px",opacity:e}:{inset:"-2px",border:`2px solid ${K}`,borderRadius:"8px",opacity:e}})(),transition:w?"none":"opacity 0.1s ease-out"}}),s.jsx("div",{className:U("absolute inset-0 pointer-events-none",_&&"bg-violet-500/5",c&&"bg-teal-500/10")}),s.jsxs(x.div,{initial:!1,animate:{y:w?-4:0},transition:W,className:"relative flex items-center gap-2 min-[600px]:gap-3 px-2 py-2 min-[600px]:px-3 min-[600px]:py-2.5",children:[s.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[s.jsxs("div",{className:"relative flex-shrink-0",children:[s.jsx(St,{packet:e,variant:"avatar",size:"sm"}),H&&s.jsx(d,{className:"absolute -right-1 -bottom-1 w-3 h-3 text-amber-400 animate-spin"})]}),s.jsxs("div",{className:"min-w-0",children:[s.jsx("div",{className:"font-bold text-[13px] text-white font-sans truncate",children:F||"—"}),D&&s.jsx("div",{className:"hidden min-[900px]:block text-[9px] text-white/40 truncate max-w-[70px]",children:D})]})]}),s.jsxs("div",{className:"flex-1 flex items-center gap-1 min-[600px]:gap-1.5 min-[900px]:gap-2 min-w-0",children:[s.jsx("span",{className:"text-[10px] min-[600px]:text-[11px] text-white/50 font-mono tabular-nums whitespace-nowrap flex-shrink-0",children:E(e.timestamp)}),s.jsx(z,{color:S,className:"flex-shrink-0",children:k}),s.jsx("span",{className:"min-[600px]:hidden text-[10px] font-mono text-white/40 flex-shrink-0",children:C.charAt(0)}),s.jsx(z,{color:T,className:"flex-shrink-0 hidden min-[600px]:inline-flex",children:C}),s.jsx("div",{className:"flex-shrink-0 flex items-center",children:s.jsx(_t,{count:A})}),s.jsxs("span",{className:"hidden min-[520px]:inline text-[10px] text-white/40 font-mono flex-shrink-0",children:[R,"B"]}),s.jsx("div",{className:"flex-1 min-w-0 overflow-hidden",children:w?s.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-white/40 font-mono",children:[s.jsx("span",{className:"truncate",children:null==(f=e.packet_hash)?void 0:f.slice(0,10)}),V&&s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"text-white/20",children:"·"}),s.jsxs("span",{className:I>1?"text-amber-400/70":"",children:["LBT:",I]})]}),e.tx_delay_ms&&s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"text-white/20",children:"·"}),s.jsxs("span",{children:[Math.round(e.tx_delay_ms),"ms"]})]})]}):s.jsx(Tt,{path:L,localHash:n})})]}),s.jsx("div",{className:"flex-shrink-0",children:s.jsx(re,{rssi:e.rssi,snr:e.snr,compact:!0,showValues:!0})})]})]})})}),Lt=a.memo(function({packet:e,onClick:t,localHash:a,neighbors:n,isFlashing:r=!1,isPending:i,isTraceHighlighted:l,traceTag:c,onViewTraceReport:o,dupeGroupPosition:x,isDupeGroupHovered:h=!1,onDupeGroupHover:p}){const{payloadType:m,routeType:u,payloadColor:g,routeColor:f}=Ht(e),y="tx_local"===e.packet_origin,j=i??e.isPending,b="TRACE"===m,N=$(e.is_duplicate),v=Pt(e.original_path),w=Pt(e.forwarded_path),k=w.length>0?w:v,C=k.length,S=e.src_hash?(e.src_hash.startsWith("0x")?e.src_hash.slice(2,6):e.src_hash.slice(0,4)).toUpperCase():null,T=Bt(e.src_hash,n),_=e.payload_length??e.length??0,H=e.lbt_attempts??0,P={lime:"rgb(132, 204, 22)",cyan:"rgb(34, 211, 238)",amber:"rgb(251, 191, 36)",violet:"rgb(167, 139, 250)",rose:"rgb(251, 113, 133)",emerald:"rgb(52, 211, 153)",sky:"rgb(56, 189, 248)",orange:"rgb(251, 146, 60)",pink:"rgb(244, 114, 182)",zinc:"rgb(161, 161, 170)",purple:"rgb(168, 85, 247)",indigo:"rgb(129, 140, 248)",teal:"rgb(45, 212, 191)",fuchsia:"rgb(232, 121, 249)",blue:"rgb(59, 130, 246)",green:"rgb(34, 197, 94)",yellow:"rgb(250, 204, 21)",red:"rgb(239, 68, 68)"},B=P[g]||P.zinc;return s.jsxs("div",{onClick:()=>{b&&c&&o?o(c):t(e)},className:U("relative pl-3 pr-2.5 py-2 cursor-pointer","active:bg-white/[0.04]",N&&"opacity-40",r&&"flash-row",j&&"opacity-70",y&&"bg-violet-500/5",l&&"bg-teal-500/10"),children:[s.jsx("div",{className:"absolute left-0 transition-all",style:(()=>{if(!x)return{opacity:0};const e=h?1:.4,t=h?"3px":"2px";return"first"===x?{backgroundColor:B,opacity:e,width:t,top:"6px",bottom:0,borderRadius:"0 9999px 0 0"}:"middle"===x?{backgroundColor:B,opacity:e,width:t,top:0,bottom:0,borderRadius:0}:"last"===x?{backgroundColor:B,opacity:e,width:t,top:0,bottom:"6px",borderRadius:"0 0 9999px 0"}:{backgroundColor:B,opacity:e,width:t,top:"6px",bottom:"6px",borderRadius:"9999px"}})()}),s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsxs("div",{className:"relative flex-shrink-0 mt-0.5",children:[s.jsx(St,{packet:e,variant:"avatar",size:"sm"}),j&&s.jsx(d,{className:"absolute -right-1 -bottom-1 w-2.5 h-2.5 text-amber-400 animate-spin"})]}),s.jsxs("div",{className:"flex-1 min-w-0 space-y-0.5",children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx("span",{className:"font-semibold text-[14px] text-white tracking-tight",children:S||"—"}),T&&s.jsx("span",{className:"text-[12px] text-white/40 truncate max-w-[80px]",children:T}),s.jsx("div",{className:"flex-1"}),s.jsx(z,{color:g,className:"flex-shrink-0 !text-[9px] !px-1.5 !py-0",children:m}),s.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[s.jsx("span",{className:"text-[10px] font-mono text-white/50 tabular-nums w-[28px] text-right",children:e.rssi}),s.jsx(re,{rssi:e.rssi,compact:!0,showValues:!1})]})]}),s.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-white/40 font-mono",children:[s.jsx("span",{className:"tabular-nums",children:E(e.timestamp)}),s.jsx(z,{color:f,className:"!text-[8px] !px-1 !py-0 !leading-none",children:u.charAt(0)}),C>0&&s.jsxs("span",{className:"text-white/30",children:[C,"h"]}),_>0&&s.jsxs("span",{className:"text-white/30",children:[_,"B"]}),H>0&&s.jsxs("span",{className:H>1?"text-amber-400/60":"text-white/30",children:["LBT:",H]}),null!=e.snr&&s.jsxs("span",{className:"text-white/30",children:[e.snr.toFixed(0),"dB"]})]}),C>0&&s.jsx("div",{className:"pt-0.5",children:s.jsx(Tt,{path:k,localHash:a})})]})]})]})});function At(e){if(e.contact_type){const t=e.contact_type.toLowerCase();if("repeater"===t||"rep"===t)return!0;if("companion"===t||"client"===t||"cli"===t)return!1;if("room server"===t||"room_server"===t||"room"===t||"server"===t)return!1}return!0===e.is_repeater||(e.is_repeater,!1)}const Ft=a.lazy(()=>ae(()=>import("./PathMapMapLibre-CKO2fNHB.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])));function Ut(e){return`${(100*e).toFixed(0)}%`}function Dt(e,t){const s=document.documentElement,a=getComputedStyle(s),n={success:a.getPropertyValue("--accent-success").trim()||"#39D98A",secondary:a.getPropertyValue("--accent-secondary").trim()||"#F9D26F",poor:a.getPropertyValue("--signal-poor").trim()||"#FF8A5C",danger:a.getPropertyValue("--accent-danger").trim()||"#FF5C7A",muted:a.getPropertyValue("--text-muted").trim()||"#767688"};let r;return r=0===t?n.muted:e>=1?n.success:e>=.5?n.secondary:e>=.25?n.poor:e>0?n.danger:n.muted,{color:r}}class zt extends a.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?s.jsxs("div",{className:"h-[200px] flex items-center justify-center text-text-muted",children:[s.jsx(m,{className:"w-4 h-4 mr-2"}),"Map failed to load"]}):this.props.children}}function $t({path:e,neighbors:t,localNode:n,localHash:r,srcHash:i,dstHash:l,neighborAffinity:c,prefixLookup:o,hubNodes:d,traceSnr:x,advertiserSource:m}){const[u,g]=a.useState(null),f=a.useMemo(()=>m?{prefix:m.prefix||"??",candidates:[{hash:m.publicKey||m.prefix||"advertiser",name:m.name,latitude:m.latitude,longitude:m.longitude,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isSource:!0}:null,[m]),y=a.useMemo(()=>{if(m)return null;if(!i)return null;const e=O(i),s=t[i];if((null==s?void 0:s.latitude)&&(null==s?void 0:s.longitude)&&(0!==s.latitude||0!==s.longitude))return{prefix:e,candidates:[{hash:i,name:s.node_name||s.name||"Source",latitude:s.latitude,longitude:s.longitude,probability:1,isLocal:!1,isDirectNeighbor:!0===s.zero_hop}],confidence:1,totalMatches:1,isSource:!0};const a=(null==s?void 0:s.node_name)||(null==s?void 0:s.name)||i.slice(0,8);return{prefix:e,candidates:[{hash:i,name:a,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isSource:!0}},[m,i,t]),j=a.useMemo(()=>{const e=(null==l?void 0:l.startsWith("0x"))?l.slice(2):l;if((!e||"00"===e||"0000000000000000"===e)&&n&&r){const e=O(r),t=0!==n.latitude||0!==n.longitude;return{prefix:e,candidates:[{hash:r,name:n.name||"Local Node",latitude:t?n.latitude:0,longitude:t?n.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}if(!l)return null;const s=O(l);if(r&&l===r&&n){const e=0!==n.latitude||0!==n.longitude;return{prefix:s,candidates:[{hash:l,name:n.name||"Local Node",latitude:e?n.latitude:0,longitude:e?n.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}const a=t[l];if((null==a?void 0:a.latitude)&&(null==a?void 0:a.longitude)&&(0!==a.latitude||0!==a.longitude))return{prefix:s,candidates:[{hash:l,name:a.node_name||a.name||"Destination",latitude:a.latitude,longitude:a.longitude,probability:1,isLocal:!1,isDirectNeighbor:!0===a.zero_hop}],confidence:1,totalMatches:1,isDestination:!0};const i=(null==a?void 0:a.node_name)||(null==a?void 0:a.name)||l.slice(0,8);return{prefix:s,candidates:[{hash:l,name:i,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isDestination:!0}},[l,t,n,r]),b=a.useMemo(()=>function(e,t,s,a,n,r){if(!e||0===e.length)return{hops:[],overallConfidence:0,hasValidPath:!1};const i=e.length-1,l=e.map((l,c)=>{const o=c===i,d=e.length-c,{candidates:x,totalMatches:h}=function(e,t,s,a,n=!1,r,i,l){const c=function(e){const t={};for(const[s,a]of Object.entries(e))At(a)&&(t[s]=a);return t}(t);let o;if(i){const t=function(e,t,s){const a=t.toUpperCase(),n=e.get(a);if(!n||0===n.candidates.length)return{hash:null,confidence:0};if(null==s?void 0:s.isLastHop)return{hash:n.bestMatch,confidence:n.confidence};if(1===(null==s?void 0:s.position))return{hash:n.bestMatch,confidence:n.confidence};if((null==s?void 0:s.position)&&n.bestMatchForPosition.has(s.position)){const e=n.bestMatchForPosition.get(s.position),t=Math.max(e.confidence,n.confidence);return{hash:e.hash,confidence:t}}if((null==s?void 0:s.adjacentPrefixes)&&s.adjacentPrefixes.length>0){let e=n.bestMatch,t=0;for(const a of n.candidates){let n=0;for(const e of s.adjacentPrefixes)n+=a.adjacentPrefixCounts.get(e.toUpperCase())||0;const r=a.combinedScore+n/Math.max(1,a.totalAdjacentObservations)*.3;r>t&&(t=r,e=a.hash)}return{hash:e,confidence:n.confidence}}return{hash:n.bestMatch,confidence:n.confidence}}(i,e,{position:l,isLastHop:n});o=t.confidence}const{matches:d,probability:x}=function(e,t,s,a,n=!1){const r=e.toUpperCase(),i=[],l=s&&V(r,s);l&&i.push(s);for(const p of Object.keys(t))V(r,p)&&i.push(p);if(n&&l&&s&&1===i.length)return{matches:i,probability:1,bestMatch:s};if(n&&l&&i.length>1){const e=i.filter(e=>e!==s);if(1===e.length)return{matches:i,probability:1,bestMatch:e[0]}}const c=i.length>0?1/i.length:0,o=[...i].sort();let d=null,x=-1;if(1===o.length)d=o[0];else if(o.length>1&&a){for(const e of o){const t=a.get(e),s=t?"number"==typeof t?t:t.combinedScore:0;s>x&&(x=s,d=e)}d||(d=o[0])}else o.length>0&&(d=o[0]);let h=c;if(i.length>1&&a&&x>0){let e=0;for(const t of i){const s=a.get(t);e+=s?"number"==typeof s?s:s.combinedScore:0}e>0&&(h=Math.min(.95,x/e))}return{matches:i,probability:h,bestMatch:d}}(e,c,a,r,n),h=d.length,p=[],m=e.toUpperCase(),u=s&&void 0!==s.latitude&&void 0!==s.longitude&&(0!==s.latitude||0!==s.longitude);for(const f of d){if(a&&V(m,a)&&f===a&&u&&s){p.push({hash:f,name:s.name||"Local Node",latitude:s.latitude,longitude:s.longitude,probability:n?1:x,isLocal:!0});continue}const e=c[f];(null==e?void 0:e.latitude)&&(null==e?void 0:e.longitude)&&(0!==e.latitude||0!==e.longitude)&&p.push({hash:f,name:e.node_name||e.name||"Unknown",latitude:e.latitude,longitude:e.longitude,probability:x,isLocal:!1,isDirectNeighbor:!0===e.zero_hop})}const g=p.length;if(1===g)p[0].probability=o??1;else if(g>1)if(void 0!==o&&o>0){p[0].probability=o;const e=1-o,t=g-1;p.slice(1).forEach(s=>{s.probability=e/t})}else{let e=0;const t=p.map(t=>{if(t.isLocal)return{candidate:t,score:1};const a=null==r?void 0:r.get(t.hash);let n=.5;var i;let l;return u&&s&&(n=(i=function(e,t,s,a){const n=(s-e)*Math.PI/180,r=(a-t)*Math.PI/180,i=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371e3}(s.latitude,s.longitude,t.latitude,t.longitude))<100?1:i<500?.9:i<1e3?.7:i<5e3?.5:i<1e4?.3:.1),a?l=.3*n+.3*a.hopConsistencyScore+.4*a.frequencyScore:(l=n,t.isDirectNeighbor&&(l=Math.max(l,.8))),e+=l,{candidate:t,score:l}});if(e>0)t.forEach(({candidate:t,score:s})=>{t.probability=Math.min(.95,s/e)});else{const e=1/g;p.forEach(t=>t.probability=e)}}return{candidates:p,totalMatches:h}}(l,t,s,a,o,n,r,d),p=x.length>0?Math.max(...x.map(e=>e.probability)):0;return{prefix:l,candidates:x,confidence:p,totalMatches:h}}),c=l.reduce((e,t)=>0===t.confidence?0:e*t.confidence,1),o=l.some(e=>e.candidates.length>0);return{hops:l,overallConfidence:c,hasValidPath:o}}(e,t,n,r,c,o),[e,t,n,r,c,o]),N=a.useMemo(()=>{const e=[];f?e.push(f):y&&e.push(y),e.push(...b.hops),j&&e.push(j);const t=e.reduce((e,t)=>0===t.confidence?0:e*t.confidence,1),s=e.some(e=>e.candidates.some(e=>0!==e.latitude||0!==e.longitude));return{hops:e,overallConfidence:t,hasValidPath:s}},[f,y,b,j]);return N.hasValidPath?s.jsxs("div",{className:"h-full flex flex-col space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between text-xs",children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx("span",{className:"text-text-muted",children:"Path Confidence:"}),s.jsx("span",{className:(v=N.overallConfidence,v>=1?"text-accent-success":v>=.5?"text-accent-secondary":v>=.25?"text-signal-poor":v>0?"text-accent-danger":"text-text-muted"),children:Ut(N.overallConfidence)}),s.jsx("button",{className:"text-text-muted hover:text-text-secondary transition-colors",title:"Confidence is calculated based on how many known nodes match each path prefix. Multiple matches reduce confidence due to collision probability.",children:s.jsx(p,{className:"w-3 h-3"})})]}),s.jsxs("div",{className:"flex items-center gap-2 text-[10px]",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-accent-success"}),s.jsx("span",{className:"text-text-muted",children:"Exact"})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-accent-secondary"}),s.jsx("span",{className:"text-text-muted",children:"Multi"})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-text-muted"}),s.jsx("span",{className:"text-text-muted",children:"Unknown"})]})]})]}),s.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:s.jsx(zt,{children:s.jsx(a.Suspense,{fallback:s.jsx("div",{className:"h-full bg-bg-elevated flex items-center justify-center text-text-muted text-sm",children:"Loading map..."}),children:s.jsx(Ft,{resolvedPath:N,localNode:n,hubNodes:d,hoveredHopIndex:u,onHoverHop:g,traceSnr:x})})})}),s.jsx("div",{className:"flex flex-wrap items-center gap-1.5",children:N.hops.map((e,t)=>{var a,n,r;const i=!0===e.isSource,l=!0===e.isDestination,c=u===t;let o;return o=i?`Source: ${(null==(a=e.candidates[0])?void 0:a.name)||"Unknown"}`:l?`Destination: ${(null==(n=e.candidates[0])?void 0:n.name)||"Unknown"}`:0===e.totalMatches?"No matching nodes found":1===e.totalMatches?`Exact match: ${(null==(r=e.candidates[0])?void 0:r.name)||"Unknown"}`:`${e.totalMatches} possible matches (${(100*e.confidence).toFixed(0)}% confidence)`,s.jsxs("div",{className:U("flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-mono cursor-pointer transition-all",c?"bg-accent-primary/20 ring-1 ring-accent-primary/50":"bg-bg-elevated hover:bg-bg-subtle",i&&"border border-accent-success/30",l&&"border border-accent-primary/30"),title:o,onMouseEnter:()=>g(t),onMouseLeave:()=>g(null),children:[i&&s.jsx("span",{className:"text-accent-success text-[8px] mr-0.5",children:"SRC"}),l&&s.jsx("span",{className:"text-accent-primary text-[8px] mr-0.5",children:"DST"}),s.jsx("span",{style:Dt(e.confidence,e.totalMatches),children:e.prefix}),!i&&!l&&e.totalMatches>1&&s.jsxs("span",{className:"text-text-muted",children:["×",e.totalMatches]}),!i&&!l&&0===e.totalMatches&&s.jsx("span",{className:"text-text-muted",children:"?"})]},t)})})]}):s.jsxs("div",{className:"flex items-center justify-center text-text-muted text-xs py-4",children:[s.jsx(h,{className:"w-3.5 h-3.5 mr-1.5 opacity-50"}),"No location data available for path nodes"]});var v}function Et(e){return e.match(/.{1,2}/g)||[]}function Rt(e){return null!==e&&e.startsWith("payload:")}const It={red:"var(--sys-red)",orange:"var(--sys-orange)",amber:"var(--sys-amber)",yellow:"var(--sys-yellow)",lime:"var(--sys-green)",green:"var(--sys-green)",emerald:"var(--sys-green)",teal:"var(--sys-teal)",cyan:"var(--sys-cyan)",sky:"var(--sys-cyan)",blue:"var(--sys-blue)",indigo:"var(--sys-indigo)",violet:"var(--sys-indigo)",purple:"var(--sys-purple)",fuchsia:"var(--sys-pink)",pink:"var(--sys-pink)",rose:"var(--sys-red)",brown:"var(--sys-brown)",zinc:"var(--text-muted)"},Vt=15,Ot="color-mix(in srgb, var(--bg-elevated) 60%, var(--bg-body))",Qt="\n    inset 0 0 0 1px color-mix(in srgb, var(--text-primary) 6%, transparent),\n    inset 0 1px 0 color-mix(in srgb, white 3%, transparent),\n    0 1px 2px color-mix(in srgb, black 5%, transparent)\n  ",Wt=2,Gt={type:"tween",duration:.25,ease:[.25,.1,.25,1]};function Kt(e,t){return e?`inset 0 0 0 ${Wt}px ${It[t]}`:Qt}function qt(e,t){return e?t:`color-mix(in srgb, ${t} ${Vt}%, transparent)`}function Yt({segments:e,selectedSegment:t,onSegmentClick:n}){const[r,i]=a.useState(null),[l,c]=a.useState(null),o=e.some(e=>void 0!==e.id)&&n,d=[];for(const s of e){const e=Et(s.hex);for(const t of e)d.push({byte:t.toUpperCase(),color:s.color,id:s.id})}const x=[];for(let s=0;s<d.length;s+=16)x.push(d.slice(s,s+16));return s.jsx("div",{className:"space-y-1",children:x.map((e,a)=>{const d=e.length<16;return s.jsx("div",{className:"flex rounded-md overflow-hidden",children:e.map(({byte:a,color:x,id:h},p)=>{const m=p===e.length-1,u=d&&m,g=It[x],f=h?r===h:l===x,y=Boolean(h&&t===h),j=f||y;return s.jsx("span",{className:"w-[1.75rem] text-xs text-center py-0.5 font-mono select-none "+(o?"cursor-pointer":""),style:{backgroundColor:qt(j,g),color:j?"rgba(255,255,255,0.95)":g,transition:j?"none":"background-color 0.15s ease-out, color 0.15s ease-out",touchAction:"manipulation",...u?{borderRadius:"0 0.375rem 0.375rem 0"}:{}},onMouseEnter:()=>{h?i(h):c(x)},onMouseLeave:()=>{i(null),c(null)},onClick:()=>h&&(null==n?void 0:n(h)),onTouchStart:()=>{h?i(h):c(x)},onTouchEnd:()=>{i(null),c(null)},children:a},p)})},a)})})}function Jt({bits:e,field:t,value:a,binary:n}){return s.jsxs("tr",{children:[s.jsx("td",{className:"py-1.5 text-xs text-text-muted tabular-nums",children:e}),s.jsx("td",{className:"py-1.5 text-sm text-text-secondary",children:t}),s.jsx("td",{className:"py-1.5",children:(()=>{if("Payload Type"===t){const e=le[a]||"zinc";return s.jsx(z,{color:e,children:a})}if("Route Type"===t){const e=ie[a]||"zinc";return s.jsx(z,{color:e,children:a})}return s.jsx("span",{className:"text-sm text-text-primary",children:a})})()}),s.jsx("td",{className:"py-1.5 font-mono text-xs text-sys-cyan",children:n})]})}function Xt({id:e,title:t,color:a,hexBytes:n,startByte:r,endByte:i,isSelected:l,children:c}){const o=n?Et(n):[];return s.jsxs(x.div,{layout:"position",layoutId:e,transition:Gt,className:"w-full min-w-0 overflow-hidden rounded-xl p-4 sm:p-5 space-y-4",style:{backgroundColor:Ot,boxShadow:Kt(l,a)},children:[s.jsxs("div",{className:"flex items-start justify-between gap-4",children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-0.5 min-w-0",children:[s.jsx(z,{color:a,children:t}),o.length>0&&o.length<=16&&o.map((e,t)=>s.jsx(z,{color:a,className:"font-mono",children:e.toUpperCase()},t))]}),s.jsxs("span",{className:"text-[10px] text-text-muted font-mono flex-shrink-0",children:["Bytes ",r,"-",i]})]}),s.jsx("div",{className:"min-w-0 overflow-hidden",children:c})]})}function Zt({advert:e,timestamp:t}){const a=W(t||e.timestamp);return s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-2xl overflow-hidden bg-purple-500/10 dark:bg-purple-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[s.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-purple) 0%, var(--sys-blue) 100%)"},children:s.jsx(k,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:e.name||"Unknown Node"}),s.jsx("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:e.nodeType})]})]}),s.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),s.jsxs("div",{className:"px-4 py-3 space-y-2",children:[void 0!==e.latitude&&void 0!==e.longitude&&s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(h,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 flex-shrink-0"}),s.jsxs("span",{className:"text-sm text-text-secondary font-mono",children:[e.latitude.toFixed(5),"°, ",e.longitude.toFixed(5),"°"]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(y,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 flex-shrink-0"}),s.jsx("span",{className:"text-sm text-text-secondary font-sans",children:a})]})]})]})})}function es({decoded:e,timestamp:t}){const a=t?W(t):"Unknown";return s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-2xl overflow-hidden bg-teal-500/10 dark:bg-teal-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[s.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-teal) 0%, var(--sys-cyan) 100%)"},children:s.jsx(w,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:e.channelName||"Channel Data"}),s.jsxs("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:[e.dataLength," bytes • ",e.decrypted?"Decrypted":"Encrypted"]})]})]}),s.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),s.jsxs("div",{className:"px-4 py-3 space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(f,{className:"w-4 h-4 text-teal-600 dark:text-teal-400 flex-shrink-0"}),s.jsxs("span",{className:"text-sm text-text-secondary font-sans",children:["Channel: ",s.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(y,{className:"w-4 h-4 text-teal-600 dark:text-teal-400 flex-shrink-0"}),s.jsx("span",{className:"text-sm text-text-secondary font-sans",children:a})]}),e.decrypted&&e.decryptedHex&&s.jsxs("div",{className:"mt-2 pt-2 border-t border-black/10 dark:border-white/10",children:[s.jsx("p",{className:"text-[10px] uppercase tracking-wide text-text-muted mb-1 font-sans",children:"Decrypted Data"}),s.jsx("div",{className:"max-w-full overflow-x-auto",children:s.jsx(oe,{size:"compact",copy:!0,className:"inline-block",children:s.jsx("span",{className:"break-all text-xs",children:e.decryptedHex.toUpperCase()})})})]})]})]})})}function ts({decoded:e,timestamp:t,isLoading:a=!1}){const n=t?W(t):"Unknown";return a?s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-xl p-4 sm:p-5",style:{backgroundColor:"color-mix(in srgb, var(--bg-elevated) 60%, var(--bg-body))",boxShadow:"\n              inset 0 0 0 1px color-mix(in srgb, var(--text-primary) 6%, transparent),\n              inset 0 1px 0 color-mix(in srgb, white 3%, transparent),\n              0 1px 2px color-mix(in srgb, black 5%, transparent)\n            "},children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3 h-[15px]",children:[s.jsx("div",{className:"h-2.5 w-12 rounded bg-white/[0.08] animate-pulse"}),s.jsx("div",{className:"h-2.5 w-16 rounded bg-white/[0.08] animate-pulse"})]}),s.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tl-md",style:{background:"color-mix(in srgb, var(--sys-blue) 30%, transparent)"},children:s.jsxs("div",{className:"space-y-1.5",children:[s.jsx("div",{className:"h-3.5 w-48 rounded bg-white/[0.15] animate-pulse"}),s.jsx("div",{className:"h-3.5 w-32 rounded bg-white/[0.15] animate-pulse"})]})})]})}):e.decrypted?s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-xl p-4 sm:p-5",style:{backgroundColor:"color-mix(in srgb, var(--bg-elevated) 60%, var(--bg-body))",boxShadow:"\n              inset 0 0 0 1px color-mix(in srgb, var(--text-primary) 6%, transparent),\n              inset 0 1px 0 color-mix(in srgb, white 3%, transparent),\n              0 1px 2px color-mix(in srgb, black 5%, transparent)\n            "},children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.senderName&&s.jsxs("span",{className:"text-[11px] text-text-muted font-sans",children:["From ",s.jsx("span",{className:"text-text-secondary font-medium",children:e.senderName})]}),e.channelName&&s.jsxs("span",{className:"text-[11px] text-text-muted font-sans",children:["in ",s.jsx("span",{className:"text-sys-cyan font-medium",children:e.channelName})]})]}),s.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tl-md",style:{background:"linear-gradient(135deg, var(--sys-blue) 0%, color-mix(in srgb, var(--sys-blue) 85%, var(--sys-cyan)) 100%)"},children:s.jsx("p",{className:"text-sm text-white font-sans leading-relaxed whitespace-pre-wrap break-words",children:e.text})})]})}):s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-2xl overflow-hidden bg-zinc-500/10 dark:bg-zinc-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[s.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-zinc) 0%, color-mix(in srgb, var(--sys-zinc) 70%, black) 100%)"},children:s.jsx(j,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:"Encrypted Message"}),s.jsxs("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:["Channel hash: ",s.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]})]})]}),s.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),s.jsxs("div",{className:"px-4 py-3 space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(y,{className:"w-4 h-4 text-zinc-500 dark:text-zinc-400 flex-shrink-0"}),s.jsx("span",{className:"text-sm text-text-secondary font-sans",children:n})]}),s.jsx("p",{className:"text-xs text-text-muted",children:"Private channel or unknown hash channel. Channel secret required for decryption."})]})]})})}function ss({decoded:e,timestamp:t}){const a=t?W(t):"Unknown";return s.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:"linear-gradient(135deg, var(--sys-green) 0%, var(--sys-teal) 100%)"},children:s.jsx(v,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-semibold text-text-primary font-sans",children:"Acknowledgment"}),s.jsxs("p",{className:"text-xs text-text-muted font-sans mt-0.5",children:["CRC: ",s.jsxs("span",{className:"font-mono text-sys-green",children:["0x",e.crc]})," · ",a]})]})]})}function as({decoded:e,timestamp:t}){const a=t?W(t):"Unknown",n=e.path.length;return s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-2xl overflow-hidden bg-amber-500/10 dark:bg-amber-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[s.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-amber) 0%, var(--sys-orange) 100%)"},children:s.jsx(N,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:"Path Response"}),s.jsxs("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:[n," ",1===n?"hop":"hops"]})]})]}),s.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),s.jsxs("div",{className:"px-4 py-3 space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(y,{className:"w-4 h-4 text-amber-600 dark:text-amber-400 flex-shrink-0"}),s.jsx("span",{className:"text-sm text-text-secondary font-sans",children:a})]}),e.path.length>0&&s.jsx("div",{className:"mt-2 pt-2 border-t border-black/10 dark:border-white/10",children:s.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.path.map((e,t)=>s.jsxs("div",{className:"flex items-center gap-2",children:[t>0&&s.jsx(l,{className:"w-4 h-4 text-amber-500 dark:text-amber-400"}),s.jsx(z,{color:"amber",className:"font-mono",children:e})]},t))})})]})]})})}function ns({decoded:e,timestamp:t}){const a=t?W(t):"Unknown",n=e.pathHashes.length,r=e.snrValues.length;return s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-2xl overflow-hidden bg-blue-500/10 dark:bg-blue-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[s.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-blue) 0%, var(--sys-indigo) 100%)"},children:s.jsx(b,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("h3",{className:"text-lg font-medium text-text-primary truncate leading-tight",children:["Trace ",e.isComplete?"Complete":"In Progress"]}),s.jsxs("p",{className:"text-sm text-text-muted mt-0.5",children:["Tag: 0x",e.traceTag.slice(0,8),e.isComplete&&" • ✓"]})]})]}),s.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),s.jsxs("div",{className:"px-4 py-3 space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(y,{className:"w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0"}),s.jsx("span",{className:"text-sm text-text-secondary",children:a})]}),s.jsxs("div",{className:"flex items-center gap-4 text-xs text-text-muted",children:[s.jsxs("span",{children:[n," target ",1===n?"hop":"hops"]}),s.jsx("span",{children:"•"}),s.jsxs("span",{children:[r," SNR ",1===r?"sample":"samples"]}),0!==e.authCode&&s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"•"}),s.jsxs("span",{children:["Auth: ",e.authCode]})]})]}),e.pathHashes.length>0&&s.jsx("div",{className:"flex flex-wrap items-center gap-2 pt-1",children:e.pathHashes.map((t,a)=>{const n=e.snrValues[a],r=void 0!==n?(e=>e>=7?"green":e>=0?"yellow":e>=-5?"orange":"red")(n):"zinc",i=void 0!==n;return s.jsxs("div",{className:"flex items-center gap-2",children:[a>0&&s.jsx(l,{className:"w-4 h-4 text-blue-500 dark:text-blue-400 flex-shrink-0"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(z,{color:i?"blue":"zinc",className:"font-mono",children:t}),i&&s.jsxs(z,{color:r,className:"font-mono",children:[n>=0?"+":"",Number.isInteger(n)?n:n.toFixed(1),"dB"]})]})]},a)})})]})]})})}function rs({decoded:e,timestamp:t}){const a=t?W(t):"Unknown";return e.encrypted?s.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:"linear-gradient(135deg, var(--sys-purple) 0%, var(--sys-indigo) 100%)"},children:s.jsx(j,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-semibold text-text-primary font-sans",children:"Encrypted Message"}),s.jsxs("p",{className:"text-xs text-text-muted font-sans mt-0.5",children:[e.srcHash," → ",e.destHash," · ",a]})]})]}):s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1.5 px-1",children:[s.jsxs("span",{className:"text-[11px] text-text-muted font-sans",children:[s.jsx("span",{className:"font-mono text-text-secondary",children:e.srcHash})," → ",s.jsx("span",{className:"font-mono text-text-secondary",children:e.destHash})]}),s.jsxs("span",{className:"text-[11px] text-text-muted font-sans",children:["· ",a]})]}),s.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tr-md ml-auto",style:{background:"linear-gradient(135deg, var(--sys-green) 0%, var(--sys-teal) 100%)"},children:s.jsx("p",{className:"text-sm text-white font-sans leading-relaxed whitespace-pre-wrap break-words",children:e.text})})]})}function is({decoded:e,timestamp:t}){const a=t?W(t):"Unknown",n=(e.partNumber+1)/e.totalParts*100;return s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-2xl overflow-hidden bg-yellow-500/10 dark:bg-yellow-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[s.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-yellow) 0%, var(--sys-amber) 100%)"},children:s.jsx(g,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:"Multipart Segment"}),s.jsxs("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:["Part ",e.partNumber+1," of ",e.totalParts]})]})]}),s.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),s.jsxs("div",{className:"px-4 py-3 space-y-3",children:[s.jsx("div",{children:s.jsx("div",{className:"h-2 bg-black/10 dark:bg-white/10 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${n}%`,background:"linear-gradient(90deg, var(--sys-yellow), var(--sys-amber))"}})})}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(f,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400 flex-shrink-0"}),s.jsxs("span",{className:"text-sm text-text-secondary font-sans",children:["Message ID: ",s.jsx("span",{className:"font-mono",children:e.messageId})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(y,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400 flex-shrink-0"}),s.jsx("span",{className:"text-sm text-text-secondary font-sans",children:a})]})]})]})})}function ls({decoded:e,timestamp:t,payloadType:a}){const n=t?W(t):"Unknown",r=(()=>{switch(a){case 0:return{icon:T,gradient:"var(--sys-orange), var(--sys-red)",bg:"rgba(249, 115, 22, 0.15)",label:"Request"};case 1:return{icon:S,gradient:"var(--sys-green), var(--sys-teal)",bg:"rgba(34, 197, 94, 0.15)",label:"Response"};case 7:return{icon:j,gradient:"var(--sys-purple), var(--sys-pink)",bg:"rgba(168, 85, 247, 0.15)",label:"Anonymous Request"};default:return{icon:C,gradient:"var(--sys-gray), var(--sys-slate)",bg:"rgba(107, 114, 128, 0.15)",label:e.payloadTypeName}}})(),i=r.icon;return s.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:`linear-gradient(135deg, ${r.gradient})`},children:s.jsx(i,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-semibold text-text-primary font-sans",children:r.label}),s.jsxs("p",{className:"text-xs text-text-muted font-sans mt-0.5",children:[e.length," bytes · ",n]})]})]})}function cs({pathHex:e}){if(!e)return null;const t=Et(e);return s.jsx("div",{className:"flex flex-wrap items-center gap-2 py-2",children:t.map((e,t)=>s.jsxs("div",{className:"flex items-center gap-2",children:[t>0&&s.jsx(l,{className:"w-4 h-4 text-sys-amber flex-shrink-0"}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(oe,{size:"compact",copy:!0,children:e.toUpperCase()}),s.jsx("span",{className:"text-[10px] text-text-muted font-sans tabular-nums w-4 text-left",children:t+1})]})]},t))})}function os({decoded:e,payloadType:t}){const a=Ue[t]||`TYPE_${t}`;switch(e.type){case"advert":{const t="chat"===e.nodeType?"companion":e.nodeType.replace("_"," "),a=void 0!==e.latitude&&void 0!==e.longitude&&!(0===e.latitude&&0===e.longitude);return s.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[s.jsxs("p",{children:[s.jsx("span",{className:"text-text-muted",children:"Role:"})," ",t]}),e.name&&s.jsxs("p",{children:[s.jsx("span",{className:"text-text-muted",children:"Name:"})," ",e.name]}),a&&s.jsxs("p",{children:[s.jsx("span",{className:"text-text-muted",children:"Location:"})," ",e.latitude.toFixed(4),"°, ",e.longitude.toFixed(4),"°"]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-text-muted",children:"Time:"})," ",W(e.timestamp)]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-text-muted",children:"Flags:"})," ",e.flagsDescription]})]})}case"ack":return s.jsx("div",{className:"text-xs text-text-primary space-y-0.5",children:s.jsxs("p",{children:[s.jsx("span",{className:"text-text-muted",children:"CRC:"})," 0x",e.crc]})});case"path":return s.jsx("div",{className:"text-xs text-text-primary space-y-1",children:s.jsxs("p",{children:[s.jsx("span",{className:"text-text-muted",children:"Path:"})," ",e.pathString||"(empty)"]})});case"trace":return s.jsxs("div",{className:"text-xs text-text-primary space-y-1",children:[s.jsxs("p",{children:[s.jsx("span",{className:"text-text-muted",children:"Tag:"})," 0x",e.traceTag]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-text-muted",children:"Target Path:"})," ",e.pathString||"(empty)"]}),e.snrValues.length>0&&s.jsxs("p",{children:[s.jsx("span",{className:"text-text-muted",children:"SNR:"})," ",e.snrValues.map(e=>`${e>=0?"+":""}${Number.isInteger(e)?e:e.toFixed(1)}dB`).join(" → ")]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-text-muted",children:"Status:"})," ",e.isComplete?"✓ Complete":`In progress (${e.snrValues.length}/${e.pathHashes.length})`]})]});case"txt_msg":return s.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[s.jsxs("p",{children:[s.jsx("span",{className:"text-text-muted",children:"Dest:"})," ",e.destHash]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-text-muted",children:"Src:"})," ",e.srcHash]}),e.encrypted?s.jsx("p",{className:"text-text-muted italic",children:"Encrypted content"}):s.jsxs("p",{children:[s.jsx("span",{className:"text-text-muted",children:"Text:"})," ",e.text]})]});case"grp_txt":return s.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[s.jsxs("p",{children:[s.jsx("span",{className:"text-text-muted",children:"Channel:"})," ",e.channelName?s.jsx("span",{className:"text-accent-success",children:e.channelName}):s.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]}),e.decrypted?s.jsxs(s.Fragment,{children:[e.senderName&&s.jsxs("p",{children:[s.jsx("span",{className:"text-text-muted",children:"From:"})," ",e.senderName]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-text-muted",children:"Text:"})," ",e.text]})]}):s.jsx("p",{className:"text-text-muted italic",children:"Encrypted (unknown channel)"})]});case"grp_data":return s.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[s.jsxs("p",{children:[s.jsx("span",{className:"text-text-muted",children:"Channel:"})," ",e.channelName?s.jsx("span",{className:"text-sys-teal",children:e.channelName}):s.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-text-muted",children:"Data:"})," ",e.dataLength," bytes ",e.decrypted?"(decrypted)":"(encrypted)"]})]});case"multipart":return s.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[s.jsxs("p",{children:[s.jsx("span",{className:"text-text-muted",children:"Part:"})," ",e.partNumber+1,"/",e.totalParts]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-text-muted",children:"Message ID:"})," ",e.messageId]})]});default:return s.jsxs("p",{className:"text-xs text-text-secondary",children:[a," (",e.length," bytes)"]})}}const ds=a.memo(function({packet:e}){var t;const n=e.raw_packet||"",r=n.length/2,i=Q(),[c,o]=a.useState(null),[d,h]=a.useState(null),[p,m]=a.useState(!1),[g,f]=a.useState(null),y=a.useCallback(e=>{f(t=>t===e?null:e)},[]),j=a.useMemo(()=>ct(n),[n]),b=5===(null==(t=null==j?void 0:j.packet)?void 0:t.payloadType)&&(!i||p);if(a.useEffect(()=>{if(!(null==j?void 0:j.packet)||5!==j.packet.payloadType)return o(null),void m(!1);if(!i)return void m(!0);m(!0);let e=!1;return async function(e){if(e.length<4)return null;const t=e[0],s=Re(t,!0),a=e.slice(1,3),n=e.slice(3),r={type:"grp_txt",channelHash:s,text:Ee(n),decrypted:!1,ciphertextHex:Ee(n),macHex:Ee(a)};try{const{tryDecryptGroupMessage:e}=await ae(async()=>{const{tryDecryptGroupMessage:e}=await Promise.resolve().then(()=>yt);return{tryDecryptGroupMessage:e}},void 0),s=await e(t,a,n);if(s&&s.plaintext.length>=5){r.channelName=s.channelName;const e=s.plaintext,t=st(e,0),a=e[4],n=new TextDecoder("utf-8",{fatal:!1}).decode(e.slice(5));r.decrypted=!0,r.timestamp=t,r.flags=a;const i=n.indexOf(": ");i>0?(r.senderName=n.slice(0,i),r.text=n.slice(i+2)):r.text=n}}catch(i){}return r}(j.packet.payload).then(t=>{e||(t&&o(t),m(!1))}),()=>{e=!0}},[null==j?void 0:j.packet,i]),a.useEffect(()=>{if(!(null==j?void 0:j.packet)||6!==j.packet.payloadType)return void h(null);if(!i)return;let e=!1;return async function(e){if(e.length<4)return null;const t=e[0],s=Re(t,!0),a=e.slice(1,3),n=e.slice(3),r={type:"grp_data",channelHash:s,dataHex:Ee(n),dataLength:n.length,decrypted:!1,macHex:Ee(a)};try{const{tryDecryptGroupMessage:e}=await ae(async()=>{const{tryDecryptGroupMessage:e}=await Promise.resolve().then(()=>yt);return{tryDecryptGroupMessage:e}},void 0),s=await e(t,a,n);s&&(r.channelName=s.channelName,r.decrypted=!0,r.decryptedHex=Ee(s.plaintext))}catch(i){}return r}(j.packet.payload).then(t=>{!e&&t&&h(t)}),()=>{e=!0}},[null==j?void 0:j.packet,i]),!j||0===n.length)return s.jsx("div",{className:"p-4 text-center text-text-muted",children:s.jsx("p",{className:"text-sm",children:"No raw packet data available"})});const{packet:N}=j;let v=j.decoded;c&&"grp_txt"===j.decoded.type?v=c:d&&"grp_data"===j.decoded.type&&(v=d);const w=a.useMemo(()=>function(e,t){switch(e.type){case"advert":return function(e,t){const a=[];let n=0;const r=t.slice(0,64);a.push({id:"payload:publicKey",title:"Public Key",color:"pink",hex:r,startByte:n,endByte:n+31,decoded:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:e.publicKey.toUpperCase()}),s.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Ed25519 public key (32 bytes)"})]})}),n+=32;const i=t.slice(64,72);a.push({id:"payload:timestamp",title:"Timestamp",color:"orange",hex:i,startByte:n,endByte:n+3,decoded:s.jsxs(s.Fragment,{children:[s.jsx(oe,{size:"standard",copy:!0,children:i.toUpperCase()}),s.jsxs("p",{className:"text-xs text-text-primary mt-1",children:[e.timestamp," (",W(e.timestamp),")"]})]})}),n+=4;const l=t.slice(72,200);a.push({id:"payload:signature",title:"Signature",color:"teal",hex:l,startByte:n,endByte:n+63,decoded:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:e.signature.toUpperCase()}),s.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Ed25519 signature (64 bytes)"})]})}),n+=64;const c=t.slice(200,202);if(a.push({id:"payload:flags",title:"Flags",color:"blue",hex:c,startByte:n,endByte:n,decoded:s.jsxs(s.Fragment,{children:[s.jsxs(oe,{size:"standard",copy:!0,children:["0x",e.flags.toString(16).padStart(2,"0").toUpperCase()]}),s.jsx("p",{className:"text-xs text-text-primary mt-1",children:e.flagsDescription}),s.jsxs("p",{className:"text-xs text-text-muted",children:["Node Type: ",e.nodeType]})]})}),n+=1,void 0!==e.latitude){const r=t.slice(2*n,2*n+8);a.push({id:"payload:latitude",title:"Latitude",color:"green",hex:r,startByte:n,endByte:n+3,decoded:s.jsxs(s.Fragment,{children:[s.jsx(oe,{size:"standard",copy:!0,children:r.toUpperCase()}),s.jsxs("p",{className:"text-xs text-text-primary mt-1",children:[e.latitude.toFixed(6),"°"]})]})}),n+=4}if(void 0!==e.longitude){const r=t.slice(2*n,2*n+8);a.push({id:"payload:longitude",title:"Longitude",color:"purple",hex:r,startByte:n,endByte:n+3,decoded:s.jsxs(s.Fragment,{children:[s.jsx(oe,{size:"standard",copy:!0,children:r.toUpperCase()}),s.jsxs("p",{className:"text-xs text-text-primary mt-1",children:[e.longitude.toFixed(6),"°"]})]})}),n+=4}if(e.name){const r=t.slice(2*n),i=r.length/2;a.push({id:"payload:name",title:"Name",color:"amber",hex:r,startByte:n,endByte:n+i-1,decoded:s.jsxs(s.Fragment,{children:[s.jsx(oe,{size:"standard",copy:!0,children:r.toUpperCase()}),s.jsxs("p",{className:"text-xs text-text-primary mt-1",children:['"',e.name,'"']})]})})}return a}(e,t);case"ack":return function(e,t){return[{id:"payload:crc",title:"CRC",color:"green",hex:t.slice(0,8),startByte:0,endByte:3,decoded:s.jsxs(s.Fragment,{children:[s.jsxs(oe,{size:"standard",copy:!0,children:["0x",e.crc]}),s.jsx("p",{className:"text-xs text-text-muted mt-1",children:"CRC32 of acknowledged packet"})]})}]}(e,t);case"grp_txt":return function(e,t){const a=[];a.push({id:"payload:channelHash",title:"Channel Hash",color:"blue",hex:t.slice(0,2),startByte:0,endByte:0,decoded:s.jsxs(s.Fragment,{children:[s.jsxs(oe,{size:"standard",copy:!0,children:["0x",e.channelHash]}),e.channelName&&s.jsxs("p",{className:"text-xs text-text-primary mt-1",children:["Channel: ",e.channelName]})]})}),e.macHex&&a.push({id:"payload:mac",title:"MAC",color:"purple",hex:t.slice(2,6),startByte:1,endByte:2,decoded:s.jsxs(s.Fragment,{children:[s.jsx(oe,{size:"standard",copy:!0,children:e.macHex.toUpperCase()}),s.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Truncated HMAC-SHA256"})]})});const n=t.slice(6);return n&&a.push({id:"payload:ciphertext",title:e.decrypted?"Message":"Ciphertext",color:e.decrypted?"green":"zinc",hex:n,startByte:3,endByte:3+n.length/2-1,decoded:e.decrypted?s.jsxs(s.Fragment,{children:[s.jsxs("p",{className:"text-sm text-text-primary",children:['"',e.text,'"']}),e.senderName&&s.jsxs("p",{className:"text-xs text-text-muted mt-1",children:["From: ",e.senderName]})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:n.toUpperCase()}),s.jsx("p",{className:"text-xs text-text-muted mt-1",children:"AES-128-ECB encrypted"})]})}),a}(e,t);case"grp_data":return function(e,t){const a=[];a.push({id:"payload:channelHash",title:"Channel Hash",color:"blue",hex:t.slice(0,2),startByte:0,endByte:0,decoded:s.jsxs(s.Fragment,{children:[s.jsxs(oe,{size:"standard",copy:!0,children:["0x",e.channelHash]}),e.channelName&&s.jsxs("p",{className:"text-xs text-text-primary mt-1",children:["Channel: ",e.channelName]})]})}),e.macHex&&a.push({id:"payload:mac",title:"MAC",color:"purple",hex:t.slice(2,6),startByte:1,endByte:2,decoded:s.jsxs(s.Fragment,{children:[s.jsx(oe,{size:"standard",copy:!0,children:e.macHex.toUpperCase()}),s.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Truncated HMAC-SHA256"})]})});const n=t.slice(6);return n&&a.push({id:"payload:ciphertext",title:e.decrypted?"Decrypted Data":"Encrypted Data",color:e.decrypted?"green":"zinc",hex:n,startByte:3,endByte:3+n.length/2-1,decoded:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:(e.decryptedHex||n).toUpperCase()}),s.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[e.dataLength," bytes",e.decrypted?"":" (AES-128-ECB encrypted)"]})]})}),a}(e,t);case"path":return function(e,t){return[{id:"payload:path",title:"Path Hops",color:"amber",hex:t,startByte:0,endByte:t.length/2-1,decoded:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex flex-wrap items-center gap-1",children:e.path.map((e,t)=>s.jsxs("span",{className:"flex items-center gap-1",children:[t>0&&s.jsx(l,{className:"w-3 h-3 text-text-muted"}),s.jsx(z,{color:"amber",className:"font-mono",children:e})]},t))}),s.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[e.path.length," hops"]})]})}]}(e,t);case"trace":return function(e,t){const a=[];a.push({id:"payload:crc",title:"Trace Tag",color:"blue",hex:t.slice(0,8),startByte:0,endByte:3,decoded:s.jsxs(s.Fragment,{children:[s.jsxs(oe,{size:"standard",copy:!0,children:["0x",e.traceTag]}),s.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Unique trace request identifier"})]})}),a.push({id:"payload:mac",title:"Auth Code",color:"purple",hex:t.slice(8,16),startByte:4,endByte:7,decoded:s.jsxs(s.Fragment,{children:[s.jsx(oe,{size:"standard",copy:!0,children:e.authCode}),s.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Authentication/verification code"})]})}),a.push({id:"payload:flags",title:"Flags",color:"amber",hex:t.slice(16,18),startByte:8,endByte:8,decoded:s.jsxs(s.Fragment,{children:[s.jsxs(oe,{size:"standard",copy:!0,children:["0x",e.flags.toString(16).toUpperCase().padStart(2,"0")]}),s.jsx("p",{className:"text-xs text-text-muted mt-1",children:0===e.flags?"No flags set":`Flags: ${e.flags.toString(2).padStart(8,"0")}b`})]})});const n=t.slice(18);if(n){const t=e=>e>=7?"green":e>=0?"yellow":e>=-5?"orange":"red";a.push({id:"payload:path",title:"Target Path",color:"indigo",hex:n,startByte:9,endByte:9+n.length/2-1,decoded:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex flex-wrap items-center gap-1",children:e.pathHashes.map((a,n)=>{const r=e.snrValues[n],i=void 0!==r?t(r):"zinc";return s.jsxs("span",{className:"flex items-center gap-1",children:[n>0&&s.jsx(l,{className:"w-3 h-3 text-text-muted"}),s.jsx(z,{color:"indigo",className:"font-mono",children:a}),void 0!==r&&s.jsxs(z,{color:i,className:"font-mono",children:[r>=0?"+":"",Number.isInteger(r)?r:r.toFixed(1),"dB"]})]},n)})}),s.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[e.pathHashes.length," target ",1===e.pathHashes.length?"hop":"hops",e.snrValues.length>0&&` • ${e.snrValues.length} SNR ${1===e.snrValues.length?"value":"values"} collected`,e.isComplete&&" • ✓ Complete"]})]})})}return a}(e,t);case"multipart":return function(e,t){const a=[];a.push({id:"payload:msgId",title:"Message ID",color:"blue",hex:t.slice(0,4),startByte:0,endByte:1,decoded:s.jsxs(s.Fragment,{children:[s.jsx(oe,{size:"standard",copy:!0,children:e.messageId.toUpperCase()}),s.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Unique message identifier"})]})}),a.push({id:"payload:partNum",title:"Part Number",color:"amber",hex:t.slice(4,6),startByte:2,endByte:2,decoded:s.jsxs(s.Fragment,{children:[s.jsx(oe,{size:"standard",copy:!0,children:e.partNumber}),s.jsx("p",{className:"text-xs text-text-muted mt-1",children:"0-indexed part number"})]})}),a.push({id:"payload:totalParts",title:"Total Parts",color:"orange",hex:t.slice(6,8),startByte:3,endByte:3,decoded:s.jsxs(s.Fragment,{children:[s.jsx(oe,{size:"standard",copy:!0,children:e.totalParts}),s.jsxs("p",{className:"text-xs text-text-muted mt-1",children:["Part ",e.partNumber+1," of ",e.totalParts]})]})});const n=t.slice(8);return n&&a.push({id:"payload:partData",title:"Part Data",color:"cyan",hex:n,startByte:4,endByte:4+n.length/2-1,decoded:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:n.toUpperCase()}),s.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[n.length/2," bytes"]})]})}),a}(e,t);default:return[{id:"payload:ciphertext",title:"Raw Data",color:"zinc",hex:t,startByte:0,endByte:t.length/2-1,decoded:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:t.toUpperCase()}),s.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[t.length/2," bytes"]})]})}]}}(v,j.payloadHex),[v,j.payloadHex]),k="payload"===g||Rt(g),C=a.useMemo(()=>{const e=[{id:"header",hex:j.headerHex,color:"red"},...j.transportCodesHex?[{id:"transportCodes",hex:j.transportCodesHex,color:"purple"}]:[],{id:"pathLength",hex:j.pathLengthHex,color:"green"},...j.pathDataHex?[{id:"pathData",hex:j.pathDataHex,color:"amber"}]:[]];return k?[...e,...(t=w,t.map(e=>({id:e.id,hex:e.hex,color:e.color})))]:[...e,{id:"payload",hex:j.payloadHex,color:"cyan"}];var t},[j,k,w]);return s.jsxs("div",{className:"font-mono space-y-2 min-w-0 overflow-hidden",children:[(()=>{switch(v.type){case"advert":return s.jsx(Zt,{advert:v,timestamp:e.timestamp});case"grp_data":return s.jsx(es,{decoded:v,timestamp:e.timestamp});case"grp_txt":return s.jsx(ts,{decoded:v,timestamp:e.timestamp,isLoading:b});case"ack":return s.jsx(ss,{decoded:v,timestamp:e.timestamp});case"path":return s.jsx(as,{decoded:v,timestamp:e.timestamp});case"trace":return s.jsx(ns,{decoded:v,timestamp:e.timestamp});case"txt_msg":return s.jsx(rs,{decoded:v,timestamp:e.timestamp});case"multipart":return s.jsx(is,{decoded:v,timestamp:e.timestamp});case"generic":return 0===N.payloadType||1===N.payloadType||7===N.payloadType?s.jsx(ls,{decoded:v,timestamp:e.timestamp,payloadType:N.payloadType}):null;default:return null}})(),s.jsx("div",{className:"bg-black rounded-2xl p-6",children:s.jsx(Yt,{segments:C,selectedSegment:g,onSegmentClick:y})}),s.jsx(u,{children:s.jsx(x.div,{layout:!0,transition:Gt,className:"space-y-2 min-w-0",children:(()=>{var e,t,a,n;const i=[{id:"header",title:"Header",color:"red",startByte:0,endByte:0,hexBytes:`0x${j.headerHex.toUpperCase()}`,condition:!0,content:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"text-[10px] uppercase tracking-wide text-text-muted border-b border-border-subtle font-sans",children:[s.jsx("th",{className:"py-1 font-medium",children:"Bits"}),s.jsx("th",{className:"py-1 font-medium",children:"Field"}),s.jsx("th",{className:"py-1 font-medium",children:"Value"}),s.jsx("th",{className:"py-1 font-medium",children:"Binary"})]})}),s.jsx("tbody",{children:j.headerFields.map(e=>s.jsx(Jt,{...e},e.bits))})]})},{id:"transportCodes",title:"Transport Codes",color:"purple",startByte:1,endByte:4,hexBytes:(null==(e=j.transportCodesHex)?void 0:e.toUpperCase())||"",condition:!!j.transportCodesHex,content:s.jsxs(s.Fragment,{children:[s.jsx("p",{className:"text-xs text-text-muted",children:"Two 16-bit transport codes for encrypted routing"}),s.jsxs("div",{className:"mt-1 text-xs text-text-secondary",children:["Code 1: 0x",null==(t=j.transportCodesHex)?void 0:t.slice(0,4).toUpperCase()," | Code 2: 0x",null==(a=j.transportCodesHex)?void 0:a.slice(4,8).toUpperCase()]})]})},{id:"pathLength",title:"Path Length",color:"green",startByte:j.transportCodesHex?5:1,endByte:j.transportCodesHex?5:1,hexBytes:`0x${j.pathLengthHex.toUpperCase()}`,condition:!0,content:s.jsxs("p",{className:"text-xs text-text-muted pt-1",children:[N.pathLen," bytes showing route taken (increases as packet floods)"]})},{id:"pathData",title:"Path Data",color:"amber",startByte:j.transportCodesHex?6:2,endByte:(j.transportCodesHex?5:1)+N.pathLen,hexBytes:(null==(n=j.pathDataHex)?void 0:n.toUpperCase())||"",condition:N.pathLen>0,content:s.jsxs("div",{className:"space-y-3",children:[s.jsx(cs,{pathHex:j.pathDataHex}),s.jsx("p",{className:"text-xs text-text-muted",children:"Historical route taken (bytes are added as packet floods through network)"})]})},{id:"payload",title:"Payload",color:"cyan",startByte:j.payloadStartByte,endByte:r-1,hexBytes:j.payloadHex.toUpperCase(),condition:!0,content:s.jsxs(s.Fragment,{children:[!Rt(g)&&s.jsxs("div",{className:"p-3 rounded-lg bg-black",children:[s.jsx("p",{className:"text-[10px] uppercase tracking-wide text-text-muted mb-1.5 font-sans",children:"Decoded"}),s.jsx(os,{decoded:v,payloadType:N.payloadType})]}),!Rt(g)&&w.length>0&&s.jsx("p",{className:"text-[10px] uppercase tracking-wide text-text-muted mt-3 font-sans",children:"Click a field below to highlight its bytes"}),Rt(g)&&s.jsx("p",{className:"text-[10px] uppercase tracking-wide text-text-muted font-sans",children:"↑ Selected field above • Other fields below ↓"})]})}].filter(e=>e.condition),l=Rt(g)?w.find(e=>e.id===g):null,c=Rt(g)?[...i].sort((e,t)=>"payload"===e.id?-1:"payload"===t.id?1:0):[...i].sort((e,t)=>e.id===g?-1:t.id===g?1:0),o=Rt(g)?w.filter(e=>e.id!==g):[];return s.jsxs(s.Fragment,{children:[l&&s.jsx(Xt,{id:`subfield-${l.id}`,title:l.title,color:l.color,startByte:j.payloadStartByte+l.startByte,endByte:j.payloadStartByte+l.endByte,hexBytes:l.hex.toUpperCase(),isSelected:!0,children:l.decoded},l.id),c.map(e=>s.jsx(Xt,{id:`section-${e.id}`,title:e.title,color:e.color,startByte:e.startByte,endByte:e.endByte,hexBytes:e.hexBytes,isSelected:e.id===g,children:e.content},e.id)),o.map(e=>s.jsxs(x.div,{layout:"position",layoutId:`subfield-${e.id}`,transition:Gt,className:"w-full min-w-0 overflow-hidden rounded-xl p-4 sm:p-5 space-y-4",style:{backgroundColor:Ot,boxShadow:Qt},children:[s.jsxs("div",{className:"flex items-start justify-between gap-4",children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-0.5 min-w-0",children:[s.jsx(z,{color:e.color,children:e.title}),e.hex.length<=32&&Et(e.hex).map((t,a)=>s.jsx(z,{color:e.color,className:"font-mono",children:t.toUpperCase()},a))]}),s.jsxs("span",{className:"text-[10px] text-text-muted font-mono flex-shrink-0",children:["Bytes ",j.payloadStartByte+e.startByte,"-",j.payloadStartByte+e.endByte]})]}),s.jsx("div",{className:"min-w-0 overflow-hidden p-3 rounded-lg bg-black",children:e.decoded})]},e.id))]})})()})})]})});function xs(e){if(!e)return[];if(Array.isArray(e))return e;try{const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}}function hs(e){return e?(e.startsWith("0x")?e.slice(2):e).slice(0,2).toUpperCase():""}function ps({hop:e,compact:t=!1,index:n=0,highlightIndex:r=-1,isTrace:i=!1}){var l;const c=n===r,o=_();return a.useEffect(()=>{c&&i&&o.start({boxShadow:["0 0 0 0px rgba(113, 156, 223, 0)","0 0 0 2px rgba(113, 156, 223, 0.5)","0 0 0 2px rgba(113, 156, 223, 0.5)","0 0 0 0px rgba(113, 156, 223, 0)"],transition:{duration:.5,times:[0,.2,.7,1],ease:"easeInOut"}})},[c,i,o]),s.jsxs(x.div,{className:U("flex items-center gap-1.5",t?"flex-row":"flex-col"),animate:{scale:c?1.05:1,opacity:c?1:.85},transition:{duration:.3,ease:"easeInOut"},children:[s.jsxs(x.div,{className:U("flex items-center gap-1.5 px-2.5 py-1 rounded-md","font-mono text-xs font-semibold",e.isLocal?"bg-amber-500/20 text-amber-300 ring-1 ring-amber-500/30":"bg-zinc-700/50 text-zinc-200 ring-1 ring-zinc-600/50"),animate:o,initial:{boxShadow:"0 0 0 0px rgba(113, 156, 223, 0)"},children:[e.isLocal&&s.jsx(H,{className:"w-3 h-3"}),s.jsx("span",{children:e.prefix}),void 0!==e.confidence&&e.confidence<.9&&s.jsxs("span",{className:"text-[9px] opacity-70",children:[(100*e.confidence).toFixed(0),"%"]})]}),!t&&(null==(l=e.neighborInfo)?void 0:l.name)&&s.jsx("span",{className:"text-[10px] text-text-muted truncate max-w-[80px]",children:e.neighborInfo.name})]})}function ms({snr:e}){const t=xe(e),a=de()[t]||"#6b7280",n=Number.isInteger(e)?e.toString():e.toFixed(1);return s.jsxs(z,{customColor:a,compact:!0,className:"font-mono",children:[e>=0?"+":"",n,"dB"]})}function us({hops:e,compact:t,isTrace:n=!1}){const[r,i]=a.useState(-1);return a.useEffect(()=>{if(0===e.length)return;const t=setTimeout(()=>{i(0)},400),s=setInterval(()=>{i(t=>{const a=t+1;return a>=e.length?(clearInterval(s),-1):a})},n?500:600);return()=>{clearTimeout(t),clearInterval(s)}},[e.length,n]),s.jsx("div",{className:"p-6",style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"4px 8px"},children:e.map((a,i)=>{const l=i%2==0,c=i===e.length-1;return s.jsxs("div",{className:"contents",children:[s.jsx("div",{className:U("flex items-center","justify-end"),children:l&&s.jsx(ps,{hop:a,compact:t,index:i,highlightIndex:r,isTrace:n})}),s.jsx("div",{className:"flex flex-col items-center justify-center min-h-[28px]",children:!c&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-px flex-1 bg-zinc-600/40 min-h-[8px]"}),void 0!==a.snr&&s.jsx(ms,{snr:a.snr}),s.jsx("svg",{className:"w-3 h-3 text-zinc-500 flex-shrink-0",viewBox:"0 0 12 12",fill:"none",children:s.jsx("path",{d:"M6 2v8M3 7l3 3 3-3",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]})}),s.jsx("div",{className:U("flex items-center","justify-start"),children:!l&&s.jsx(ps,{hop:a,compact:t,index:i,highlightIndex:r,isTrace:n})})]},`${a.prefix}-${i}`)})})}const gs=a.memo(function({packet:e,neighbors:t,localHash:n,neighborAffinity:r,ghostPrefixes:i,direction:o="horizontal",compact:d=!1,traceSnr:x,overridePath:h}){const p=void 0!==x&&x.length>0,m=xs(e.original_path),u=xs(e.forwarded_path),g=h??(u.length>0?u:m),f=hs(n),y=a.useMemo(()=>g.map((e,s)=>{const a=e.toUpperCase(),n=a===f,l=(null==i?void 0:i.has(a))??!1,c=function(e,t,s){const a=e.toUpperCase();if(s){let e=null,n=0;if(s.forEach((t,s)=>{if(hs(s)===a){const a=t.combinedScore??0;a>n&&(n=a,e=s)}}),e&&t[e])return{hash:e,info:t[e],confidence:n}}for(const[n,r]of Object.entries(t))if(hs(n)===a)return{hash:n,info:r,confidence:void 0};return null}(a,t,r);return{prefix:a,fullHash:null==c?void 0:c.hash,neighborInfo:null==c?void 0:c.info,isLocal:n,isGhost:l,confidence:null==c?void 0:c.confidence,snr:null==x?void 0:x[s]}}),[g,t,r,f,i,x]);if(0===y.length)return s.jsxs("div",{className:"flex items-center gap-2 text-text-muted text-xs",children:[s.jsx(k,{className:"w-4 h-4 opacity-50"}),s.jsx("span",{children:"Direct / No path data"})]});if("flowchart"===o)return s.jsx(us,{hops:y,compact:d,isTrace:p});const j="horizontal"===o?l:c;return s.jsx("div",{className:U("flex gap-1.5","horizontal"===o?"flex-row flex-wrap items-center":"flex-col items-start"),children:y.map((e,t)=>s.jsxs("div",{className:U("flex items-center gap-1.5","vertical"===o&&"flex-col"),children:[s.jsx(ps,{hop:e,compact:d}),t<y.length-1&&s.jsx(j,{className:"w-3 h-3 text-text-muted flex-shrink-0"})]},`${e.prefix}-${t}`))})});function fs(e){if(!e)return[];if(Array.isArray(e))return e;try{const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}}function ys({packets:e,selectedIndex:t,onSelect:a,compact:n=!1}){if(e.length<=1)return null;const r=t>0,l=t<e.length-1;return s.jsxs("div",{className:U("flex items-center gap-1",n?"gap-0.5":"gap-1"),children:[s.jsx("button",{onClick:()=>r&&a(t-1),disabled:!r,className:U("p-0.5 rounded transition-colors",r?"text-text-muted hover:text-text-primary hover:bg-white/10":"text-white/20 cursor-not-allowed"),"aria-label":"Previous observation",children:s.jsx(B,{className:n?"size-3":"size-4"})}),s.jsx("div",{className:"flex items-center gap-0.5",children:e.map((e,r)=>{const i=r===t,l=new Date(1e3*e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});return s.jsx(Z,{color:i?"cyan":"zinc",filled:i,compact:n,onClick:()=>a(r),title:`Observation ${r+1} at ${l}`,className:U("transition-all duration-150",!i&&"opacity-60 hover:opacity-100"),children:n?s.jsx("span",{className:"tabular-nums",children:r+1}):s.jsxs("span",{className:"tabular-nums text-[10px]",children:["#",r+1,null!=e.rssi&&s.jsx("span",{className:"ml-1 opacity-70",children:e.rssi})]})},`${e.timestamp}_${r}`)})}),s.jsx("button",{onClick:()=>l&&a(t+1),disabled:!l,className:U("p-0.5 rounded transition-colors",l?"text-text-muted hover:text-text-primary hover:bg-white/10":"text-white/20 cursor-not-allowed"),"aria-label":"Next observation",children:s.jsx(o,{className:n?"size-3":"size-4"})}),s.jsxs("span",{className:U("text-text-muted ml-1",n?"text-[9px]":"text-[10px]"),children:[s.jsx(i,{className:"inline size-3 mr-0.5 opacity-50"}),e.length]})]})}const js=a.memo(function({packets:e,initialIndex:t=0,onClose:n}){const[r,i]=a.useState(t),l=e[r]??e[0],c=e.length>1,o=a.useCallback(t=>{i(Math.max(0,Math.min(t,e.length-1)))},[e.length]),d=G(),h=K(),p=q(),m=Y(),u=a.useMemo(()=>new Set(m.map(e=>e.prefix.toUpperCase())),[m]),g=l.payload_type_name||R(l.payload_type??l.type),f=l.route_type_name||I(l.route_type??l.route),y=l.payload_length??l.length??0,j=fs(l.original_path),b=fs(l.forwarded_path),N=j.length>0||b.length>0,v=b.length>0?b:j,w=a.useMemo(()=>{var e;if(null==(e=null==d?void 0:d.config)?void 0:e.repeater)return{latitude:d.config.repeater.latitude,longitude:d.config.repeater.longitude,name:d.config.node_name||"Local Node"}},[d]),k=(null==d?void 0:d.neighbors)??{},C=p.size>0?p:void 0,S=l.raw_packet&&l.raw_packet.length>0,T=a.useMemo(()=>{if(9!==(l.payload_type??l.type)||!l.payload)return null;try{const e=$e(l.payload),t=l.original_path||l.forwarded_path||[];let s=[];if("string"==typeof t)try{const e=JSON.parse(t);Array.isArray(e)&&(s=e.map(e=>parseInt(e,16)))}catch{s=[]}else Array.isArray(t)&&(s=t.map(e=>parseInt(e,16)));return it(e,s)}catch{return null}},[l]),_=null==T?void 0:T.snrValues,H=a.useMemo(()=>{if(4!==(l.payload_type??l.type)||!l.payload)return null;try{const e=rt($e(l.payload));if(!e)return null;const t=e.publicKey.slice(0,2).toUpperCase();return{...e,prefix:t}}catch{return null}},[l]),B=a.useMemo(()=>{if((null==H?void 0:H.latitude)&&(null==H?void 0:H.longitude))return{latitude:H.latitude,longitude:H.longitude,name:H.name||`Node ${H.prefix||"??"}`,prefix:H.prefix,publicKey:H.publicKey}},[H]),M=4===(l.payload_type??l.type)&&(void 0!==B||N);if(0===v.length)return null;const L=(null==d?void 0:d.local_hash)?(d.local_hash.startsWith("0x")?d.local_hash.slice(2,4):d.local_hash.slice(0,2)).toUpperCase():"";for(const s of v){const e=s.toUpperCase();if(e!==L)if(C){let t=0,s=0;if(C.forEach((a,n)=>{(n.startsWith("0x")?n.slice(2,4):n.slice(0,2)).toUpperCase()===e&&(t++,s=Math.max(s,a.combinedScore??0))}),0===t)for(const a of Object.keys(k))if((a.startsWith("0x")?a.slice(2,4):a.slice(0,2)).toUpperCase()===e)break}else for(const t of Object.keys(k))if((t.startsWith("0x")?t.slice(2,4):t.slice(0,2)).toUpperCase()===e)break}const A={lime:"rgb(132, 204, 22)",cyan:"rgb(34, 211, 238)",amber:"rgb(251, 191, 36)",violet:"rgb(167, 139, 250)",rose:"rgb(251, 113, 133)",emerald:"rgb(52, 211, 153)",sky:"rgb(56, 189, 248)",orange:"rgb(251, 146, 60)",pink:"rgb(244, 114, 182)",zinc:"rgb(161, 161, 170)",purple:"rgb(168, 85, 247)",indigo:"rgb(129, 140, 248)",teal:"rgb(45, 212, 191)",fuchsia:"rgb(232, 121, 249)",blue:"rgb(59, 130, 246)",green:"rgb(34, 197, 94)",yellow:"rgb(250, 204, 21)",red:"rgb(239, 68, 68)"},F=A[le[g]??"zinc"]||A.zinc;return s.jsxs(J,{open:!0,onClose:n,size:"5xl",motionPlus:!0,className:"sm:h-[85vh] sm:max-h-[800px] md:h-[80vh] md:max-h-[900px]",children:[s.jsxs("div",{className:"sm:hidden",children:[s.jsx("div",{className:"flex justify-center pt-2 pb-1",children:s.jsx("div",{className:"w-9 h-1 rounded-full bg-white/30","aria-hidden":"true"})}),s.jsxs("div",{className:"flex items-center justify-between px-3 pb-2",children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(z,{color:le[g]??"zinc",className:"!text-[9px] !px-1.5 !py-0",children:g}),s.jsx(z,{color:"DIRECT"===f||"T_DIRECT"===f?"cyan":"amber",className:"!text-[9px] !px-1.5 !py-0",children:f}),s.jsxs(z,{color:"zinc",className:"!text-[9px] !px-1.5 !py-0",children:[y,"B"]})]}),s.jsx("button",{onClick:n,className:"px-3 py-1.5 text-[15px] font-medium text-blue-400 active:text-blue-300 transition-colors flex-shrink-0 rounded-lg active:bg-white/5",children:"Done"})]}),c&&s.jsx("div",{className:"px-3 pb-2",children:s.jsx(ys,{packets:e,selectedIndex:r,onSelect:o,compact:!0})})]}),s.jsx("div",{className:"hidden sm:block px-6 pt-5 pb-4",children:s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(z,{color:le[g]??"zinc",children:g}),s.jsx(z,{color:"DIRECT"===f||"T_DIRECT"===f?"cyan":"amber",children:f}),s.jsxs(z,{color:"zinc",children:[y,"B"]}),c&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-px h-4 bg-white/10"}),s.jsx(ys,{packets:e,selectedIndex:r,onSelect:o})]})]}),s.jsx("button",{onClick:n,className:"p-1.5 -m-1.5 text-text-muted hover:text-text-primary transition-colors rounded-lg hover:bg-bg-elevated flex-shrink-0",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})}),s.jsx("div",{className:"sm:hidden h-[2px]",style:{backgroundColor:F,opacity:.6}}),s.jsxs(X,{className:"p-0 overflow-hidden flex-1 flex flex-col min-h-0",children:[s.jsx("div",{className:"md:hidden flex-1 overflow-y-auto overflow-x-hidden",children:s.jsxs("div",{className:"p-2 space-y-2",children:[(null!=l.rssi||null!=l.snr)&&s.jsxs("div",{className:"relative flex items-center justify-between px-2 py-1.5 rounded-lg bg-white/[0.03]",children:[s.jsx(P,{mode:"popLayout",initial:!1,children:s.jsxs(x.div,{className:"flex items-center gap-3",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[s.jsx(re,{rssi:l.rssi,snr:l.snr,compact:!0,showValues:!0}),s.jsx("span",{className:"text-[11px] text-white/50",children:ce(l.rssi)})]},r)}),v.length>0&&s.jsxs("span",{className:"text-[10px] font-mono text-white/40",children:[v.length," hop",1!==v.length?"s":""]})]}),(N&&v.length>0||M)&&s.jsx("div",{className:"overflow-hidden rounded-xl",children:s.jsx("div",{className:"aspect-[4/3] w-full",children:s.jsx($t,{path:v,neighbors:k,localNode:w,localHash:null==d?void 0:d.local_hash,srcHash:l.src_hash,dstHash:l.dst_hash,neighborAffinity:C,hubNodes:[...h],traceSnr:_,advertiserSource:B})})}),T&&T.pathHashes.length>0&&s.jsxs("div",{className:"rounded-xl bg-black overflow-hidden",children:[s.jsx("div",{className:"px-3 py-2 space-y-1.5",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-[10px] font-medium text-text-muted uppercase tracking-wide",children:"Trace Route"}),s.jsx("div",{className:"flex items-center gap-1.5",children:s.jsx(z,{color:T.isComplete?"green":"amber",compact:!0,children:T.isComplete?"Complete":"In Progress"})})]})}),s.jsx(gs,{packet:l,neighbors:k,localHash:null==d?void 0:d.local_hash,neighborAffinity:C,ghostPrefixes:u,direction:"flowchart",compact:!0,overridePath:T.pathHashes,traceSnr:T.snrValues})]}),N&&!T&&s.jsxs("div",{className:"rounded-xl bg-black overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[s.jsx("span",{className:"text-[10px] font-medium text-text-muted uppercase tracking-wide",children:"Path"}),s.jsxs(z,{color:"zinc",compact:!0,children:[v.length," hop",1!==v.length?"s":""]})]}),s.jsx(gs,{packet:l,neighbors:k,localHash:null==d?void 0:d.local_hash,neighborAffinity:C,ghostPrefixes:u,direction:"flowchart",compact:!0,traceSnr:_})]}),S&&s.jsx("div",{className:"pt-1",children:s.jsx(ds,{packet:l})})]})}),s.jsxs("div",{className:"hidden md:grid md:grid-cols-2 flex-1 overflow-hidden",children:[s.jsx("div",{className:"overflow-y-auto overflow-x-hidden scrollbar-none p-4 border-r border-border-subtle",children:S&&s.jsx(ds,{packet:l})}),s.jsxs("div",{className:"grid overflow-hidden",style:{gridTemplateRows:"minmax(280px, 1fr) auto"},children:[s.jsx("div",{className:"overflow-hidden p-2",children:N&&v.length>0||M?s.jsx("div",{className:"h-full w-full",children:s.jsx($t,{path:v,neighbors:k,localNode:w,localHash:null==d?void 0:d.local_hash,srcHash:l.src_hash,dstHash:l.dst_hash,neighborAffinity:C,hubNodes:[...h],traceSnr:_,advertiserSource:B})}):s.jsx("div",{className:"h-full w-full flex items-center justify-center text-text-muted text-sm",children:"No path data"})}),s.jsxs("div",{className:"overflow-y-auto max-h-[200px] p-2 space-y-2",children:[!T&&v.length<=1&&(null!=l.rssi||null!=l.snr)&&s.jsx("div",{className:"glass-card rounded-xl p-4",children:s.jsxs("dl",{className:"text-xs grid grid-cols-2 gap-2",children:[s.jsxs("div",{children:[s.jsx("dt",{className:"text-text-muted mb-1",children:"Signal"}),s.jsx(P,{mode:"popLayout",initial:!1,children:s.jsxs(x.dd,{className:"flex items-center gap-2",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[s.jsx(re,{rssi:l.rssi,snr:l.snr}),s.jsx("span",{className:"font-medium text-text-primary",children:ce(l.rssi)})]},r)})]}),s.jsxs("div",{children:[s.jsx("dt",{className:"text-text-muted mb-1",children:"RF"}),s.jsx(P,{mode:"popLayout",initial:!1,children:s.jsxs(x.dd,{className:"font-mono text-text-secondary tabular-nums",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[null!=l.rssi&&`${l.rssi} dBm`,null!=l.snr&&` · ${l.snr.toFixed(1)} dB`]},r)})]})]})}),T&&T.pathHashes.length>0&&s.jsxs("div",{className:"rounded-xl bg-black overflow-hidden",children:[s.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[s.jsx("span",{className:"text-xs font-medium text-text-muted uppercase tracking-wide",children:"Trace Route"}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(z,{color:T.isComplete?"green":"amber",compact:!0,children:T.isComplete?"Complete":"In Progress"}),s.jsxs(z,{color:"teal",compact:!0,children:[T.pathHashes.length,"h"]})]})]}),s.jsx(gs,{packet:l,neighbors:k,localHash:null==d?void 0:d.local_hash,neighborAffinity:C,ghostPrefixes:u,direction:"flowchart",compact:!0,overridePath:T.pathHashes,traceSnr:T.snrValues})]}),N&&!T&&s.jsxs("div",{className:"rounded-xl bg-black overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between px-4 py-2",children:[s.jsx("span",{className:"text-xs font-medium text-text-muted uppercase tracking-wide",children:"Path"}),s.jsxs(z,{color:"zinc",compact:!0,children:[v.length,"h"]})]}),s.jsx(gs,{packet:l,neighbors:k,localHash:null==d?void 0:d.local_hash,neighborAffinity:C,ghostPrefixes:u,direction:"flowchart",compact:!0,traceSnr:_})]})]})]})]})]})]})}),bs={type:"spring",visualDuration:.6,bounce:.25,opacity:{duration:.2,ease:"linear"}};function Ns({value:e,format:t,prefix:n,className:r}){const[i,l]=a.useState("waiting");if(a.useEffect(()=>{const e=setTimeout(()=>{l("mounted")},400);return()=>clearTimeout(e)},[]),a.useEffect(()=>{if("mounted"===i){const e=requestAnimationFrame(()=>{l("animating")});return()=>cancelAnimationFrame(e)}},[i]),"waiting"===i){const e=(0).toLocaleString(void 0,t);return s.jsxs("span",{className:r,children:[n,e]})}return s.jsx(A,{className:r,format:t,prefix:n,transition:bs,children:"animating"===i?e:0})}function vs({label:e,numericValue:t,unit:a,icon:n,subtext:r,showSign:i=!1}){return s.jsxs("div",{className:"rounded-lg p-3 sm:rounded-xl sm:p-4 bg-white/[0.03] ring-1 ring-inset ring-white/[0.06]",children:[s.jsx("div",{className:"mb-1.5 sm:mb-2",children:s.jsx("span",{className:"text-[10px] sm:text-[11px] font-medium uppercase tracking-wide text-text-muted",children:e})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ns,{value:t,format:{minimumFractionDigits:1,maximumFractionDigits:1,signDisplay:i?"always":"auto"},className:"font-mono text-xl sm:text-2xl font-semibold tabular-nums tracking-tight text-white"}),s.jsxs("div",{className:"flex flex-col items-center justify-center",children:[s.jsx(n,{className:"w-[14px] h-[14px] text-text-muted"}),a&&s.jsx("span",{className:"text-[10px] sm:text-xs font-medium leading-tight text-text-muted",children:a})]})]}),r&&s.jsx("p",{className:"mt-1.5 sm:mt-2 font-mono text-[10px] sm:text-[11px] text-text-muted/80 truncate",children:r})]})}function ws({snr:e}){const t=e>=5?"bg-sys-teal":e>=0?"bg-sys-green":e>=-5?"bg-sys-amber":e>=-10?"bg-sys-orange":"bg-sys-red";return s.jsx("span",{className:U("w-1.5 h-1.5 rounded-full flex-shrink-0",t),title:`SNR: ${e.toFixed(1)} dB`})}function ks({fromPrefix:e,toPrefix:t,fromName:a,toName:n,snr:r,maxSnr:i,isWeakest:c,isStrongest:o,index:d=0}){const h=Math.max(i+5,15),p=Math.max(0,Math.min(100,(r- -20)/(h- -20)*100)),m="bg-[#0074BE]",u=r>=5?"bg-sys-teal":r>=0?"bg-sys-green":r>=-5?"bg-sys-amber":r>=-10?"bg-sys-orange":"bg-sys-red",g=.3+.15*d;return s.jsxs("div",{className:"relative p-3 pl-5 rounded-lg bg-white/[0.03] ring-1 ring-inset ring-white/[0.06]",children:[s.jsx("span",{className:U("absolute left-0 top-1/2 -translate-y-1/2 h-4 w-0.5 rounded-full",u)}),s.jsx("span",{className:"absolute -top-0.5 -right-0.5",children:s.jsx(ws,{snr:r})}),s.jsxs("div",{className:"sm:hidden",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[s.jsx("span",{className:"text-[13px] font-medium text-white/70 truncate",children:a||e}),s.jsx(l,{className:"w-3 h-3 text-white/30 flex-shrink-0"}),s.jsx("span",{className:"text-[13px] font-semibold text-white truncate",children:n||t})]}),s.jsxs("div",{className:"flex items-center gap-1.5 ml-2 flex-shrink-0",children:[c&&s.jsx(z,{color:"red",compact:!0,children:"Low"}),o&&!c&&s.jsxs(z,{color:"amber",compact:!0,children:[s.jsx(F,{className:"w-2.5 h-2.5"}),"Best"]}),s.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[12px] font-mono font-bold tabular-nums bg-white/[0.06] text-text-primary ring-1 ring-inset ring-white/[0.1]",children:[r>=0?"+":"−",Math.abs(r).toFixed(1)]})]})]}),s.jsx("div",{className:"h-1.5 bg-white/10 rounded-full overflow-hidden",children:s.jsx(x.div,{className:U("h-full rounded-full",m),initial:{width:0},animate:{width:`${p}%`},transition:{duration:1.5,delay:g,ease:[.25,.1,.25,1]}})})]}),s.jsxs("div",{className:"hidden sm:block",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[s.jsx("code",{className:"font-mono text-xs text-text-muted",children:e}),a&&s.jsx("span",{className:"text-xs text-text-secondary truncate max-w-[100px]",children:a})]}),s.jsx(l,{className:"w-3 h-3 text-text-muted/40 flex-shrink-0"}),s.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[s.jsx("code",{className:"font-mono text-xs font-semibold text-text-primary",children:t}),n&&s.jsx("span",{className:"text-xs text-text-secondary truncate max-w-[100px]",children:n})]})]}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[c&&s.jsx(z,{color:"red",compact:!0,children:"Bottleneck"}),o&&!c&&s.jsxs(z,{color:"amber",compact:!0,children:[s.jsx(F,{className:"w-3 h-3"}),"Strongest"]}),s.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-sm font-mono font-semibold tabular-nums bg-white/[0.06] text-text-primary ring-1 ring-inset ring-white/[0.1]",children:[r>=0?"+":"−",Math.abs(r).toFixed(1)]})]})]}),s.jsx("div",{className:"h-1.5 bg-bg-elevated rounded-full overflow-hidden",children:s.jsx(x.div,{className:U("h-full rounded-full",m),initial:{width:0},animate:{width:`${p}%`},transition:{duration:1.5,delay:g,ease:[.25,.1,.25,1]}})})]})]})}function Cs(e,t){if("You"===e)return"You";const s=e.toUpperCase();for(const[a,n]of Object.entries(t))if((a.startsWith("0x")?a.slice(2,4):a.slice(0,2)).toUpperCase()===s)return n.name||n.node_name||void 0}const Ss=a.memo(function({report:e,onClose:t}){var a,n;const r=G(),i=(null==r?void 0:r.neighbors)??{},l=(null==(a=null==r?void 0:r.config)?void 0:a.repeater)?{latitude:r.config.repeater.latitude,longitude:r.config.repeater.longitude,name:r.config.node_name||"Local Node"}:void 0,c=null==(n=e.bestObservation)?void 0:n.decoded.snrValues,o=e.linkQuality?e.linkQuality.avgSnr>=5?"excellent":e.linkQuality.avgSnr>=0?"good":e.linkQuality.avgSnr>=-5?"fair":"poor":"unknown",d={excellent:"var(--signal-excellent)",good:"var(--signal-good)",fair:"var(--signal-fair)",poor:"var(--signal-poor)",unknown:"var(--text-muted)"}[o];return s.jsxs(J,{open:!0,onClose:t,size:"5xl",motionPlus:!0,children:[s.jsxs("div",{className:"sm:hidden",children:[s.jsx("div",{className:"flex justify-center pt-2 pb-1",children:s.jsx("div",{className:"w-9 h-1 rounded-full bg-white/30","aria-hidden":"true"})}),s.jsxs("div",{className:"flex items-center justify-between px-4 pb-2",children:[s.jsx("h2",{className:"font-semibold text-[17px] text-white",children:"Trace Report"}),s.jsx("button",{onClick:t,className:"text-[17px] font-medium text-blue-400 active:text-blue-300",children:"Done"})]})]}),s.jsx("div",{className:"sm:hidden h-[2px]",style:{backgroundColor:d,opacity:.6}}),s.jsx("div",{className:"hidden sm:block px-6 pt-5 pb-4",children:s.jsxs("div",{className:"flex items-start justify-between gap-3",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[s.jsx("h2",{className:"text-base sm:text-lg font-semibold text-text-primary",children:"Trace Report"}),s.jsxs(z,{color:"excellent"===o||"good"===o?"green":"fair"===o?"amber":"red",children:[s.jsx(M,{className:"w-3 h-3 mr-1"}),"excellent"===o?"Excellent":"good"===o?"Good":"fair"===o?"Fair":"Poor"]})]}),s.jsx("p",{className:"mt-1 text-xs sm:text-sm font-mono text-text-muted tabular-nums",children:e.traceTag})]}),s.jsx("button",{onClick:t,className:"p-1.5 -m-1.5 text-text-muted hover:text-text-primary transition-colors rounded-lg hover:bg-bg-elevated flex-shrink-0",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})}),s.jsxs("div",{className:"hidden sm:flex flex-wrap items-center gap-1.5 sm:gap-2 px-4 sm:px-6 pb-3 sm:pb-4 border-b border-border-subtle",children:[s.jsxs(z,{color:"teal",children:[s.jsx("span",{className:"font-mono tabular-nums",children:e.targetHopCount}),s.jsxs("span",{className:"ml-1",children:["hop",1!==e.targetHopCount?"s":""]})]}),s.jsxs(z,{color:"zinc",children:[s.jsx("span",{className:"font-mono tabular-nums",children:e.observationCount}),s.jsx("span",{className:"ml-1",children:"obs"})]}),e.linkQuality&&s.jsxs(z,{color:"purple",children:[s.jsx("span",{className:"font-mono tabular-nums",children:e.linkQuality.avgSnr.toFixed(1)}),s.jsx("span",{className:"ml-1",children:"dB avg"})]}),s.jsx("span",{className:"font-mono text-xs text-text-muted tabular-nums",children:ee(e.duration)}),e.linkQuality&&s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"text-text-muted/40",children:"•"}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-medium bg-sys-red/15 text-sys-red ring-1 ring-inset ring-sys-red/25",children:[s.jsx("span",{className:"opacity-70",children:"Min"}),s.jsx("span",{className:"font-mono tabular-nums",children:e.linkQuality.minSnr.toFixed(1)})]}),s.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-medium bg-sys-teal/15 text-sys-teal ring-1 ring-inset ring-sys-teal/25",children:[s.jsx("span",{className:"opacity-70",children:"Max"}),s.jsx("span",{className:"font-mono tabular-nums",children:e.linkQuality.maxSnr.toFixed(1)})]})]})]})]}),s.jsxs(X,{className:"p-0 overflow-hidden",children:[s.jsx("div",{className:"md:hidden h-[75vh] max-h-[calc(100vh-80px)] overflow-y-auto overflow-x-hidden",children:s.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.linkQuality&&s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("div",{className:"rounded-lg bg-white/[0.03] ring-1 ring-inset ring-white/[0.06] p-2.5 text-center",children:[s.jsx(Ns,{value:Math.abs(e.linkQuality.minSnr),format:{maximumFractionDigits:0,signDisplay:"never"},prefix:e.linkQuality.minSnr<0?"-":"",className:"text-[20px] font-bold font-mono tabular-nums flex items-center justify-center text-white"}),s.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[s.jsx(m,{className:"w-2.5 h-2.5 text-text-muted"}),s.jsx("span",{className:"text-[10px] text-white/40",children:"Min dB"})]})]}),s.jsxs("div",{className:"rounded-lg bg-white/[0.03] ring-1 ring-inset ring-white/[0.06] p-2.5 text-center",children:[s.jsx(Ns,{value:e.linkQuality.maxSnr,format:{maximumFractionDigits:0,signDisplay:"always"},className:"text-[20px] font-bold font-mono text-white tabular-nums flex items-center justify-center"}),s.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[s.jsx(L,{className:"w-2.5 h-2.5 text-text-muted"}),s.jsx("span",{className:"text-[10px] text-white/40",children:"Max dB"})]})]})]}),s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsxs(z,{color:"excellent"===o||"good"===o?"green":"fair"===o?"amber":"red",compact:!0,children:[s.jsx(M,{className:"w-2.5 h-2.5 mr-0.5"}),"excellent"===o?"Excellent":"good"===o?"Good":"fair"===o?"Fair":"Poor"]}),s.jsxs(z,{color:"teal",compact:!0,children:[e.targetHopCount," hops"]}),s.jsxs(z,{color:"zinc",compact:!0,children:[e.observationCount," obs"]}),s.jsx("span",{className:"text-[10px] font-mono text-white/30 ml-auto",children:e.traceTag.slice(0,8)})]}),e.targetPath.length>0&&s.jsx("div",{className:"overflow-hidden rounded-xl",children:s.jsx("div",{className:"aspect-[4/3] w-full",children:s.jsx($t,{path:e.targetPath,neighbors:i,localNode:l,localHash:null==r?void 0:r.local_hash,srcHash:e.srcHash,dstHash:e.dstHash,traceSnr:c})})}),s.jsxs("div",{className:"rounded-xl bg-black overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-white/5",children:[s.jsx("span",{className:"text-[11px] font-medium text-white/60",children:"Route Path"}),e.linkQuality&&s.jsxs("span",{className:"text-[10px] font-mono text-white/40",children:["SNR ",e.linkQuality.minSnr.toFixed(1)," → ",e.linkQuality.maxSnr.toFixed(1)," dB"]})]}),e.bestObservation?s.jsx(gs,{packet:e.bestObservation.packet,neighbors:i,localHash:null==r?void 0:r.local_hash,direction:"flowchart",compact:!0,overridePath:e.targetPath,traceSnr:e.bestObservation.decoded.snrValues}):s.jsx("div",{className:"p-6 text-center text-text-muted text-[11px]",children:"No path data available"})]}),s.jsxs("div",{children:[s.jsxs("h3",{className:"text-[11px] font-medium uppercase tracking-wide text-white/40 mb-2",children:["Link Quality · ",e.hopStats.length," hops"]}),s.jsx("div",{className:"space-y-1.5",children:e.hopStats.length>0?e.hopStats.map((t,a)=>{var n,r,l;const c=a<e.targetPath.length-1?e.targetPath[a+1]:"You",o=Cs(t.prefix,i),d=Cs(c,i);return s.jsx(ks,{fromPrefix:t.prefix,toPrefix:c,fromName:o,toName:d,snr:t.snr,maxSnr:(null==(n=e.linkQuality)?void 0:n.maxSnr)??10,isWeakest:(null==(r=e.linkQuality)?void 0:r.weakestLinkPosition)===a,isStrongest:(null==(l=e.linkQuality)?void 0:l.strongestLinkPosition)===a,index:a},`${t.prefix}-${a}`)}):s.jsx("div",{className:"text-[11px] text-text-muted py-6 text-center",children:"No link data collected"})})]}),s.jsx("div",{className:"pt-1 pb-2 text-center",children:s.jsxs("span",{className:"text-[10px] text-white/30",children:["Traced ",te(e.firstSeen)]})})]})}),s.jsxs("div",{className:"hidden md:flex md:flex-row h-[70vh] max-h-[calc(100vh-200px)] overflow-hidden",children:[s.jsx("div",{className:"w-1/2 flex flex-col min-w-0 min-h-0 overflow-hidden border-r border-border-subtle",children:s.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.linkQuality&&(()=>{const t=e.targetPath[e.linkQuality.weakestLinkPosition],a=e.targetPath[e.linkQuality.weakestLinkPosition+1]||"You",n=Cs(t,i),r=Cs(a,i),l=e.targetPath[e.linkQuality.strongestLinkPosition],c=e.targetPath[e.linkQuality.strongestLinkPosition+1]||"You",o=Cs(l,i),d=Cs(c,i);return s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsx(vs,{label:"Weakest Link",numericValue:e.linkQuality.minSnr,unit:"dB",icon:m,subtext:`${n||t} → ${r||a}`}),s.jsx(vs,{label:"Best Link",numericValue:e.linkQuality.maxSnr,showSign:!0,unit:"dB",icon:L,subtext:`${o||l} → ${d||c}`})]})})(),s.jsxs("div",{children:[s.jsx("h3",{className:"text-[11px] font-medium uppercase tracking-wide text-text-muted mb-3",children:"Link Details"}),s.jsx("div",{className:"space-y-2",children:e.hopStats.length>0?e.hopStats.map((t,a)=>{var n,r,l;const c=a<e.targetPath.length-1?e.targetPath[a+1]:"You",o=Cs(t.prefix,i),d=Cs(c,i);return s.jsx(ks,{fromPrefix:t.prefix,toPrefix:c,fromName:o,toName:d,snr:t.snr,maxSnr:(null==(n=e.linkQuality)?void 0:n.maxSnr)??10,isWeakest:(null==(r=e.linkQuality)?void 0:r.weakestLinkPosition)===a,isStrongest:(null==(l=e.linkQuality)?void 0:l.strongestLinkPosition)===a,index:a},`${t.prefix}-${a}`)}):s.jsx("div",{className:"text-xs text-text-muted py-8 text-center",children:"No link data collected"})})]}),s.jsxs("div",{className:"pt-2 text-center",children:[s.jsx("span",{className:"text-[10px] text-text-muted",children:"Traced "}),s.jsx("span",{className:"font-mono text-[10px] text-text-muted tabular-nums",children:te(e.firstSeen)})]})]})}),s.jsxs("div",{className:"w-1/2 min-w-0 overflow-y-auto p-3 space-y-2",children:[e.targetPath.length>0&&s.jsx("div",{className:"overflow-hidden",children:s.jsx("div",{className:"aspect-square w-full",children:s.jsx($t,{path:e.targetPath,neighbors:i,localNode:l,localHash:null==r?void 0:r.local_hash,srcHash:e.srcHash,dstHash:e.dstHash,traceSnr:c})})}),s.jsxs("div",{className:"rounded-xl bg-black overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[s.jsx("span",{className:"text-xs font-medium text-text-muted uppercase tracking-wide",children:"Trace Route"}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(z,{color:e.isComplete?"green":"amber",compact:!0,children:e.isComplete?"Complete":`${e.maxHopsObserved}/${e.targetHopCount}`}),s.jsxs(z,{color:"teal",compact:!0,children:[e.targetHopCount," hop",1!==e.targetHopCount?"s":""]})]})]}),e.linkQuality&&e.bestObservation&&s.jsxs("div",{className:"flex items-center gap-4 px-4 pb-2 font-mono text-[10px] text-text-muted",children:[s.jsxs("span",{children:[s.jsx("span",{className:"opacity-60",children:"Tag"})," ",s.jsx("code",{className:"text-teal-400 tabular-nums",children:e.traceTag.slice(0,8)})]}),s.jsxs("span",{children:[s.jsx("span",{className:"opacity-60",children:"SNR"})," ",s.jsxs("code",{className:"text-accent-secondary tabular-nums",children:[e.linkQuality.minSnr.toFixed(1),"–",e.linkQuality.maxSnr.toFixed(1)]}),s.jsx("span",{className:"opacity-60",children:" dB"})]})]}),e.bestObservation?s.jsx(gs,{packet:e.bestObservation.packet,neighbors:i,localHash:null==r?void 0:r.local_hash,direction:"flowchart",compact:!0,overridePath:e.targetPath,traceSnr:e.bestObservation.decoded.snrValues}):s.jsx("div",{className:"p-8 text-center text-text-muted text-xs",children:"No path data available"})]})]})]})]})]})});function Ts({message:e}){return s.jsxs("div",{className:"flex flex-col items-center justify-center py-14 text-center",children:[s.jsx(k,{className:"size-6 text-text-muted mb-2"}),s.jsx("p",{className:"text-sm text-text-primary",children:e}),s.jsx("p",{className:"text-xs text-text-muted",children:"Packets will appear here"})]})}function _s(){return s.jsx("div",{className:"py-14 text-center text-sm text-text-muted",children:"Loading packets…"})}function Hs({showPagination:e,currentPage:t,perPage:a,displayCount:n,totalCount:r,action:i}){const l=e?(t-1)*a+1:1,c=e?Math.min(t*a,r):n;return s.jsxs("div",{className:"flex items-center justify-between gap-4 border-t border-white/5 px-4 py-3 text-xs text-text-muted sm:px-6",children:[s.jsxs("span",{children:["Showing"," ",s.jsx("span",{className:"font-medium text-text-secondary",children:e?`${l}–${c}`:n})," ","of"," ",s.jsx("span",{className:"font-medium text-text-secondary",children:r})," ","packets"]}),i]})}function Ps({packets:e,allPackets:t,localHash:n,neighbors:r,loading:i=!1,maxPackets:l,perPage:c=50,showPagination:o=!1,onPacketSelect:d,flashNewest:x=!1,emptyMessage:h="No packets found",className:p,footerAction:m}){const[u,g]=a.useState(null),[f,y]=a.useState(null),[j,b]=a.useState({traceTag:null,dupeGroup:null}),N=t??e,v=a.useMemo(()=>l&&l>0?e.slice(0,l):e,[e,l]),{currentPage:w,totalPages:k,goToPage:C,pageRange:S}=function(e,t,s){const[n,r]=a.useState(1),i=s?Math.ceil(e/t):1;a.useEffect(()=>{n>i&&i>0&&queueMicrotask(()=>r(1))},[i,n]);const l=a.useCallback(e=>r(Math.max(1,Math.min(e,i))),[i]),c=a.useMemo(()=>function(e,t,s=1){if(t<=7)return Array.from({length:t},(e,t)=>t+1);const a=Math.max(e-s,1),n=Math.min(e+s,t),r=a>2,i=n<t-1;if(!r&&i){const e=3+2*s;return[...Array.from({length:e},(e,t)=>t+1),"gap",t]}if(r&&!i){const e=3+2*s;return[1,"gap",...Array.from({length:e},(s,a)=>t-e+a+1)]}return[1,"gap",...Array.from({length:n-a+1},(e,t)=>a+t),"gap",t]}(n,i),[n,i]);return{currentPage:n,totalPages:i,goToPage:l,pageRange:c}}(v.length,c,o),T=a.useMemo(()=>{if(!o)return v;const e=(w-1)*c;return v.slice(e,e+c)},[v,o,w,c]),_=a.useMemo(()=>function(e){const t=new Map;for(const s of e)if((s.payload_type??s.type)===se.TRACE&&s.payload&&s.packet_hash){const e=jt(s.payload);e&&t.set(s.packet_hash,e)}return t}(T),[T]),H=a.useMemo(()=>function(e){const t=new Map;if(0===e.length)return t;for(let s=0;s<e.length;s++){const a=e[s].packet_hash;if(!a)continue;const n=e[s-1],r=e[s+1],i=(null==n?void 0:n.packet_hash)===a,l=(null==r?void 0:r.packet_hash)===a;(i||l)&&(i&&l?t.set(s,"middle"):i?t.set(s,"last"):l&&t.set(s,"first"))}return t}(T),[T]),P=function(e,t){const[s,n]=a.useState(null),r=a.useRef(0);return a.useEffect(()=>{var s,a;if(!t||!e.length)return;const i=(null==(s=e[0])?void 0:s.timestamp)??0,l=i>r.current&&r.current>0;if(r.current=i,!l)return;const c=null==(a=e[0])?void 0:a.packet_hash;if(!c)return;const o=requestAnimationFrame(()=>n(c)),d=setTimeout(()=>n(null),600);return()=>{cancelAnimationFrame(o),clearTimeout(d)}},[e,t]),s}(e,x),B=a.useCallback((e,t)=>{var s,a;const n=e.packet_hash;if(!n)return[e];let r=t;for(;r>0&&(null==(s=T[r-1])?void 0:s.packet_hash)===n;)r--;let i=t;for(;i<T.length-1&&(null==(a=T[i+1])?void 0:a.packet_hash)===n;)i++;return r===i?[e]:T.slice(r,i+1)},[T]),M=a.useCallback((e,t)=>{if(d)d(e);else if(void 0!==t){const s=B(e,t),a=s.indexOf(e);g({packets:s,initialIndex:a>=0?a:0})}else g({packets:[e],initialIndex:0})},[d,B]),L=a.useCallback(e=>b(t=>({...t,traceTag:e})),[]),A=a.useCallback(e=>b(t=>({...t,dupeGroup:e})),[]),F=a.useCallback(e=>{const t=N.filter(t=>(t.payload_type??t.type)===se.TRACE&&t.payload&&jt(t.payload)===e);if(0===t.length)return;const s=function(e){const t=new Map;for(const s of e){const e=Nt(s);if(!e)continue;const a=e.decoded.traceTag,n=t.get(a)||[];n.push(e),t.set(a,n)}for(const[s,a]of t)a.sort((e,t)=>e.timestamp-t.timestamp),t.set(s,a);return t}(t),a=s.get(e);(null==a?void 0:a.length)&&y(function(e,t){if(0===t.length)return{traceTag:e,traceTagValue:0,targetPath:[],targetHopCount:0,observations:[],observationCount:0,firstSeen:0,lastSeen:0,duration:0,isComplete:!1,maxHopsObserved:0,progressPercent:0,bestObservation:null,hopStats:[],linkQuality:null};const s=[...t].sort((e,t)=>e.timestamp-t.timestamp),a=s.reduce((e,t)=>t.hopCount>e.hopCount?t:e,s[0]),n=s[0].timestamp,r=s[s.length-1].timestamp,i=a.decoded.pathHashes,l=i.length,c=a.hopCount,o=a.decoded.isComplete,d=[],x=a.decoded.snrValues;for(let p=0;p<x.length&&p<i.length;p++)d.push({prefix:i[p],snr:x[p],position:p,quality:bt(x[p])});let h=null;if(x.length>0){const e=Math.min(...x),t=Math.max(...x);h={minSnr:e,maxSnr:t,avgSnr:x.reduce((e,t)=>e+t,0)/x.length,weakestLinkPosition:x.indexOf(e),strongestLinkPosition:x.indexOf(t)}}return{traceTag:e,traceTagValue:a.decoded.traceTagValue,targetPath:i,targetHopCount:l,observations:s,observationCount:s.length,firstSeen:n,lastSeen:r,duration:r-n,isComplete:o,maxHopsObserved:c,progressPercent:l>0?Math.round(c/l*100):0,bestObservation:a,hopStats:d,linkQuality:h,srcHash:a.packet.src_hash,dstHash:a.packet.dst_hash}}(e,a))},[N]),D=a.useCallback(e=>{const t=N.find(t=>t.packet_hash===e);t&&(y(null),M(t))},[N,M]),z=t=>{if(i&&0===e.length)return s.jsx(_s,{});if(0===T.length)return s.jsx(Ts,{message:h});const a=t?Lt:Mt;return T.map((e,t)=>{const i=e.packet_hash?_.get(e.packet_hash):void 0,l=null!==j.traceTag&&i===j.traceTag,c=H.get(t),o=void 0!==c&&null!==j.dupeGroup&&e.packet_hash===j.dupeGroup;return s.jsx(a,{packet:e,onClick:e=>M(e,t),localHash:n,neighbors:r,isFlashing:x&&P===e.packet_hash,traceTag:i,isTraceHighlighted:l,onTraceHover:L,onViewTraceReport:F,dupeGroupPosition:c,isDupeGroupHovered:o,onDupeGroupHover:A},`${e.packet_hash}_${e.timestamp}_${t}`)})};return s.jsxs("div",{className:U("flex flex-col",p),children:[s.jsx("div",{className:"hidden divide-y divide-white/5 py-1 sm:block",children:z(!1)}),s.jsx("div",{className:"divide-y divide-white/5 sm:hidden",children:z(!0)}),o&&k>1&&s.jsx("nav",{className:"border-t border-white/5 px-4 py-3",children:s.jsxs(he,{className:"justify-center",children:[s.jsx(pe,{onClick:()=>C(w-1),disabled:1===w}),s.jsx(ue,{children:S.map((e,t)=>"gap"===e?s.jsx(fe,{},`gap-${t}`):s.jsx(ge,{page:e,current:e===w,onClick:C},e))}),s.jsx(me,{onClick:()=>C(w+1),disabled:w===k})]})}),s.jsx(Hs,{showPagination:o,currentPage:w,perPage:c,displayCount:T.length,totalCount:o?v.length:e.length,action:m}),!d&&u&&s.jsx(js,{packets:u.packets,initialIndex:u.initialIndex,onClose:()=>g(null)}),f&&s.jsx(Ss,{report:f,onClose:()=>y(null),onViewPacket:D})]})}export{Ps as P,Ct as g};
