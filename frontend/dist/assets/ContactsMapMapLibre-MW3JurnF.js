var e,t,n=Object.defineProperty,s=(e,t,s)=>((e,t,s)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);import{c as r,j as i,I as o,X as a,_ as l,ag as c,ah as u,f as h,ai as d}from"./index-CghAavBY.js";import{b as f,g as p,c as g,r as m}from"./recharts-bmHCCfxU.js";import{u as _,a as y,P as b,S as v,L as x,M as w,N as E,b as T}from"./maplibre-gl-DkWLRH05.js";import{G as S,N as A,T as R,M as C,C as P}from"./Contacts-BeK0Kmc9.js";import{a as k,C as I}from"./HashBadge-DRvoJWUk.js";import{L as M}from"./loader-circle-BpG1hWSi.js";import{I as L}from"./info-2P1yfKNj.js";import{H as N}from"./house-B5TO9LE2.js";import{R as O}from"./refresh-cw-CLeY-Xmk.js";import{N as F}from"./trending-up-1mclTNuB.js";import{M as D}from"./map-Bw1EBCOb.js";import"./maplibre-gl-CFO9X1Ek.js";import"./SignalIndicator-DvUTpR-7.js";import"./triangle-alert-WpF8_xK8.js";import"./zap-D4Tr6Fc8.js";import"./activity-DNdDThXC.js";import"./PageLayout-tjMSgERr.js";import"./users-Cb56Pa85.js";const B=r("car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]),U=r("chart-no-axes-column",[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V3",key:"1lcnhd"}],["path",{d:"M19 21V9",key:"unv183"}]]),j=r("chevrons-left-right-ellipsis",[["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"m17 7 5 5-5 5",key:"1xlxn0"}],["path",{d:"m7 7-5 5 5 5",key:"19njba"}],["path",{d:"M8 12h.01",key:"czm47f"}]]),G=r("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),V=r("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),z=r("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),W=r("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),H=r("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),$=r("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),X=r("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]),q=r("minimize-2",[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]]);function Y(e,t){const n=Math.max(5,Math.min(e,300)),s=Math.log(5),r=Math.log(300);return 1+(Math.log(n)-s)/(r-s)*5}const K="#4338CA";function Z({label:e,icon:t,status:n,detail:s}){return i.jsxs("div",{className:g("flex items-center gap-3 py-3 px-4 rounded-xl transition-all duration-300","active"===n&&"bg-[#4338CA]/10","complete"===n&&"bg-accent-success/10","pending"===n&&"opacity-40"),children:[i.jsx("div",{className:g("w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 transition-all duration-300","active"===n&&"bg-[#4338CA]/20","complete"===n&&"bg-accent-success/20","pending"===n&&"bg-white/5"),children:"complete"===n?i.jsx(k,{className:"w-4 h-4 text-accent-success"}):"active"===n?i.jsx(M,{className:"w-4 h-4 animate-spin",style:{color:K}}):i.jsx("span",{className:"text-text-muted",children:t})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("div",{className:g("text-sm font-medium transition-colors","active"===n&&"text-[#4338CA]","complete"===n&&"text-accent-success","pending"===n&&"text-text-muted"),children:e}),s&&"pending"!==n&&i.jsx("div",{className:"text-xs text-text-muted mt-0.5 truncate",children:s})]})]})}const Q=f.memo(function({isOpen:e,currentStep:t,packetCount:n,onClose:s}){if(f.useEffect(()=>{if(!e)return;const t=e=>{"Escape"===e.key&&s&&s()};window.addEventListener("keydown",t);const n=document.body.style.overflow,r=document.body.style.position,i=document.body.style.width,o=document.body.style.top,a=window.scrollY;return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.top=`-${a}px`,()=>{window.removeEventListener("keydown",t),document.body.style.overflow=n,document.body.style.position=r,document.body.style.width=i,document.body.style.top=o,window.scrollTo(0,a)}},[e,s]),!e)return null;const r="complete"===t,o=e=>{const n=["fetching","analyzing","building","complete"],s=n.indexOf(t),r=n.indexOf(e);return r<s?"complete":r===s?"active":"pending"};return p.createPortal(i.jsxs("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center",role:"dialog","aria-modal":"true","aria-labelledby":"deep-analysis-modal-title",children:[i.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm"}),i.jsx("div",{className:"relative glass-card w-full max-w-sm mx-4 p-6 animate-in fade-in zoom-in-95 duration-200",style:{background:"rgba(20, 20, 22, 0.95)",border:"1px solid rgba(140, 160, 200, 0.15)"},children:r?i.jsxs("div",{className:"flex flex-col items-center py-6",children:[i.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center mb-4 animate-in zoom-in-50 duration-300",style:{backgroundColor:"rgba(57, 217, 138, 0.2)"},children:i.jsx(k,{className:"w-8 h-8 text-accent-success"})}),i.jsx("h3",{className:"text-lg font-semibold text-accent-success",children:"Ready!"})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[i.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{backgroundColor:"rgba(67, 56, 202, 0.15)"},children:i.jsx(S,{className:"w-5 h-5",style:{color:K}})}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-semibold text-text-primary",children:"Deep Analysis"}),i.jsx("p",{className:"text-xs text-text-muted",children:"Building mesh topology"})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(Z,{label:"Fetching Packets",icon:i.jsx(z,{className:"w-4 h-4"}),status:o("fetching"),detail:n>0?`${n.toLocaleString()} packets`:"Loading database..."}),i.jsx(Z,{label:"Analyzing Database",icon:i.jsx(V,{className:"w-4 h-4"}),status:o("analyzing"),detail:"Processing packet paths"}),i.jsx(Z,{label:"Building Topology",icon:i.jsx(S,{className:"w-4 h-4"}),status:o("building"),detail:"Computing mesh edges"})]}),i.jsx("p",{className:"text-xs text-text-muted text-center mt-5",children:"This may take a few seconds..."})]})})]}),document.body)}),J="#4338CA",ee="#FBBF24",te="#6366F1",ne="#F97316",se="#F59E0B",re="#FBBF24",ie="#4B5563",oe="#6B7280",ae="#374151",le="#5EEAD4",ce="#6366F1",ue="#9CA3AF",he="#6B7280",de="#FBBF24",fe=2e3;function pe({text:e}){return i.jsxs("span",{className:"group relative cursor-help",children:[i.jsx(L,{className:"w-3 h-3 text-text-muted"}),i.jsx("div",{className:"absolute bottom-full left-0 mb-1 hidden group-hover:block w-44 p-2 text-[10px] leading-tight rounded-lg z-10",style:{background:"rgba(20, 20, 22, 0.98)",border:"1px solid rgba(140, 160, 200, 0.3)"},children:e})]})}function ge(e){const t=new Date(1e3*e);return`${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getDate().toString().padStart(2,"0")}`}function me({hash:e,hashPrefix:t,name:n,isHub:s,isZeroHop:r,isMobile:a,isRoomServer:l,isStale:c,lastSeenTimestamp:u,centrality:h,affinity:d,meanSnr:p,meanRssi:g,neighbor:m,onRemove:_,txDelayRec:y}){const[b,v]=f.useState(!1),x=r?"Direct":(null==d?void 0:d.typicalHopPosition)?`${d.typicalHopPosition}-hop`:null,w=[{label:"Packets",value:(null==d?void 0:d.frequency)||0},{label:"Adverts",value:m.advert_count||0}];r&&void 0!==p&&w.push({label:"SNR",value:`${p.toFixed(1)} dB`}),r&&void 0!==g&&w.push({label:"RSSI",value:`${Math.round(g)} dBm`});const E=y&&!y.insufficientData,T={hub:{bg:"bg-amber-500/20",text:"text-amber-400",title:"Hub: High-connectivity node (4+ neighbors) that bridges many paths"},backbone:{bg:"bg-purple-500/20",text:"text-purple-400",title:"Backbone: Critical relay with 4+ neighbors and high traffic"},relay:{bg:"bg-cyan-500/20",text:"text-cyan-400",title:"Relay: Standard forwarding node with symmetric traffic"},edge:{bg:"bg-gray-500/20",text:"text-gray-400",title:"Edge: Peripheral node with few connections"}},S={high:{bg:"bg-green-500/20",text:"text-green-400",title:"1000+ packets observed"},medium:{bg:"bg-amber-500/20",text:"text-amber-400",title:"500-999 packets observed"},low:{bg:"bg-red-500/20",text:"text-red-400",title:"100-499 packets observed"},insufficient:{bg:"bg-gray-500/20",text:"text-gray-400",title:"Insufficient data for analysis"}};return i.jsxs("div",{className:"w-[220px] pr-3",children:[i.jsx("div",{className:"text-[14px] font-semibold text-text-primary leading-snug truncate mb-0.5",children:n}),i.jsxs("div",{className:"flex items-center gap-1 flex-wrap mb-1.5",children:[i.jsx("code",{className:"font-mono text-[10px] text-text-muted/70 bg-white/5 px-1 py-px rounded",children:t}),i.jsx("button",{onClick:()=>{navigator.clipboard.writeText(e),v(!0),setTimeout(()=>v(!1),1500)},className:"p-0.5 hover:bg-white/10 rounded transition-colors",title:"Copy full hash",children:b?i.jsx(k,{className:"w-2.5 h-2.5 text-accent-success"}):i.jsx(I,{className:"w-2.5 h-2.5 text-text-muted/50"})}),s&&i.jsx("span",{className:"px-1 py-px text-[8px] font-bold uppercase rounded",style:{backgroundColor:"#FBBF24",color:"#000"},children:"Hub"}),x&&i.jsx("span",{className:"px-1 py-px text-[8px] font-bold uppercase rounded",style:{backgroundColor:r?re:"rgba(255,255,255,0.08)",color:r?"#000":"rgba(255,255,255,0.5)"},children:x}),a&&i.jsx("span",{className:"px-1 py-px text-[8px] font-bold uppercase rounded bg-orange-500/25 text-orange-300",children:"Mobile"}),m.is_repeater&&i.jsx("span",{className:"px-1 py-px text-[8px] font-bold uppercase rounded bg-cyan-500/20 text-cyan-400",children:"Rptr"}),l&&i.jsx("span",{className:"px-1 py-px text-[8px] font-bold uppercase rounded bg-amber-500/25 text-amber-400",children:"Room"}),c&&u&&i.jsxs("span",{className:"px-1 py-px text-[8px] font-medium rounded bg-gray-500/30 text-gray-300",title:"Neighbor not heard in 7+ days",children:["Idle ",ge(u)]})]}),i.jsxs("div",{className:"text-[10px] text-text-muted/60 mb-2 leading-tight",children:[i.jsx("span",{children:o(m.last_seen)}),(null==d?void 0:d.distanceMeters)&&i.jsxs("span",{className:"font-medium text-text-muted/80",children:[" Â· ",(C=d.distanceMeters,null===C?"â€”":C<1e3?`${Math.round(C)}m`:`${(C/1e3).toFixed(1)}km`)]}),m.latitude&&m.longitude&&0!==m.latitude&&0!==m.longitude&&i.jsxs("span",{className:"font-mono text-[9px]",children:[" Â· ",m.latitude.toFixed(4),", ",m.longitude.toFixed(4)]})]}),i.jsx("div",{className:"mb-2",children:i.jsx(A,{nodeHash:e,width:"100%",height:28,showArea:!0,showTooltip:!0})}),i.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-0.5 text-[11px] mb-2",children:[w.map((e,t)=>i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-text-muted/50",children:e.label}),i.jsx("span",{className:"font-semibold tabular-nums "+("highlight"in e&&e.highlight?"text-amber-400":""),children:e.value})]},t)),E&&y.networkRole&&i.jsx(i.Fragment,{children:i.jsxs("div",{className:"flex items-center justify-between col-span-2 mt-1 pt-1 border-t border-white/5",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("span",{className:"text-text-muted/50",children:"Role"}),i.jsx("span",{className:`px-1.5 py-px text-[8px] font-bold uppercase rounded ${T[y.networkRole].bg} ${T[y.networkRole].text}`,title:T[y.networkRole].title,children:y.networkRole})]}),y.dataConfidence&&i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("span",{className:"text-text-muted/50",children:"Data"}),i.jsx("span",{className:`px-1.5 py-px text-[8px] font-bold uppercase rounded ${S[y.dataConfidence].bg} ${S[y.dataConfidence].text}`,title:S[y.dataConfidence].title,children:y.dataConfidence})]})]})})]}),(E||_)&&i.jsxs("div",{className:"pt-1.5 border-t border-white/5",children:[E&&i.jsxs("div",{className:"flex items-center gap-2 text-[10px]",children:[i.jsx("span",{className:"text-text-muted/50",children:"TX Delay"}),i.jsxs("span",{className:"font-semibold tabular-nums text-amber-400",children:["Ã—",(y.floodFactor??y.txDelayFactor).toFixed(1)]}),i.jsx("span",{className:"text-text-muted/30",children:"flood"}),i.jsxs("span",{className:"font-semibold tabular-nums text-amber-400",children:["Ã—",(y.directFactor??y.directTxDelayFactor).toFixed(1)]}),i.jsx("span",{className:"text-text-muted/30",children:"direct"})]}),_&&i.jsx("div",{className:"flex justify-end "+(E?"mt-1.5":""),children:i.jsx("button",{onClick:_,className:"flex items-center gap-0.5 p-1 text-[10px] text-text-muted/30 hover:text-red-400 hover:bg-red-500/10 rounded transition-colors",title:"Remove from contacts",children:i.jsx(R,{className:"w-3 h-3"})})})]})]});var C}function _e({showTopology:e,validatedPolylineCount:t,filteredNeighborCount:n,hasLocalNode:s,meshTopology:r,zeroHopNeighbors:o,neighborsWithLocation:a}){return i.jsxs("div",{className:"absolute bottom-4 left-4 z-[600] text-xs",style:{background:"rgba(20, 20, 22, 0.95)",borderRadius:"0.75rem",padding:"0.625rem",border:"1px solid rgba(140, 160, 200, 0.2)",maxWidth:"150px"},children:[i.jsxs("div",{className:"text-text-secondary font-medium mb-1.5 flex items-center gap-1",children:["Nodes",i.jsx(pe,{text:"Node type shown by shape/color. Yellow outer ring = direct RF neighbor."})]}),i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx("div",{className:"rounded-full flex-shrink-0",style:{width:"12px",height:"12px",background:"transparent",border:`4px solid ${J}`,boxSizing:"border-box"}}),i.jsx("span",{className:"text-text-muted",children:"Node"}),i.jsx(pe,{text:"Standard mesh node. Can be a repeater, client, or companion device."})]}),r.gatewayNodes.length>0&&i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx("div",{className:"rounded-full flex-shrink-0",style:{width:"12px",height:"12px",backgroundColor:J}}),i.jsx("span",{className:"text-text-muted",children:"Gateway"}),i.jsx(pe,{text:"Significant traffic forwarder (7-10% of last-hop traffic). Gateways relay substantial traffic to the local node."})]}),i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx("div",{className:"rounded-full flex-shrink-0",style:{width:"12px",height:"12px",backgroundColor:te}}),i.jsx("span",{className:"text-text-muted",children:"Hub"}),i.jsx(pe,{text:"Network hub (â‰¥10% of last-hop traffic). Hubs are central to mesh traffic flow and may use higher TX delays."})]}),i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx(N,{className:"w-3 h-3 flex-shrink-0",style:{color:ee},strokeWidth:2.5}),i.jsx("span",{className:"text-text-muted",children:"Local"}),i.jsx(pe,{text:"Your repeater. This is the node running pyMC_Repeater that you're connected to."})]}),(l=a,l.some(([,e])=>{var t;const n=null==(t=e.contact_type)?void 0:t.toLowerCase();return"room server"===n||"room_server"===n||"room"===n||"server"===n})&&i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx(C,{className:"w-3 h-3 flex-shrink-0",style:{color:se},strokeWidth:2.5}),i.jsx("span",{className:"text-text-muted",children:"Room"}),i.jsx(pe,{text:"Room Server identity. Hosts a chat room that clients can sync messages with."})]})),r.mobileNodes.length>0&&i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx("div",{className:"rounded-full flex-shrink-0",style:{width:"12px",height:"12px",background:"transparent",border:`4px solid ${ne}`,boxSizing:"border-box"}}),i.jsx("span",{className:"text-text-muted",children:"Mobile"}),i.jsx(pe,{text:"Volatile node that frequently appears/disappears from paths. Likely a portable or vehicle-mounted device."})]}),o.size>0&&i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsxs("div",{className:"relative flex-shrink-0",style:{width:"14px",height:"14px"},children:[i.jsx("div",{className:"absolute rounded-full",style:{top:"-2px",left:"-2px",width:"18px",height:"18px",background:"transparent",border:`2px solid ${re}`,boxSizing:"border-box",opacity:.85}}),i.jsx("div",{className:"absolute rounded-full",style:{top:"1px",left:"1px",width:"12px",height:"12px",background:"transparent",border:`4px solid ${J}`,boxSizing:"border-box"}})]}),i.jsx("span",{className:"text-text-muted",children:"Neighbor"}),i.jsx(pe,{text:"Zero-hop direct RF contact. We receive their ADVERTs directly without any relay hops."})]})]}),o.size>0&&i.jsx("div",{className:"mt-1.5 pt-1.5 border-t border-white/10",children:i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx("div",{className:"flex-shrink-0",style:{width:"14px",height:"2px",backgroundImage:`repeating-linear-gradient(90deg, ${he} 0, ${he} 3px, transparent 3px, transparent 5px)`,borderRadius:"1px"}}),i.jsx("span",{className:"text-text-muted",children:"Neighbor"}),i.jsx(pe,{text:"Dashed gray â†’ yellow on hover. Direct RF contact with local."})]})}),e&&t>0&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"text-text-secondary font-medium mt-2 pt-2 border-t border-white/10 mb-1 flex items-center gap-1",children:["Topology",i.jsx(pe,{text:"Links with 5+ validations. Thickness = relative strength."})]}),i.jsxs("div",{className:"flex flex-col gap-0.5 text-text-muted",children:[i.jsxs("div",{className:"flex justify-between tabular-nums",children:[i.jsx("span",{children:"Nodes"}),i.jsx("span",{className:"text-text-secondary",children:n+(s?1:0)})]}),i.jsxs("div",{className:"flex justify-between tabular-nums",children:[i.jsx("span",{children:"Links"}),i.jsx("span",{className:"text-text-secondary",children:t})]}),r.hubNodes.length>0&&i.jsxs("div",{className:"flex justify-between tabular-nums",children:[i.jsx("span",{children:"Hubs"}),i.jsx("span",{style:{color:te},children:r.hubNodes.length})]})]}),i.jsxs("div",{className:"flex flex-col gap-1 mt-1.5 pt-1.5 border-t border-white/10",children:[i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx("div",{className:"flex-shrink-0",style:{width:"14px",height:"3px",backgroundColor:ie,borderRadius:"1px"}}),i.jsx("span",{className:"text-text-muted",children:"Link"}),i.jsx(pe,{text:"Gray at rest. Hover to reveal type (teal=direct, indigo=loop)."})]}),r.loops.length>0&&i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsxs("div",{className:"flex-shrink-0 flex flex-col gap-0.5",style:{width:"14px"},children:[i.jsx("div",{style:{height:"2px",backgroundColor:ie,borderRadius:"1px"}}),i.jsx("div",{style:{height:"2px",backgroundColor:ie,borderRadius:"1px"}})]}),i.jsx("span",{className:"text-text-muted",children:"Redundant"})]})]}),r.loops.length>0&&i.jsx("div",{className:"mt-1.5 pt-1.5 border-t border-white/10",children:i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx(O,{className:"w-3 h-3 flex-shrink-0",style:{color:ce}}),i.jsxs("div",{className:"flex flex-col",children:[i.jsxs("span",{style:{color:ce},className:"font-medium",children:[r.loops.length," ",1===r.loops.length?"Loop":"Loops"]}),i.jsx("span",{className:"text-text-muted text-[10px] leading-tight",children:"Redundant paths"})]})]})})]})]});var l}const ye={background:"rgba(20, 20, 22, 0.95)",borderRadius:"0.75rem",border:"1px solid rgba(140, 160, 200, 0.2)"},be=(e,t=.4)=>({background:e,borderRadius:"0.75rem",border:`1px solid ${e.replace(/[\d.]+\)$/,`${t})`)}`});function ve({isDeepLoading:e,showDeepAnalysisModal:t,onDeepAnalysis:n,showTopology:s,onToggleTopology:r,hasValidatedPolylines:o,soloHubs:a,onToggleSoloHubs:l,hasHubNodes:c,soloDirect:u,onToggleSoloDirect:h,hasZeroHopNeighbors:d,isFullscreen:f,onToggleFullscreen:p}){return i.jsxs("div",{className:"absolute top-4 right-4 z-[600] flex gap-2",children:[i.jsxs("button",{onClick:n,disabled:e||t,className:"px-3 py-2 flex items-center gap-2 transition-colors hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed",style:ye,title:"Deep Analysis - Load full packet history and rebuild topology",children:[i.jsx("span",{className:"text-xs font-medium text-text-primary",children:"Deep Analysis"}),i.jsx(U,{className:"w-4 h-4 text-accent-primary"})]}),o&&i.jsx("button",{onClick:r,className:"p-2 transition-colors hover:bg-white/10",style:s?be("rgba(74, 222, 128, 0.2)"):ye,title:s?"Hide topology lines":"Show topology lines",children:s?i.jsx(S,{className:"w-4 h-4 text-green-400"}):i.jsx(H,{className:"w-4 h-4 text-text-secondary"})}),c&&i.jsx("button",{onClick:l,className:"p-2 transition-colors hover:bg-white/10",style:a?{...ye,background:"rgba(251, 191, 36, 0.25)",border:"1px solid rgba(251, 191, 36, 0.5)"}:ye,title:a?"Show all nodes":"Solo hubs & connections",children:i.jsx(F,{className:"w-4 h-4 "+(a?"text-amber-400":"text-text-secondary")})}),d&&i.jsx("button",{onClick:h,className:"p-2 transition-colors hover:bg-white/10",style:u?{...ye,background:"rgba(67, 56, 202, 0.35)",border:"1px solid rgba(67, 56, 202, 0.6)"}:ye,title:u?"Show all nodes":"Solo direct (0-hop) nodes",children:i.jsx(j,{className:"w-4 h-4 "+(u?"text-indigo-400":"text-text-secondary")})}),i.jsx("button",{onClick:p,className:"p-2 transition-colors hover:bg-white/10",style:ye,title:f?"Exit fullscreen":"Fullscreen",children:f?i.jsx(q,{className:"w-4 h-4 text-text-secondary"}):i.jsx(X,{className:"w-4 h-4 text-text-secondary"})})]})}const xe={background:"rgba(20, 20, 22, 0.95)",borderRadius:"0.75rem",border:"1px solid rgba(140, 160, 200, 0.2)"},we={background:"rgba(245, 158, 11, 0.25)",borderRadius:"0.75rem",border:"1px solid rgba(245, 158, 11, 0.5)"};function Ee({isActive:e,onClick:t}){return i.jsx("div",{className:"absolute bottom-8 right-4 z-[600]",children:i.jsx("button",{onClick:t,className:"p-2 transition-colors hover:bg-white/10",style:e?we:xe,title:e?"Configure wardriving coverage":"Show wardriving coverage",children:i.jsx(B,{className:"w-4 h-4 "+(e?"text-amber-400":"text-text-secondary")})})})}function Te({status:e,isLoading:t}){if(!t)return null;const n={idle:"",connecting:"Connecting to server...",loading:"Fetching coverage data...",processing:"Processing coverage points...",success:"",error:""}[e];return n?i.jsxs("div",{className:"flex items-center gap-3 p-4 bg-amber-500/10 border border-amber-500/30 rounded-xl",children:[i.jsx("div",{className:"relative",children:i.jsx(M,{className:"w-5 h-5 text-amber-400 animate-spin"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm text-amber-400 font-medium",children:n}),i.jsx("div",{className:"mt-2 h-1 bg-amber-500/20 rounded-full overflow-hidden",children:i.jsx("div",{className:"h-full bg-amber-400 rounded-full transition-all duration-300",style:{width:"connecting"===e?"30%":"loading"===e?"60%":"90%"}})})]})]}):null}function Se({isOpen:e,onClose:t,state:n,isLoading:s,onLoadCoverage:r,onClearCoverage:o,onToggleVisibility:l,onSetUrl:c}){const[u,h]=f.useState(n.url),d=f.useCallback(async()=>{await r(u)},[u,r]),p=f.useCallback(()=>{h(""),o()},[o]),g=f.useCallback(e=>{"Enter"!==e.key||e.shiftKey||s||(e.preventDefault(),d())},[d,s]),m=f.useCallback(e=>{const t=e.target.value;h(t),c(t)},[c]);if(!e)return null;const _=n.stats.coverageCount>0,y=u.trim().length>0&&!s;return i.jsxs("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center",children:[i.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:s?void 0:t}),i.jsxs("div",{className:"relative bg-surface border border-border rounded-2xl shadow-2xl w-full max-w-md mx-4 overflow-hidden",children:[i.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"p-2 rounded-lg bg-amber-500/20",children:i.jsx(B,{className:"w-5 h-5 text-amber-400"})}),i.jsxs("div",{children:[i.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:"Wardriving Coverage"}),i.jsx("p",{className:"text-xs text-text-muted",children:"Overlay RF coverage heatmap"})]})]}),i.jsx("button",{onClick:t,disabled:s,className:"p-2 rounded-lg hover:bg-white/10 transition-colors disabled:opacity-50",children:i.jsx(a,{className:"w-5 h-5 text-text-secondary"})})]}),i.jsxs("div",{className:"p-4 space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Coverage Server URL"}),i.jsx("input",{type:"url",value:u,onChange:m,onKeyDown:g,placeholder:"https://coverage.wcmesh.com",className:"w-full px-4 py-3 bg-black/30 border border-border rounded-xl text-text-primary placeholder:text-text-muted focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50 transition-all disabled:opacity-50",disabled:s}),i.jsx("p",{className:"mt-1.5 text-xs text-text-muted",children:"Enter the base URL of a wardriving coverage server (e.g., coverage.wcmesh.com)"})]}),i.jsx(Te,{status:n.status,isLoading:s}),"error"===n.status&&n.error&&i.jsxs("div",{className:"flex items-start gap-3 p-3 bg-red-500/10 border border-red-500/30 rounded-xl",children:[i.jsx(G,{className:"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-red-400 font-medium",children:"Connection Failed"}),i.jsx("p",{className:"text-xs text-red-400/80 mt-0.5",children:n.error})]})]}),"success"===n.status&&_&&i.jsxs("div",{className:"flex items-start gap-3 p-3 bg-green-500/10 border border-green-500/30 rounded-xl",children:[i.jsx(k,{className:"w-5 h-5 text-green-400 flex-shrink-0 mt-0.5"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm text-green-400 font-medium",children:"Data Loaded Successfully"}),i.jsxs("p",{className:"text-xs text-green-400/80 mt-0.5",children:[n.stats.coverageCount.toLocaleString()," coverage points â€¢ ",n.stats.repeaterCount.toLocaleString()," repeaters"]})]})]}),_&&!s&&"success"!==n.status&&i.jsxs("div",{className:"flex items-start gap-3 p-3 bg-amber-500/10 border border-amber-500/30 rounded-xl",children:[i.jsx(D,{className:"w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm text-amber-400 font-medium",children:"Coverage Data Loaded"}),i.jsxs("p",{className:"text-xs text-amber-400/80 mt-0.5",children:[n.stats.coverageCount.toLocaleString()," points â€¢",n.stats.lastUpdated&&` Last updated ${n.stats.lastUpdated.toLocaleTimeString()}`]})]})]})]}),i.jsxs("div",{className:"flex items-center justify-between gap-3 p-4 border-t border-border bg-black/20",children:[i.jsx("div",{className:"flex items-center gap-2",children:_&&i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:l,disabled:s,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-text-secondary hover:text-text-primary hover:bg-white/5 rounded-lg transition-colors disabled:opacity-50",title:n.isVisible?"Hide heatmap":"Show heatmap",children:n.isVisible?i.jsxs(i.Fragment,{children:[i.jsx(H,{className:"w-3.5 h-3.5"})," Hide"]}):i.jsxs(i.Fragment,{children:[i.jsx($,{className:"w-3.5 h-3.5"})," Show"]})}),i.jsxs("button",{onClick:p,disabled:s,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-red-400/80 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors disabled:opacity-50",title:"Clear coverage data",children:[i.jsx(R,{className:"w-3.5 h-3.5"})," Clear"]})]})}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("button",{onClick:t,disabled:s,className:"px-4 py-2 text-sm font-medium text-text-secondary hover:bg-white/10 rounded-lg transition-colors disabled:opacity-50",children:_?"Done":"Cancel"}),i.jsx("button",{onClick:d,disabled:!y,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium bg-amber-500 hover:bg-amber-400 text-black rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:s?i.jsxs(i.Fragment,{children:[i.jsx(M,{className:"w-4 h-4 animate-spin"}),"Loading..."]}):_?i.jsxs(i.Fragment,{children:[i.jsx(z,{className:"w-4 h-4"}),"Refresh"]}):i.jsxs(i.Fragment,{children:[i.jsx(W,{className:"w-4 h-4"}),"Connect"]})})]})]})]})]})}function Ae(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const Re=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser),Ce="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);Ce&&parseFloat(Ce[1]);const Pe=globalThis,ke=globalThis.process||{},Ie=globalThis.navigator||{};function Me(e){var t,n;if("undefined"!=typeof window&&"renderer"===(null==(t=window.process)?void 0:t.type))return!0;if("undefined"!=typeof process&&Boolean(null==(n=process.versions)?void 0:n.electron))return!0;const s="undefined"!=typeof navigator&&navigator.userAgent;return Boolean(s&&s.indexOf("Electron")>=0)}function Le(){return!("object"==typeof process&&"[object process]"===String(process)&&!(null==process?void 0:process.browser))||Me()}const Ne="4.1.0";class Oe{constructor(e,t,n="sessionStorage"){this.storage=function(e){try{const t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),t}catch(hi){return null}}(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}var Fe,De;function Be(e){return"string"!=typeof e?e:(e=e.toUpperCase(),Fe[e]||Fe.WHITE)}function Ue(e,t){if(!e)throw new Error("Assertion failed")}function je(){var e,t,n;let s;if(Le()&&Pe.performance)s=null==(t=null==(e=null==Pe?void 0:Pe.performance)?void 0:e.now)?void 0:t.call(e);else if("hrtime"in ke){const e=null==(n=null==ke?void 0:ke.hrtime)?void 0:n.call(ke);s=1e3*e[0]+e[1]/1e6}else s=Date.now();return s}(De=Fe||(Fe={}))[De.BLACK=30]="BLACK",De[De.RED=31]="RED",De[De.GREEN=32]="GREEN",De[De.YELLOW=33]="YELLOW",De[De.BLUE=34]="BLUE",De[De.MAGENTA=35]="MAGENTA",De[De.CYAN=36]="CYAN",De[De.WHITE=37]="WHITE",De[De.BRIGHT_BLACK=90]="BRIGHT_BLACK",De[De.BRIGHT_RED=91]="BRIGHT_RED",De[De.BRIGHT_GREEN=92]="BRIGHT_GREEN",De[De.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",De[De.BRIGHT_BLUE=94]="BRIGHT_BLUE",De[De.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",De[De.BRIGHT_CYAN=96]="BRIGHT_CYAN",De[De.BRIGHT_WHITE=97]="BRIGHT_WHITE";const Ge={debug:Le()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Ve={enabled:!0,level:0};function ze(){}const We={},He={once:!0};class $e{constructor({id:e}={id:""}){this.VERSION=Ne,this._startTs=je(),this._deltaTs=je(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new Oe(`__probe-${this.id}__`,Ve),this.timeStamp(`${this.id} started`),function(e,t=["constructor"]){const n=Object.getPrototypeOf(e),s=Object.getOwnPropertyNames(n),r=e;for(const i of s){const n=r[i];"function"==typeof n&&(t.find(e=>i===e)||(r[i]=n.bind(e)))}}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((je()-this._startTs).toPrecision(10))}getDelta(){return Number((je()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Ge.warn,arguments,He)}error(e){return this._getLogFunction(0,e,Ge.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Ge.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Ge.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Ge.debug||Ge.info,arguments,He)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||ze,n&&[n],{tag:Ye(t)}):ze}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||ze)}group(e,t,n={collapsed:!1}){const s=qe({logLevel:e,message:t,opts:n}),{collapsed:r}=n;return s.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,t,n={}){return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ze)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Xe(e)}_getLogFunction(e,t,n,s,r){if(this._shouldLog(e)){r=qe({logLevel:e,message:t,args:s,opts:r}),Ue(n=n||r.method),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=je();const i=r.tag||r.message;if(r.once&&i){if(We[i])return ze;We[i]=je()}return t=function(e,t,n){if("string"==typeof t){const o=n.time?function(e,t=8){const n=Math.max(t-e.length,0);return`${" ".repeat(n)}${e}`}(function(e){let t;return t=e<10?`${e.toFixed(2)}ms`:e<100?`${e.toFixed(1)}ms`:e<1e3?`${e.toFixed(0)}ms`:`${(e/1e3).toFixed(2)}s`,t}(n.total)):"";s=t=n.time?`${e}: ${o}  ${t}`:`${e}: ${t}`,r=n.color,i=n.background,Le||"string"!=typeof s||(r&&(s=`[${Be(r)}m${s}[39m`),i&&(s=`[${Be(i)+10}m${s}[49m`)),t=s}var s,r,i;return t}(this.id,r.message,r),n.bind(console,t,...r.args)}return ze}}function Xe(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return Ue(Number.isFinite(t)&&t>=0),t}function qe(e){const{logLevel:t,message:n}=e;e.logLevel=Xe(t);const s=e.args?Array.from(e.args):[];for(;s.length&&s.shift()!==n;);switch(typeof t){case"string":case"function":void 0!==n&&s.unshift(n),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());const r=typeof e.message;return Ue("string"===r||"object"===r),Object.assign(e,{args:s},e.opts)}function Ye(e){for(const t in e)for(const n in e[t])return n||"untitled";return"empty"}$e.VERSION=Ne;const Ke="4.3.3",Ze=Ke[0]>="0"&&Ke[0]<="9"?`v${Ke}`:"",Qe=function(){const e=new $e({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=e,globalThis.loaders.version=Ze,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=e,e}();function Je(e,t){return et(e||{},t)}function et(e,t,n=0){if(n>3)return t;const s={...e};for(const[r,i]of Object.entries(t))i&&"object"==typeof i&&!Array.isArray(i)?s[r]=et(s[r]||{},t[r],n+1):s[r]=t[r];return s}var tt;function nt(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}(null==(tt=globalThis._loadersgl_)?void 0:tt.version)||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version;const st="object"!=typeof process||"[object process]"!==String(process)||process.browser,rt="undefined"!=typeof window&&void 0!==window.orientation,it="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);it&&parseFloat(it[1]);class ot{constructor(e,t){s(this,"name"),s(this,"workerThread"),s(this,"isRunning",!0),s(this,"result"),s(this,"_resolve",()=>{}),s(this,"_reject",()=>{}),this.name=e,this.workerThread=t,this.result=new Promise((e,t)=>{this._resolve=e,this._reject=t})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){nt(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){nt(this.isRunning),this.isRunning=!1,this._reject(e)}}class at{terminate(){}}const lt=new Map;function ct(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function ut(e,t=!0,n){const s=n||new Set;if(e)if(ht(e))s.add(e);else if(ht(e.buffer))s.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(const r in e)ut(e[r],t,s);return void 0===n?Array.from(s):[]}function ht(e){return!!e&&(e instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&e instanceof MessagePort||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)}const dt=()=>{};class ft{constructor(e){s(this,"name"),s(this,"source"),s(this,"url"),s(this,"terminated",!1),s(this,"worker"),s(this,"onMessage"),s(this,"onError"),s(this,"_loadableURL","");const{name:t,source:n,url:r}=e;nt(n||r),this.name=t,this.source=n,this.url=r,this.onMessage=dt,this.onError=e=>{},this.worker=st?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return"undefined"!=typeof Worker&&st||void 0!==at&&!st}destroy(){this.onMessage=dt,this.onError=dt,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||ut(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=function(e){nt(e.source&&!e.url||!e.source&&e.url);let t=lt.get(e.source||e.url);return t||(e.url&&(t=(n=e.url).startsWith("http")?ct(`try {\n  importScripts('${n}');\n} catch (error) {\n  console.error(error);\n  throw error;\n}`):n,lt.set(e.url,t)),e.source&&(t=ct(e.source),lt.set(e.source,t))),nt(t),t;var n}({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>{},e}_createNodeWorker(){let e;if(this.url){const t=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new at(t,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new at(this.source,{eval:!0})}return e.on("message",e=>{this.onMessage(e)}),e.on("error",e=>{this.onError(e)}),e.on("exit",e=>{}),e}}class pt{constructor(e){s(this,"name","unnamed"),s(this,"source"),s(this,"url"),s(this,"maxConcurrency",1),s(this,"maxMobileConcurrency",1),s(this,"onDebug",()=>{}),s(this,"reuseWorkers",!0),s(this,"props",{}),s(this,"jobQueue",[]),s(this,"idleQueue",[]),s(this,"count",0),s(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return ft.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e,t=(e,t,n)=>e.done(n),n=(e,t)=>e.error(t)){const s=new Promise(s=>(this.jobQueue.push({name:e,onMessage:t,onError:n,onStart:s}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const s=new ot(t.name,e);e.onMessage=e=>t.onMessage(s,e.type,e.payload),e.onError=e=>t.onError(s,e),t.onStart(s);try{await s.result}catch(n){}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!st||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new ft({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return rt?this.maxMobileConcurrency:this.maxConcurrency}}const gt={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},mt=class e{constructor(e){s(this,"props"),s(this,"workerPools",new Map),this.props={...gt},this.setProps(e),this.workerPools=new Map}static isSupported(){return ft.isSupported()}static getWorkerFarm(t={}){return e._workerFarm=e._workerFarm||new e({}),e._workerFarm.setProps(t),e._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:n,url:s}=e;let r=this.workerPools.get(t);return r||(r=new pt({name:t,source:n,url:s}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};s(mt,"_workerFarm");let _t=mt;async function yt(e,t,n,s,r){const i=e.id,o=function(e,t={}){const n=t[e.id]||{},s=st?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let r=n.workerUrl;if(r||"compression"!==e.id||(r=t.workerUrl),"test"===t._workerType&&(r=st?`modules/${e.module}/dist/${s}`:`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!r){let t=e.version;"latest"===t&&(t="latest");const n=t?`@${t}`:"";r=`https://unpkg.com/@loaders.gl/${e.module}${n}/dist/${s}`}return nt(r),r}(e,n),a=_t.getWorkerFarm(n).getWorkerPool({name:i,url:o});n=JSON.parse(JSON.stringify(n)),s=JSON.parse(JSON.stringify(s||{}));const l=await a.startJob("process-on-worker",bt.bind(null,r));l.postMessage("process",{input:t,options:n,context:s});const c=await l.result;return await c.result}async function bt(e,t,n,s){switch(n){case"done":t.done(s);break;case"error":t.error(new Error(s.error));break;case"process":const{id:n,input:i,options:o}=s;try{const s=await e(i,o);t.postMessage("done",{id:n,result:s})}catch(r){const e=r instanceof Error?r.message:"unknown error";t.postMessage("error",{id:n,error:e})}}}function vt(){let e;if("undefined"!=typeof window&&window.performance)e=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){const t=process.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}class xt{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=vt(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(vt()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class wt{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(e=>this._getOrCreate(e))}_getOrCreate(e){const{name:t,type:n}=e;let s=this.stats[t];return s||(s=e instanceof xt?e:new xt(t,n),this.stats[t]=s),s}}const Et={};function Tt(e){if((t=e)&&"object"==typeof t&&t.isBuffer)return e;var t;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){const t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function St(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}const At=e=>"function"==typeof e,Rt=e=>null!==e&&"object"==typeof e,Ct=e=>Rt(e)&&e.constructor==={}.constructor,Pt=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,kt=e=>"undefined"!=typeof Blob&&e instanceof Blob,It=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||Rt(e)&&At(e.tee)&&At(e.cancel)&&At(e.getReader))(e)||(e=>Rt(e)&&At(e.read)&&At(e.pipe)&&(e=>"boolean"==typeof e)(e.readable))(e);class Mt extends Error{constructor(e,t){super(e),s(this,"reason"),s(this,"url"),s(this,"response"),this.reason=t.reason,this.url=t.url,this.response=t.response}}const Lt=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Nt=/^([-\w.]+\/[-\w.+]+)/;function Ot(e,t){return e.toLowerCase()===t.toLowerCase()}function Ft(e){const t=Lt.exec(e);return t?t[1]:""}const Dt=/\?.*/;function Bt(e){return e.replace(Dt,"")}function Ut(e){return Pt(e)?e.url:kt(e)?e.name||"":"string"==typeof e?e:""}function jt(e){if(Pt(e)){const t=e,n=t.headers.get("content-type")||"",s=Bt(t.url);return function(e){const t=Nt.exec(e);return t?t[1]:e}(n)||Ft(s)}return kt(e)?e.type||"":"string"==typeof e?Ft(e):""}async function Gt(e){if(Pt(e))return e;const t={},n=function(e){return Pt(e)?e.headers["content-length"]||-1:kt(e)?e.size:"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}(e);n>=0&&(t["content-length"]=String(n));const s=Ut(e),r=jt(e);r&&(t["content-type"]=r);const i=await async function(e){if("string"==typeof e)return`data:,${e.slice(0,5)}`;if(e instanceof Blob){const t=e.slice(0,5);return await new Promise(e=>{const n=new FileReader;n.onload=t=>{var n;return e(null==(n=null==t?void 0:t.target)?void 0:n.result)},n.readAsDataURL(t)})}return e instanceof ArrayBuffer?`data:base64,${function(e){let t="";const n=new Uint8Array(e);for(let s=0;s<n.byteLength;s++)t+=String.fromCharCode(n[s]);return btoa(t)}(e.slice(0,5))}`:null}(e);i&&(t["x-first-bytes"]=i),"string"==typeof e&&(e=(new TextEncoder).encode(e));const o=new Response(e,{headers:t});return Object.defineProperty(o,"url",{value:s}),o}async function Vt(e,t){var n,s;if("string"==typeof e){const r=function(e){for(const t in Et)if(e.startsWith(t)){const n=Et[t];e=e.replace(t,n)}return e.startsWith("http://")||e.startsWith("https://")||(e=`${e}`),e}(e);return function(e){return!function(e){return e.startsWith("http:")||e.startsWith("https:")}(e)&&!function(e){return e.startsWith("data:")}(e)}(r)&&(null==(n=globalThis.loaders)?void 0:n.fetchNode)?null==(s=globalThis.loaders)?void 0:s.fetchNode(r,t):await fetch(r,t)}return await Gt(e)}const zt=new $e({id:"loaders.gl"});class Wt{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}const Ht={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){s(this,"console"),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Re,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},$t={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Xt(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function qt(){const e=Xt();return e.globalOptions=e.globalOptions||{...Ht},e.globalOptions}function Yt(e,t,n,s,r){const i=t||"Top level",o=t?`${t}.`:"";for(const a in e){const l=!t&&Rt(e[a]);if(!(a in n)&&("baseUri"!==a||t)&&("workerUrl"!==a||!t))if(a in s)zt.warn(`${i} loader option '${o}${a}' no longer supported, use '${s[a]}'`)();else if(!l){const e=Kt(a,r);zt.warn(`${i} loader option '${o}${a}' not recognized. ${e}`)()}}}function Kt(e,t){const n=e.toLowerCase();let s="";for(const r of t)for(const t in r.options){if(e===t)return`Did you mean '${r.id}.${t}'?`;const i=t.toLowerCase();(n.startsWith(i)||i.startsWith(n))&&(s=s||`Did you mean '${r.id}.${t}'?`)}return s}function Zt(e,t){for(const n in t)if(n in t){const s=t[n];Ct(s)&&Ct(e[n])?e[n]={...e[n],...t[n]}:e[n]=t[n]}}function Qt(e){return!!e&&(Array.isArray(e)&&(e=e[0]),Array.isArray(null==e?void 0:e.extensions))}function Jt(e){let t;return Ae(e,"null loader"),Ae(Qt(e),"invalid loader"),Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),((null==e?void 0:e.parseTextSync)||(null==e?void 0:e.parseText))&&(e.text=!0),e.text||(e.binary=!0),e}const en=()=>{const e=Xt();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry},tn=/\.([^.]+)$/;function nn(e,t=[],n,s){if(!sn(e))return null;if(t&&!Array.isArray(t))return Jt(t);let r=[];t&&(r=r.concat(t)),(null==n?void 0:n.ignoreRegisteredLoaders)||r.push(...en()),function(e){for(const t of e)Jt(t)}(r);const i=function(e,t,n,s){const r=Ut(e),i=jt(e),o=Bt(r)||(null==s?void 0:s.url);let a=null,l="";return(null==n?void 0:n.mimeType)&&(a=on(t,null==n?void 0:n.mimeType),l=`match forced by supplied MIME type ${null==n?void 0:n.mimeType}`),a=a||function(e,t){const n=t&&tn.exec(t),s=n&&n[1];return s?function(e,t){t=t.toLowerCase();for(const n of e)for(const e of n.extensions)if(e.toLowerCase()===t)return n;return null}(e,s):null}(t,o),l=l||(a?`matched url ${o}`:""),a=a||on(t,i),l=l||(a?`matched MIME type ${i}`:""),a=a||function(e,t){if(!t)return null;for(const n of e)if("string"==typeof t){if(an(t,n))return n}else if(ArrayBuffer.isView(t)){if(ln(t.buffer,t.byteOffset,n))return n}else if(t instanceof ArrayBuffer&&ln(t,0,n))return n;return null}(t,e),l=l||(a?`matched initial data ${cn(e)}`:""),(null==n?void 0:n.fallbackMimeType)&&(a=a||on(t,null==n?void 0:n.fallbackMimeType),l=l||(a?`matched fallback MIME type ${i}`:"")),l&&Qe.log(1,`selectLoader selected ${null==a?void 0:a.name}: ${l}.`),a}(e,r,n,s);if(!i&&!(null==n?void 0:n.nothrow))throw new Error(rn(e));return i}function sn(e){return!(e instanceof Response&&204===e.status)}function rn(e){const t=Ut(e),n=jt(e);let s="No valid loader found (";s+=t?`${St(t)}, `:"no url provided, ",s+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const r=e?cn(e):"";return s+=r?` first bytes: "${r}"`:"first bytes: not available",s+=")",s}function on(e,t){var n;for(const s of e){if(null==(n=s.mimeTypes)?void 0:n.some(e=>Ot(t,e)))return s;if(Ot(t,`application/x.${s.id}`))return s}return null}function an(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(t=>e.startsWith(t))}function ln(e,t,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(n=>function(e,t,n,s){if(s instanceof ArrayBuffer)return function(e,t,n){if(n=n||e.byteLength,e.byteLength<n||t.byteLength<n)return!1;const s=new Uint8Array(e),r=new Uint8Array(t);for(let i=0;i<s.length;++i)if(s[i]!==r[i])return!1;return!0}(s,e,s.byteLength);switch(typeof s){case"function":return s(e);case"string":return s===un(e,t,s.length);default:return!1}}(e,t,0,n))}function cn(e,t=5){return"string"==typeof e?e.slice(0,t):ArrayBuffer.isView(e)?un(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?un(e,0,t):""}function un(e,t,n){if(e.byteLength<t+n)return"";const s=new DataView(e);let r="";for(let i=0;i<n;i++)r+=String.fromCharCode(s.getUint8(t+i));return r}const hn=262144;function dn(e,t){return Re?async function*(e,t){const n=e.getReader();let s;try{for(;;){const e=s||n.read();(null==t?void 0:t._streamReadAhead)&&(s=n.read());const{done:r,value:i}=await e;if(r)return;yield Tt(i)}}catch(r){n.releaseLock()}}(e,t):async function*(e){for await(const t of e)yield Tt(t)}(e)}const fn="Cannot convert supplied data type";async function pn(e,t,n){const s=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||s)return function(e,t){if(t.text&&"string"==typeof e)return e;var n;if((n=e)&&"object"==typeof n&&n.isBuffer&&(e=e.buffer),e instanceof ArrayBuffer){const n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer;const s=e.byteLength||e.length;return 0===e.byteOffset&&s===n.byteLength||(n=n.slice(e.byteOffset,e.byteOffset+s)),n}throw new Error(fn)}(e,t);if(kt(e)&&(e=await Gt(e)),Pt(e)){const n=e;return await async function(e){if(!e.ok){const t=await async function(e){const n=function(e){if(e.length<50)return e;const t=e.slice(e.length-15);return`${e.substr(0,32)}...${t}`}(e.url);let s=`Failed to fetch resource (${e.status}) ${e.statusText}: ${n}`;s=s.length>100?`${s.slice(0,100)}...`:s;const r={reason:e.statusText,url:e.url,response:e};try{const t=e.headers.get("Content-Type");r.reason=!e.bodyUsed&&(null==t?void 0:t.includes("application/json"))?await e.json():await e.text()}catch(t){}return new Mt(s,r)}(e);throw t}}(n),t.binary?await n.arrayBuffer():await n.text()}if(It(e)&&(e=function(e,t){if("string"==typeof e)return function*(e,t){const n=(null==t?void 0:t.chunkSize)||262144;let s=0;const r=new TextEncoder;for(;s<e.length;){const t=Math.min(e.length-s,n),i=e.slice(s,s+t);s+=t,yield r.encode(i)}}(e,t);if(e instanceof ArrayBuffer)return function*(e,t={}){const{chunkSize:n=hn}=t;let s=0;for(;s<e.byteLength;){const t=Math.min(e.byteLength-s,n),r=new ArrayBuffer(t),i=new Uint8Array(e,s,t);new Uint8Array(r).set(i),s+=t,yield r}}(e,t);if(kt(e))return async function*(e,t){const n=(null==t?void 0:t.chunkSize)||1048576;let s=0;for(;s<e.size;){const t=s+n,r=await e.slice(s,t).arrayBuffer();s=t,yield r}}(e,t);if(It(e))return dn(e,t);if(Pt(e))return dn(e.body,t);throw new Error("makeIterator")}(e,n)),r=e,Boolean(r)&&"function"==typeof r[Symbol.iterator]||(e=>e&&"function"==typeof e[Symbol.asyncIterator])(e))return async function(e){const t=[];for await(const n of e)t.push(n);return function(...e){return function(e){const t=e.map(e=>e instanceof ArrayBuffer?new Uint8Array(e):e),n=t.reduce((e,t)=>e+t.byteLength,0),s=new Uint8Array(n);let r=0;for(const i of t)s.set(i,r),r+=i.byteLength;return s.buffer}(e)}(...t)}(e);var r;throw new Error(fn)}function gn(e,t){const n=qt(),s=e||n;return"function"==typeof s.fetch?s.fetch:Rt(s.fetch)?e=>Vt(e,s.fetch):(null==t?void 0:t.fetch)?null==t?void 0:t.fetch:Vt}async function mn(e,t,n,s){!t||Array.isArray(t)||Qt(t)||(s=void 0,n=t,t=void 0),n=n||{};const r=Ut(e=await e),i=function(e,t){if(e&&!Array.isArray(e))return e;let n;if(e&&(n=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];n=n?[...n,...e]:e}return n&&n.length?n:void 0}(t,s),o=await async function(e,t=[],n,s){if(!sn(e))return null;let r=nn(e,t,{...n,nothrow:!0},s);if(r)return r;if(kt(e)&&(r=nn(e=await e.slice(0,10).arrayBuffer(),t,n,s)),!r&&!(null==n?void 0:n.nothrow))throw new Error(rn(e));return r}(e,i,n);return o?(s=function(e,t,n){if(n)return n;const s={fetch:gn(t,e),...e};if(s.url){const e=Bt(s.url);s.baseUrl=e,s.queryString=function(e){const t=e.match(Dt);return t&&t[0]}(s.url),s.filename=St(e),s.baseUrl=function(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}(e)}return Array.isArray(s.loaders)||(s.loaders=null),s}({url:r,_parse:mn,loaders:i},n=function(e,t,n,s){return n=n||[],function(e,t){Yt(e,null,Ht,$t,t);for(const n of t){const s=e&&e[n.id]||{},r=n.options&&n.options[n.id]||{},i=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Yt(s,n.id,r,i,t)}}(e,n=Array.isArray(n)?n:[n]),function(e,t,n){const s={...e.options||{}};return function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}(s,n),null===s.log&&(s.log=new Wt),Zt(s,qt()),Zt(s,t),s}(t,e,s)}(n,o,i,r),s||null),await async function(e,t,n,s){if(function(e){nt(e,"no worker provided");e.version}(e),n=Je(e.options,n),Pt(t)){const e=t,{ok:n,redirected:r,status:i,statusText:o,type:a,url:l}=e,c=Object.fromEntries(e.headers.entries());s.response={headers:c,ok:n,redirected:r,status:i,statusText:o,type:a,url:l}}t=await pn(t,e,n);const r=e;if(r.parseTextSync&&"string"==typeof t)return r.parseTextSync(t,n,s);if(function(e,t){return!!_t.isSupported()&&!(!st&&!(null==t?void 0:t._nodeWorkers))&&e.worker&&(null==t?void 0:t.worker)}(e,n))return await yt(e,t,n,s,mn);if(r.parseText&&"string"==typeof t)return await r.parseText(t,n,s);if(r.parse)return await r.parse(t,n,s);throw nt(!r.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}(o,e,n,s)):null}async function _n(e,t,n,s){let r,i;Array.isArray(t)||Qt(t)?(r=t,i=n):(r=[],i=t);const o=gn(i);let a=e;return"string"==typeof e&&(a=await o(e)),kt(e)&&(a=await o(e)),Array.isArray(r),await mn(a,r,i)}const yn=null==(e=globalThis.loaders)?void 0:e.parseImageNode,bn="undefined"!=typeof Image,vn="undefined"!=typeof ImageBitmap,xn=Boolean(yn),wn=!!Re||xn;const En=/^data:image\/svg\+xml/,Tn=/\.svg((\?|#).*)?$/;function Sn(e){return e&&(En.test(e)||Tn.test(e))}function An(e,t){if(Sn(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function Rn(e,t,n){const s=function(e,t){if(Sn(t)){let t=(new TextDecoder).decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(n){throw new Error(n.message)}return`data:image/svg+xml;base64,${btoa(t)}`}return An(e,t)}(e,n),r=self.URL||self.webkitURL,i="string"!=typeof s&&r.createObjectURL(s);try{return await async function(e,t){const n=new Image;return n.src=e,t.image&&t.image.decode&&n.decode?(await n.decode(),n):await new Promise((e,t)=>{try{n.onload=()=>e(n),n.onerror=e=>{const n=e instanceof Error?e.message:"error";t(new Error(n))}}catch(s){t(s)}})}(i||s,t)}finally{i&&r.revokeObjectURL(i)}}const Cn={};let Pn=!0;const kn=!1,In=!0;function Mn(e){const t=Ln(e);return function(e){const t=Ln(e);return t.byteLength>=24&&2303741511===t.getUint32(0,kn)?{mimeType:"image/png",width:t.getUint32(16,kn),height:t.getUint32(20,kn)}:null}(t)||function(e){const t=Ln(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,kn)&&255===t.getUint8(2)))return null;const{tableMarkers:n,sofMarkers:s}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}();let r=2;for(;r+9<t.byteLength;){const e=t.getUint16(r,kn);if(s.has(e))return{mimeType:"image/jpeg",height:t.getUint16(r+5,kn),width:t.getUint16(r+7,kn)};if(!n.has(e))return null;r+=2,r+=t.getUint16(r,kn)}return null}(t)||function(e){const t=Ln(e);return t.byteLength>=10&&1195984440===t.getUint32(0,kn)?{mimeType:"image/gif",width:t.getUint16(6,In),height:t.getUint16(8,In)}:null}(t)||function(e){const t=Ln(e);return t.byteLength>=14&&16973===t.getUint16(0,kn)&&t.getUint32(2,In)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,In),height:t.getUint32(22,In)}:null}(t)||function(e){const t=function(e){return function(e,t,n=0){const s=(r="ftyp",[...r].map(e=>e.charCodeAt(0)));var r;for(let i=0;i<s.length;++i)if(s[i]!==e[i+n])return!1;return!0}(e,0,4)&&96&e[8]?function(e){switch((t=e,String.fromCharCode(...t.slice(8,12))).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}var t}(e):null}(new Uint8Array(e instanceof DataView?e.buffer:e));return t?{mimeType:t.mimeType,width:0,height:0}:null}(t)}function Ln(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}const Nn={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:"4.3.3",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:async function(e,t,n){const s=((t=t||{}).image||{}).type||"auto",{url:r}=n||{};let i;switch(function(e){switch(e){case"auto":case"data":return function(){if(vn)return"imagebitmap";if(bn)return"image";if(wn)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return vn||bn||wn;case"imagebitmap":return vn;case"image":return bn;case"data":return wn;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}(e),e}}(s)){case"imagebitmap":i=await async function(e,t,n){let s;s=Sn(n)?await Rn(e,t,n):An(e,n);const r=t&&t.imagebitmap;return await async function(e,t=null){if(!function(e){for(const t in e||Cn)return!1;return!0}(t)&&Pn||(t=null),t)try{return await createImageBitmap(e,t)}catch(n){Pn=!1}return await createImageBitmap(e)}(s,r)}(e,t,r);break;case"image":i=await Rn(e,t,r);break;case"data":i=await async function(e){var t;const{mimeType:n}=Mn(e)||{},s=null==(t=globalThis.loaders)?void 0:t.parseImageNode;return Ae(s),await s(e,n)}(e);break;default:Ae(!1)}return"data"===s&&(i=function(e){switch(function(e){const t=function(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&e instanceof Image?"image":e&&"object"==typeof e&&e.data&&e.width&&e.height?"data":null}(e);if(!t)throw new Error("Not an image");return t}(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("getImageData");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}(i)),i},tests:[e=>Boolean(Mn(new DataView(e)))],options:{image:{type:"auto",decode:!0}}},On=new $e({id:"deck"});let Fn={};function Dn(e){Fn=e}function Bn(e,t,n,s){On.level>0&&Fn[e]&&Fn[e].call(null,t,n,s)}const Un={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(e){const t=e[0],n=e[e.length-1];return"{"===t&&"}"===n||"["===t&&"]"===n},parseTextSync:JSON.parse},jn=function(){const e="9.2.5",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${e}`);return t||(On.log(1,`deck.gl ${e}`)(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:On,_registerLoggers:Dn},function(e){const t=en();e=Array.isArray(e)?e:[e];for(const n of e){const e=Jt(n);t.find(t=>e===t)||t.unshift(e)}}([Un,[Nn,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}();function Gn(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}const Vn={number:{type:"number",validate:(e,t)=>Number.isFinite(e)&&"object"==typeof t&&(void 0===t.max||e<=t.max)&&(void 0===t.min||e>=t.min)},array:{type:"array",validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function zn(e){let t=Wn(e);if("object"!==t)return{value:e,...Vn[t],type:t};if("object"==typeof e)return e?void 0!==e.type?{...e,...Vn[e.type],type:e.type}:void 0===e.value?{type:"object",value:e}:(t=Wn(e.value),{...e,...Vn[t],type:t}):{type:"object",value:null};throw new Error("props")}function Wn(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const Hn={vertex:"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n",fragment:"#ifdef MODULE_MATERIAL\n  fragColor = material_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  fragColor = lighting_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_FOG\n  fragColor = fog_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  fragColor = picking_filterHighlightColor(fragColor);\n  fragColor = picking_filterPickingColor(fragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"},$n=/void\s+main\s*\([^)]*\)\s*\{\n?/,Xn=/}\n?[^{}]*$/,qn=[],Yn="__LUMA_INJECT_DECLARATIONS__";function Kn(e){const t={vertex:{},fragment:{}};for(const n in e){let s=e[n];"string"==typeof s&&(s={order:0,injection:s}),t[Zn(n)][n]=s}return t}function Zn(e){const t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function Qn(e,t,n,s=!1){const r="vertex"===t;for(const i in n){const t=n[i];t.sort((e,t)=>e.order-t.order),qn.length=t.length;for(let e=0,n=t.length;e<n;++e)qn[e]=t[e].injection;const s=`${qn.join("\n")}\n`;switch(i){case"vs:#decl":r&&(e=e.replace(Yn,s));break;case"vs:#main-start":r&&(e=e.replace($n,e=>e+s));break;case"vs:#main-end":r&&(e=e.replace(Xn,e=>s+e));break;case"fs:#decl":r||(e=e.replace(Yn,s));break;case"fs:#main-start":r||(e=e.replace($n,e=>e+s));break;case"fs:#main-end":r||(e=e.replace(Xn,e=>s+e));break;default:e=e.replace(i,e=>e+s)}}return e=e.replace(Yn,""),s&&(e=e.replace(/\}\s*$/,e=>e+Hn[t])),e}function Jn(e){e.map(e=>function(e){if(e.instance)return;Jn(e.dependencies||[]);const{propTypes:t={},deprecations:n=[],inject:s={}}=e,r={normalizedInjections:Kn(s),parsedDeprecations:ts(n)};t&&(r.propValidators=function(e){const t={};for(const[n,s]of Object.entries(e))t[n]=zn(s);return t}(t)),e.instance=r;let i={};t&&(i=Object.entries(t).reduce((e,[t,n])=>{const s=null==n?void 0:n.value;return s&&(e[t]=s),e},{})),e.defaultUniforms={...e.defaultUniforms,...i}}(e))}function es(e,t,n){var s;null==(s=e.deprecations)||s.forEach(e=>{var s;(null==(s=e.regex)?void 0:s.test(t))&&(e.deprecated?n.deprecated(e.old,e.new)():n.removed(e.old,e.new)())})}function ts(e){return e.forEach(e=>{"function"===e.type?e.regex=new RegExp(`\\b${e.old}\\(`):e.regex=new RegExp(`${e.type} ${e.old};`)}),e}function ns(e){Jn(e);const t={},n={};ss({modules:e,level:0,moduleMap:t,moduleDepth:n});const s=Object.keys(n).sort((e,t)=>n[t]-n[e]).map(e=>t[e]);return Jn(s),s}function ss(e){const{modules:t,level:n,moduleMap:s,moduleDepth:r}=e;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const i of t)s[i.name]=i,(void 0===r[i.name]||r[i.name]<n)&&(r[i.name]=n);for(const i of t)i.dependencies&&ss({modules:i.dependencies,level:n+1,moduleMap:s,moduleDepth:r})}const rs=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],is=[...rs,[ls("attribute"),"in $1"],[ls("varying"),"out $1"]],os=[...rs,[ls("varying"),"in $1"]];function as(e,t){for(const[n,s]of t)e=e.replace(n,s);return e}function ls(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function cs(e,t){let n="";for(const s in e){const r=e[s];if(n+=`void ${r.signature} {\n`,r.header&&(n+=`  ${r.header}`),t[s]){const e=t[s];e.sort((e,t)=>e.order-t.order);for(const t of e)n+=`  ${t.injection}\n`}r.footer&&(n+=`  ${r.footer}`),n+="}\n"}return n}function us(e){const t={vertex:{},fragment:{}};for(const n of e){let e,s;"string"!=typeof n?(e=n,s=e.hook):(e={},s=n),s=s.trim();const[r,i]=s.split(":"),o=s.replace(/\(.+/,""),a=Object.assign(e,{signature:i});switch(r){case"vs":t.vertex[o]=a;break;case"fs":t.fragment[o]=a;break;default:throw new Error(r)}}return t}function hs(e,t="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return n?n[1]:t}function ds(e){let t=100;const n=e.match(/[^\s]+/g);if(n&&n.length>=2&&"#version"===n[0]){const e=parseInt(n[1],10);Number.isFinite(e)&&(t=e)}if(100!==t&&300!==t)throw new Error(`Invalid GLSL version ${t}`);return t}const fs=`\n\n${Yn}\n`;function ps(e,t){var n;const{source:s,stage:r,modules:i,hookFunctions:o=[],inject:a={},log:l}=t;Gn("string"==typeof s,"shader source must be a string");const c=s;let u="";const h=us(o),d={},f={},p={};for(const m in a){const e="string"==typeof a[m]?{injection:a[m],order:0}:a[m],t=/^(v|f)s:(#)?([\w-]+)$/.exec(m);if(t){const n=t[2],s=t[3];n?"decl"===s?f[m]=[e]:p[m]=[e]:d[m]=[e]}else p[m]=[e]}const g=i;for(const m of g){l&&es(m,c,l),u+=_s(m,"wgsl");const e=(null==(n=m.injections)?void 0:n[r])||{};for(const t in e){const n=/^(v|f)s:#([\w-]+)$/.exec(t);if(n){const s="decl"===n[2]?f:p;s[t]=s[t]||[],s[t].push(e[t])}else d[t]=d[t]||[],d[t].push(e[t])}}return u+=fs,u=Qn(u,r,f),u+=cs(h[r],d),u+=c,u=Qn(u,r,p),u}function gs(e,t){var n;const{source:s,stage:r,language:i="glsl",modules:o,defines:a={},hookFunctions:l=[],inject:c={},prologue:u=!0,log:h}=t;Gn("string"==typeof s,"shader source must be a string");const d="glsl"===i?function(e){return{name:hs(e,void 0),language:"glsl",version:ds(e)}}(s).version:-1,f=e.shaderLanguageVersion,p=100===d?"#version 100":"#version 300 es",g=s.split("\n").slice(1).join("\n"),m={};o.forEach(e=>{Object.assign(m,e.defines)}),Object.assign(m,a);let _="";switch(i){case"wgsl":break;case"glsl":_=u?`${p}\n\n// ----- PROLOGUE -------------------------\n#define SHADER_TYPE_${r.toUpperCase()}\n\n${function(e){switch(null==e?void 0:e.gpu.toLowerCase()){case"apple":return"#define APPLE_GPU\n// Apple optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Headless Chrome's software shader 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// If the GPU doesn't have full 32 bits precision, will causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}(e)}\n${"fragment"===r?"precision highp float;\n":""}\n\n// ----- APPLICATION DEFINES -------------------------\n\n${function(e={}){let t="";for(const n in e){const s=e[n];(s||Number.isFinite(s))&&(t+=`#define ${n.toUpperCase()} ${e[n]}\n`)}return t}(m)}\n\n`:`${p}\n`}const y=us(l),b={},v={},x={};for(const w in c){const e="string"==typeof c[w]?{injection:c[w],order:0}:c[w],t=/^(v|f)s:(#)?([\w-]+)$/.exec(w);if(t){const n=t[2],s=t[3];n?"decl"===s?v[w]=[e]:x[w]=[e]:b[w]=[e]}else x[w]=[e]}for(const w of o){h&&es(w,g,h),_+=_s(w,r);const e=(null==(n=w.instance)?void 0:n.normalizedInjections[r])||{};for(const t in e){const n=/^(v|f)s:#([\w-]+)$/.exec(t);if(n){const s="decl"===n[2]?v:x;s[t]=s[t]||[],s[t].push(e[t])}else b[t]=b[t]||[],b[t].push(e[t])}}return _+="// ----- MAIN SHADER SOURCE -------------------------",_+=fs,_=Qn(_,r,v),_+=cs(y[r],b),_+=g,_=Qn(_,r,x),"glsl"===i&&d!==f&&(_=function(e,t){var n;if(300!==Number((null==(n=e.match(/^#version[ \t]+(\d+)/m))?void 0:n[1])||100))throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return as(e,is);case"fragment":return as(e,os);default:throw new Error(t)}}(_,r)),_.trim()}function ms(e){return function(t){var n;const s={};for(const r of e){const e=null==(n=r.getUniforms)?void 0:n.call(r,t,s);Object.assign(s,e)}return s}}function _s(e,t){let n;switch(t){case"vertex":n=e.vs||"";break;case"fragment":n=e.fs||"";break;case"wgsl":n=e.source||"";break;default:Gn(!1)}if(!e.name)throw new Error("Shader module must have a name");const s=e.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let r=`// ----- MODULE ${e.name} ---------------\n\n`;return"wgsl"!==t&&(r+=`#define MODULE_${s}\n`),r+=`${n}\n`,r}const ys=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,bs=/^\s*\#\s*endif\s*$/,vs=class e{constructor(){s(this,"_hookFunctions",[]),s(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return e.defaultShaderAssembler=e.defaultShaderAssembler||new e,e.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===("string"==typeof e?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter(e=>e.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,{source:s,getUniforms:r}=function(e){const t=ns(e.modules||[]);return{source:ps(e.platformInfo,{...e,source:e.source,stage:"vertex",modules:t}),getUniforms:ms(t)}}({...e,source:e.source,modules:t,hookFunctions:n}),i="wgsl"===e.platformInfo.shaderLanguage?function(e){const t=e.split("\n"),n=[];let s=!0,r=null;for(const i of t){const e=i.match(ys),t=i.match(bs);e?(r=e[1],s=Boolean(null==void 0?void 0:undefined[r])):t?s=!0:s&&n.push(i)}return n.join("\n")}(s):s;return{source:i,getUniforms:r,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,s=function(e){const{vs:t,fs:n}=e,s=ns(e.modules||[]);return{vs:gs(e.platformInfo,{...e,source:t,stage:"vertex",modules:s}),fs:gs(e.platformInfo,{...e,source:n,stage:"fragment",modules:s}),getUniforms:ms(s)}}({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:n});return{...s,modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),n={};let s=0;for(let r=0,i=this._defaultModules.length;r<i;++r){const e=this._defaultModules[r],i=e.name;t[s++]=e,n[i]=!0}for(let r=0,i=e.length;r<i;++r){const i=e[r],o=i.name;n[o]||(t[s++]=i,n[o]=!0)}return t.length=s,Jn(t),t}};s(vs,"defaultShaderAssembler");let xs=vs;function ws(e){const{input:t,inputChannels:n,output:s}={};if(!t)return"#version 300 es\nout vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}";if(!n)throw new Error("inputChannels");return`#version 300 es\nin ${function(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${e}`)}}(n)} ${t};\nout vec4 ${s};\nvoid main() {\n  ${s} = ${function(e,t){switch(t){case 1:return`vec4(${e}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${e}, 0.0, 1.0)`;case 3:return`vec4(${e}, 1.0)`;case 4:return e;default:throw new Error(`invalid channels: ${t}`)}}(t,n)};\n}`}const Es=new class{constructor(){s(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new wt({id:e})),this.stats.get(e)}},Ts=new $e({id:"luma.gl"}),Ss={};function As(e="id"){return Ss[e]=Ss[e]||1,`${e}-${Ss[e]++}`}let Rs=(t=class{constructor(e,t,n){if(s(this,"id"),s(this,"props"),s(this,"userData",{}),s(this,"_device"),s(this,"destroyed",!1),s(this,"allocatedBytes",0),s(this,"_attachedResources",new Set),!e)throw new Error("no device");this._device=e,this.props=function(e,t){const n={...t};for(const s in e)void 0!==e[s]&&(n[s]=e[s]);return n}(t,n);const r="undefined"!==this.props.id?this.props.id:As(this[Symbol.toStringTag]);this.props.id=r,this.id=r,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},s(t,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),t);const Cs=class e extends Rs{constructor(t,n){const r={...n};(n.usage||0)&e.INDEX&&!n.indexType&&(n.data instanceof Uint32Array?r.indexType="uint32":n.data instanceof Uint16Array&&(r.indexType="uint16")),delete r.data,super(t,r,e.defaultProps),s(this,"usage"),s(this,"indexType"),s(this,"updateTimestamp"),s(this,"debugData",new ArrayBuffer(0)),this.usage=r.usage||0,this.indexType=r.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(e){return this.device.createBuffer({...this.props,...e})}_setDebugData(t,n,s){const r=ArrayBuffer.isView(t)?t.buffer:t,i=Math.min(t?t.byteLength:s,e.DEBUG_DATA_MAX_LENGTH);null===r?this.debugData=new ArrayBuffer(i):0===n&&s===r.byteLength?this.debugData=r.slice(0,i):this.debugData=r.slice(n,n+i)}};s(Cs,"INDEX",16),s(Cs,"VERTEX",32),s(Cs,"UNIFORM",64),s(Cs,"STORAGE",128),s(Cs,"INDIRECT",256),s(Cs,"QUERY_RESOLVE",512),s(Cs,"MAP_READ",1),s(Cs,"MAP_WRITE",2),s(Cs,"COPY_SRC",4),s(Cs,"COPY_DST",8),s(Cs,"DEBUG_DATA_MAX_LENGTH",32),s(Cs,"defaultProps",{...Rs.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0});let Ps=Cs;function ks(e){const[t,n,s]=Ns[e],r=e.includes("norm");return{signedType:t,primitiveType:n,byteLength:s,normalized:r,integer:!r&&!e.startsWith("float"),signed:e.startsWith("s")}}function Is(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}function Ms(e){const t=ArrayBuffer.isView(e)?e.constructor:e;if(t===Uint8ClampedArray)return"uint8";const n=Object.values(Ns).find(e=>t===e[4]);if(!n)throw new Error(t.name);return n[0]}function Ls(e){const[,,,,t]=Ns[e];return t}const Ns={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]};function Os(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);const[n,s]=e.split("x"),r=n,i=s?parseInt(s):1,o=ks(r),a={type:r,components:i,byteLength:o.byteLength*i,integer:o.integer,signed:o.signed,normalized:o.normalized};return t&&(a.webglOnly=!0),a}function Fs(e,t,n){if(!t||t>4)throw new Error(`size ${t}`);const s=t;return function(e,t,n){const s=n?function(e){const t=e;switch(t){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return t}}(e):e;switch(s){case"unorm8":return 1===t?"unorm8":3===t?"unorm8x3-webgl":`${s}x${t}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(1===t||3===t)throw new Error(`size: ${t}`);return`${s}x${t}`;default:return 1===t?s:`${s}x${t}`}}(Ms(e),s,n)}const Ds="texture-compression-bc",Bs="texture-compression-astc",Us="texture-compression-etc2",js="texture-compression-pvrtc-webgl",Gs="texture-compression-atc-webgl",Vs="float32-renderable-webgl",zs="float16-renderable-webgl",Ws="snorm8-renderable-webgl",Hs="norm16-renderable-webgl",$s="snorm16-renderable-webgl",Xs="float32-filterable",qs="float16-filterable-webgl";function Ys(e){const t=Ks[e];if(!t)throw new Error(`Unsupported texture format ${e}`);return t}const Ks={r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:Ws},rg8snorm:{render:Ws},"rgb8snorm-webgl":{},rgba8snorm:{render:Ws},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:Hs},rg16unorm:{render:Hs},"rgb16unorm-webgl":{f:Hs},rgba16unorm:{render:Hs},r16snorm:{f:$s},rg16snorm:{render:$s},"rgb16snorm-webgl":{f:Hs},rgba16snorm:{render:$s},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:zs,filter:"float16-filterable-webgl"},rg16float:{render:zs,filter:qs},rgba16float:{render:zs,filter:qs},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:Vs,filter:Xs},rg32float:{render:!1,filter:Xs},"rgb32float-webgl":{render:Vs,filter:Xs},rgba32float:{render:Vs,filter:Xs},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:"rgb9e5ufloat-renderable-webgl"},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Vs},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Ds},"bc1-rgb-unorm-srgb-webgl":{f:Ds},"bc1-rgba-unorm":{f:Ds},"bc1-rgba-unorm-srgb":{f:Ds},"bc2-rgba-unorm":{f:Ds},"bc2-rgba-unorm-srgb":{f:Ds},"bc3-rgba-unorm":{f:Ds},"bc3-rgba-unorm-srgb":{f:Ds},"bc4-r-unorm":{f:Ds},"bc4-r-snorm":{f:Ds},"bc5-rg-unorm":{f:Ds},"bc5-rg-snorm":{f:Ds},"bc6h-rgb-ufloat":{f:Ds},"bc6h-rgb-float":{f:Ds},"bc7-rgba-unorm":{f:Ds},"bc7-rgba-unorm-srgb":{f:Ds},"etc2-rgb8unorm":{f:Us},"etc2-rgb8unorm-srgb":{f:Us},"etc2-rgb8a1unorm":{f:Us},"etc2-rgb8a1unorm-srgb":{f:Us},"etc2-rgba8unorm":{f:Us},"etc2-rgba8unorm-srgb":{f:Us},"eac-r11unorm":{f:Us},"eac-r11snorm":{f:Us},"eac-rg11unorm":{f:Us},"eac-rg11snorm":{f:Us},"astc-4x4-unorm":{f:Bs},"astc-4x4-unorm-srgb":{f:Bs},"astc-5x4-unorm":{f:Bs},"astc-5x4-unorm-srgb":{f:Bs},"astc-5x5-unorm":{f:Bs},"astc-5x5-unorm-srgb":{f:Bs},"astc-6x5-unorm":{f:Bs},"astc-6x5-unorm-srgb":{f:Bs},"astc-6x6-unorm":{f:Bs},"astc-6x6-unorm-srgb":{f:Bs},"astc-8x5-unorm":{f:Bs},"astc-8x5-unorm-srgb":{f:Bs},"astc-8x6-unorm":{f:Bs},"astc-8x6-unorm-srgb":{f:Bs},"astc-8x8-unorm":{f:Bs},"astc-8x8-unorm-srgb":{f:Bs},"astc-10x5-unorm":{f:Bs},"astc-10x5-unorm-srgb":{f:Bs},"astc-10x6-unorm":{f:Bs},"astc-10x6-unorm-srgb":{f:Bs},"astc-10x8-unorm":{f:Bs},"astc-10x8-unorm-srgb":{f:Bs},"astc-10x10-unorm":{f:Bs},"astc-10x10-unorm-srgb":{f:Bs},"astc-12x10-unorm":{f:Bs},"astc-12x10-unorm-srgb":{f:Bs},"astc-12x12-unorm":{f:Bs},"astc-12x12-unorm-srgb":{f:Bs},"pvrtc-rgb4unorm-webgl":{f:js},"pvrtc-rgba4unorm-webgl":{f:js},"pvrtc-rbg2unorm-webgl":{f:js},"pvrtc-rgba2unorm-webgl":{f:js},"etc1-rbg-unorm-webgl":{f:"texture-compression-etc1-webgl"},"atc-rgb-unorm-webgl":{f:Gs},"atc-rgba-unorm-webgl":{f:Gs},"atc-rgbai-unorm-webgl":{f:Gs}},Zs=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],Qs=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/,Js=new class{getInfo(e){return er(e)}isColor(e){return e.startsWith("rgba")||e.startsWith("bgra")||e.startsWith("rgb")}isDepthStencil(e){return e.startsWith("depth")||e.startsWith("stencil")}isCompressed(e){return Zs.some(t=>e.startsWith(t))}getCapabilities(e){const t=Ys(e),n={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},s=er(e),r=e.startsWith("depth")||e.startsWith("stencil"),i=null==s?void 0:s.signed,o=null==s?void 0:s.integer,a=null==s?void 0:s.webgl;return n.render&&(n.render=!i),n.filter&&(n.filter=!(r||i||o||a)),n}};function er(e){let t=function(e){var t;const n=Ys(e),s=n.bytesPerPixel||1,r=n.bitsPerChannel||[8,8,8,8];delete n.bitsPerChannel,delete n.bytesPerPixel,delete n.f,delete n.render,delete n.filter,delete n.blend,delete n.store;return{...n,format:e,attachment:n.attachment||"color",channels:n.channels||"r",components:n.components||(null==(t=n.channels)?void 0:t.length)||1,bytesPerPixel:s,bitsPerChannel:r,dataType:n.dataType||"uint8",srgb:n.srgb??!1,packed:n.packed??!1,webgl:n.webgl??!1,integer:n.integer??!1,signed:n.signed??!1,normalized:n.normalized??!1,compressed:n.compressed??!1}}(e);if(Js.isCompressed(e)){t.channels="rgb",t.components=3,t.bytesPerPixel=1,t.srgb=!1,t.compressed=!0;const n=function(e){const t=/.*-(\d+)x(\d+)-.*/.exec(e);if(t){const[,e,n]=t;return{blockWidth:Number(e),blockHeight:Number(n)}}return null}(e);n&&(t.blockWidth=n.blockWidth,t.blockHeight=n.blockHeight)}const n=Qs.exec(e);if(n){const[,s,r,i,o,a]=n,l=ks(`${i}${r}`),c=8*l.byteLength,u=s.length,h=[c,u>=2?c:0,u>=3?c:0,u>=4?c:0];t={format:e,attachment:t.attachment,dataType:l.signedType,components:u,channels:s,integer:l.integer,signed:l.signed,normalized:l.normalized,bitsPerChannel:h,bytesPerPixel:l.byteLength*s.length,packed:t.packed,srgb:t.srgb},"-webgl"===a&&(t.webgl=!0),"-srgb"===o&&(t.srgb=!0)}return e.endsWith("-webgl")&&(t.webgl=!0),e.endsWith("-srgb")&&(t.srgb=!0),t}class tr{}class nr{constructor(e=[],t){s(this,"features"),s(this,"disabledFeatures"),this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){var t;return!(null==(t=this.disabledFeatures)?void 0:t[e])&&this.features.has(e)}}const sr=class e{constructor(t){s(this,"id"),s(this,"props"),s(this,"userData",{}),s(this,"statsManager",Es),s(this,"timestamp",0),s(this,"_reused",!1),s(this,"_lumaData",{}),s(this,"_textureCaps",{}),this.props={...e.defaultProps,...t},this.id=this.props.id||As(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}getVertexFormatInfo(e){return Os(e)}isVertexFormatSupported(e){return!0}getTextureFormatInfo(e){return Js.getInfo(e)}getTextureFormatCapabilities(e){let t=this._textureCaps[e];if(!t){const n=this._getDeviceTextureFormatCapabilities(e);t=this._getDeviceSpecificTextureFormatCapabilities(n),this._textureCaps[e]=t}return t}getMipLevelCount(e,t,n=1){const s=Math.max(e,t,n);return 1+Math.floor(Math.log2(s))}isExternalImage(e){return function(e){return"undefined"!=typeof ImageData&&e instanceof ImageData||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas}(e)}getExternalImageSize(e){return function(e){if("undefined"!=typeof ImageData&&e instanceof ImageData||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if("undefined"!=typeof VideoFrame&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}(e)}isTextureFormatSupported(e){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return Js.isCompressed(e)}pushDebugGroup(e){this.commandEncoder.pushDebugGroup(e)}popDebugGroup(){var e;null==(e=this.commandEncoder)||e.popDebugGroup()}insertDebugMarker(e){var t;null==(t=this.commandEncoder)||t.insertDebugMarker(e)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(e,t,...n){return this.props.onError(e,t)?()=>{}:Ts.error(e.message,t,...n)}debug(){if(this.props.debug);else{const e="'Type luma.log.set({debug: true}) in console to enable debug breakpoints',\nor create a device with the 'debug: true' prop.";Ts.once(0,e)()}}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(e){return this.commandEncoder.beginRenderPass(e)}beginComputePass(e){return this.commandEncoder.beginComputePass(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return!0===e.createCanvasContext?{}:e.createCanvasContext}_getDeviceTextureFormatCapabilities(e){const t=Js.getCapabilities(e),n=e=>("string"==typeof e?this.features.has(e):e)??!0,s=n(t.create);return{format:e,create:s,render:s&&n(t.render),filter:s&&n(t.filter),blend:s&&n(t.blend),store:s&&n(t.store)}}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};if((e.usage||0)&Ps.INDEX&&(e.indexType||(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array&&(t.indexType="uint16")),!t.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return t}};s(sr,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(e,t)=>{},onResize:(e,t)=>{const[n,s]=e.getDevicePixelSize();Ts.log(1,`${e} resized => ${n}x${s}px`)()},onPositionChange:(e,t)=>{const[n,s]=e.getPosition();Ts.log(1,`${e} repositioned => ${n},${s}`)()},onVisibilityChange:e=>Ts.log(1,`${e} Visibility changed ${e.isVisible}`)(),onDevicePixelRatioChange:(e,t)=>Ts.log(1,`${e} DPR changed ${t.oldRatio} => ${e.devicePixelRatio}`)(),debug:Ts.get("debug")||void 0,debugShaders:Ts.get("debug-shaders")||void 0,debugFramebuffers:Boolean(Ts.get("debug-framebuffers")),debugFactories:Boolean(Ts.get("debug-factories")),debugWebGL:Boolean(Ts.get("debug-webgl")),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0});let rr=sr;const ir="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",or=class e{constructor(){if(s(this,"stats",Es),s(this,"log",Ts),s(this,"VERSION","9.2.5"),s(this,"spector"),s(this,"preregisteredAdapters",new Map),globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Ts.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),Ts.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Ts.error("This version of luma.gl has already been initialized")()}Ts.log(1,`${this.VERSION} - set luma.log.level=1 (or higher) to trace rendering`)(),globalThis.luma=this}async createDevice(t={}){const n={...e.defaultProps,...t},s=this.selectAdapter(n.type,n.adapters);if(!s)throw new Error(ir);return n.waitForPageLoad&&await s.pageLoaded,await s.create(n)}async attachDevice(e,t){var n;const s=this._getTypeFromHandle(e,t.adapters),r=s&&this.selectAdapter(s,t.adapters);if(!r)throw new Error(ir);return await(null==(n=null==r?void 0:r.attach)?void 0:n.call(r,e,t))}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this._getAdapterMap(e);return Array.from(t).map(([,e])=>e).filter(e=>{var t;return null==(t=e.isSupported)?void 0:t.call(e)}).map(e=>e.type)}getBestAvailableAdapterType(e=[]){var t,n;const s=["webgpu","webgl","null"],r=this._getAdapterMap(e);for(const i of s)if(null==(n=null==(t=r.get(i))?void 0:t.isSupported)?void 0:n.call(t))return i;return null}selectAdapter(e,t=[]){let n=e;"best-available"===e&&(n=this.getBestAvailableAdapterType(t));const s=this._getAdapterMap(t);return n&&s.get(n)||null}enforceWebGL2(e=!0,t=[]){var n;const s=this._getAdapterMap(t).get("webgl");s||Ts.warn("enforceWebGL2: webgl adapter not found")(),null==(n=null==s?void 0:s.enforceWebGL2)||n.call(s,e)}setDefaultDeviceProps(t){Object.assign(e.defaultProps,t)}_getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const n of e)t.set(n.type,n);return t}_getTypeFromHandle(e,t=[]){return e instanceof WebGL2RenderingContext?"webgl":"undefined"!=typeof GPUDevice&&e instanceof GPUDevice||(null==e?void 0:e.queue)?"webgpu":null===e?"null":(e instanceof WebGLRenderingContext?Ts.warn("WebGL1 is not supported",e)():Ts.warn("Unknown handle type",e)(),null)}};s(or,"defaultProps",{...rr.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0});const ar=new or;class lr{get pageLoaded(){return hr||(hr=ur()||"undefined"==typeof window?Promise.resolve():new Promise(e=>window.addEventListener("load",()=>e()))),hr}}const cr=Le()&&"undefined"!=typeof document,ur=()=>cr&&"complete"===document.readyState;let hr=null;const dr=class e{constructor(t){var n,r;if(s(this,"id"),s(this,"props"),s(this,"canvas"),s(this,"htmlCanvas"),s(this,"offscreenCanvas"),s(this,"type"),s(this,"initialized"),s(this,"isInitialized",!1),s(this,"isVisible",!0),s(this,"cssWidth"),s(this,"cssHeight"),s(this,"devicePixelRatio"),s(this,"devicePixelWidth"),s(this,"devicePixelHeight"),s(this,"drawingBufferWidth"),s(this,"drawingBufferHeight"),s(this,"_initializedResolvers",function(){let e,t;return{promise:new Promise((n,s)=>{e=n,t=s}),resolve:e,reject:t}}()),s(this,"_resizeObserver"),s(this,"_intersectionObserver"),s(this,"_position"),s(this,"destroyed",!1),this.props={...e.defaultProps,...t},t=this.props,this.initialized=this._initializedResolvers.promise,Le()?t.canvas?"string"==typeof t.canvas?this.canvas=function(e){const t=document.getElementById(e);if(!fr.isHTMLCanvas(t))throw new Error("Object is not a canvas element");return t}(t.canvas):this.canvas=t.canvas:this.canvas=function(e){const{width:t,height:n}=e,s=document.createElement("canvas");s.id=As("lumagl-auto-created-canvas"),s.width=t||1,s.height=n||1,s.style.width=Number.isFinite(t)?`${t}px`:"100%",s.style.height=Number.isFinite(n)?`${n}px`:"100%",(null==e?void 0:e.visible)||(s.style.visibility="hidden");const r=function(e){if("string"==typeof e){const t=document.getElementById(e);if(!t)throw new Error(`${e} is not an HTML element`);return t}return e||document.body}((null==e?void 0:e.container)||null);return r.insertBefore(s,r.firstChild),s}(t):this.canvas={width:t.width||1,height:t.height||1},e.isHTMLCanvas(this.canvas)?(this.id=t.id||this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):e.isOffscreenCanvas(this.canvas)?(this.id=t.id||"offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas):(this.id=t.id||"node-canvas-context",this.type="node"),this.cssWidth=(null==(n=this.htmlCanvas)?void 0:n.clientWidth)||this.canvas.width,this.cssHeight=(null==(r=this.htmlCanvas)?void 0:r.clientHeight)||this.canvas.height,this.devicePixelWidth=this.canvas.width,this.devicePixelHeight=this.canvas.height,this.drawingBufferWidth=this.canvas.width,this.drawingBufferHeight=this.canvas.height,this.devicePixelRatio=globalThis.devicePixelRatio||1,this._position=[0,0],e.isHTMLCanvas(this.canvas)){this._intersectionObserver=new IntersectionObserver(e=>this._handleIntersection(e)),this._intersectionObserver.observe(this.canvas),this._resizeObserver=new ResizeObserver(e=>this._handleResize(e));try{this._resizeObserver.observe(this.canvas,{box:"device-pixel-content-box"})}catch{this._resizeObserver.observe(this.canvas,{box:"content-box"})}setTimeout(()=>this._observeDevicePixelRatio(),0),this.props.trackPosition&&this._trackPosition()}}static isHTMLCanvas(e){return"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement}static isOffscreenCanvas(e){return"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}destroy(){this.destroyed=!0}setProps(e){return"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1,this._updateDrawingBufferSize()),this}getCSSSize(){return[this.cssWidth,this.cssHeight]}getPosition(){return this._position}getDevicePixelSize(){return[this.devicePixelWidth,this.devicePixelHeight]}getDrawingBufferSize(){return[this.drawingBufferWidth,this.drawingBufferHeight]}getMaxDrawingBufferSize(){const e=this.device.limits.maxTextureDimension2D;return[e,e]}setDrawingBufferSize(e,t){this.canvas.width=e,this.canvas.height=t,this.drawingBufferWidth=e,this.drawingBufferHeight=t}getDevicePixelRatio(){return"undefined"!=typeof window&&window.devicePixelRatio||1}cssToDevicePixels(e,t=!0){const n=this.cssToDeviceRatio(),[s,r]=this.getDrawingBufferSize();return function(e,t,n,s,r){const i=e,o=pr(i[0],t,n);let a=gr(i[1],t,s,r),l=pr(i[0]+1,t,n);const c=l===n-1?l:l-1;let u;return l=gr(i[1]+1,t,s,r),r?(l=0===l?l:l+1,u=a,a=l):u=l===s-1?l:l-1,{x:o,y:a,width:Math.max(c-o+1,1),height:Math.max(u-a+1,1)}}(e,n,s,r,t)}getPixelSize(){return this.getDevicePixelSize()}getAspect(){const[e,t]=this.getDevicePixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),[t]=this.getCSSSize();return t?e/t:1}catch{return 1}}resize(e){this.setDrawingBufferSize(e.width,e.height)}_setAutoCreatedCanvasId(e){var t;"lumagl-auto-created-canvas"===(null==(t=this.htmlCanvas)?void 0:t.id)&&(this.htmlCanvas.id=e)}_handleIntersection(e){const t=e.find(e=>e.target===this.canvas);if(!t)return;const n=t.isIntersecting;this.isVisible!==n&&(this.isVisible=n,this.device.props.onVisibilityChange(this))}_handleResize(e){var t,n;const s=e.find(e=>e.target===this.canvas);if(!s)return;this.cssWidth=s.contentBoxSize[0].inlineSize,this.cssHeight=s.contentBoxSize[0].blockSize;const r=this.getDevicePixelSize(),i=(null==(t=s.devicePixelContentBoxSize)?void 0:t[0].inlineSize)||s.contentBoxSize[0].inlineSize*devicePixelRatio,o=(null==(n=s.devicePixelContentBoxSize)?void 0:n[0].blockSize)||s.contentBoxSize[0].blockSize*devicePixelRatio,[a,l]=this.getMaxDrawingBufferSize();this.devicePixelWidth=Math.max(1,Math.min(i,a)),this.devicePixelHeight=Math.max(1,Math.min(o,l)),this._updateDrawingBufferSize(),this.device.props.onResize(this,{oldPixelSize:r})}_updateDrawingBufferSize(){if(this.props.autoResize){if("number"==typeof this.props.useDevicePixels){const e=this.props.useDevicePixels;this.setDrawingBufferSize(this.cssWidth*e,this.cssHeight*e)}else this.props.useDevicePixels?this.setDrawingBufferSize(this.devicePixelWidth,this.devicePixelHeight):this.setDrawingBufferSize(this.cssWidth,this.cssHeight);this._updateDevice()}this._initializedResolvers.resolve(),this.isInitialized=!0,this.updatePosition()}_observeDevicePixelRatio(){const e=this.devicePixelRatio;this.devicePixelRatio=window.devicePixelRatio,this.updatePosition(),this.device.props.onDevicePixelRatioChange(this,{oldRatio:e}),matchMedia(`(resolution: ${this.devicePixelRatio}dppx)`).addEventListener("change",()=>this._observeDevicePixelRatio(),{once:!0})}_trackPosition(e=100){const t=setInterval(()=>{this.destroyed?clearInterval(t):this.updatePosition()},e)}updatePosition(){var e,t,n;const s=null==(e=this.htmlCanvas)?void 0:e.getBoundingClientRect();if(s){const e=[s.left,s.top];if(this._position??(this._position=e),e[0]!==this._position[0]||e[1]!==this._position[1]){const s=this._position;this._position=e,null==(n=(t=this.device.props).onPositionChange)||n.call(t,this,{oldPosition:s})}}}};s(dr,"defaultProps",{id:void 0,canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb",trackPosition:!1});let fr=dr;function pr(e,t,n){return Math.min(Math.round(e*t),n-1)}function gr(e,t,n,s){return s?Math.max(0,n-1-Math.round(e*t)):Math.min(Math.round(e*t),n-1)}const mr=class e extends Rs{get[Symbol.toStringTag](){return"Sampler"}constructor(t,n){super(t,n=e.normalizeProps(t,n),e.defaultProps)}static normalizeProps(e,t){return t}};s(mr,"defaultProps",{...Rs.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let _r=mr;const yr={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"},br=class e extends Rs{constructor(t,n){if(super(t,n=e.normalizeProps(t,n),e.defaultProps),s(this,"dimension"),s(this,"baseDimension"),s(this,"format"),s(this,"width"),s(this,"height"),s(this,"depth"),s(this,"mipLevels"),s(this,"updateTimestamp"),this.dimension=this.props.dimension,this.baseDimension=yr[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,void 0===this.props.width||void 0===this.props.height)if(t.isExternalImage(n.data)){const e=t.getExternalImageSize(n.data);this.width=(null==e?void 0:e.width)||1,this.height=(null==e?void 0:e.height)||1}else this.width=1,this.height=1,void 0!==this.props.width&&void 0!==this.props.height||Ts.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}setSampler(e){this.sampler=e instanceof _r?e:this.device.createSampler(e)}clone(e){return this.device.createTexture({...this.props,...e})}static normalizeProps(e,t){const n={...t},{width:s,height:r}=n;return"number"==typeof s&&(n.width=Math.max(1,Math.ceil(s))),"number"==typeof r&&(n.height=Math.max(1,Math.ceil(r))),n}_initializeData(e){this.device.isExternalImage(e)?this.copyExternalImage({image:e,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):e&&this.copyImageData({data:e,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(t){const{width:n,height:s,depth:r}=this,i={...e.defaultCopyDataOptions,width:n,height:s,depth:r,...t},o=this.device.getTextureFormatInfo(this.format);if(!t.bytesPerRow&&!o.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return i.bytesPerRow=t.bytesPerRow||n*(o.bytesPerPixel||4),i.rowsPerImage=t.rowsPerImage||s,i}_normalizeCopyExternalImageOptions(t){const n=this.device.getExternalImageSize(t.image),s={...e.defaultCopyExternalImageOptions,...n,...t};return s.width=Math.min(s.width,this.width-s.x),s.height=Math.min(s.height,this.height-s.y),s}};s(br,"SAMPLE",4),s(br,"STORAGE",8),s(br,"RENDER",16),s(br,"COPY_SRC",1),s(br,"COPY_DST",2),s(br,"TEXTURE",4),s(br,"RENDER_ATTACHMENT",16),s(br,"defaultProps",{...Rs.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:br.TEXTURE|br.RENDER_ATTACHMENT|br.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0}),s(br,"defaultCopyDataOptions",{data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"}),s(br,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let vr=br;const xr=class e extends Rs{get[Symbol.toStringTag](){return"TextureView"}constructor(t,n){super(t,n,e.defaultProps)}};s(xr,"defaultProps",{...Rs.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let wr=xr;function Er(e,t,n,s){if(null==s?void 0:s.inlineSource){const s=function(e,t){let n="";for(let s=t-2;s<=t;s++){const r=e[s-1];void 0!==r&&(n+=Tr(r,t,undefined))}return n}(t,n);return`\n${s}${e.linePos>0?`${" ".repeat(e.linePos+5)}^^^\n`:""}${e.type.toUpperCase()}: ${e.message}\n\n`}const r="error"===e.type?"red":"#8B4000";return(null==s?void 0:s.html)?`<div class='luma-compiler-log-error' style="color:${r};"><b> ${e.type.toUpperCase()}: ${e.message}</b></div>`:`${e.type.toUpperCase()}: ${e.message}`}function Tr(e,t,n){const s=(null==n?void 0:n.html)?e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"):e;return`${function(e){let t="";for(let n=e.length;n<4;++n)t+=" ";return t+e}(String(t))}: ${s}${(null==n?void 0:n.html)?"<br/>":"\n"}`}const Sr=class e extends Rs{constructor(t,n){super(t,{id:Rr(n={...n,debugShaders:n.debugShaders||t.props.debugShaders||"errors"}),...n},e.defaultProps),s(this,"stage"),s(this,"source"),s(this,"compilationStatus","pending"),this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if("success"===this.compilationStatus)return}const t=await this.getCompilationInfo();"warnings"===e&&0===(null==t?void 0:t.length)||this._displayShaderLog(t,this.id)}_displayShaderLog(e,t){var n;if("undefined"==typeof document||!(null==document?void 0:document.createElement))return;const s=t,r=`${this.stage} shader "${s}"`;let i=function(e,t,n){let s="";const r=t.split(/\r?\n/),i=e.slice().sort((e,t)=>e.lineNum-t.lineNum);switch((null==n?void 0:n.showSourceCode)||"no"){case"all":let t=0;for(let e=1;e<=r.length;e++)for(s+=Tr(r[e-1],e,n);i.length>t&&i[t].lineNum===e;){const e=i[t++];s+=Er(e,r,e.lineNum,{...n,inlineSource:!1})}for(;i.length>t;)s+=Er(i[t++],[],0,{...n,inlineSource:!1});return s;case"issues":case"no":for(const i of e)s+=Er(i,r,i.lineNum,{inlineSource:"no"!==(null==n?void 0:n.showSourceCode)});return s}}(e,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(i+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`\n<h1>Compilation error in ${r}</h1><br /><br />\n<code style="user-select:text;"><pre>\n${i}\n</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a),null==(n=document.getElementsByClassName("luma-compiler-log-error")[0])||n.scrollIntoView(),a.onclick=()=>{const e=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(e)}}};s(Sr,"defaultProps",{...Rs.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let Ar=Sr;function Rr(e){return function(e,t="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return n?n[1]:t}(e.source)||e.id||As(`unnamed ${e.stage}-shader`)}const Cr=class e extends Rs{constructor(t,n={}){super(t,n,e.defaultProps),s(this,"width"),s(this,"height"),this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(e){const t=this.colorAttachments.map(t=>t.texture.clone(e)),n=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:t,depthStencilAttachment:n})}resize(e){let t=!e;if(e){const[n,s]=Array.isArray(e)?e:[e.width,e.height];t=t||s!==this.height||n!==this.width,this.width=n,this.height=s}t&&(Ts.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(0===this.props.colorAttachments.length&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((e,t)=>{if("string"==typeof e){const n=this.createColorTexture(e,t);return this.attachResource(n),n.view}return e instanceof vr?e.view:e});const e=this.props.depthStencilAttachment;if(e)if("string"==typeof e){const t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else this.depthStencilAttachment=e instanceof vr?e.view:e}createColorTexture(e,t){return this.device.createTexture({id:`${this.id}-color-attachment-${t}`,usage:vr.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:vr.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,t){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const s=this.colorAttachments[n].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const n=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}this.updateAttachments()}};s(Cr,"defaultProps",{...Rs.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let Pr=Cr;const kr=class e extends Rs{constructor(t,n){super(t,n,e.defaultProps),s(this,"shaderLayout"),s(this,"bufferLayout"),s(this,"linkStatus","pending"),s(this,"hash",""),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}};s(kr,"defaultProps",{...Rs.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}});let Ir=kr;const Mr=class e extends Rs{get[Symbol.toStringTag](){return"RenderPass"}constructor(t,n){super(t,n=e.normalizeProps(t,n),e.defaultProps)}static normalizeProps(e,t){return t}};s(Mr,"defaultClearColor",[0,0,0,1]),s(Mr,"defaultClearDepth",1),s(Mr,"defaultClearStencil",0),s(Mr,"defaultProps",{...Rs.defaultProps,framebuffer:null,parameters:void 0,clearColor:Mr.defaultClearColor,clearColors:void 0,clearDepth:Mr.defaultClearDepth,clearStencil:Mr.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Lr=Mr;const Nr=class e extends Rs{constructor(t,n){super(t,n,e.defaultProps),s(this,"hash",""),s(this,"shaderLayout"),this.shaderLayout=n.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};s(Nr,"defaultProps",{...Rs.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Or=Nr;const Fr=class e extends Rs{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(t,n){super(t,n,e.defaultProps)}};s(Fr,"defaultProps",{...Rs.defaultProps,measureExecutionTime:void 0});let Dr=Fr;const Br=class e extends Rs{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(t,n){super(t,n,e.defaultProps)}};s(Br,"defaultProps",{...Rs.defaultProps});let Ur=Br;function jr(e){return zr[e]}const Gr={f32:4,f16:2,i32:4,u32:4},Vr={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},zr={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}};function Wr(e,t){const n={};for(const s of e.attributes){const r=Hr(e,t,s.name);r&&(n[s.name]=r)}return n}function Hr(e,t,n){const s=function(e,t){const n=e.attributes.find(e=>e.name===t);return n||Ts.warn(`shader layout attribute "${t}" not present in shader`),n||null}(e,n),r=function(e,t){!function(e){for(const t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&Ts.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}(e);let n=function(e,t){for(const n of e)if(n.format&&n.name===t)return{attributeName:n.name,bufferName:t,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}(e,t);return n||(n=function(e,t){var n;for(const s of e){let e=s.byteStride;if("number"!=typeof s.byteStride)for(const t of s.attributes||[])e+=Os(t.format).byteLength;const r=null==(n=s.attributes)?void 0:n.find(e=>e.attribute===t);if(r)return{attributeName:r.attribute,bufferName:s.name,stepMode:s.stepMode,vertexFormat:r.format,byteOffset:r.byteOffset,byteStride:e}}return null}(e,t),n||(Ts.warn(`layout for attribute "${t}" not present in buffer layout`),null))}(t,n);if(!s)return null;const i=function(e){const[t,n]=Vr[e];return{primitiveType:t,components:n,byteLength:Gr[t]*n,integer:"i32"===t||"u32"===t,signed:"u32"!==t}}(s.type),o=function(e){let t;switch(e.primitiveType){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e.components<=2?"float16x2":"float16x4"}return 1===e.components?t:`${t}x${e.components}`}(i),a=(null==r?void 0:r.vertexFormat)||o,l=Os(a);return{attributeName:(null==r?void 0:r.attributeName)||s.name,bufferName:(null==r?void 0:r.bufferName)||s.name,location:s.location,shaderType:s.type,primitiveType:i.primitiveType,shaderComponents:i.components,vertexFormat:a,bufferDataType:l.type,bufferComponents:l.components,normalized:l.normalized,integer:i.integer,stepMode:(null==r?void 0:r.stepMode)||s.stepMode||"vertex",byteOffset:(null==r?void 0:r.byteOffset)||0,byteStride:(null==r?void 0:r.byteStride)||0}}const $r=class e extends Rs{constructor(t,n){super(t,n,e.defaultProps),s(this,"maxVertexAttributes"),s(this,"attributeInfos"),s(this,"indexBuffer",null),s(this,"attributes"),this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=function(e,t,n=16){const s=Wr(e,t),r=new Array(n).fill(null);for(const i of Object.values(s))r[i.location]=i;return r}(n.shaderLayout,n.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(e,t){this.device.reportError(new Error("constant attributes not supported"),this)()}};s($r,"defaultProps",{...Rs.defaultProps,shaderLayout:void 0,bufferLayout:[]});let Xr=$r;const qr=class e extends Rs{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(t,n){super(t,n,e.defaultProps)}};s(qr,"defaultProps",{...Rs.defaultProps,layout:void 0,buffers:{}});let Yr=qr;const Kr=class e extends Rs{get[Symbol.toStringTag](){return"QuerySet"}constructor(t,n){super(t,n,e.defaultProps)}};s(Kr,"defaultProps",{...Rs.defaultProps,type:void 0,count:void 0});let Zr,Qr=Kr;function Jr(e){return(!Zr||Zr.byteLength<e)&&(Zr=new ArrayBuffer(e)),Zr}function ei(e){return Array.isArray(e)?0===e.length||"number"==typeof e[0]:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(e)}class ti{constructor(e,t={}){s(this,"layout",{}),s(this,"byteLength");let n=0;for(const[s,i]of Object.entries(e)){const e=jr(i),{type:r,components:o}=e,a=o*((null==t?void 0:t[s])??1);n=Is(n,a);const l=n;n+=a,this.layout[s]={type:r,size:a,offset:l}}n+=(4-n%4)%4;const r=4*n;this.byteLength=Math.max(r,1024)}getData(e){const t=Jr(this.byteLength),n={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(const[s,r]of Object.entries(e)){const e=this.layout[s];if(!e){Ts.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:t,size:i,offset:o}=e,a=n[t];if(1===i){if("number"!=typeof r&&"boolean"!=typeof r){Ts.warn(`Supplied value for single component uniform ${s} is not a number: ${r}`)();continue}a[o]=Number(r)}else{if(!ei(r)){Ts.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${r}`)();continue}a.set(r,o)}}return new Uint8Array(t,0,this.byteLength)}has(e){return Boolean(this.layout[e])}get(e){return this.layout[e]}}class ni{constructor(e){var t;if(s(this,"name"),s(this,"uniforms",{}),s(this,"modifiedUniforms",{}),s(this,"modified",!0),s(this,"bindingLayout",{}),s(this,"needsRedraw","initialized"),this.name=(null==e?void 0:e.name)||"unnamed",(null==e?void 0:e.name)&&(null==e?void 0:e.shaderLayout)){const n=null==(t=null==e?void 0:e.shaderLayout.bindings)?void 0:t.find(t=>"uniform"===t.type&&t.name===(null==e?void 0:e.name));if(!n)throw new Error(null==e?void 0:e.name);const s=n;for(const e of s.uniforms||[])this.bindingLayout[e.name]=e}}setUniforms(e){for(const[t,n]of Object.entries(e))this._setUniform(t,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){var n;(function(e,t){if(e!==t)return!1;const n=e,s=t;if(!ei(n))return!1;if(ei(s)&&n.length===s.length)for(let r=0;r<n.length;++r)if(s[r]!==n[r])return!1;return!0})(this.uniforms[e],t)||(this.uniforms[e]=ei(n=t)?n.slice():n,this.modifiedUniforms[e]=!0,this.modified=!0)}}class si{constructor(e){s(this,"uniformBlocks",new Map),s(this,"uniformBufferLayouts",new Map),s(this,"uniformBuffers",new Map);for(const[t,n]of Object.entries(e)){const e=t,s=new ti(n.uniformTypes??{},n.uniformSizes??{});this.uniformBufferLayouts.set(e,s);const r=new ni({name:t});r.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(e,r)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var t;for(const[n,s]of Object.entries(e))null==(t=this.uniformBlocks.get(n))||t.setUniforms(s);this.updateUniformBuffers()}getUniformBufferByteLength(e){var t;return(null==(t=this.uniformBufferLayouts.get(e))?void 0:t.byteLength)||0}getUniformBufferData(e){var t,n;const s=(null==(t=this.uniformBlocks.get(e))?void 0:t.getAllUniforms())||{};return null==(n=this.uniformBufferLayouts.get(e))?void 0:n.getData(s)}createUniformBuffer(e,t,n){n&&this.setUniforms(n);const s=this.getUniformBufferByteLength(t),r=e.createBuffer({usage:Ps.UNIFORM|Ps.COPY_DST,byteLength:s}),i=this.getUniformBufferData(t);return r.write(i),r}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const n=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:Ps.UNIFORM|Ps.COPY_DST,byteLength:n});this.uniformBuffers.set(t,s)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(t);e||(e=n)}return e&&Ts.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var t;const n=this.uniformBlocks.get(e);let s=this.uniformBuffers.get(e),r=!1;if(s&&(null==n?void 0:n.needsRedraw)){r||(r=n.needsRedraw);const i=this.getUniformBufferData(e);s=this.uniformBuffers.get(e),null==s||s.write(i);const o=null==(t=this.uniformBlocks.get(e))?void 0:t.getAllUniforms();Ts.log(4,`Writing to uniform buffer ${String(e)}`,i,o)()}return r}}class ri{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class ii{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class oi extends ri{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class ai extends ri{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class li extends ri{constructor(e,t,n){super(e,n),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class ci extends ri{constructor(e,t,n,s){super(e,n),this.format=t,this.access=s}get isTemplate(){return!0}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+="f",e;if("i32"===this.format.name)return e+="i",e;if("u32"===this.format.name)return e+="u",e;if("bool"===this.format.name)return e+="b",e;if("f16"===this.format.name)return e+="h",e}e+=`<${this.format.name}>`}else if("vec2"===e||"vec3"===e||"vec4"===e)return e;return e}}var ui,hi;(hi=ui||(ui={}))[hi.Uniform=0]="Uniform",hi[hi.Storage=1]="Storage",hi[hi.Texture=2]="Texture",hi[hi.Sampler=3]="Sampler",hi[hi.StorageTexture=4]="StorageTexture";class di{constructor(e,t,n,s,r,i,o){this.name=e,this.type=t,this.group=n,this.binding=s,this.attributes=r,this.resourceType=i,this.access=o}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class fi{constructor(e,t){this.name=e,this.type=t}}class pi{constructor(e,t,n,s){this.name=e,this.type=t,this.locationType=n,this.location=s,this.interpolation=null}}class gi{constructor(e,t,n,s){this.name=e,this.type=t,this.locationType=n,this.location=s}}class mi{constructor(e,t,n,s){this.name=e,this.type=t,this.attributes=n,this.id=s}}class _i{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n}}class yi{constructor(e,t=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=n}}class bi{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function vi(e){var t=(32768&e)>>15,n=(31744&e)>>10,s=1023&e;return 0==n?(t?-1:1)*Math.pow(2,-14)*(s/Math.pow(2,10)):31==n?s?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,n-15)*(1+s/Math.pow(2,10))}const xi=new Float32Array(1),wi=new Int32Array(xi.buffer),Ei=new Uint16Array(1);function Ti(e){xi[0]=e;const t=wi[0],n=t>>31&1;let s=t>>23&255,r=8388607&t;if(255===s)return Ei[0]=n<<15|31744|(0!==r?512:0),Ei[0];if(0===s){if(0===r)return Ei[0]=n<<15,Ei[0];r|=8388608;let e=113;for(;!(8388608&r);)r<<=1,e--;return s=127-e,r&=8388607,s>0?(r=(r>>126-s)+(r>>127-s&1),Ei[0]=n<<15|s<<10|r>>13,Ei[0]):(Ei[0]=n<<15,Ei[0])}return s=s-127+15,s>=31?(Ei[0]=n<<15|31744,Ei[0]):s<=0?s<-10?(Ei[0]=n<<15,Ei[0]):(r=(8388608|r)>>1-s,Ei[0]=n<<15|r>>13,Ei[0]):(r>>=13,Ei[0]=n<<15|s<<10|r,Ei[0])}const Si=new Uint32Array(1),Ai=new Float32Array(Si.buffer,0,1);function Ri(e){const t=112+(e>>6&31)<<23|(63&e)<<17;return Si[0]=t,Ai[0]}function Ci(e,t,n,s){const r=[0,0,0,0];for(let i=0;i<s;++i)switch(n){case"8unorm":r[i]=e[t]/255,t++;break;case"8snorm":r[i]=e[t]/255*2-1,t++;break;case"8uint":r[i]=e[t],t++;break;case"8sint":r[i]=e[t]-127,t++;break;case"16uint":r[i]=e[t]|e[t+1]<<8,t+=2;break;case"16sint":r[i]=(e[t]|e[t+1]<<8)-32768,t+=2;break;case"16float":r[i]=vi(e[t]|e[t+1]<<8),t+=2;break;case"32uint":case"32sint":r[i]=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,t+=4;break;case"32float":r[i]=new Float32Array(e.buffer,t,1)[0],t+=4}return r}function Pi(e,t,n,s,r){for(let i=0;i<s;++i)switch(n){case"8unorm":e[t]=255*r[i],t++;break;case"8snorm":e[t]=.5*(r[i]+1)*255,t++;break;case"8uint":e[t]=r[i],t++;break;case"8sint":e[t]=r[i]+127,t++;break;case"16uint":new Uint16Array(e.buffer,t,1)[0]=r[i],t+=2;break;case"16sint":new Int16Array(e.buffer,t,1)[0]=r[i],t+=2;break;case"16float":{const n=Ti(r[i]);new Uint16Array(e.buffer,t,1)[0]=n,t+=2;break}case"32uint":new Uint32Array(e.buffer,t,1)[0]=r[i],t+=4;break;case"32sint":new Int32Array(e.buffer,t,1)[0]=r[i],t+=4;break;case"32float":new Float32Array(e.buffer,t,1)[0]=r[i],t+=4}return r}const ki={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Ii{constructor(){this.id=Ii._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(Mi.instance);for(const n of e)n instanceof Array?this.searchBlock(n,t):n.search(t);t(Li.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}Ii._id=0;class Mi extends Ii{}Mi.instance=new Mi;class Li extends Ii{}Li.instance=new Li;const Ni=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class Oi extends Ii{constructor(){super()}}class Fi extends Oi{constructor(e,t,n,s,r,i){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=n,this.body=s,this.startLine=r,this.endLine=i}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class Di extends Oi{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class Bi extends Oi{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Ui extends Oi{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class ji extends Oi{constructor(e,t,n,s){super(),this.init=e,this.condition=t,this.increment=n,this.body=s}get astNodeType(){return"for"}search(e){var t,n,s;null===(t=this.init)||void 0===t||t.search(e),null===(n=this.condition)||void 0===n||n.search(e),null===(s=this.increment)||void 0===s||s.search(e),this.searchBlock(this.body,e)}}class Gi extends Oi{constructor(e,t,n,s,r){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=s,this.value=r}get astNodeType(){return"var"}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}class Vi extends Oi{constructor(e,t,n){super(),this.attributes=null,this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}search(e){var t;null===(t=this.value)||void 0===t||t.search(e)}}class zi extends Oi{constructor(e,t,n,s,r){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=s,this.value=r}get astNodeType(){return"let"}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}class Wi extends Oi{constructor(e,t,n,s,r){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=s,this.value=r}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}var Hi,$i,Xi,qi;(e=>{e.increment="++",e.decrement="--"})(Hi||(Hi={})),(e=>{e.parse=function(t){const n=t;if("parse"==n)throw new Error("Invalid value for IncrementOperator");return e[n]}})(Hi||(Hi={}));class Yi extends Oi{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(e=>{e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="})($i||($i={})),($i||($i={})).parse=function(e){const t=e;if("parse"==t)throw new Error("Invalid value for AssignOperator");return t};class Ki extends Oi{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class Zi extends Oi{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return Ni.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class Qi extends Oi{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),null===(t=this.continuing)||void 0===t||t.search(e)}}class Ji extends Oi{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class eo extends Oi{constructor(e,t,n,s){super(),this.condition=e,this.body=t,this.elseif=n,this.else=s}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class to extends Oi{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;null===(t=this.value)||void 0===t||t.search(e)}}class no extends Oi{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class so extends Oi{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class ro extends Oi{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class io extends Oi{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class oo extends Oi{constructor(){super()}get astNodeType(){return"discard"}}class ao extends Oi{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class lo extends Oi{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class co extends Oi{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if("f32"===t.name)return t;for(let n=1;n<e.length;++n){const s=co._priority.get(t.name);co._priority.get(e[n].name)<s&&(t=e[n])}return"x32"===t.name?co.i32:t}getTypeName(){return this.name}}co.x32=new co("x32"),co.f32=new co("f32"),co.i32=new co("i32"),co.u32=new co("u32"),co.f16=new co("f16"),co.bool=new co("bool"),co.void=new co("void"),co._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class uo extends co{constructor(e){super(e)}}class ho extends co{constructor(e,t,n,s){super(e),this.members=t,this.startLine=n,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class fo extends co{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+="f",e;if("i32"===this.format.name)return e+="i",e;if("u32"===this.format.name)return e+="u",e;if("bool"===this.format.name)return e+="b",e;if("f16"===this.format.name)return e+="h",e}e+=`<${this.format.name}>`}else if("vec2"===e||"vec3"===e||"vec4"===e)return e;return e}}fo.vec2f=new fo("vec2",co.f32,null),fo.vec3f=new fo("vec3",co.f32,null),fo.vec4f=new fo("vec4",co.f32,null),fo.vec2i=new fo("vec2",co.i32,null),fo.vec3i=new fo("vec3",co.i32,null),fo.vec4i=new fo("vec4",co.i32,null),fo.vec2u=new fo("vec2",co.u32,null),fo.vec3u=new fo("vec3",co.u32,null),fo.vec4u=new fo("vec4",co.u32,null),fo.vec2h=new fo("vec2",co.f16,null),fo.vec3h=new fo("vec3",co.f16,null),fo.vec4h=new fo("vec4",co.f16,null),fo.vec2b=new fo("vec2",co.bool,null),fo.vec3b=new fo("vec3",co.bool,null),fo.vec4b=new fo("vec4",co.bool,null),fo.mat2x2f=new fo("mat2x2",co.f32,null),fo.mat2x3f=new fo("mat2x3",co.f32,null),fo.mat2x4f=new fo("mat2x4",co.f32,null),fo.mat3x2f=new fo("mat3x2",co.f32,null),fo.mat3x3f=new fo("mat3x3",co.f32,null),fo.mat3x4f=new fo("mat3x4",co.f32,null),fo.mat4x2f=new fo("mat4x2",co.f32,null),fo.mat4x3f=new fo("mat4x3",co.f32,null),fo.mat4x4f=new fo("mat4x4",co.f32,null),fo.mat2x2h=new fo("mat2x2",co.f16,null),fo.mat2x3h=new fo("mat2x3",co.f16,null),fo.mat2x4h=new fo("mat2x4",co.f16,null),fo.mat3x2h=new fo("mat3x2",co.f16,null),fo.mat3x3h=new fo("mat3x3",co.f16,null),fo.mat3x4h=new fo("mat3x4",co.f16,null),fo.mat4x2h=new fo("mat4x2",co.f16,null),fo.mat4x3h=new fo("mat4x3",co.f16,null),fo.mat4x4h=new fo("mat4x4",co.f16,null),fo.mat2x2i=new fo("mat2x2",co.i32,null),fo.mat2x3i=new fo("mat2x3",co.i32,null),fo.mat2x4i=new fo("mat2x4",co.i32,null),fo.mat3x2i=new fo("mat3x2",co.i32,null),fo.mat3x3i=new fo("mat3x3",co.i32,null),fo.mat3x4i=new fo("mat3x4",co.i32,null),fo.mat4x2i=new fo("mat4x2",co.i32,null),fo.mat4x3i=new fo("mat4x3",co.i32,null),fo.mat4x4i=new fo("mat4x4",co.i32,null),fo.mat2x2u=new fo("mat2x2",co.u32,null),fo.mat2x3u=new fo("mat2x3",co.u32,null),fo.mat2x4u=new fo("mat2x4",co.u32,null),fo.mat3x2u=new fo("mat3x2",co.u32,null),fo.mat3x3u=new fo("mat3x3",co.u32,null),fo.mat3x4u=new fo("mat3x4",co.u32,null),fo.mat4x2u=new fo("mat4x2",co.u32,null),fo.mat4x3u=new fo("mat4x3",co.u32,null),fo.mat4x4u=new fo("mat4x4",co.u32,null);class po extends co{constructor(e,t,n,s){super(e),this.storage=t,this.type=n,this.access=s}get astNodeType(){return"pointer"}}class go extends co{constructor(e,t,n,s){super(e),this.attributes=t,this.format=n,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class mo extends co{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}}class _o extends Ii{constructor(){super(),this.postfix=null}}class yo extends _o{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class bo extends _o{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class vo extends _o{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return Ni.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class xo extends _o{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class wo extends _o{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const t=e.evalExpression(this.initializer,e.context);return null!==t&&this.postfix?t.getSubData(e,this.postfix,e.context):t}return null}search(e){this.initializer.search(e)}}class Eo extends _o{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return void 0!==t&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof jo}get isVector(){return this.value instanceof Vo||this.value instanceof zo}get scalarValue(){return this.value instanceof jo?this.value.value:0}get vectorValue(){return this.value instanceof Vo||this.value instanceof zo?this.value.data:new Float32Array(0)}}class To extends _o{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class So extends _o{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class Ao extends _o{constructor(){super()}}class Ro extends Ao{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Co extends Ao{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:"f32"===e.name||"f32"===t.name?co.f32:"u32"===e.name||"u32"===t.name?co.u32:co.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class Po extends Ii{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class ko extends _o{constructor(){super()}get astNodeType(){return"default"}}class Io extends Po{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class Mo extends Po{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class Lo extends Ii{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}}class No extends Ii{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Oo extends Ii{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}}class Fo extends Ii{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class Do{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=Do._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,n,s){}getSubData(e,t,n){return null}toString(){return`<${this.typeInfo.getTypeName()}>`}}Do._id=0;class Bo extends Do{constructor(){super(new ri("void",null),null)}toString(){return"void"}}Bo.void=new Bo;class Uo extends Do{constructor(e){super(new li("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,n,s){this.reference.setDataValue(e,t,n,s)}getSubData(e,t,n){return t?this.reference.getSubData(e,t,n):this}toString(){return`&${this.reference.toString()}`}}class jo extends Do{constructor(e,t,n=null){super(t,n),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:"x32"===this.typeInfo.name?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):"i32"===this.typeInfo.name||"bool"===this.typeInfo.name?this.data=new Int32Array([e]):"u32"===this.typeInfo.name?this.data=new Uint32Array([e]):("f32"===this.typeInfo.name||"f16"===this.typeInfo.name)&&(this.data=new Float32Array([e]))}clone(){if(this.data instanceof Float32Array)return new jo(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new jo(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new jo(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,n,s){if(n)return;if(!(t instanceof jo))return;let r=t.data[0];"i32"===this.typeInfo.name||"u32"===this.typeInfo.name?r=Math.floor(r):"bool"===this.typeInfo.name&&(r=r?1:0),this.data[0]=r}getSubData(e,t,n){return t?null:this}toString(){return`${this.value}`}}function Go(e,t,n){const s=t.length;return 2===s?"f32"===n?new Vo(new Float32Array(t),e.getTypeInfo("vec2f")):"i32"===n||"bool"===n?new Vo(new Int32Array(t),e.getTypeInfo("vec2i")):"u32"===n?new Vo(new Uint32Array(t),e.getTypeInfo("vec2u")):"f16"===n?new Vo(new Float32Array(t),e.getTypeInfo("vec2h")):null:3===s?"f32"===n?new Vo(new Float32Array(t),e.getTypeInfo("vec3f")):"i32"===n||"bool"===n?new Vo(new Int32Array(t),e.getTypeInfo("vec3i")):"u32"===n?new Vo(new Uint32Array(t),e.getTypeInfo("vec3u")):"f16"===n?new Vo(new Float32Array(t),e.getTypeInfo("vec3h")):null:4===s?"f32"===n?new Vo(new Float32Array(t),e.getTypeInfo("vec4f")):"i32"===n||"bool"===n?new Vo(new Int32Array(t),e.getTypeInfo("vec4i")):"u32"===n?new Vo(new Uint32Array(t),e.getTypeInfo("vec4u")):"f16"===n?new Vo(new Float32Array(t),e.getTypeInfo("vec4h")):null:null}class Vo extends Do{constructor(e,t,n=null){if(super(t,n),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?this.data=new Float32Array(e):"vec2i"===t||"vec3i"===t||"vec4i"===t?this.data=new Int32Array(e):"vec2u"===t||"vec3u"===t||"vec4u"===t?this.data=new Uint32Array(e):"vec2h"===t||"vec3h"===t||"vec4h"===t?this.data=new Float32Array(e):"vec2b"===t||"vec3b"===t||"vec4b"===t?this.data=new Int32Array(e):("vec2"===t||"vec3"===t||"vec4"===t)&&(this.data=new Float32Array(e))}}clone(){if(this.data instanceof Float32Array)return new Vo(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Vo(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Vo(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,n,s){n instanceof yo||t instanceof Vo&&(this.data=t.data)}getSubData(e,t,n){if(null===t)return this;let s=e.getTypeInfo("f32");if(this.typeInfo instanceof ci)s=this.typeInfo.format||s;else{const t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?s=e.getTypeInfo("f32"):"vec2i"===t||"vec3i"===t||"vec4i"===t?s=e.getTypeInfo("i32"):"vec2b"===t||"vec3b"===t||"vec4b"===t?s=e.getTypeInfo("bool"):"vec2u"===t||"vec3u"===t||"vec4u"===t?s=e.getTypeInfo("u32"):("vec2h"===t||"vec3h"===t||"vec4h"===t)&&(s=e.getTypeInfo("f16"))}let r=this;for(;null!==t&&null!==r;){if(t instanceof So){const i=t.index;let o=-1;if(i instanceof Eo){if(!(i.value instanceof jo))return null;o=i.value.value}else{const t=e.evalExpression(i,n);if(!(t instanceof jo))return null;o=t.value}if(o<0||o>=r.data.length)return null;if(r.data instanceof Float32Array){const e=new Float32Array(r.data.buffer,r.data.byteOffset+4*o,1);return new jo(e,s)}if(r.data instanceof Int32Array){const e=new Int32Array(r.data.buffer,r.data.byteOffset+4*o,1);return new jo(e,s)}if(r.data instanceof Uint32Array){const e=new Uint32Array(r.data.buffer,r.data.byteOffset+4*o,1);return new jo(e,s)}throw"GetSubData: Invalid data type"}if(!(t instanceof yo))return null;{const n=t.value.toLowerCase();if(1===n.length){let e=0;if("x"===n||"r"===n)e=0;else if("y"===n||"g"===n)e=1;else if("z"===n||"b"===n)e=2;else{if("w"!==n&&"a"!==n)return null;e=3}if(this.data instanceof Float32Array){let t=new Float32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new jo(t,s,this)}if(this.data instanceof Int32Array){let t=new Int32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new jo(t,s,this)}if(this.data instanceof Uint32Array){let t=new Uint32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new jo(t,s,this)}}const i=[];for(const e of n)"x"===e||"r"===e?i.push(this.data[0]):"y"===e||"g"===e?i.push(this.data[1]):"z"===e||"b"===e?i.push(this.data[2]):("w"===e||"a"===e)&&i.push(this.data[3]);r=Go(e,i,s.name)}t=t.postfix}return r}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class zo extends Do{constructor(e,t,n=null){super(t,n),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new zo(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,n,s){n instanceof yo||t instanceof zo&&(this.data=t.data)}getSubData(e,t,n){if(null===t)return this;const s=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof ci)this.typeInfo.format;else if(s.endsWith("f"))e.getTypeInfo("f32");else if(s.endsWith("i"))e.getTypeInfo("i32");else if(s.endsWith("u"))e.getTypeInfo("u32");else{if(!s.endsWith("h"))return null;e.getTypeInfo("f16")}if(t instanceof So){const r=t.index;let i=-1;if(r instanceof Eo){if(!(r.value instanceof jo))return null;i=r.value.value}else{const t=e.evalExpression(r,n);if(!(t instanceof jo))return null;i=t.value}if(i<0||i>=this.data.length)return null;const o=s.endsWith("h")?"h":"f";let a;if("mat2x2"===s||"mat2x2f"===s||"mat2x2h"===s||"mat3x2"===s||"mat3x2f"===s||"mat3x2h"===s||"mat4x2"===s||"mat4x2f"===s||"mat4x2h"===s)a=new Vo(new Float32Array(this.data.buffer,this.data.byteOffset+2*i*4,2),e.getTypeInfo(`vec2${o}`));else if("mat2x3"===s||"mat2x3f"===s||"mat2x3h"===s||"mat3x3"===s||"mat3x3f"===s||"mat3x3h"===s||"mat4x3"===s||"mat4x3f"===s||"mat4x3h"===s)a=new Vo(new Float32Array(this.data.buffer,this.data.byteOffset+3*i*4,3),e.getTypeInfo(`vec3${o}`));else{if("mat2x4"!==s&&"mat2x4f"!==s&&"mat2x4h"!==s&&"mat3x4"!==s&&"mat3x4f"!==s&&"mat3x4h"!==s&&"mat4x4"!==s&&"mat4x4f"!==s&&"mat4x4h"!==s)return null;a=new Vo(new Float32Array(this.data.buffer,this.data.byteOffset+4*i*4,4),e.getTypeInfo(`vec4${o}`))}return t.postfix?a.getSubData(e,t.postfix,n):a}return null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Wo extends Do{constructor(e,t,n=0,s=null){super(t,s),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Wo(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,n,s){if(null===t)return;let r=this.offset,i=this.typeInfo;for(;n;){if(n instanceof So){if(i instanceof ai){const t=n.index;if(t instanceof Eo){if(!(t.value instanceof jo))return;r+=t.value.value*i.stride}else{const n=e.evalExpression(t,s);if(!(n instanceof jo))return;r+=n.value*i.stride}i=i.format}}else{if(!(n instanceof yo))return;{const e=n.value;if(i instanceof oi){let t=!1;for(const n of i.members)if(n.name===e){r+=n.offset,i=n.type,t=!0;break}if(!t)return}else if(i instanceof ri){const n=i.getTypeName();let s=0;if("x"===e||"r"===e)s=0;else if("y"===e||"g"===e)s=1;else if("z"===e||"b"===e)s=2;else{if("w"!==e&&"a"!==e)return;s=3}if(!(t instanceof jo))return;const o=t.value;return"vec2f"===n?void(new Float32Array(this.buffer,r,2)[s]=o):"vec3f"===n?void(new Float32Array(this.buffer,r,3)[s]=o):"vec4f"===n?void(new Float32Array(this.buffer,r,4)[s]=o):"vec2i"===n?void(new Int32Array(this.buffer,r,2)[s]=o):"vec3i"===n?void(new Int32Array(this.buffer,r,3)[s]=o):"vec4i"===n?void(new Int32Array(this.buffer,r,4)[s]=o):"vec2u"===n?void(new Uint32Array(this.buffer,r,2)[s]=o):"vec3u"===n?void(new Uint32Array(this.buffer,r,3)[s]=o):"vec4u"===n?void(new Uint32Array(this.buffer,r,4)[s]=o):void 0}}}n=n.postfix}this.setData(e,t,i,r,s)}setData(e,t,n,s,r){const i=n.getTypeName();if("f32"!==i&&"f16"!==i)if("i32"!==i&&"atomic<i32>"!==i&&"x32"!==i)if("u32"!==i&&"atomic<u32>"!==i)if("bool"!==i){if("vec2f"===i||"vec2h"===i){const e=new Float32Array(this.buffer,s,2);return void(t instanceof Vo?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3f"===i||"vec3h"===i){const e=new Float32Array(this.buffer,s,3);return void(t instanceof Vo?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4f"===i||"vec4h"===i){const e=new Float32Array(this.buffer,s,4);return void(t instanceof Vo?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2i"===i){const e=new Int32Array(this.buffer,s,2);return void(t instanceof Vo?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3i"===i){const e=new Int32Array(this.buffer,s,3);return void(t instanceof Vo?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4i"===i){const e=new Int32Array(this.buffer,s,4);return void(t instanceof Vo?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2u"===i){const e=new Uint32Array(this.buffer,s,2);return void(t instanceof Vo?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3u"===i){const e=new Uint32Array(this.buffer,s,3);return void(t instanceof Vo?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4u"===i){const e=new Uint32Array(this.buffer,s,4);return void(t instanceof Vo?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2b"===i){const e=new Uint32Array(this.buffer,s,2);return void(t instanceof Vo?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3b"===i){const e=new Uint32Array(this.buffer,s,3);return void(t instanceof Vo?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4b"===i){const e=new Uint32Array(this.buffer,s,4);return void(t instanceof Vo?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("mat2x2f"===i||"mat2x2h"===i){const e=new Float32Array(this.buffer,s,4);return void(t instanceof zo?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("mat2x3f"===i||"mat2x3h"===i){const e=new Float32Array(this.buffer,s,6);return void(t instanceof zo?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]))}if("mat2x4f"===i||"mat2x4h"===i){const e=new Float32Array(this.buffer,s,8);return void(t instanceof zo?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]))}if("mat3x2f"===i||"mat3x2h"===i){const e=new Float32Array(this.buffer,s,6);return void(t instanceof zo?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]))}if("mat3x3f"===i||"mat3x3h"===i){const e=new Float32Array(this.buffer,s,9);return void(t instanceof zo?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]))}if("mat3x4f"===i||"mat3x4h"===i){const e=new Float32Array(this.buffer,s,12);return void(t instanceof zo?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]))}if("mat4x2f"===i||"mat4x2h"===i){const e=new Float32Array(this.buffer,s,8);return void(t instanceof zo?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]))}if("mat4x3f"===i||"mat4x3h"===i){const e=new Float32Array(this.buffer,s,12);return void(t instanceof zo?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]))}if("mat4x4f"===i||"mat4x4h"===i){const e=new Float32Array(this.buffer,s,16);return void(t instanceof zo?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11],e[12]=t.data[12],e[13]=t.data[13],e[14]=t.data[14],e[15]=t.data[15]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}if(t instanceof Wo&&n===t.typeInfo)return void new Uint8Array(this.buffer,s,t.buffer.byteLength).set(new Uint8Array(t.buffer))}else t instanceof jo&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof jo&&(new Uint32Array(this.buffer,s,1)[0]=t.value);else t instanceof jo&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof jo&&(new Float32Array(this.buffer,s,1)[0]=t.value)}getSubData(e,t,n){var s,r;if(null===t)return this;let i=this.offset,o=this.typeInfo;for(;t;){if(t instanceof So){const s=t.index,r=s instanceof _o?e.evalExpression(s,n):s;let a=0;if(r instanceof jo?a=r.value:"number"==typeof r&&(a=r),o instanceof ai)i+=a*o.stride,o=o.format;else{const t=o.getTypeName();("mat4x4"===t||"mat4x4f"===t||"mat4x4h"===t)&&(i+=16*a,o=e.getTypeInfo("vec4f"))}}else{if(!(t instanceof yo))return null;{const n=t.value;if(o instanceof oi){let e=!1;for(const t of o.members)if(t.name===n){i+=t.offset,o=t.type,e=!0;break}if(!e)return null}else if(o instanceof ri){const t=o.getTypeName();if("vec2f"===t||"vec3f"===t||"vec4f"===t||"vec2i"===t||"vec3i"===t||"vec4i"===t||"vec2u"===t||"vec3u"===t||"vec4u"===t||"vec2b"===t||"vec3b"===t||"vec4b"===t||"vec2h"===t||"vec3h"===t||"vec4h"===t||"vec2"===t||"vec3"===t||"vec4"===t){if(n.length>0&&n.length<5){let s="f";const r=[];for(let o=0;o<n.length;++o){const a=n[o].toLowerCase();let l=0;if("x"===a||"r"===a)l=0;else if("y"===a||"g"===a)l=1;else if("z"===a||"b"===a)l=2;else{if("w"!==a&&"a"!==a)return null;l=3}if(1===n.length){if(t.endsWith("f"))return this.buffer.byteLength<i+4*l+4?null:new jo(new Float32Array(this.buffer,i+4*l,1),e.getTypeInfo("f32"),this);if(t.endsWith("h"))return new jo(new Float32Array(this.buffer,i+4*l,1),e.getTypeInfo("f16"),this);if(t.endsWith("i"))return new jo(new Int32Array(this.buffer,i+4*l,1),e.getTypeInfo("i32"),this);if(t.endsWith("b"))return new jo(new Int32Array(this.buffer,i+4*l,1),e.getTypeInfo("bool"),this);if(t.endsWith("u"))return new jo(new Uint32Array(this.buffer,i+4*l,1),e.getTypeInfo("i32"),this)}if("vec2f"===t)r.push(new Float32Array(this.buffer,i,2)[l]);else if("vec3f"===t){if(i+12>=this.buffer.byteLength)return null;const e=new Float32Array(this.buffer,i,3);r.push(e[l])}else if("vec4f"===t)r.push(new Float32Array(this.buffer,i,4)[l]);else if("vec2i"===t)s="i",r.push(new Int32Array(this.buffer,i,2)[l]);else if("vec3i"===t)s="i",r.push(new Int32Array(this.buffer,i,3)[l]);else if("vec4i"===t)s="i",r.push(new Int32Array(this.buffer,i,4)[l]);else if("vec2u"===t){s="u";const e=new Uint32Array(this.buffer,i,2);r.push(e[l])}else"vec3u"===t?(s="u",r.push(new Uint32Array(this.buffer,i,3)[l])):"vec4u"===t&&(s="u",r.push(new Uint32Array(this.buffer,i,4)[l]))}return 2===r.length?o=e.getTypeInfo(`vec2${s}`):3===r.length?o=e.getTypeInfo(`vec3${s}`):4===r.length&&(o=e.getTypeInfo(`vec4${s}`)),new Vo(r,o,null)}return null}return null}}}t=t.postfix}const a=o.getTypeName();return"f32"===a?new jo(new Float32Array(this.buffer,i,1),o,this):"i32"===a?new jo(new Int32Array(this.buffer,i,1),o,this):"u32"===a?new jo(new Uint32Array(this.buffer,i,1),o,this):"vec2f"===a?new Vo(new Float32Array(this.buffer,i,2),o,this):"vec3f"===a?new Vo(new Float32Array(this.buffer,i,3),o,this):"vec4f"===a?new Vo(new Float32Array(this.buffer,i,4),o,this):"vec2i"===a?new Vo(new Int32Array(this.buffer,i,2),o,this):"vec3i"===a?new Vo(new Int32Array(this.buffer,i,3),o,this):"vec4i"===a?new Vo(new Int32Array(this.buffer,i,4),o,this):"vec2u"===a?new Vo(new Uint32Array(this.buffer,i,2),o,this):"vec3u"===a?new Vo(new Uint32Array(this.buffer,i,3),o,this):"vec4u"===a?new Vo(new Uint32Array(this.buffer,i,4),o,this):o instanceof ci&&"atomic"===o.name?"u32"===(null===(s=o.format)||void 0===s?void 0:s.name)?new jo(new Uint32Array(this.buffer,i,1)[0],o.format,this):"i32"===(null===(r=o.format)||void 0===r?void 0:r.name)?new jo(new Int32Array(this.buffer,i,1)[0],o.format,this):null:new Wo(this.buffer,o,i,this)}toString(){let e="";if(this.typeInfo instanceof ai)if("f32"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("i32"===this.typeInfo.format.name){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("u32"===this.typeInfo.format.name){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("vec2f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let n=1;n<t.length/2;++n)e+=`, [${t[2*n]}, ${t[2*n+1]}]`}else if("vec3f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}]`}else if("vec4f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}, ${t[n+3]}]`}else e="[...]";else this.typeInfo instanceof oi?e+="{...}":e="[...]";return e}}class Ho extends Do{constructor(e,t,n,s){super(t,null),this.data=e,this.descriptor=n,this.view=s}clone(){return new Ho(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>0?null!==(e=n[0])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.width)&&void 0!==t?t:0}get height(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>1?null!==(e=n[1])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.height)&&void 0!==t?t:0}get depthOrArrayLayers(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>2?null!==(e=n[2])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.depthOrArrayLayers)&&void 0!==t?t:0}get format(){var e;return this.descriptor&&null!==(e=this.descriptor.format)&&void 0!==e?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&null!==(e=this.descriptor.sampleCount)&&void 0!==e?e:1}get mipLevelCount(){var e;return this.descriptor&&null!==(e=this.descriptor.mipLevelCount)&&void 0!==e?e:1}get dimension(){var e;return this.descriptor&&null!==(e=this.descriptor.dimension)&&void 0!==e?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<t.length;++n)t[n]=Math.max(1,t[n]>>e);return t}get texelByteSize(){const e=this.format,t=ki[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=ki[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=ki[e],n=this.width;if(!e||n<=0||!t)return-1;const s=this.height,r=this.depthOrArrayLayers,i=this.dimension;return n/t.blockWidth*("1d"===i?1:s/t.blockHeight)*t.bytesPerBlock*r}getPixel(e,t,n=0,s=0){const r=this.texelByteSize,i=this.bytesPerRow,o=this.height,a=this.data[s];return function(e,t,n,s,r,i,o,a,l){const c=s*(o>>=r)*(i>>=r)+n*o+t*a;switch(l){case"r8unorm":return[Ci(e,c,"8unorm",1)[0]];case"r8snorm":return[Ci(e,c,"8snorm",1)[0]];case"r8uint":return[Ci(e,c,"8uint",1)[0]];case"r8sint":return[Ci(e,c,"8sint",1)[0]];case"rg8unorm":{const t=Ci(e,c,"8unorm",2);return[t[0],t[1]]}case"rg8snorm":{const t=Ci(e,c,"8snorm",2);return[t[0],t[1]]}case"rg8uint":{const t=Ci(e,c,"8uint",2);return[t[0],t[1]]}case"rg8sint":{const t=Ci(e,c,"8sint",2);return[t[0],t[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const t=Ci(e,c,"8unorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8snorm":{const t=Ci(e,c,"8snorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8uint":{const t=Ci(e,c,"8uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba8sint":{const t=Ci(e,c,"8sint",4);return[t[0],t[1],t[2],t[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const t=Ci(e,c,"8unorm",4);return[t[2],t[1],t[0],t[3]]}case"r16uint":return[Ci(e,c,"16uint",1)[0]];case"r16sint":return[Ci(e,c,"16sint",1)[0]];case"r16float":return[Ci(e,c,"16float",1)[0]];case"rg16uint":{const t=Ci(e,c,"16uint",2);return[t[0],t[1]]}case"rg16sint":{const t=Ci(e,c,"16sint",2);return[t[0],t[1]]}case"rg16float":{const t=Ci(e,c,"16float",2);return[t[0],t[1]]}case"rgba16uint":{const t=Ci(e,c,"16uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16sint":{const t=Ci(e,c,"16sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16float":{const t=Ci(e,c,"16float",4);return[t[0],t[1],t[2],t[3]]}case"r32uint":return[Ci(e,c,"32uint",1)[0]];case"r32sint":return[Ci(e,c,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Ci(e,c,"32float",1)[0]];case"rg32uint":{const t=Ci(e,c,"32uint",2);return[t[0],t[1]]}case"rg32sint":{const t=Ci(e,c,"32sint",2);return[t[0],t[1]]}case"rg32float":{const t=Ci(e,c,"32float",2);return[t[0],t[1]]}case"rgba32uint":{const t=Ci(e,c,"32uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32sint":{const t=Ci(e,c,"32sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32float":{const t=Ci(e,c,"32float",4);return[t[0],t[1],t[2],t[3]]}case"rg11b10ufloat":{const t=new Uint32Array(e.buffer,c,1)[0],n=(4192256&t)>>11,s=(4290772992&t)>>22;return[Ri(2047&t),Ri(n),function(e){const t=112+(e>>5&31)<<23|(31&e)<<18;return Si[0]=t,Ai[0]}(s),1]}}return null}(new Uint8Array(a),e,t,n,s,o,i,r,this.format)}setPixel(e,t,n,s,r){const i=this.texelByteSize,o=this.bytesPerRow,a=this.height,l=this.data[s];!function(e,t,n,s,r,i,o,a,l,c){const u=s*(o>>=r)*(i>>=r)+n*o+t*a;switch(l){case"r8unorm":return void Pi(e,u,"8unorm",1,c);case"r8snorm":return void Pi(e,u,"8snorm",1,c);case"r8uint":return void Pi(e,u,"8uint",1,c);case"r8sint":return void Pi(e,u,"8sint",1,c);case"rg8unorm":return void Pi(e,u,"8unorm",2,c);case"rg8snorm":return void Pi(e,u,"8snorm",2,c);case"rg8uint":return void Pi(e,u,"8uint",2,c);case"rg8sint":return void Pi(e,u,"8sint",2,c);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void Pi(e,u,"8unorm",4,c);case"rgba8snorm":return void Pi(e,u,"8snorm",4,c);case"rgba8uint":return void Pi(e,u,"8uint",4,c);case"rgba8sint":return void Pi(e,u,"8sint",4,c);case"r16uint":return void Pi(e,u,"16uint",1,c);case"r16sint":return void Pi(e,u,"16sint",1,c);case"r16float":return void Pi(e,u,"16float",1,c);case"rg16uint":return void Pi(e,u,"16uint",2,c);case"rg16sint":return void Pi(e,u,"16sint",2,c);case"rg16float":return void Pi(e,u,"16float",2,c);case"rgba16uint":return void Pi(e,u,"16uint",4,c);case"rgba16sint":return void Pi(e,u,"16sint",4,c);case"rgba16float":return void Pi(e,u,"16float",4,c);case"r32uint":return void Pi(e,u,"32uint",1,c);case"r32sint":return void Pi(e,u,"32sint",1,c);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void Pi(e,u,"32float",1,c);case"rg32uint":return void Pi(e,u,"32uint",2,c);case"rg32sint":return void Pi(e,u,"32sint",2,c);case"rg32float":return void Pi(e,u,"32float",2,c);case"rgba32uint":return void Pi(e,u,"32uint",4,c);case"rgba32sint":return void Pi(e,u,"32sint",4,c);case"rgba32float":Pi(e,u,"32float",4,c)}}(new Uint8Array(l),e,t,n,s,a,o,i,this.format,r)}}(e=>{e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"})(qi||(qi={}));class $o{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}}class Xo{}Xi=Xo,Xo.none=new $o("",qi.reserved,""),Xo.eof=new $o("EOF",qi.token,""),Xo.reserved={asm:new $o("asm",qi.reserved,"asm"),bf16:new $o("bf16",qi.reserved,"bf16"),do:new $o("do",qi.reserved,"do"),enum:new $o("enum",qi.reserved,"enum"),f16:new $o("f16",qi.reserved,"f16"),f64:new $o("f64",qi.reserved,"f64"),handle:new $o("handle",qi.reserved,"handle"),i8:new $o("i8",qi.reserved,"i8"),i16:new $o("i16",qi.reserved,"i16"),i64:new $o("i64",qi.reserved,"i64"),mat:new $o("mat",qi.reserved,"mat"),premerge:new $o("premerge",qi.reserved,"premerge"),regardless:new $o("regardless",qi.reserved,"regardless"),typedef:new $o("typedef",qi.reserved,"typedef"),u8:new $o("u8",qi.reserved,"u8"),u16:new $o("u16",qi.reserved,"u16"),u64:new $o("u64",qi.reserved,"u64"),unless:new $o("unless",qi.reserved,"unless"),using:new $o("using",qi.reserved,"using"),vec:new $o("vec",qi.reserved,"vec"),void:new $o("void",qi.reserved,"void")},Xo.keywords={array:new $o("array",qi.keyword,"array"),atomic:new $o("atomic",qi.keyword,"atomic"),bool:new $o("bool",qi.keyword,"bool"),f32:new $o("f32",qi.keyword,"f32"),i32:new $o("i32",qi.keyword,"i32"),mat2x2:new $o("mat2x2",qi.keyword,"mat2x2"),mat2x3:new $o("mat2x3",qi.keyword,"mat2x3"),mat2x4:new $o("mat2x4",qi.keyword,"mat2x4"),mat3x2:new $o("mat3x2",qi.keyword,"mat3x2"),mat3x3:new $o("mat3x3",qi.keyword,"mat3x3"),mat3x4:new $o("mat3x4",qi.keyword,"mat3x4"),mat4x2:new $o("mat4x2",qi.keyword,"mat4x2"),mat4x3:new $o("mat4x3",qi.keyword,"mat4x3"),mat4x4:new $o("mat4x4",qi.keyword,"mat4x4"),ptr:new $o("ptr",qi.keyword,"ptr"),sampler:new $o("sampler",qi.keyword,"sampler"),sampler_comparison:new $o("sampler_comparison",qi.keyword,"sampler_comparison"),struct:new $o("struct",qi.keyword,"struct"),texture_1d:new $o("texture_1d",qi.keyword,"texture_1d"),texture_2d:new $o("texture_2d",qi.keyword,"texture_2d"),texture_2d_array:new $o("texture_2d_array",qi.keyword,"texture_2d_array"),texture_3d:new $o("texture_3d",qi.keyword,"texture_3d"),texture_cube:new $o("texture_cube",qi.keyword,"texture_cube"),texture_cube_array:new $o("texture_cube_array",qi.keyword,"texture_cube_array"),texture_multisampled_2d:new $o("texture_multisampled_2d",qi.keyword,"texture_multisampled_2d"),texture_storage_1d:new $o("texture_storage_1d",qi.keyword,"texture_storage_1d"),texture_storage_2d:new $o("texture_storage_2d",qi.keyword,"texture_storage_2d"),texture_storage_2d_array:new $o("texture_storage_2d_array",qi.keyword,"texture_storage_2d_array"),texture_storage_3d:new $o("texture_storage_3d",qi.keyword,"texture_storage_3d"),texture_depth_2d:new $o("texture_depth_2d",qi.keyword,"texture_depth_2d"),texture_depth_2d_array:new $o("texture_depth_2d_array",qi.keyword,"texture_depth_2d_array"),texture_depth_cube:new $o("texture_depth_cube",qi.keyword,"texture_depth_cube"),texture_depth_cube_array:new $o("texture_depth_cube_array",qi.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new $o("texture_depth_multisampled_2d",qi.keyword,"texture_depth_multisampled_2d"),texture_external:new $o("texture_external",qi.keyword,"texture_external"),u32:new $o("u32",qi.keyword,"u32"),vec2:new $o("vec2",qi.keyword,"vec2"),vec3:new $o("vec3",qi.keyword,"vec3"),vec4:new $o("vec4",qi.keyword,"vec4"),bitcast:new $o("bitcast",qi.keyword,"bitcast"),block:new $o("block",qi.keyword,"block"),break:new $o("break",qi.keyword,"break"),case:new $o("case",qi.keyword,"case"),continue:new $o("continue",qi.keyword,"continue"),continuing:new $o("continuing",qi.keyword,"continuing"),default:new $o("default",qi.keyword,"default"),diagnostic:new $o("diagnostic",qi.keyword,"diagnostic"),discard:new $o("discard",qi.keyword,"discard"),else:new $o("else",qi.keyword,"else"),enable:new $o("enable",qi.keyword,"enable"),fallthrough:new $o("fallthrough",qi.keyword,"fallthrough"),false:new $o("false",qi.keyword,"false"),fn:new $o("fn",qi.keyword,"fn"),for:new $o("for",qi.keyword,"for"),function:new $o("function",qi.keyword,"function"),if:new $o("if",qi.keyword,"if"),let:new $o("let",qi.keyword,"let"),const:new $o("const",qi.keyword,"const"),loop:new $o("loop",qi.keyword,"loop"),while:new $o("while",qi.keyword,"while"),private:new $o("private",qi.keyword,"private"),read:new $o("read",qi.keyword,"read"),read_write:new $o("read_write",qi.keyword,"read_write"),return:new $o("return",qi.keyword,"return"),requires:new $o("requires",qi.keyword,"requires"),storage:new $o("storage",qi.keyword,"storage"),switch:new $o("switch",qi.keyword,"switch"),true:new $o("true",qi.keyword,"true"),alias:new $o("alias",qi.keyword,"alias"),type:new $o("type",qi.keyword,"type"),uniform:new $o("uniform",qi.keyword,"uniform"),var:new $o("var",qi.keyword,"var"),override:new $o("override",qi.keyword,"override"),workgroup:new $o("workgroup",qi.keyword,"workgroup"),write:new $o("write",qi.keyword,"write"),r8unorm:new $o("r8unorm",qi.keyword,"r8unorm"),r8snorm:new $o("r8snorm",qi.keyword,"r8snorm"),r8uint:new $o("r8uint",qi.keyword,"r8uint"),r8sint:new $o("r8sint",qi.keyword,"r8sint"),r16uint:new $o("r16uint",qi.keyword,"r16uint"),r16sint:new $o("r16sint",qi.keyword,"r16sint"),r16float:new $o("r16float",qi.keyword,"r16float"),rg8unorm:new $o("rg8unorm",qi.keyword,"rg8unorm"),rg8snorm:new $o("rg8snorm",qi.keyword,"rg8snorm"),rg8uint:new $o("rg8uint",qi.keyword,"rg8uint"),rg8sint:new $o("rg8sint",qi.keyword,"rg8sint"),r32uint:new $o("r32uint",qi.keyword,"r32uint"),r32sint:new $o("r32sint",qi.keyword,"r32sint"),r32float:new $o("r32float",qi.keyword,"r32float"),rg16uint:new $o("rg16uint",qi.keyword,"rg16uint"),rg16sint:new $o("rg16sint",qi.keyword,"rg16sint"),rg16float:new $o("rg16float",qi.keyword,"rg16float"),rgba8unorm:new $o("rgba8unorm",qi.keyword,"rgba8unorm"),rgba8unorm_srgb:new $o("rgba8unorm_srgb",qi.keyword,"rgba8unorm_srgb"),rgba8snorm:new $o("rgba8snorm",qi.keyword,"rgba8snorm"),rgba8uint:new $o("rgba8uint",qi.keyword,"rgba8uint"),rgba8sint:new $o("rgba8sint",qi.keyword,"rgba8sint"),bgra8unorm:new $o("bgra8unorm",qi.keyword,"bgra8unorm"),bgra8unorm_srgb:new $o("bgra8unorm_srgb",qi.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new $o("rgb10a2unorm",qi.keyword,"rgb10a2unorm"),rg11b10float:new $o("rg11b10float",qi.keyword,"rg11b10float"),rg32uint:new $o("rg32uint",qi.keyword,"rg32uint"),rg32sint:new $o("rg32sint",qi.keyword,"rg32sint"),rg32float:new $o("rg32float",qi.keyword,"rg32float"),rgba16uint:new $o("rgba16uint",qi.keyword,"rgba16uint"),rgba16sint:new $o("rgba16sint",qi.keyword,"rgba16sint"),rgba16float:new $o("rgba16float",qi.keyword,"rgba16float"),rgba32uint:new $o("rgba32uint",qi.keyword,"rgba32uint"),rgba32sint:new $o("rgba32sint",qi.keyword,"rgba32sint"),rgba32float:new $o("rgba32float",qi.keyword,"rgba32float"),static_assert:new $o("static_assert",qi.keyword,"static_assert")},Xo.tokens={decimal_float_literal:new $o("decimal_float_literal",qi.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new $o("hex_float_literal",qi.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new $o("int_literal",qi.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new $o("uint_literal",qi.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new $o("name",qi.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new $o("ident",qi.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new $o("and",qi.token,"&"),and_and:new $o("and_and",qi.token,"&&"),arrow:new $o("arrow ",qi.token,"->"),attr:new $o("attr",qi.token,"@"),forward_slash:new $o("forward_slash",qi.token,"/"),bang:new $o("bang",qi.token,"!"),bracket_left:new $o("bracket_left",qi.token,"["),bracket_right:new $o("bracket_right",qi.token,"]"),brace_left:new $o("brace_left",qi.token,"{"),brace_right:new $o("brace_right",qi.token,"}"),colon:new $o("colon",qi.token,":"),comma:new $o("comma",qi.token,","),equal:new $o("equal",qi.token,"="),equal_equal:new $o("equal_equal",qi.token,"=="),not_equal:new $o("not_equal",qi.token,"!="),greater_than:new $o("greater_than",qi.token,">"),greater_than_equal:new $o("greater_than_equal",qi.token,">="),shift_right:new $o("shift_right",qi.token,">>"),less_than:new $o("less_than",qi.token,"<"),less_than_equal:new $o("less_than_equal",qi.token,"<="),shift_left:new $o("shift_left",qi.token,"<<"),modulo:new $o("modulo",qi.token,"%"),minus:new $o("minus",qi.token,"-"),minus_minus:new $o("minus_minus",qi.token,"--"),period:new $o("period",qi.token,"."),plus:new $o("plus",qi.token,"+"),plus_plus:new $o("plus_plus",qi.token,"++"),or:new $o("or",qi.token,"|"),or_or:new $o("or_or",qi.token,"||"),paren_left:new $o("paren_left",qi.token,"("),paren_right:new $o("paren_right",qi.token,")"),semicolon:new $o("semicolon",qi.token,";"),star:new $o("star",qi.token,"*"),tilde:new $o("tilde",qi.token,"~"),underscore:new $o("underscore",qi.token,"_"),xor:new $o("xor",qi.token,"^"),plus_equal:new $o("plus_equal",qi.token,"+="),minus_equal:new $o("minus_equal",qi.token,"-="),times_equal:new $o("times_equal",qi.token,"*="),division_equal:new $o("division_equal",qi.token,"/="),modulo_equal:new $o("modulo_equal",qi.token,"%="),and_equal:new $o("and_equal",qi.token,"&="),or_equal:new $o("or_equal",qi.token,"|="),xor_equal:new $o("xor_equal",qi.token,"^="),shift_right_equal:new $o("shift_right_equal",qi.token,">>="),shift_left_equal:new $o("shift_left_equal",qi.token,"<<=")},Xo.simpleTokens={"@":Xi.tokens.attr,"{":Xi.tokens.brace_left,"}":Xi.tokens.brace_right,":":Xi.tokens.colon,",":Xi.tokens.comma,"(":Xi.tokens.paren_left,")":Xi.tokens.paren_right,";":Xi.tokens.semicolon},Xo.literalTokens={"&":Xi.tokens.and,"&&":Xi.tokens.and_and,"->":Xi.tokens.arrow,"/":Xi.tokens.forward_slash,"!":Xi.tokens.bang,"[":Xi.tokens.bracket_left,"]":Xi.tokens.bracket_right,"=":Xi.tokens.equal,"==":Xi.tokens.equal_equal,"!=":Xi.tokens.not_equal,">":Xi.tokens.greater_than,">=":Xi.tokens.greater_than_equal,">>":Xi.tokens.shift_right,"<":Xi.tokens.less_than,"<=":Xi.tokens.less_than_equal,"<<":Xi.tokens.shift_left,"%":Xi.tokens.modulo,"-":Xi.tokens.minus,"--":Xi.tokens.minus_minus,".":Xi.tokens.period,"+":Xi.tokens.plus,"++":Xi.tokens.plus_plus,"|":Xi.tokens.or,"||":Xi.tokens.or_or,"*":Xi.tokens.star,"~":Xi.tokens.tilde,_:Xi.tokens.underscore,"^":Xi.tokens.xor,"+=":Xi.tokens.plus_equal,"-=":Xi.tokens.minus_equal,"*=":Xi.tokens.times_equal,"/=":Xi.tokens.division_equal,"%=":Xi.tokens.modulo_equal,"&=":Xi.tokens.and_equal,"|=":Xi.tokens.or_equal,"^=":Xi.tokens.xor_equal,">>=":Xi.tokens.shift_right_equal,"<<=":Xi.tokens.shift_left_equal},Xo.regexTokens={decimal_float_literal:Xi.tokens.decimal_float_literal,hex_float_literal:Xi.tokens.hex_float_literal,int_literal:Xi.tokens.int_literal,uint_literal:Xi.tokens.uint_literal,ident:Xi.tokens.ident},Xo.storage_class=[Xi.keywords.function,Xi.keywords.private,Xi.keywords.workgroup,Xi.keywords.uniform,Xi.keywords.storage],Xo.access_mode=[Xi.keywords.read,Xi.keywords.write,Xi.keywords.read_write],Xo.sampler_type=[Xi.keywords.sampler,Xi.keywords.sampler_comparison],Xo.sampled_texture_type=[Xi.keywords.texture_1d,Xi.keywords.texture_2d,Xi.keywords.texture_2d_array,Xi.keywords.texture_3d,Xi.keywords.texture_cube,Xi.keywords.texture_cube_array],Xo.multisampled_texture_type=[Xi.keywords.texture_multisampled_2d],Xo.storage_texture_type=[Xi.keywords.texture_storage_1d,Xi.keywords.texture_storage_2d,Xi.keywords.texture_storage_2d_array,Xi.keywords.texture_storage_3d],Xo.depth_texture_type=[Xi.keywords.texture_depth_2d,Xi.keywords.texture_depth_2d_array,Xi.keywords.texture_depth_cube,Xi.keywords.texture_depth_cube_array,Xi.keywords.texture_depth_multisampled_2d],Xo.texture_external_type=[Xi.keywords.texture_external],Xo.any_texture_type=[...Xi.sampled_texture_type,...Xi.multisampled_texture_type,...Xi.storage_texture_type,...Xi.depth_texture_type,...Xi.texture_external_type],Xo.texel_format=[Xi.keywords.r8unorm,Xi.keywords.r8snorm,Xi.keywords.r8uint,Xi.keywords.r8sint,Xi.keywords.r16uint,Xi.keywords.r16sint,Xi.keywords.r16float,Xi.keywords.rg8unorm,Xi.keywords.rg8snorm,Xi.keywords.rg8uint,Xi.keywords.rg8sint,Xi.keywords.r32uint,Xi.keywords.r32sint,Xi.keywords.r32float,Xi.keywords.rg16uint,Xi.keywords.rg16sint,Xi.keywords.rg16float,Xi.keywords.rgba8unorm,Xi.keywords.rgba8unorm_srgb,Xi.keywords.rgba8snorm,Xi.keywords.rgba8uint,Xi.keywords.rgba8sint,Xi.keywords.bgra8unorm,Xi.keywords.bgra8unorm_srgb,Xi.keywords.rgb10a2unorm,Xi.keywords.rg11b10float,Xi.keywords.rg32uint,Xi.keywords.rg32sint,Xi.keywords.rg32float,Xi.keywords.rgba16uint,Xi.keywords.rgba16sint,Xi.keywords.rgba16float,Xi.keywords.rgba32uint,Xi.keywords.rgba32sint,Xi.keywords.rgba32float],Xo.const_literal=[Xi.tokens.int_literal,Xi.tokens.uint_literal,Xi.tokens.decimal_float_literal,Xi.tokens.hex_float_literal,Xi.keywords.true,Xi.keywords.false],Xo.literal_or_ident=[Xi.tokens.ident,Xi.tokens.int_literal,Xi.tokens.uint_literal,Xi.tokens.decimal_float_literal,Xi.tokens.hex_float_literal,Xi.tokens.name],Xo.element_count_expression=[Xi.tokens.int_literal,Xi.tokens.uint_literal,Xi.tokens.ident],Xo.template_types=[Xi.keywords.vec2,Xi.keywords.vec3,Xi.keywords.vec4,Xi.keywords.mat2x2,Xi.keywords.mat2x3,Xi.keywords.mat2x4,Xi.keywords.mat3x2,Xi.keywords.mat3x3,Xi.keywords.mat3x4,Xi.keywords.mat4x2,Xi.keywords.mat4x3,Xi.keywords.mat4x4,Xi.keywords.atomic,Xi.keywords.bitcast,...Xi.any_texture_type],Xo.attribute_name=[Xi.tokens.ident,Xi.keywords.block,Xi.keywords.diagnostic],Xo.assignment_operators=[Xi.tokens.equal,Xi.tokens.plus_equal,Xi.tokens.minus_equal,Xi.tokens.times_equal,Xi.tokens.division_equal,Xi.tokens.modulo_equal,Xi.tokens.and_equal,Xi.tokens.or_equal,Xi.tokens.xor_equal,Xi.tokens.shift_right_equal,Xi.tokens.shift_left_equal],Xo.increment_operators=[Xi.tokens.plus_plus,Xi.tokens.minus_minus];class qo{constructor(e,t,n,s,r){this.type=e,this.lexeme=t,this.line=n,this.start=s,this.end=r}toString(){return this.lexeme}isTemplateType(){return-1!=Xo.template_types.indexOf(this.type)}isArrayType(){return this.type==Xo.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class Yo{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=null!=e?e:""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new qo(Xo.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if("\n"==e)return this._line++,!0;if(this._isWhitespace(e))return!0;if("/"==e){if("/"==this._peekAhead()){for(;"\n"!=e;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if("*"==this._peekAhead()){this._advance();let t=1;for(;t>0;){if(this._isAtEnd())return!0;if(e=this._advance(),"\n"==e)this._line++;else if("*"==e){if("/"==this._peekAhead()&&(this._advance(),t--,0==t))return!0}else"/"==e&&"*"==this._peekAhead()&&(this._advance(),t++)}return!0}}const t=Xo.simpleTokens[e];if(t)return this._addToken(t),!0;let n=Xo.none;const s=this._isAlpha(e),r="_"===e;if(this._isAlphaNumeric(e)){let t=this._peekAhead();for(;this._isAlphaNumeric(t);)e+=this._advance(),t=this._peekAhead()}if(s){const t=Xo.keywords[e];if(t)return this._addToken(t),!0}if(s||r)return this._addToken(Xo.tokens.ident),!0;for(;;){let t=this._findType(e);const s=this._peekAhead();if("-"==e&&this._tokens.length>0){if("="==s)return this._current++,e+=s,this._addToken(Xo.tokens.minus_equal),!0;if("-"==s)return this._current++,e+=s,this._addToken(Xo.tokens.minus_minus),!0;const n=this._tokens.length-1;if((-1!=Xo.literal_or_ident.indexOf(this._tokens[n].type)||this._tokens[n].type==Xo.tokens.paren_right)&&">"!=s)return this._addToken(t),!0}if(">"==e&&(">"==s||"="==s)){let e=!1,n=this._tokens.length-1;for(let t=0;t<5&&n>=0&&-1===Xo.assignment_operators.indexOf(this._tokens[n].type);++t,--n)if(this._tokens[n].type===Xo.tokens.less_than){n>0&&this._tokens[n-1].isArrayOrTemplateType()&&(e=!0);break}if(e)return this._addToken(t),!0}if(t===Xo.none){let s=e,r=0;const i=2;for(let e=0;e<i;++e)if(s+=this._peekAhead(e),t=this._findType(s),t!==Xo.none){r=e;break}if(t===Xo.none)return n!==Xo.none&&(this._current--,this._addToken(n),!0);e=s,this._current+=r+1}if(n=t,this._isAtEnd())break;e+=this._advance()}return n!==Xo.none&&(this._addToken(n),!0)}_findType(e){for(const t in Xo.regexTokens){const n=Xo.regexTokens[t];if(this._match(e,n.rule))return n}return Xo.literalTokens[e]||Xo.none}_match(e,t){const n=t.exec(e);return n&&0==n.index&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&"_"!==e&&"."!==e&&"("!==e&&")"!==e&&"["!==e&&"]"!==e&&"{"!==e&&"}"!==e&&","!==e&&";"!==e&&":"!==e&&"="!==e&&"!"!==e&&"<"!==e&&">"!==e&&"+"!==e&&"-"!==e&&"*"!==e&&"/"!==e&&"%"!==e&&"&"!==e&&"|"!==e&&"^"!==e&&"~"!==e&&"@"!==e&&"#"!==e&&"?"!==e&&"'"!==e&&"`"!==e&&'"'!==e&&"\\"!==e&&"\n"!==e&&"\r"!==e&&"\t"!==e&&"\0"!==e}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||"_"===e}_isWhitespace(e){return" "==e||"\t"==e||"\r"==e}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new qo(e,t,this._line,this._start,this._current))}}function Ko(e){return Array.isArray(e)||(null==e?void 0:e.buffer)instanceof ArrayBuffer}const Zo=new Float32Array(1),Qo=new Uint32Array(Zo.buffer),Jo=new Uint32Array(Zo.buffer),ea=new Int32Array(1),ta=new Float32Array(ea.buffer),na=new Uint32Array(ea.buffer),sa=new Uint32Array(1),ra=new Float32Array(sa.buffer),ia=new Int32Array(sa.buffer);function oa(e,t,n){if(t===n)return e;if("f32"===t){if("i32"===n||"x32"===n)return Zo[0]=e,Qo[0];if("u32"===n)return Zo[0]=e,Jo[0]}else if("i32"===t||"x32"===t){if("f32"===n)return ea[0]=e,ta[0];if("u32"===n)return ea[0]=e,na[0]}else if("u32"===t){if("f32"===n)return sa[0]=e,ra[0];if("i32"===n||"x32"===n)return sa[0]=e,ia[0]}return e}class aa{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class la{constructor(e,t){this.align=e,this.size=t}}class ca{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new bi,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return"texture_storage_1d"==e.name||"texture_storage_2d"==e.name||"texture_storage_2d_array"==e.name||"texture_storage_3d"==e.name}updateAST(e){for(const t of e)t instanceof Fi&&this._functions.set(t.name,new aa(t));for(const t of e)if(t instanceof ho){const e=this.getTypeInfo(t,null);e instanceof oi&&this.structs.push(e)}for(const t of e)if(t instanceof io)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof Vi){const e=t,n=this._getAttributeNum(e.attributes,"id",0),s=null!=e.type?this.getTypeInfo(e.type,e.attributes):null;this.overrides.push(new mi(e.name,s,e.attributes,n));continue}if(this._isUniformVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),s=this._getAttributeNum(e.attributes,"binding",0),r=this.getTypeInfo(e.type,e.attributes),i=new di(e.name,r,n,s,e.attributes,ui.Uniform,e.access);i.access||(i.access="read"),this.uniforms.push(i);continue}if(this._isStorageVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),s=this._getAttributeNum(e.attributes,"binding",0),r=this.getTypeInfo(e.type,e.attributes),i=this._isStorageTexture(r),o=new di(e.name,r,n,s,e.attributes,i?ui.StorageTexture:ui.Storage,e.access);o.access||(o.access="read"),this.storage.push(o);continue}if(this._isTextureVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),s=this._getAttributeNum(e.attributes,"binding",0),r=this.getTypeInfo(e.type,e.attributes),i=this._isStorageTexture(r),o=new di(e.name,r,n,s,e.attributes,i?ui.StorageTexture:ui.Texture,e.access);o.access||(o.access="read"),i?this.storage.push(o):this.textures.push(o);continue}if(this._isSamplerVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),s=this._getAttributeNum(e.attributes,"binding",0),r=this.getTypeInfo(e.type,e.attributes),i=new di(e.name,r,n,s,e.attributes,ui.Sampler,e.access);this.samplers.push(i);continue}}for(const t of e)if(t instanceof Fi){const e=this._getAttribute(t,"vertex"),n=this._getAttribute(t,"fragment"),s=this._getAttribute(t,"compute"),r=e||n||s,i=new yi(t.name,null==r?void 0:r.name,t.attributes);i.attributes=t.attributes,i.startLine=t.startLine,i.endLine=t.endLine,this.functions.push(i),this._functions.get(t.name).info=i,r&&(this._functions.get(t.name).inUse=!0,i.inUse=!0,i.resources=this._findResources(t,!!r),i.inputs=this._getInputs(t.args),i.outputs=this._getOutputs(t.returnType),this.entry[r.name].push(i)),i.arguments=t.args.map(e=>new _i(e.name,this.getTypeInfo(e.type,e.attributes),e.attributes)),i.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(e=>{var n,s,r;if(e instanceof Fo){if(e.value)if(Ko(e.value))for(const i of e.value)for(const e of this.overrides)i===e.name&&(null===(n=t.info)||void 0===n||n.overrides.push(e));else for(const i of this.overrides)e.value===i.name&&(null===(s=t.info)||void 0===s||s.overrides.push(i))}else if(e instanceof xo)for(const i of this.overrides)e.name===i.name&&(null===(r=t.info)||void 0===r||r.overrides.push(i))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getFunctionInfo(e){for(const t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var n;for(const s of e.calls){const e=null===(n=this._functions.get(s.name))||void 0===n?void 0:n.info;e&&t.add(e)}}findResource(e,t,n){if(n){for(const s of this.entry.compute)if(s.name===n)for(const n of s.resources)if(n.group==e&&n.binding==t)return n;for(const s of this.entry.vertex)if(s.name===n)for(const n of s.resources)if(n.group==e&&n.binding==t)return n;for(const s of this.entry.fragment)if(s.name===n)for(const n of s.resources)if(n.group==e&&n.binding==t)return n}for(const s of this.uniforms)if(s.group==e&&s.binding==t)return s;for(const s of this.storage)if(s.group==e&&s.binding==t)return s;for(const s of this.textures)if(s.group==e&&s.binding==t)return s;for(const s of this.samplers)if(s.group==e&&s.binding==t)return s;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const n=[],s=this,r=[];return e.search(i=>{if(i instanceof Mi)r.push({});else if(i instanceof Li)r.pop();else if(i instanceof Gi){const e=i;t&&null!==e.type&&this._markStructsFromAST(e.type),r.length>0&&(r[r.length-1][e.name]=e)}else if(i instanceof bo){const e=i;t&&null!==e.type&&this._markStructsFromAST(e.type)}else if(i instanceof zi){const e=i;t&&null!==e.type&&this._markStructsFromAST(e.type),r.length>0&&(r[r.length-1][e.name]=e)}else if(i instanceof xo){const e=i;if(r.length>0&&r[r.length-1][e.name])return;const t=s._findResource(e.name);t&&n.push(t)}else if(i instanceof vo){const r=i,o=s._functions.get(r.name);o&&(t&&(o.inUse=!0),e.calls.add(o.node),null===o.resources&&(o.resources=s._findResources(o.node,t)),n.push(...o.resources))}else if(i instanceof Zi){const r=i,o=s._functions.get(r.name);o&&(t&&(o.inUse=!0),e.calls.add(o.node),null===o.resources&&(o.resources=s._findResources(o.node,t)),n.push(...o.resources))}}),[...new Map(n.map(e=>[e.name,e])).values()]}getBindGroups(){const e=[];function t(t,n){t>=e.length&&(e.length=t+1),void 0===e[t]&&(e[t]=[]),n>=e[t].length&&(e[t].length=n+1)}for(const n of this.uniforms)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)t(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e,t=void 0){if(void 0===t&&(t=[]),e instanceof ho)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);null!==n&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof ho)this._getStructOutputs(n.type,t);else{const e=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(null!==e){const s=this.getTypeInfo(n.type,n.type.attributes),r=this._parseInt(e.value),i=new gi(n.name,s,e.name,r);t.push(i)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this.getTypeInfo(e,e.attributes),s=this._parseInt(t.value);return new gi("",n,t.name,s)}return null}_getInputs(e,t=void 0){void 0===t&&(t=[]);for(const n of e)if(n.type instanceof ho)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof ho)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this._getAttribute(e,"interpolation"),s=this.getTypeInfo(e.type,e.attributes),r=this._parseInt(t.value),i=new pi(e.name,s,t.name,r);return null!==n&&(i.interpolation=this._parseString(n.value)),i}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new fi(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof po){const n=e.type?this.getTypeInfo(e.type,e.attributes):null,s=new li(e.name,n,t);return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof go){const n=e,s=n.format?this.getTypeInfo(n.format,n.attributes):null,r=new ai(n.name,t);return r.format=s,r.count=n.count,this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof ho){const n=e,s=new oi(n.name,t);s.startLine=n.startLine,s.endLine=n.endLine;for(const e of n.members){const t=this.getTypeInfo(e.type,e.attributes);s.members.push(new ii(e.name,t,e.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof mo){const n=e,s=n.format instanceof co,r=n.format?s?this.getTypeInfo(n.format,null):new ri(n.format,null):null,i=new ci(n.name,r,t,n.access);return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof fo){const n=e,s=n.format?this.getTypeInfo(n.format,null):null,r=new ci(n.name,s,t,n.access);return this._types.set(e,r),this._updateTypeInfo(r),r}const n=new ri(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n,s;const r=this._getTypeSize(e);if(e.size=null!==(t=null==r?void 0:r.size)&&void 0!==t?t:0,e instanceof ai&&e.format){const t=this._getTypeSize(e.format);e.stride=Math.max(null!==(n=null==t?void 0:t.size)&&void 0!==n?n:0,null!==(s=null==t?void 0:t.align)&&void 0!==s?s:0),this._updateTypeInfo(e.format)}e instanceof li&&this._updateTypeInfo(e.format),e instanceof oi&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,s=0,r=0,i=0;for(let o=0,a=e.members.length;o<a;++o){const a=e.members[o],l=this._getTypeSize(a);if(!l)continue;null!==(t=this._getAlias(a.type.name))&&void 0!==t||a.type;const c=l.align,u=l.size;n=this._roundUp(c,n+s),s=u,r=n,i=Math.max(i,c),a.offset=n,a.size=u,this._updateTypeInfo(a.type)}e.size=this._roundUp(i,r+s),e.align=i}_getTypeSize(e){var t,n;if(null==e)return null;const s=this._getAttributeNum(e.attributes,"size",0),r=this._getAttributeNum(e.attributes,"align",0);if(e instanceof ii&&(e=e.type),e instanceof ri){const t=this._getAlias(e.name);null!==t&&(e=t)}{const n=ca._typeInfo[e.name];if(void 0!==n){const i="f16"===(null===(t=e.format)||void 0===t?void 0:t.name)?2:1;return new la(Math.max(r,n.align/i),Math.max(s,n.size/i))}}{const t=ca._typeInfo[e.name.substring(0,e.name.length-1)];if(t){const n="h"===e.name[e.name.length-1]?2:1;return new la(Math.max(r,t.align/n),Math.max(s,t.size/n))}}if(e instanceof ai){let t=e,i=8,o=8;const a=this._getTypeSize(t.format);return null!==a&&(o=a.size,i=a.align),o=t.count*this._getAttributeNum(null!==(n=null==e?void 0:e.attributes)&&void 0!==n?n:null,"stride",this._roundUp(i,o)),s&&(o=s),new la(Math.max(r,i),Math.max(s,o))}if(e instanceof oi){let t=0,n=0,i=0,o=0,a=0;for(const s of e.members){const e=this._getTypeSize(s.type);null!==e&&(t=Math.max(e.align,t),i=this._roundUp(e.align,i+o),o=e.size,a=i)}return n=this._roundUp(t,a+o),new la(Math.max(r,t),Math.max(s,n))}return null}_isUniformVar(e){return e instanceof Gi&&"uniform"==e.storage}_isStorageVar(e){return e instanceof Gi&&"storage"==e.storage}_isTextureVar(e){return e instanceof Gi&&null!==e.type&&-1!=ca._textureTypes.indexOf(e.type.name)}_isSamplerVar(e){return e instanceof Gi&&null!==e.type&&-1!=ca._samplerTypes.indexOf(e.type.name)}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const s=n.attributes;for(let r of s)if(r.name==t)return r;return null}_getAttributeNum(e,t,n){if(null===e)return n;for(let s of e)if(s.name==t){let e=null!==s&&null!==s.value?s.value:n;return e instanceof Array&&(e=e[0]),"number"==typeof e?e:"string"==typeof e?parseInt(e):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}}ca._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},ca._textureTypes=Xo.any_texture_type.map(e=>e.name),ca._samplerTypes=Xo.sampler_type.map(e=>e.name);let ua=0;class ha{constructor(e,t,n){this.id=ua++,this.name=e,this.value=t,this.node=n}clone(){return new ha(this.name,this.value,this.node)}}class da{constructor(e){this.id=ua++,this.name=e.name,this.node=e}clone(){return new da(this.node)}}class fa{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=ua++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?null!==(t=this.variables.get(e))&&void 0!==t?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?null!==(t=this.functions.get(e))&&void 0!==t?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,n){this.variables.set(e,new ha(e,t,null!=n?n:null))}setVariable(e,t,n){const s=this.getVariable(e);null!==s?s.value=t:this.createVariable(e,t,n)}getVariableValue(e){var t;const n=this.getVariable(e);return null!==(t=null==n?void 0:n.value)&&void 0!==t?t:null}clone(){return new fa(this)}}class pa{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class ga{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const n=this.exec.evalExpression(e.args[0],t);let s=!0;if(n instanceof Vo)return n.data.forEach(e=>{e||(s=!1)}),new jo(s?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo){const e=n.data.some(e=>e);return new jo(e?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const n=this.exec.evalExpression(e.args[2],t);if(!(n instanceof jo))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return n.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let n=e.args[0];n instanceof Ro&&(n=n.right);const s=this.exec.evalExpression(n,t);if(s instanceof Wo&&0===s.typeInfo.size){const e=s.typeInfo,t=s.buffer.byteLength/e.stride;return new jo(t,this.getTypeInfo("u32"))}return new jo(s.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.abs(e)),n.typeInfo);const s=n;return new jo(Math.abs(s.value),s.typeInfo)}Acos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.acos(e)),n.typeInfo);const s=n;return new jo(Math.acos(s.value),n.typeInfo)}Acosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.acosh(e)),n.typeInfo);const s=n;return new jo(Math.acosh(s.value),n.typeInfo)}Asin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.asin(e)),n.typeInfo);const s=n;return new jo(Math.asin(s.value),n.typeInfo)}Asinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.asinh(e)),n.typeInfo);const s=n;return new jo(Math.asinh(s.value),n.typeInfo)}Atan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.atan(e)),n.typeInfo);const s=n;return new jo(Math.atan(s.value),n.typeInfo)}Atanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.atanh(e)),n.typeInfo);const s=n;return new jo(Math.atanh(s.value),n.typeInfo)}Atan2(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Vo&&s instanceof Vo)return new Vo(n.data.map((e,t)=>Math.atan2(e,s.data[t])),n.typeInfo);const r=n,i=s;return new jo(Math.atan2(r.value,i.value),n.typeInfo)}Ceil(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.ceil(e)),n.typeInfo);const s=n;return new jo(Math.ceil(s.value),n.typeInfo)}_clamp(e,t,n){return Math.min(Math.max(e,t),n)}Clamp(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Vo&&s instanceof Vo&&r instanceof Vo)return new Vo(n.data.map((e,t)=>this._clamp(e,s.data[t],r.data[t])),n.typeInfo);const i=n,o=s,a=r;return new jo(this._clamp(i.value,o.value,a.value),n.typeInfo)}Cos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.cos(e)),n.typeInfo);const s=n;return new jo(Math.cos(s.value),n.typeInfo)}Cosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.cosh(e)),n.typeInfo);const s=n;return new jo(Math.cos(s.value),n.typeInfo)}CountLeadingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.clz32(e)),n.typeInfo);const s=n;return new jo(Math.clz32(s.value),n.typeInfo)}_countOneBits(e){let t=0;for(;0!==e;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>this._countOneBits(e)),n.typeInfo);const s=n;return new jo(this._countOneBits(s.value),n.typeInfo)}_countTrailingZeros(e){if(0===e)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>this._countTrailingZeros(e)),n.typeInfo);const s=n;return new jo(this._countTrailingZeros(s.value),n.typeInfo)}Cross(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Vo&&s instanceof Vo){if(3!==n.data.length||3!==s.data.length)return null;const e=n.data,t=s.data;return new Vo([e[1]*t[2]-t[1]*e[2],e[2]*t[0]-t[2]*e[0],e[0]*t[1]-t[0]*e[1]],n.typeInfo)}return null}Degrees(e,t){const n=this.exec.evalExpression(e.args[0],t),s=180/Math.PI;return n instanceof Vo?new Vo(n.data.map(e=>e*s),n.typeInfo):new jo(n.value*s,this.getTypeInfo("f32"))}Determinant(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof zo){const e=n.data,t=n.typeInfo.getTypeName(),s=t.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t)return new jo(e[0]*e[3]-e[1]*e[2],s);if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t)return new jo(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),s);if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t);else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t);else if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t)return new jo(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),s)}return null}Distance(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Vo&&s instanceof Vo){let e=0;for(let t=0;t<n.data.length;++t)e+=(n.data[t]-s.data[t])*(n.data[t]-s.data[t]);return new jo(Math.sqrt(e),this.getTypeInfo("f32"))}const r=n,i=s;return new jo(Math.abs(r.value-i.value),n.typeInfo)}_dot(e,t){let n=0;for(let s=0;s<e.length;++s)n+=t[s]*e[s];return n}Dot(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);return n instanceof Vo&&s instanceof Vo?new jo(this._dot(n.data,s.data),this.getTypeInfo("f32")):null}Dot4U8Packed(e,t){return null}Dot4I8Packed(e,t){return null}Exp(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.exp(e)),n.typeInfo);const s=n;return new jo(Math.exp(s.value),n.typeInfo)}Exp2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.pow(2,e)),n.typeInfo);const s=n;return new jo(Math.pow(2,s.value),n.typeInfo)}ExtractBits(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if("u32"!==s.typeInfo.name&&"x32"!==s.typeInfo.name)return null;if("u32"!==r.typeInfo.name&&"x32"!==r.typeInfo.name)return null;const i=s.value,o=r.value;if(n instanceof Vo)return new Vo(n.data.map(e=>e>>i&(1<<o)-1),n.typeInfo);if("i32"!==n.typeInfo.name&&"x32"!==n.typeInfo.name)return null;const a=n.value;return new jo(a>>i&(1<<o)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Vo&&s instanceof Vo&&r instanceof Vo){const e=this._dot(s.data,r.data);return new Vo(e<0?Array.from(n.data):n.data.map(e=>-e),n.typeInfo)}return null}_firstLeadingBit(e){return 0===e?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>this._firstLeadingBit(e)),n.typeInfo);const s=n;return new jo(this._firstLeadingBit(s.value),n.typeInfo)}_firstTrailingBit(e){return 0===e?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>this._firstTrailingBit(e)),n.typeInfo);const s=n;return new jo(this._firstTrailingBit(s.value),n.typeInfo)}Floor(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.floor(e)),n.typeInfo);const s=n;return new jo(Math.floor(s.value),n.typeInfo)}Fma(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Vo&&s instanceof Vo&&r instanceof Vo)return n.data.length!==s.data.length||n.data.length!==r.data.length?null:new Vo(n.data.map((e,t)=>e*s.data[t]+r.data[t]),n.typeInfo);const i=n,o=s,a=r;return new jo(i.value*o.value+a.value,i.typeInfo)}Fract(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>e-Math.floor(e)),n.typeInfo);const s=n;return new jo(s.value-Math.floor(s.value),n.typeInfo)}Frexp(e,t){return null}InsertBits(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t),i=this.exec.evalExpression(e.args[3],t);if("u32"!==r.typeInfo.name&&"x32"!==r.typeInfo.name)return null;const o=r.value,a=(1<<i.value)-1<<o,l=~a;if(n instanceof Vo&&s instanceof Vo)return new Vo(n.data.map((e,t)=>e&l|s.data[t]<<o&a),n.typeInfo);const c=n.value,u=s.value;return new jo(c&l|u<<o&a,n.typeInfo)}InverseSqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>1/Math.sqrt(e)),n.typeInfo);const s=n;return new jo(1/Math.sqrt(s.value),n.typeInfo)}Ldexp(e,t){return null}Length(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo){let e=0;return n.data.forEach(t=>{e+=t*t}),new jo(Math.sqrt(e),this.getTypeInfo("f32"))}const s=n;return new jo(Math.abs(s.value),n.typeInfo)}Log(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.log(e)),n.typeInfo);const s=n;return new jo(Math.log(s.value),n.typeInfo)}Log2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.log2(e)),n.typeInfo);const s=n;return new jo(Math.log2(s.value),n.typeInfo)}Max(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Vo&&s instanceof Vo)return new Vo(n.data.map((e,t)=>Math.max(e,s.data[t])),n.typeInfo);const r=n,i=s;return new jo(Math.max(r.value,i.value),n.typeInfo)}Min(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Vo&&s instanceof Vo)return new Vo(n.data.map((e,t)=>Math.min(e,s.data[t])),n.typeInfo);const r=n,i=s;return new jo(Math.min(r.value,i.value),n.typeInfo)}Mix(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Vo&&s instanceof Vo&&r instanceof Vo)return new Vo(n.data.map((e,t)=>n.data[t]*(1-r.data[t])+s.data[t]*r.data[t]),n.typeInfo);const i=s,o=r;return new jo(n.value*(1-o.value)+i.value*o.value,n.typeInfo)}Modf(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Vo&&s instanceof Vo)return new Vo(n.data.map((e,t)=>e%s.data[t]),n.typeInfo);const r=s;return new jo(n.value%r.value,n.typeInfo)}Normalize(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo){const s=this.Length(e,t).value;return new Vo(n.data.map(e=>e/s),n.typeInfo)}return null}Pow(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Vo&&s instanceof Vo)return new Vo(n.data.map((e,t)=>Math.pow(e,s.data[t])),n.typeInfo);const r=n,i=s;return new jo(Math.pow(r.value,i.value),n.typeInfo)}QuantizeToF16(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof Vo?new Vo(n.data.map(e=>e),n.typeInfo):new jo(n.value,n.typeInfo)}Radians(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof Vo?new Vo(n.data.map(e=>e*Math.PI/180),n.typeInfo):new jo(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Vo&&s instanceof Vo){const e=this._dot(n.data,s.data);return new Vo(n.data.map((t,n)=>t-2*e*s.data[n]),n.typeInfo)}return null}Refract(e,t){let n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Vo&&s instanceof Vo&&r instanceof jo){const e=this._dot(s.data,n.data);return new Vo(n.data.map((t,n)=>{const i=1-r.value*r.value*(1-e*e);if(i<0)return 0;const o=Math.sqrt(i);return r.value*t-(r.value*e+o)*s.data[n]}),n.typeInfo)}return null}ReverseBits(e,t){return null}Round(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.round(e)),n.typeInfo);const s=n;return new jo(Math.round(s.value),n.typeInfo)}Saturate(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.min(Math.max(e,0),1)),n.typeInfo);const s=n;return new jo(Math.min(Math.max(s.value,0),1),n.typeInfo)}Sign(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.sign(e)),n.typeInfo);const s=n;return new jo(Math.sign(s.value),n.typeInfo)}Sin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.sin(e)),n.typeInfo);const s=n;return new jo(Math.sin(s.value),n.typeInfo)}Sinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.sinh(e)),n.typeInfo);const s=n;return new jo(Math.sinh(s.value),n.typeInfo)}_smoothstep(e,t,n){const s=Math.min(Math.max((n-e)/(t-e),0),1);return s*s*(3-2*s)}SmoothStep(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(r instanceof Vo&&n instanceof Vo&&s instanceof Vo)return new Vo(r.data.map((e,t)=>this._smoothstep(n.data[t],s.data[t],e)),r.typeInfo);const i=n,o=s,a=r;return new jo(this._smoothstep(i.value,o.value,a.value),r.typeInfo)}Sqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.sqrt(e)),n.typeInfo);const s=n;return new jo(Math.sqrt(s.value),n.typeInfo)}Step(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(s instanceof Vo&&n instanceof Vo)return new Vo(s.data.map((e,t)=>e<n.data[t]?0:1),s.typeInfo);const r=n;return new jo(s.value<r.value?0:1,r.typeInfo)}Tan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.tan(e)),n.typeInfo);const s=n;return new jo(Math.tan(s.value),n.typeInfo)}Tanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.tanh(e)),n.typeInfo);const s=n;return new jo(Math.tanh(s.value),n.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return"mat2x2f"===t||"mat2x2h"===t?e:"mat2x3f"===t?this.getTypeInfo("mat3x2f"):"mat2x3h"===t?this.getTypeInfo("mat3x2h"):"mat2x4f"===t?this.getTypeInfo("mat4x2f"):"mat2x4h"===t?this.getTypeInfo("mat4x2h"):"mat3x2f"===t?this.getTypeInfo("mat2x3f"):"mat3x2h"===t?this.getTypeInfo("mat2x3h"):"mat3x3f"===t||"mat3x3h"===t?e:"mat3x4f"===t?this.getTypeInfo("mat4x3f"):"mat3x4h"===t?this.getTypeInfo("mat4x3h"):"mat4x2f"===t?this.getTypeInfo("mat2x4f"):"mat4x2h"===t?this.getTypeInfo("mat2x4h"):"mat4x3f"===t?this.getTypeInfo("mat3x4f"):"mat4x3h"===t?this.getTypeInfo("mat3x4h"):e}Transpose(e,t){const n=this.exec.evalExpression(e.args[0],t);if(!(n instanceof zo))return null;const s=this._getTransposeType(n.typeInfo);if("mat2x2"===n.typeInfo.name||"mat2x2f"===n.typeInfo.name||"mat2x2h"===n.typeInfo.name){const e=n.data;return new zo([e[0],e[2],e[1],e[3]],s)}if("mat2x3"===n.typeInfo.name||"mat2x3f"===n.typeInfo.name||"mat2x3h"===n.typeInfo.name){const e=n.data;return new zo([e[0],e[3],e[6],e[1],e[4],e[7]],s)}if("mat2x4"===n.typeInfo.name||"mat2x4f"===n.typeInfo.name||"mat2x4h"===n.typeInfo.name){const e=n.data;return new zo([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13]],s)}if("mat3x2"===n.typeInfo.name||"mat3x2f"===n.typeInfo.name||"mat3x2h"===n.typeInfo.name){const e=n.data;return new zo([e[0],e[3],e[1],e[4],e[2],e[5]],s)}if("mat3x3"===n.typeInfo.name||"mat3x3f"===n.typeInfo.name||"mat3x3h"===n.typeInfo.name){const e=n.data;return new zo([e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]],s)}if("mat3x4"===n.typeInfo.name||"mat3x4f"===n.typeInfo.name||"mat3x4h"===n.typeInfo.name){const e=n.data;return new zo([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14]],s)}if("mat4x2"===n.typeInfo.name||"mat4x2f"===n.typeInfo.name||"mat4x2h"===n.typeInfo.name){const e=n.data;return new zo([e[0],e[4],e[1],e[5],e[2],e[6]],s)}if("mat4x3"===n.typeInfo.name||"mat4x3f"===n.typeInfo.name||"mat4x3h"===n.typeInfo.name){const e=n.data;return new zo([e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]],s)}if("mat4x4"===n.typeInfo.name||"mat4x4f"===n.typeInfo.name||"mat4x4h"===n.typeInfo.name){const e=n.data;return new zo([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]],s)}return null}Trunc(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vo)return new Vo(n.data.map(e=>Math.trunc(e)),n.typeInfo);const s=n;return new jo(Math.trunc(s.value),n.typeInfo)}Dpdx(e,t){return null}DpdxCoarse(e,t){return null}DpdxFine(e,t){return null}Dpdy(e,t){return null}DpdyCoarse(e,t){return null}DpdyFine(e,t){return null}Fwidth(e,t){return null}FwidthCoarse(e,t){return null}FwidthFine(e,t){return null}TextureDimensions(e,t){const n=e.args[0],s=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(n instanceof xo){const e=n.name,r=t.getVariableValue(e);if(r instanceof Ho){if(s<0||s>=r.mipLevelCount)return null;const e=r.getMipLevelSize(s),t=r.dimension;return"1d"===t?new jo(e[0],this.getTypeInfo("u32")):"3d"===t?new Vo(e,this.getTypeInfo("vec3u")):"2d"===t?new Vo(e.slice(0,2),this.getTypeInfo("vec2u")):null}return null}return null}TextureGather(e,t){return null}TextureGatherCompare(e,t){return null}TextureLoad(e,t){const n=e.args[0],s=this.exec.evalExpression(e.args[1],t),r=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(s instanceof Vo)||2!==s.data.length)return null;if(n instanceof xo){const e=n.name,i=t.getVariableValue(e);if(i instanceof Ho){const e=Math.floor(s.data[0]),t=Math.floor(s.data[1]);if(e<0||e>=i.width||t<0||t>=i.height)return null;const n=i.getPixel(e,t,0,r);return null===n?null:new Vo(n,this.getTypeInfo("vec4f"))}return null}return null}TextureNumLayers(e,t){const n=e.args[0];if(n instanceof xo){const e=n.name,s=t.getVariableValue(e);return s instanceof Ho?new jo(s.depthOrArrayLayers,this.getTypeInfo("u32")):null}return null}TextureNumLevels(e,t){const n=e.args[0];if(n instanceof xo){const e=n.name,s=t.getVariableValue(e);return s instanceof Ho?new jo(s.mipLevelCount,this.getTypeInfo("u32")):null}return null}TextureNumSamples(e,t){const n=e.args[0];if(n instanceof xo){const e=n.name,s=t.getVariableValue(e);return s instanceof Ho?new jo(s.sampleCount,this.getTypeInfo("u32")):null}return null}TextureSample(e,t){return null}TextureSampleBias(e,t){return null}TextureSampleCompare(e,t){return null}TextureSampleCompareLevel(e,t){return null}TextureSampleGrad(e,t){return null}TextureSampleLevel(e,t){return null}TextureSampleBaseClampToEdge(e,t){return null}TextureStore(e,t){const n=e.args[0],s=this.exec.evalExpression(e.args[1],t),r=4===e.args.length?this.exec.evalExpression(e.args[2],t).value:0,i=4===e.args.length?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(4!==i.length)return null;if(!(s instanceof Vo)||2!==s.data.length)return null;if(n instanceof xo){const e=n.name,o=t.getVariableValue(e);if(o instanceof Ho){const e=o.getMipLevelSize(0),t=Math.floor(s.data[0]),n=Math.floor(s.data[1]);return t<0||t>=e[0]||n<0||n>=e[1]||o.setPixel(t,n,0,r,Array.from(i)),null}return null}return null}AtomicLoad(e,t){let n=e.args[0];n instanceof Ro&&(n=n.right);const s=this.exec.getVariableName(n,t);return t.getVariable(s).value.getSubData(this.exec,n.postfix,t)}AtomicStore(e,t){let n=e.args[0];n instanceof Ro&&(n=n.right);const s=this.exec.getVariableName(n,t),r=t.getVariable(s);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=r.value.getSubData(this.exec,n.postfix,t);return a instanceof jo&&o instanceof jo&&(a.value=o.value),r.value instanceof Wo&&r.value.setDataValue(this.exec,a,n.postfix,t),null}AtomicAdd(e,t){let n=e.args[0];n instanceof Ro&&(n=n.right);const s=this.exec.getVariableName(n,t),r=t.getVariable(s);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new jo(a.value,a.typeInfo);return a instanceof jo&&o instanceof jo&&(a.value+=o.value),r.value instanceof Wo&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicSub(e,t){let n=e.args[0];n instanceof Ro&&(n=n.right);const s=this.exec.getVariableName(n,t),r=t.getVariable(s);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new jo(a.value,a.typeInfo);return a instanceof jo&&o instanceof jo&&(a.value-=o.value),r.value instanceof Wo&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicMax(e,t){let n=e.args[0];n instanceof Ro&&(n=n.right);const s=this.exec.getVariableName(n,t),r=t.getVariable(s);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new jo(a.value,a.typeInfo);return a instanceof jo&&o instanceof jo&&(a.value=Math.max(a.value,o.value)),r.value instanceof Wo&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicMin(e,t){let n=e.args[0];n instanceof Ro&&(n=n.right);const s=this.exec.getVariableName(n,t),r=t.getVariable(s);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new jo(a.value,a.typeInfo);return a instanceof jo&&o instanceof jo&&(a.value=Math.min(a.value,o.value)),r.value instanceof Wo&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicAnd(e,t){let n=e.args[0];n instanceof Ro&&(n=n.right);const s=this.exec.getVariableName(n,t),r=t.getVariable(s);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new jo(a.value,a.typeInfo);return a instanceof jo&&o instanceof jo&&(a.value=a.value&o.value),r.value instanceof Wo&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicOr(e,t){let n=e.args[0];n instanceof Ro&&(n=n.right);const s=this.exec.getVariableName(n,t),r=t.getVariable(s);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new jo(a.value,a.typeInfo);return a instanceof jo&&o instanceof jo&&(a.value=a.value|o.value),r.value instanceof Wo&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicXor(e,t){let n=e.args[0];n instanceof Ro&&(n=n.right);const s=this.exec.getVariableName(n,t),r=t.getVariable(s);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new jo(a.value,a.typeInfo);return a instanceof jo&&o instanceof jo&&(a.value=a.value^o.value),r.value instanceof Wo&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicExchange(e,t){let n=e.args[0];n instanceof Ro&&(n=n.right);const s=this.exec.getVariableName(n,t),r=t.getVariable(s);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new jo(a.value,a.typeInfo);return a instanceof jo&&o instanceof jo&&(a.value=o.value),r.value instanceof Wo&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicCompareExchangeWeak(e,t){return null}Pack4x8snorm(e,t){return null}Pack4x8unorm(e,t){return null}Pack4xI8(e,t){return null}Pack4xU8(e,t){return null}Pack4x8Clamp(e,t){return null}Pack4xU8Clamp(e,t){return null}Pack2x16snorm(e,t){return null}Pack2x16unorm(e,t){return null}Pack2x16float(e,t){return null}Unpack4x8snorm(e,t){return null}Unpack4x8unorm(e,t){return null}Unpack4xI8(e,t){return null}Unpack4xU8(e,t){return null}Unpack2x16snorm(e,t){return null}Unpack2x16unorm(e,t){return null}Unpack2x16float(e,t){return null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return null}SubgroupExclusiveAdd(e,t){return null}SubgroupInclusiveAdd(e,t){return null}SubgroupAll(e,t){return null}SubgroupAnd(e,t){return null}SubgroupAny(e,t){return null}SubgroupBallot(e,t){return null}SubgroupBroadcast(e,t){return null}SubgroupBroadcastFirst(e,t){return null}SubgroupElect(e,t){return null}SubgroupMax(e,t){return null}SubgroupMin(e,t){return null}SubgroupMul(e,t){return null}SubgroupExclusiveMul(e,t){return null}SubgroupInclusiveMul(e,t){return null}SubgroupOr(e,t){return null}SubgroupShuffle(e,t){return null}SubgroupShuffleDown(e,t){return null}SubgroupShuffleUp(e,t){return null}SubgroupShuffleXor(e,t){return null}SubgroupXor(e,t){return null}QuadBroadcast(e,t){return null}QuadSwapDiagonal(e,t){return null}QuadSwapX(e,t){return null}QuadSwapY(e,t){return null}}const ma={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},_a={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class ya extends pa{constructor(e,t){var n;super(),this.ast=null!=e?e:[],this.reflection=new ca,this.reflection.updateAST(this.ast),this.context=null!==(n=null==t?void 0:t.clone())&&void 0!==n?n:new fa,this.builtins=new ga(this),this.typeInfo={bool:this.getTypeInfo(co.bool),i32:this.getTypeInfo(co.i32),u32:this.getTypeInfo(co.u32),f32:this.getTypeInfo(co.f32),f16:this.getTypeInfo(co.f16),vec2f:this.getTypeInfo(fo.vec2f),vec2u:this.getTypeInfo(fo.vec2u),vec2i:this.getTypeInfo(fo.vec2i),vec2h:this.getTypeInfo(fo.vec2h),vec3f:this.getTypeInfo(fo.vec3f),vec3u:this.getTypeInfo(fo.vec3u),vec3i:this.getTypeInfo(fo.vec3i),vec3h:this.getTypeInfo(fo.vec3h),vec4f:this.getTypeInfo(fo.vec4f),vec4u:this.getTypeInfo(fo.vec4u),vec4i:this.getTypeInfo(fo.vec4i),vec4h:this.getTypeInfo(fo.vec4h),mat2x2f:this.getTypeInfo(fo.mat2x2f),mat2x3f:this.getTypeInfo(fo.mat2x3f),mat2x4f:this.getTypeInfo(fo.mat2x4f),mat3x2f:this.getTypeInfo(fo.mat3x2f),mat3x3f:this.getTypeInfo(fo.mat3x3f),mat3x4f:this.getTypeInfo(fo.mat3x4f),mat4x2f:this.getTypeInfo(fo.mat4x2f),mat4x3f:this.getTypeInfo(fo.mat4x3f),mat4x4f:this.getTypeInfo(fo.mat4x4f)}}getVariableValue(e){var t,n;const s=null!==(n=null===(t=this.context.getVariable(e))||void 0===t?void 0:t.value)&&void 0!==n?n:null;if(null===s)return null;if(s instanceof jo)return s.value;if(s instanceof Vo)return Array.from(s.data);if(s instanceof zo)return Array.from(s.data);if(s instanceof Wo&&s.typeInfo instanceof ai){if("u32"===s.typeInfo.format.name)return Array.from(new Uint32Array(s.buffer,s.offset,s.typeInfo.count));if("i32"===s.typeInfo.format.name)return Array.from(new Int32Array(s.buffer,s.offset,s.typeInfo.count));if("f32"===s.typeInfo.format.name)return Array.from(new Float32Array(s.buffer,s.offset,s.typeInfo.count))}return null}execute(e){(e=null!=e?e:{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,n,s){const r=this.context.clone();(s=null!=s?s:{}).constants&&this._setOverrides(s.constants,r),this._execStatements(this.ast,r);const i=r.getFunction(e);if(!i)return;if("number"==typeof t)t=[t,1,1];else{if(0===t.length)return;1===t.length?t=[t[0],1,1]:2===t.length?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const o=t[0],a=t[1],l=t[2],c=this.getTypeInfo("vec3u");r.setVariable("@num_workgroups",new Vo(t,c));const u=this.reflection.getFunctionInfo(e);for(const h in n)for(const e in n[h]){const t=n[h][e];r.variables.forEach(n=>{var s;const r=n.node;if(null==r?void 0:r.attributes){let i=null,o=null;for(const e of r.attributes)"binding"===e.name?i=e.value:"group"===e.name&&(o=e.value);if(e==i&&h==o){let i=!1;for(const t of u.resources)if(t.name===n.name&&t.group===parseInt(h)&&t.binding===parseInt(e)){i=!0;break}if(i)if(void 0!==t.texture&&void 0!==t.descriptor){const e=new Ho(t.texture,this.getTypeInfo(r.type),t.descriptor,null!==(s=t.texture.view)&&void 0!==s?s:null);n.value=e}else void 0!==t.uniform?n.value=new Wo(t.uniform,this.getTypeInfo(r.type)):n.value=new Wo(t,this.getTypeInfo(r.type))}}})}for(let h=0;h<l;++h)for(let e=0;e<a;++e)for(let t=0;t<o;++t)r.setVariable("@workgroup_id",new Vo([t,e,h],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(i,[t,e,h],r)}execStatement(e,t){if(e instanceof to)return this.evalExpression(e.value,t);if(e instanceof ao){if(e.condition){const n=this.evalExpression(e.condition,t);if(!(n instanceof jo))throw new Error("Invalid break-if condition");if(!n.value)return null}return ya._breakObj}if(e instanceof lo)return ya._continueObj;if(e instanceof zi)this._let(e,t);else if(e instanceof Gi)this._var(e,t);else if(e instanceof Wi)this._const(e,t);else if(e instanceof Fi)this._function(e,t);else{if(e instanceof eo)return this._if(e,t);if(e instanceof Ji)return this._switch(e,t);if(e instanceof ji)return this._for(e,t);if(e instanceof Bi)return this._while(e,t);if(e instanceof Qi)return this._loop(e,t);if(e instanceof Ui){const n=t.clone();return n.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof Ki)this._assign(e,t);else if(e instanceof Yi)this._increment(e,t);else{if(e instanceof ho)return null;if(e instanceof Vi){const n=e.name;null===t.getVariable(n)&&t.setVariable(n,new jo(0,this.getTypeInfo("u32")))}else if(e instanceof Zi)this._call(e,t);else{if(e instanceof ro)return null;if(e instanceof io)return null}}}return null}evalExpression(e,t){return e instanceof Co?this._evalBinaryOp(e,t):e instanceof Eo?this._evalLiteral(e,t):e instanceof xo?this._evalVariable(e,t):e instanceof vo?this._evalCall(e,t):e instanceof bo?this._evalCreate(e,t):e instanceof wo?this._evalConst(e,t):e instanceof To?this._evalBitcast(e,t):e instanceof Ro?this._evalUnaryOp(e,t):null}getTypeInfo(e){var t;if(e instanceof co){const t=this.reflection.getTypeInfo(e);if(null!==t)return t}let n=null!==(t=this.typeInfo[e])&&void 0!==t?t:null;return null!==n||(n=this.reflection.getTypeInfoByName(e)),n}_setOverrides(e,t){for(const n in e){const s=e[n],r=this.reflection.getOverrideInfo(n);null!==r&&(null===r.type&&(r.type=this.getTypeInfo("u32")),"u32"===r.type.name||"i32"===r.type.name||"f32"===r.type.name||"f16"===r.type.name?t.setVariable(n,new jo(s,r.type)):"bool"===r.type.name?t.setVariable(n,new jo(s?1:0,r.type)):("vec2"===r.type.name||"vec3"===r.type.name||"vec4"===r.type.name||"vec2f"===r.type.name||"vec3f"===r.type.name||"vec4f"===r.type.name||"vec2i"===r.type.name||"vec3i"===r.type.name||"vec4i"===r.type.name||"vec2u"===r.type.name||"vec3u"===r.type.name||"vec4u"===r.type.name||"vec2h"===r.type.name||"vec3h"===r.type.name||"vec4h"===r.type.name)&&t.setVariable(n,new Vo(s,r.type)))}}_dispatchWorkgroup(e,t,n){const s=[1,1,1];for(const c of e.node.attributes)if("workgroup_size"===c.name){if(c.value.length>0){const e=n.getVariableValue(c.value[0]);s[0]=e instanceof jo?e.value:parseInt(c.value[0])}if(c.value.length>1){const e=n.getVariableValue(c.value[1]);s[1]=e instanceof jo?e.value:parseInt(c.value[1])}if(c.value.length>2){const e=n.getVariableValue(c.value[2]);s[2]=e instanceof jo?e.value:parseInt(c.value[2])}}const r=this.getTypeInfo("vec3u"),i=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new Vo(s,r));const o=s[0],a=s[1],l=s[2];for(let c=0,u=0;c<l;++c)for(let l=0;l<a;++l)for(let a=0;a<o;++a,++u){const o=[a,l,c],h=[a+t[0]*s[0],l+t[1]*s[1],c+t[2]*s[2]];n.setVariable("@local_invocation_id",new Vo(o,r)),n.setVariable("@global_invocation_id",new Vo(h,r)),n.setVariable("@local_invocation_index",new jo(u,i)),this._dispatchExec(e,n)}}_dispatchExec(e,t){for(const n of e.node.args)for(const e of n.attributes)if("builtin"===e.name){const s=`@${e.value}`,r=t.getVariable(s);void 0!==r&&t.variables.set(n.name,r)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof Ro;)e=e.right;return e instanceof xo?e.name:null}_execStatements(e,t){for(const n of e){if(n instanceof Array){const e=t.clone(),s=this._execStatements(n,e);if(s)return s;continue}const e=this.execStatement(n,t);if(e)return e}return null}_call(e,t){const n=t.clone();n.currentFunctionName=e.name;const s=t.getFunction(e.name);if(s){for(let t=0;t<s.node.args.length;++t){const r=s.node.args[t],i=this.evalExpression(e.args[t],n);n.setVariable(r.name,i,r)}this._execStatements(s.node.body,n)}else e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const n=this.getVariableName(e.variable,t),s=t.getVariable(n);s&&("++"===e.operator?s.value instanceof jo&&s.value.value++:"--"===e.operator&&s.value instanceof jo&&s.value.value--)}_getVariableData(e,t){if(e instanceof xo){const n=this.getVariableName(e,t),s=t.getVariable(n);return null===s?null:s.value.getSubData(this,e.postfix,t)}if(e instanceof Ro){if("*"===e.operator){const n=this._getVariableData(e.right,t);return n instanceof Uo?n.reference.getSubData(this,e.postfix,t):null}if("&"===e.operator){const n=this._getVariableData(e.right,t);return new Uo(n)}}return null}_assign(e,t){let n=null,s="<var>",r=null;if(e.variable instanceof Ro){const n=this._getVariableData(e.variable,t),s=this.evalExpression(e.value,t),r=e.operator;if("="===r){if(n instanceof jo||n instanceof Vo||n instanceof zo){if(s instanceof jo||s instanceof Vo||s instanceof zo&&n.data.length===s.data.length)return void n.data.set(s.data)}else if(n instanceof Wo&&s instanceof Wo&&n.buffer.byteLength-n.offset>=s.buffer.byteLength-s.offset)return void(n.buffer.byteLength%4==0?new Uint32Array(n.buffer,n.offset,n.typeInfo.size/4).set(new Uint32Array(s.buffer,s.offset,s.typeInfo.size/4)):new Uint8Array(n.buffer,n.offset,n.typeInfo.size).set(new Uint8Array(s.buffer,s.offset,s.typeInfo.size)));return null}if("+="===r)return(n instanceof jo||n instanceof Vo||n instanceof zo)&&(s instanceof jo||s instanceof Vo||s instanceof zo)?void n.data.set(s.data.map((e,t)=>n.data[t]+e)):void 0;if("-="===r)return(n instanceof jo||n instanceof Vo||n instanceof zo)&&(s instanceof jo||s instanceof Vo||s instanceof zo)?void n.data.set(s.data.map((e,t)=>n.data[t]-e)):void 0}if(e.variable instanceof Ro){if("*"===e.variable.operator){s=this.getVariableName(e.variable.right,t);const r=t.getVariable(s);if(!(r&&r.value instanceof Uo))return;n=r.value.reference;let i=e.variable.postfix;if(!i){let t=e.variable.right;for(;t instanceof Ro;){if(t.postfix){i=t.postfix;break}t=t.right}}i&&(n=n.getSubData(this,i,t))}}else{r=e.variable.postfix,s=this.getVariableName(e.variable,t);const i=t.getVariable(s);if(null===i)return;n=i.value}if(n instanceof Uo&&(n=n.reference),null===n)return;const i=this.evalExpression(e.value,t),o=e.operator;if("="!==o){const e=n.getSubData(this,r,t);if(e instanceof Vo&&i instanceof jo){const t=e.data,n=i.value;if("+="===o)for(let e=0;e<t.length;++e)t[e]+=n;else if("-="===o)for(let e=0;e<t.length;++e)t[e]-=n;else if("*="===o)for(let e=0;e<t.length;++e)t[e]*=n;else if("/="===o)for(let e=0;e<t.length;++e)t[e]/=n;else if("%="===o)for(let e=0;e<t.length;++e)t[e]%=n;else if("&="===o)for(let e=0;e<t.length;++e)t[e]&=n;else if("|="===o)for(let e=0;e<t.length;++e)t[e]|=n;else if("^="===o)for(let e=0;e<t.length;++e)t[e]^=n;else if("<<="===o)for(let e=0;e<t.length;++e)t[e]<<=n;else if(">>="===o)for(let e=0;e<t.length;++e)t[e]>>=n}else if(e instanceof Vo&&i instanceof Vo){const t=e.data,n=i.data;if(t.length!==n.length)return;if("+="===o)for(let e=0;e<t.length;++e)t[e]+=n[e];else if("-="===o)for(let e=0;e<t.length;++e)t[e]-=n[e];else if("*="===o)for(let e=0;e<t.length;++e)t[e]*=n[e];else if("/="===o)for(let e=0;e<t.length;++e)t[e]/=n[e];else if("%="===o)for(let e=0;e<t.length;++e)t[e]%=n[e];else if("&="===o)for(let e=0;e<t.length;++e)t[e]&=n[e];else if("|="===o)for(let e=0;e<t.length;++e)t[e]|=n[e];else if("^="===o)for(let e=0;e<t.length;++e)t[e]^=n[e];else if("<<="===o)for(let e=0;e<t.length;++e)t[e]<<=n[e];else if(">>="===o)for(let e=0;e<t.length;++e)t[e]>>=n[e]}else{if(!(e instanceof jo&&i instanceof jo))return;"+="===o?e.value+=i.value:"-="===o?e.value-=i.value:"*="===o?e.value*=i.value:"/="===o?e.value/=i.value:"%="===o?e.value%=i.value:"&="===o?e.value&=i.value:"|="===o?e.value|=i.value:"^="===o?e.value^=i.value:"<<="===o?e.value<<=i.value:">>="===o&&(e.value>>=i.value)}return void(n instanceof Wo&&n.setDataValue(this,e,r,t))}if(n instanceof Wo)n.setDataValue(this,i,r,t);else if(r){if(!(n instanceof Vo||n instanceof zo))return;if(r instanceof So){const e=this.evalExpression(r.index,t).value;if(n instanceof Vo){if(!(i instanceof jo))return;n.data[e]=i.value}else{if(!(n instanceof zo))return;{const e=this.evalExpression(r.index,t).value;if(e<0)return;if(!(i instanceof Vo))return;{const t=n.typeInfo.getTypeName();if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t){if(!(e<2&&2===i.data.length))return;n.data[2*e]=i.data[0],n.data[2*e+1]=i.data[1]}else if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t){if(!(e<2&&3===i.data.length))return;n.data[3*e]=i.data[0],n.data[3*e+1]=i.data[1],n.data[3*e+2]=i.data[2]}else if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t){if(!(e<2&&4===i.data.length))return;n.data[4*e]=i.data[0],n.data[4*e+1]=i.data[1],n.data[4*e+2]=i.data[2],n.data[4*e+3]=i.data[3]}else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t){if(!(e<3&&2===i.data.length))return;n.data[2*e]=i.data[0],n.data[2*e+1]=i.data[1]}else if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t){if(!(e<3&&3===i.data.length))return;n.data[3*e]=i.data[0],n.data[3*e+1]=i.data[1],n.data[3*e+2]=i.data[2]}else if("mat3x4"===t||"mat3x4f"===t||"mat3x4h"===t){if(!(e<3&&4===i.data.length))return;n.data[4*e]=i.data[0],n.data[4*e+1]=i.data[1],n.data[4*e+2]=i.data[2],n.data[4*e+3]=i.data[3]}else if("mat4x2"===t||"mat4x2f"===t||"mat4x2h"===t){if(!(e<4&&2===i.data.length))return;n.data[2*e]=i.data[0],n.data[2*e+1]=i.data[1]}else if("mat4x3"===t||"mat4x3f"===t||"mat4x3h"===t){if(!(e<4&&3===i.data.length))return;n.data[3*e]=i.data[0],n.data[3*e+1]=i.data[1],n.data[3*e+2]=i.data[2]}else{if("mat4x4"!==t&&"mat4x4f"!==t&&"mat4x4h"!==t)return;if(!(e<4&&4===i.data.length))return;n.data[4*e]=i.data[0],n.data[4*e+1]=i.data[1],n.data[4*e+2]=i.data[2],n.data[4*e+3]=i.data[3]}}}}}else if(r instanceof yo){const e=r.value;if(!(n instanceof Vo))return;if(i instanceof jo){if(e.length>1)return;if("x"===e)n.data[0]=i.value;else if("y"===e){if(n.data.length<2)return;n.data[1]=i.value}else if("z"===e){if(n.data.length<3)return;n.data[2]=i.value}else if("w"===e){if(n.data.length<4)return;n.data[3]=i.value}}else{if(!(i instanceof Vo))return;if(e.length!==i.data.length)return;for(let t=0;t<e.length;++t){const s=e[t];if("x"===s||"r"===s)n.data[0]=i.data[t];else if("y"===s||"g"===s){if(i.data.length<2)return;n.data[1]=i.data[t]}else if("z"===s||"b"===s){if(i.data.length<3)return;n.data[2]=i.data[t]}else{if("w"!==s&&"a"!==s)return;if(i.data.length<4)return;n.data[3]=i.data[t]}}}}}else n instanceof jo&&i instanceof jo?n.value=i.value:(n instanceof Vo&&i instanceof Vo||n instanceof zo&&i instanceof zo)&&n.data.set(i.data)}_function(e,t){const n=new da(e);t.functions.set(e.name,n)}_const(e,t){let n=null;null!==e.value&&(n=this.evalExpression(e.value,t)),t.createVariable(e.name,n,e)}_let(e,t){let n=null;if(null!==e.value){if(n=this.evalExpression(e.value,t),null===n)return;e.value instanceof Ro||(n=n.clone())}else{const s=e.type.name;if("f32"===s||"i32"===s||"u32"===s||"bool"===s||"f16"===s||"vec2"===s||"vec3"===s||"vec4"===s||"vec2f"===s||"vec3f"===s||"vec4f"===s||"vec2i"===s||"vec3i"===s||"vec4i"===s||"vec2u"===s||"vec3u"===s||"vec4u"===s||"vec2h"===s||"vec3h"===s||"vec4h"===s||"vec2b"===s||"vec3b"===s||"vec4b"===s||"mat2x2"===s||"mat2x3"===s||"mat2x4"===s||"mat3x2"===s||"mat3x3"===s||"mat3x4"===s||"mat4x2"===s||"mat4x3"===s||"mat4x4"===s||"mat2x2f"===s||"mat2x3f"===s||"mat2x4f"===s||"mat3x2f"===s||"mat3x3f"===s||"mat3x4f"===s||"mat4x2f"===s||"mat4x3f"===s||"mat4x4f"===s||"mat2x2h"===s||"mat2x3h"===s||"mat2x4h"===s||"mat3x2h"===s||"mat3x3h"===s||"mat3x4h"===s||"mat4x2h"===s||"mat4x3h"===s||"mat4x4h"===s||"array"===s){const s=new bo(e.type,[]);n=this._evalCreate(s,t)}}t.createVariable(e.name,n,e)}_var(e,t){let n=null;if(null!==e.value){if(n=this.evalExpression(e.value,t),null===n)return;e.value instanceof Ro||(n=n.clone())}else{if(null===e.type)return;const s=e.type.name;if("f32"===s||"i32"===s||"u32"===s||"bool"===s||"f16"===s||"vec2"===s||"vec3"===s||"vec4"===s||"vec2f"===s||"vec3f"===s||"vec4f"===s||"vec2i"===s||"vec3i"===s||"vec4i"===s||"vec2u"===s||"vec3u"===s||"vec4u"===s||"vec2h"===s||"vec3h"===s||"vec4h"===s||"vec2b"===s||"vec3b"===s||"vec4b"===s||"mat2x2"===s||"mat2x3"===s||"mat2x4"===s||"mat3x2"===s||"mat3x3"===s||"mat3x4"===s||"mat4x2"===s||"mat4x3"===s||"mat4x4"===s||"mat2x2f"===s||"mat2x3f"===s||"mat2x4f"===s||"mat3x2f"===s||"mat3x3f"===s||"mat3x4f"===s||"mat4x2f"===s||"mat4x3f"===s||"mat4x4f"===s||"mat2x2h"===s||"mat2x3h"===s||"mat2x4h"===s||"mat3x2h"===s||"mat3x3h"===s||"mat3x4h"===s||"mat4x2h"===s||"mat4x3h"===s||"mat4x4h"===s||e.type instanceof go||e.type instanceof ho||e.type instanceof fo){const s=new bo(e.type,[]);n=this._evalCreate(s,t)}}t.createVariable(e.name,n,e)}_switch(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof jo))return null;let s=null;for(const r of e.cases)if(r instanceof Io)for(const e of r.selectors){if(e instanceof ko){s=r;continue}const i=this.evalExpression(e,t);if(!(i instanceof jo))return null;if(i.value===n.value)return this._execStatements(r.body,t)}else r instanceof Mo&&(s=r);return s?this._execStatements(s.body,t):null}_if(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof jo))return null;if(n.value)return this._execStatements(e.body,t);for(const s of e.elseif){const e=this.evalExpression(s.condition,t);if(!(e instanceof jo))return null;if(e.value)return this._execStatements(s.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof jo?e.value:0}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===ya._breakObj)break;if(null!==n&&n!==ya._continueObj)return n;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const n=this._execStatements(e.body,t);if(n===ya._breakObj)break;if(n===ya._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===ya._breakObj)break}else if(null!==n)return n}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===ya._breakObj)break;if(n!==ya._continueObj&&null!==n)return n}return null}_evalBitcast(e,t){const n=this.evalExpression(e.value,t),s=e.type;if(n instanceof jo){const e=oa(n.value,n.typeInfo.name,s.name);return new jo(e,this.getTypeInfo(s))}if(n instanceof Vo){const e=n.typeInfo.getTypeName();let t="";if(e.endsWith("f"))t="f32";else if(e.endsWith("i"))t="i32";else if(e.endsWith("u"))t="u32";else if(e.endsWith("b"))t="bool";else{if(!e.endsWith("h"))return null;t="f16"}const r=s.getTypeName();let i="";if(r.endsWith("f"))i="f32";else if(r.endsWith("i"))i="i32";else if(r.endsWith("u"))i="u32";else if(r.endsWith("b"))i="bool";else{if(!r.endsWith("h"))return null;i="f16"}const o=function(e,t,n){if(t===n)return e;const s=new Array(e.length);for(let r=0;r<e.length;r++)s[r]=oa(e[r],t,n);return s}(Array.from(n.data),t,i);return new Vo(o,this.getTypeInfo(s))}return null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var n;if(e instanceof bo){if(null===e.type)return Bo.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}e instanceof bo?e.type.name:e.name;const s=e instanceof bo?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(null===s)return null;if(0===s.size)return null;const r=new Wo(new ArrayBuffer(s.size),s,0);if(s instanceof oi){if(e.args)for(let i=0;i<e.args.length;++i){const n=s.members[i],o=e.args[i],a=this.evalExpression(o,t);r.setData(this,a,n.type,n.offset,t)}}else if(s instanceof ai){let i=0;if(e.args)for(let o=0;o<e.args.length;++o){const a=e.args[o],l=this.evalExpression(a,t);null===s.format&&("x32"===(null===(n=l.typeInfo)||void 0===n?void 0:n.name)?s.format=this.getTypeInfo("i32"):s.format=l.typeInfo),r.setData(this,l,s.format,i,t),i+=s.stride}}return e instanceof bo?r.getSubData(this,e.postfix,t):r}_evalLiteral(e,t){const n=this.getTypeInfo(e.type),s=n.name;return"x32"===s||"u32"===s||"f32"===s||"f16"===s||"i32"===s||"bool"===s?new jo(e.scalarValue,n):"vec2"===s||"vec3"===s||"vec4"===s||"vec2f"===s||"vec3f"===s||"vec4f"===s||"vec2h"===s||"vec3h"===s||"vec4h"===s||"vec2i"===s||"vec3i"===s||"vec4i"===s||"vec2u"===s||"vec3u"===s||"vec4u"===s?this._callConstructorVec(e,t):"mat2x2"===s||"mat2x3"===s||"mat2x4"===s||"mat3x2"===s||"mat3x3"===s||"mat3x4"===s||"mat4x2"===s||"mat4x3"===s||"mat4x4"===s||"mat2x2f"===s||"mat2x3f"===s||"mat2x4f"===s||"mat3x2f"===s||"mat3x3f"===s||"mat3x4f"===s||"mat4x2f"===s||"mat4x3f"===s||"mat4x4f"===s||"mat2x2h"===s||"mat2x3h"===s||"mat2x4h"===s||"mat3x2h"===s||"mat3x3h"===s||"mat3x4h"===s||"mat4x2h"===s||"mat4x3h"===s||"mat4x4h"===s?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const n=t.getVariableValue(e.name);return null===n?n:n.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if("f32"===t.name)return t;for(let n=1;n<e.length;++n){const s=ya._priority.get(t.name);ya._priority.get(e[n].name)<s&&(t=e[n])}return"x32"===t.name?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const n=this.evalExpression(e.right,t);if("&"===e.operator)return new Uo(n);if("*"===e.operator)return n instanceof Uo?n.reference.getSubData(this,e.postfix,t):null;const s=n instanceof jo?n.value:n instanceof Vo?Array.from(n.data):null;switch(e.operator){case"+":{if(Ko(s)){const e=s.map((e,t)=>+e);return new Vo(e,n.typeInfo)}const e=s,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new jo(+e,t)}case"-":{if(Ko(s)){const e=s.map((e,t)=>-e);return new Vo(e,n.typeInfo)}const e=s,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new jo(-e,t)}case"!":{if(Ko(s)){const e=s.map((e,t)=>e?0:1);return new Vo(e,n.typeInfo)}const e=s,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new jo(e?0:1,t)}case"~":{if(Ko(s)){const e=s.map((e,t)=>~e);return new Vo(e,n.typeInfo)}const e=s,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new jo(~e,t)}}return null}_evalBinaryOp(e,t){const n=this.evalExpression(e.left,t),s=this.evalExpression(e.right,t),r=n instanceof jo?n.value:n instanceof Vo||n instanceof zo?Array.from(n.data):null,i=s instanceof jo?s.value:s instanceof Vo||s instanceof zo?Array.from(s.data):null;switch(e.operator){case"+":{if(Ko(r)&&Ko(i)){const e=r,t=i;if(e.length!==t.length)return null;const s=e.map((e,n)=>e+t[n]);return new Vo(s,n.typeInfo)}if(Ko(r)){const e=i,t=r.map((t,n)=>t+e);return new Vo(t,n.typeInfo)}if(Ko(i)){const e=r,t=i.map((t,n)=>e+t);return new Vo(t,s.typeInfo)}const e=r,t=i,o=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new jo(e+t,o)}case"-":{if(Ko(r)&&Ko(i)){const e=r,t=i;if(e.length!==t.length)return null;const s=e.map((e,n)=>e-t[n]);return new Vo(s,n.typeInfo)}if(Ko(r)){const e=i,t=r.map((t,n)=>t-e);return new Vo(t,n.typeInfo)}if(Ko(i)){const e=r,t=i.map((t,n)=>e-t);return new Vo(t,s.typeInfo)}const e=r,t=i,o=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new jo(e-t,o)}case"*":{if(Ko(r)&&Ko(i)){const e=r,t=i;if(n instanceof zo&&s instanceof zo){const r=function(e,t,n,s){if(void 0===_a[t.name]||void 0===_a[s.name])return null;const r=_a[t.name][0],i=_a[t.name][1],o=_a[s.name][0];if(r!==_a[s.name][1])return null;const a=new Array(o*i);for(let l=0;l<i;l++)for(let t=0;t<o;t++){let s=0;for(let o=0;o<r;o++)s+=e[o*i+l]*n[t*r+o];a[l*o+t]=s}return a}(e,n.typeInfo,t,s.typeInfo);if(null===r)return null;const i=_a[s.typeInfo.name][0],o=_a[n.typeInfo.name][1],a=this.getTypeInfo(`mat${i}x${o}f`);return new zo(r,a)}if(n instanceof zo&&s instanceof Vo){const r=function(e,t,n,s){if(void 0===_a[t.name]||void 0===ma[s.name])return null;const r=_a[t.name][0],i=_a[t.name][1];if(r!==n.length)return null;const o=new Array(i);for(let a=0;a<i;a++){let t=0;for(let s=0;s<r;s++)t+=e[s*i+a]*n[s];o[a]=t}return o}(e,n.typeInfo,t,s.typeInfo);return null===r?null:new Vo(r,s.typeInfo)}if(n instanceof Vo&&s instanceof zo){const r=function(e,t,n,s){if(void 0===ma[t.name]||void 0===_a[s.name])return null;const r=_a[s.name][0],i=_a[s.name][1];if(i!==e.length)return null;const o=[];for(let a=0;a<r;a++){let t=0;for(let s=0;s<i;s++)t+=e[s]*n[s*r+a];o[a]=t}return o}(e,n.typeInfo,t,s.typeInfo);return null===r?null:new Vo(r,n.typeInfo)}{if(e.length!==t.length)return null;const s=e.map((e,n)=>e*t[n]);return new Vo(s,n.typeInfo)}}if(Ko(r)){const e=i,t=r.map((t,n)=>t*e);return n instanceof zo?new zo(t,n.typeInfo):new Vo(t,n.typeInfo)}if(Ko(i)){const e=r,t=i.map((t,n)=>e*t);return s instanceof zo?new zo(t,s.typeInfo):new Vo(t,s.typeInfo)}const e=r,t=i,o=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new jo(e*t,o)}case"%":{if(Ko(r)&&Ko(i)){const e=r,t=i;if(e.length!==t.length)return null;const s=e.map((e,n)=>e%t[n]);return new Vo(s,n.typeInfo)}if(Ko(r)){const e=i,t=r.map((t,n)=>t%e);return new Vo(t,n.typeInfo)}if(Ko(i)){const e=r,t=i.map((t,n)=>e%t);return new Vo(t,s.typeInfo)}const e=r,t=i,o=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new jo(e%t,o)}case"/":{if(Ko(r)&&Ko(i)){const e=r,t=i;if(e.length!==t.length)return null;const s=e.map((e,n)=>e/t[n]);return new Vo(s,n.typeInfo)}if(Ko(r)){const e=i,t=r.map((t,n)=>t/e);return new Vo(t,n.typeInfo)}if(Ko(i)){const e=r,t=i.map((t,n)=>e/t);return new Vo(t,s.typeInfo)}const e=r,t=i,o=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new jo(e/t,o)}case"&":{if(Ko(r)&&Ko(i)){const e=r,t=i;if(e.length!==t.length)return null;const s=e.map((e,n)=>e&t[n]);return new Vo(s,n.typeInfo)}if(Ko(r)){const e=i,t=r.map((t,n)=>t&e);return new Vo(t,n.typeInfo)}if(Ko(i)){const e=r,t=i.map((t,n)=>e&t);return new Vo(t,s.typeInfo)}const e=r,t=i,o=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new jo(e&t,o)}case"|":{if(Ko(r)&&Ko(i)){const e=r,t=i;if(e.length!==t.length)return null;const s=e.map((e,n)=>e|t[n]);return new Vo(s,n.typeInfo)}if(Ko(r)){const e=i,t=r.map((t,n)=>t|e);return new Vo(t,n.typeInfo)}if(Ko(i)){const e=r,t=i.map((t,n)=>e|t);return new Vo(t,s.typeInfo)}const e=r,t=i,o=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new jo(e|t,o)}case"^":{if(Ko(r)&&Ko(i)){const e=r,t=i;if(e.length!==t.length)return null;const s=e.map((e,n)=>e^t[n]);return new Vo(s,n.typeInfo)}if(Ko(r)){const e=i,t=r.map((t,n)=>t^e);return new Vo(t,n.typeInfo)}if(Ko(i)){const e=r,t=i.map((t,n)=>e^t);return new Vo(t,s.typeInfo)}const e=r,t=i,o=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new jo(e^t,o)}case"<<":{if(Ko(r)&&Ko(i)){const e=r,t=i;if(e.length!==t.length)return null;const s=e.map((e,n)=>e<<t[n]);return new Vo(s,n.typeInfo)}if(Ko(r)){const e=i,t=r.map((t,n)=>t<<e);return new Vo(t,n.typeInfo)}if(Ko(i)){const e=r,t=i.map((t,n)=>e<<t);return new Vo(t,s.typeInfo)}const e=r,t=i,o=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new jo(e<<t,o)}case">>":{if(Ko(r)&&Ko(i)){const e=r,t=i;if(e.length!==t.length)return null;const s=e.map((e,n)=>e>>t[n]);return new Vo(s,n.typeInfo)}if(Ko(r)){const e=i,t=r.map((t,n)=>t>>e);return new Vo(t,n.typeInfo)}if(Ko(i)){const e=r,t=i.map((t,n)=>e>>t);return new Vo(t,s.typeInfo)}const e=r,t=i,o=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new jo(e>>t,o)}case">":if(Ko(r)&&Ko(i)){const e=r,t=i;if(e.length!==t.length)return null;const s=e.map((e,n)=>e>t[n]?1:0);return new Vo(s,n.typeInfo)}if(Ko(r)){const e=i,t=r.map((t,n)=>t>e?1:0);return new Vo(t,n.typeInfo)}if(Ko(i)){const e=r,t=i.map((t,n)=>e>t?1:0);return new Vo(t,s.typeInfo)}return new jo(r>i?1:0,this.getTypeInfo("bool"));case"<":if(Ko(r)&&Ko(i)){const e=r,t=i;if(e.length!==t.length)return null;const s=e.map((e,n)=>e<t[n]?1:0);return new Vo(s,n.typeInfo)}if(Ko(r)){const e=i,t=r.map((t,n)=>t<e?1:0);return new Vo(t,n.typeInfo)}if(Ko(i)){const e=r,t=i.map((t,n)=>e<t?1:0);return new Vo(t,s.typeInfo)}return new jo(r<i?1:0,this.getTypeInfo("bool"));case"==":if(Ko(r)&&Ko(i)){const e=r,t=i;if(e.length!==t.length)return null;const s=e.map((e,n)=>e===t[n]?1:0);return new Vo(s,n.typeInfo)}if(Ko(r)){const e=i,t=r.map((t,n)=>t==e?1:0);return new Vo(t,n.typeInfo)}if(Ko(i)){const e=r,t=i.map((t,n)=>e==t?1:0);return new Vo(t,s.typeInfo)}return new jo(r===i?1:0,this.getTypeInfo("bool"));case"!=":if(Ko(r)&&Ko(i)){const e=r,t=i;if(e.length!==t.length)return null;const s=e.map((e,n)=>e!==t[n]?1:0);return new Vo(s,n.typeInfo)}if(Ko(r)){const e=i,t=r.map((t,n)=>t!==e?1:0);return new Vo(t,n.typeInfo)}if(Ko(i)){const e=r,t=i.map((t,n)=>e!==t?1:0);return new Vo(t,s.typeInfo)}return new jo(r!==i?1:0,this.getTypeInfo("bool"));case">=":if(Ko(r)&&Ko(i)){const e=r,t=i;if(e.length!==t.length)return null;const s=e.map((e,n)=>e>=t[n]?1:0);return new Vo(s,n.typeInfo)}if(Ko(r)){const e=i,t=r.map((t,n)=>t>=e?1:0);return new Vo(t,n.typeInfo)}if(Ko(i)){const e=r,t=i.map((t,n)=>e>=t?1:0);return new Vo(t,s.typeInfo)}return new jo(r>=i?1:0,this.getTypeInfo("bool"));case"<=":if(Ko(r)&&Ko(i)){const e=r,t=i;if(e.length!==t.length)return null;const s=e.map((e,n)=>e<=t[n]?1:0);return new Vo(s,n.typeInfo)}if(Ko(r)){const e=i,t=r.map((t,n)=>t<=e?1:0);return new Vo(t,n.typeInfo)}if(Ko(i)){const e=r,t=i.map((t,n)=>e<=t?1:0);return new Vo(t,s.typeInfo)}return new jo(r<=i?1:0,this.getTypeInfo("bool"));case"&&":if(Ko(r)&&Ko(i)){const e=r,t=i;if(e.length!==t.length)return null;const s=e.map((e,n)=>e&&t[n]?1:0);return new Vo(s,n.typeInfo)}if(Ko(r)){const e=i,t=r.map((t,n)=>t&&e?1:0);return new Vo(t,n.typeInfo)}if(Ko(i)){const e=r,t=i.map((t,n)=>e&&t?1:0);return new Vo(t,s.typeInfo)}return new jo(r&&i?1:0,this.getTypeInfo("bool"));case"||":if(Ko(r)&&Ko(i)){const e=r,t=i;if(e.length!==t.length)return null;const s=e.map((e,n)=>e||t[n]?1:0);return new Vo(s,n.typeInfo)}if(Ko(r)){const e=i,t=r.map((t,n)=>t||e?1:0);return new Vo(t,n.typeInfo)}if(Ko(i)){const e=r,t=i.map((t,n)=>e||t?1:0);return new Vo(t,s.typeInfo)}return new jo(r||i?1:0,this.getTypeInfo("bool"))}return null}_evalCall(e,t){if(null!==e.cachedReturnValue)return e.cachedReturnValue;const n=t.clone();n.currentFunctionName=e.name;const s=t.getFunction(e.name);if(!s)return e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)?this._evalCreate(e,t):null;for(let r=0;r<s.node.args.length;++r){const t=s.node.args[r],i=this.evalExpression(e.args[r],n);n.createVariable(t.name,i,t)}return this._execStatements(s.node.body,n)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const n=t.getFunction(e.name);if(n){const s=t.clone();for(let t=0;t<n.node.args.length;++t){const r=n.node.args[t],i=this.evalExpression(e.args[t],s);s.setVariable(r.name,i,r)}return this._execStatements(n.node.body,s)}return null}_callConstructorValue(e,t){if(!e.args||0===e.args.length)return new jo(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],t);return n.typeInfo=this.getTypeInfo(e.type),n.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const n=this.getTypeInfo(e.type),s=e.type.getTypeName(),r=ma[s];if(void 0===r)return null;const i=[];if(e instanceof Eo)if(e.isVector){const t=e.vectorValue;for(const e of t)i.push(e)}else i.push(e.scalarValue);else if(e.args)for(const o of e.args){const e=this.evalExpression(o,t);if(e instanceof Vo){const t=e.data;for(let e=0;e<t.length;++e){let n=t[e];i.push(n)}}else if(e instanceof jo){let t=e.value;i.push(t)}}if(e.type instanceof fo&&null===e.type.format&&(e.type.format=fo.f32),0===i.length){const s=new Array(r).fill(0);return new Vo(s,n).getSubData(this,e.postfix,t)}if(1===i.length)for(;i.length<r;)i.push(i[0]);return i.length<r?null:new Vo(i.length>r?i.slice(0,r):i,n).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const n=this.getTypeInfo(e.type),s=e.type.getTypeName(),r=_a[s];if(void 0===r)return null;const i=[];if(e instanceof Eo)if(e.isVector){const t=e.vectorValue;for(const e of t)i.push(e)}else i.push(e.scalarValue);else if(e.args)for(const o of e.args){const e=this.evalExpression(o,t);e instanceof Vo?i.push(...e.data):e instanceof jo?i.push(e.value):e instanceof zo&&i.push(...e.data)}if(n instanceof ci&&null===n.format&&(n.format=this.getTypeInfo("f32")),0===i.length){const s=new Array(r[2]).fill(0);return new zo(s,n).getSubData(this,e.postfix,t)}return i.length!==r[2]?null:new zo(i,n).getSubData(this,e.postfix,t)}}ya._breakObj=new Do(new ri("BREAK",null),null),ya._continueObj=new Do(new ri("CONTINUE",null),null),ya._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class ba{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class va{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new ba,this._exec=new ya,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const e=this._global_decl_or_directive();if(!e)break;t.push(e)}if(this._deferArrayCountEval.length>0){for(const e of this._deferArrayCountEval){const t=e.arrayType,s=e.countNode;if(s instanceof xo){const e=s.name,r=this._context.constants.get(e);if(r)try{const e=r.constEvaluate(this._exec);t.count=e}catch(n){}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const s of t)s.search(e=>{e instanceof Oo||e instanceof po?e.type=this._forwardType(e.type):e instanceof go?e.format=this._forwardType(e.format):e instanceof Gi||e instanceof zi||e instanceof Wi?e.type=this._forwardType(e.type):e instanceof Fi?e.returnType=this._forwardType(e.returnType):e instanceof Lo&&(e.type=this._forwardType(e.type))});return t}_forwardType(e){if(e instanceof uo){const t=this._getType(e.name);if(t)return t}else e instanceof po?e.type=this._forwardType(e.type):e instanceof go&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if("string"==typeof e){const t=new Yo(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=null!=t?t:this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==Xo.eof}_match(e){if(e instanceof $o)return!!this._check(e)&&(this._advance(),!0);for(let t=0,n=e.length;t<n;++t){const n=e[t];if(this._check(n))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const n=t.type;let s=!1;for(const t of e){if(n===t)return!0;t===Xo.tokens.name&&(s=!0)}if(s){const e=Xo.tokens.name.rule.exec(t.lexeme);if(e&&0==e.index&&e[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===Xo.tokens.name){const e=Xo.tokens.name.rule.exec(t.lexeme);return e&&0==e.index&&e[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=null!==(t=null===(e=this._peek())||void 0===e?void 0:e.line)&&void 0!==t?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(Xo.tokens.semicolon)&&!this._isAtEnd(););if(this._match(Xo.keywords.alias)){const e=this._type_alias();return this._consume(Xo.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(Xo.keywords.diagnostic)){const e=this._diagnostic();return this._consume(Xo.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(Xo.keywords.requires)){const e=this._requires_directive();return this._consume(Xo.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(Xo.keywords.enable)){const e=this._enable_directive();return this._consume(Xo.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}const e=this._attribute();if(this._check(Xo.keywords.var)){const t=this._global_variable_decl();return null!=t&&(t.attributes=e),this._consume(Xo.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Xo.keywords.override)){const t=this._override_variable_decl();return null!=t&&(t.attributes=e),this._consume(Xo.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Xo.keywords.let)){const t=this._global_let_decl();return null!=t&&(t.attributes=e),this._consume(Xo.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Xo.keywords.const)){const t=this._global_const_decl();return null!=t&&(t.attributes=e),this._consume(Xo.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Xo.keywords.struct)){const t=this._struct_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(Xo.keywords.fn)){const t=this._function_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(Xo.keywords.fn))return null;const e=this._currentLine,t=this._consume(Xo.tokens.ident,"Expected function name.").toString();this._consume(Xo.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(Xo.tokens.paren_right))do{if(this._check(Xo.tokens.paren_right))break;const e=this._attribute(),t=this._consume(Xo.tokens.name,"Expected argument name.").toString();this._consume(Xo.tokens.colon,"Expected ':' for argument type.");const s=this._attribute(),r=this._type_decl();null!=r&&(r.attributes=s,n.push(this._updateNode(new Lo(t,r,e))))}while(this._match(Xo.tokens.comma));this._consume(Xo.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(Xo.tokens.arrow)){const e=this._attribute();s=this._type_decl(),null!=s&&(s.attributes=e)}const r=this._compound_statement(),i=this._currentLine;return this._updateNode(new Fi(t,n,s,r,e,i),e)}_compound_statement(){const e=[];for(this._consume(Xo.tokens.brace_left,"Expected '{' for block.");!this._check(Xo.tokens.brace_right);){const t=this._statement();null!==t&&e.push(t)}return this._consume(Xo.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(Xo.tokens.semicolon)&&!this._isAtEnd(););if(this._check(Xo.tokens.attr)&&this._attribute(),this._check(Xo.keywords.if))return this._if_statement();if(this._check(Xo.keywords.switch))return this._switch_statement();if(this._check(Xo.keywords.loop))return this._loop_statement();if(this._check(Xo.keywords.for))return this._for_statement();if(this._check(Xo.keywords.while))return this._while_statement();if(this._check(Xo.keywords.continuing))return this._continuing_statement();if(this._check(Xo.keywords.static_assert))return this._static_assert_statement();if(this._check(Xo.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(Xo.keywords.return))e=this._return_statement();else if(this._check([Xo.keywords.var,Xo.keywords.let,Xo.keywords.const]))e=this._variable_statement();else if(this._match(Xo.keywords.discard))e=this._updateNode(new oo);else if(this._match(Xo.keywords.break)){const t=this._updateNode(new ao);if(this._currentLoop.length>0){const e=this._currentLoop[this._currentLoop.length-1];t.loopId=e.id}e=t,this._check(Xo.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(Xo.keywords.continue)){const t=this._updateNode(new lo);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const e=this._currentLoop[this._currentLoop.length-1];t.loopId=e.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return null!=e&&this._consume(Xo.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(Xo.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new Di(t),e)}_while_statement(){if(!this._match(Xo.keywords.while))return null;const e=this._updateNode(new Bi(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Xo.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(Xo.keywords.continuing))return null;const t=this._currentLine,n=this._compound_statement();return this._updateNode(new Ui(n,e),t)}_for_statement(){if(!this._match(Xo.keywords.for))return null;this._consume(Xo.tokens.paren_left,"Expected '('.");const e=this._updateNode(new ji(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(Xo.tokens.semicolon)?null:this._for_init(),this._consume(Xo.tokens.semicolon,"Expected ';'."),e.condition=this._check(Xo.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(Xo.tokens.semicolon,"Expected ';'."),e.increment=this._check(Xo.tokens.paren_right)?null:this._for_increment(),this._consume(Xo.tokens.paren_right,"Expected ')'."),this._check(Xo.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(Xo.keywords.var)){const e=this._variable_decl();if(null===e)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(Xo.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new Gi(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(Xo.keywords.let)){const e=this._currentLine,t=this._consume(Xo.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(Xo.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}this._consume(Xo.tokens.equal,"Expected '=' for let.");const s=this._short_circuit_or_expression();return this._updateNode(new zi(t,n,null,null,s),e)}if(this._match(Xo.keywords.const)){const e=this._currentLine,t=this._consume(Xo.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(Xo.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}this._consume(Xo.tokens.equal,"Expected '=' for const.");const s=this._short_circuit_or_expression();return null===n&&s instanceof Eo&&(n=s.type),this._updateNode(new Wi(t,n,null,null,s),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(null==t)return null;if(!this._check(Xo.increment_operators))return this._current=e,null;const n=this._consume(Xo.increment_operators,"Expected increment operator");return this._updateNode(new Yi(n.type===Xo.tokens.plus_plus?Hi.increment:Hi.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(Xo.tokens.brace_right))return null;let n=this._match(Xo.tokens.underscore);if(n||(e=this._unary_expression()),!n&&null==e)return null;const s=this._consume(Xo.assignment_operators,"Expected assignment operator."),r=this._short_circuit_or_expression();return this._updateNode(new Ki($i.parse(s.lexeme),e,r),t)}_func_call_statement(){if(!this._check(Xo.tokens.ident))return null;const e=this._currentLine,t=this._current,n=this._consume(Xo.tokens.ident,"Expected function name."),s=this._argument_expression_list();return null===s?(this._current=t,null):this._updateNode(new Zi(n.lexeme,s),e)}_loop_statement(){if(!this._match(Xo.keywords.loop))return null;this._check(Xo.tokens.attr)&&this._attribute(),this._consume(Xo.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new Qi([],null));this._currentLoop.push(e);let t=this._statement();for(;null!==t;){if(Array.isArray(t))for(let n of t)e.body.push(n);else e.body.push(t);if(t instanceof Ui){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(Xo.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(Xo.keywords.switch))return null;const e=this._updateNode(new Ji(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Xo.tokens.attr)&&this._attribute(),this._consume(Xo.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),null==e.cases||0==e.cases.length)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(Xo.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([Xo.keywords.default,Xo.keywords.case]);){if(this._match(Xo.keywords.case)){const n=this._case_selectors();for(const e of n)if(e instanceof ko){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(Xo.tokens.colon),this._check(Xo.tokens.attr)&&this._attribute(),this._consume(Xo.tokens.brace_left,"Exected '{' for switch case.");const s=this._case_body();this._consume(Xo.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new Io(n,s)))}if(this._match(Xo.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(Xo.tokens.colon),this._check(Xo.tokens.attr)&&this._attribute(),this._consume(Xo.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(Xo.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new Mo(n)))}}return e}_case_selectors(){const e=[];for(this._match(Xo.keywords.default)?e.push(this._updateNode(new ko)):e.push(this._shift_expression());this._match(Xo.tokens.comma);)this._match(Xo.keywords.default)?e.push(this._updateNode(new ko)):e.push(this._shift_expression());return e}_case_body(){if(this._match(Xo.keywords.fallthrough))return this._consume(Xo.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(null==e)return[];e instanceof Array||(e=[e]);const t=this._case_body();return 0==t.length?e:[...e,t[0]]}_if_statement(){if(!this._match(Xo.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(Xo.tokens.attr)&&this._attribute();const n=this._compound_statement();let s=[];this._match_elseif()&&(this._check(Xo.tokens.attr)&&this._attribute(),s=this._elseif_statement(s));let r=null;return this._match(Xo.keywords.else)&&(this._check(Xo.tokens.attr)&&this._attribute(),r=this._compound_statement()),this._updateNode(new eo(t,n,s,r),e)}_match_elseif(){return this._tokens[this._current].type===Xo.keywords.else&&this._tokens[this._current+1].type===Xo.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new No(t,n))),this._match_elseif()&&(this._check(Xo.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(Xo.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new to(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(Xo.tokens.or_or);)e=this._updateNode(new Co(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(Xo.tokens.and_and);)e=this._updateNode(new Co(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(Xo.tokens.or);)e=this._updateNode(new Co(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(Xo.tokens.xor);)e=this._updateNode(new Co(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(Xo.tokens.and);)e=this._updateNode(new Co(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([Xo.tokens.equal_equal,Xo.tokens.not_equal])?this._updateNode(new Co(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([Xo.tokens.less_than,Xo.tokens.greater_than,Xo.tokens.less_than_equal,Xo.tokens.greater_than_equal]);)e=this._updateNode(new Co(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([Xo.tokens.shift_left,Xo.tokens.shift_right]);)e=this._updateNode(new Co(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([Xo.tokens.plus,Xo.tokens.minus]);)e=this._updateNode(new Co(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([Xo.tokens.star,Xo.tokens.forward_slash,Xo.tokens.modulo]);)e=this._updateNode(new Co(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([Xo.tokens.minus,Xo.tokens.bang,Xo.tokens.tilde,Xo.tokens.star,Xo.tokens.and])?this._updateNode(new Ro(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(Xo.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(Xo.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new So(e)),n=this._postfix_expression();return n&&(t.postfix=n),t}if(this._match(Xo.tokens.period)){const e=this._consume(Xo.tokens.name,"Expected member name."),t=this._postfix_expression(),n=this._updateNode(new yo(e.lexeme));return t&&(n.postfix=t),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(null!==t)return t;switch(e){case"void":return co.void;case"bool":return co.bool;case"i32":return co.i32;case"u32":return co.u32;case"f32":return co.f32;case"f16":return co.f16;case"vec2f":return fo.vec2f;case"vec3f":return fo.vec3f;case"vec4f":return fo.vec4f;case"vec2i":return fo.vec2i;case"vec3i":return fo.vec3i;case"vec4i":return fo.vec4i;case"vec2u":return fo.vec2u;case"vec3u":return fo.vec3u;case"vec4u":return fo.vec4u;case"vec2h":return fo.vec2h;case"vec3h":return fo.vec3h;case"vec4h":return fo.vec4h;case"mat2x2f":return fo.mat2x2f;case"mat2x3f":return fo.mat2x3f;case"mat2x4f":return fo.mat2x4f;case"mat3x2f":return fo.mat3x2f;case"mat3x3f":return fo.mat3x3f;case"mat3x4f":return fo.mat3x4f;case"mat4x2f":return fo.mat4x2f;case"mat4x3f":return fo.mat4x3f;case"mat4x4f":return fo.mat4x4f;case"mat2x2h":return fo.mat2x2h;case"mat2x3h":return fo.mat2x3h;case"mat2x4h":return fo.mat2x4h;case"mat3x2h":return fo.mat3x2h;case"mat3x3h":return fo.mat3x3h;case"mat3x4h":return fo.mat3x4h;case"mat4x2h":return fo.mat4x2h;case"mat4x3h":return fo.mat4x3h;case"mat4x4h":return fo.mat4x4h;case"mat2x2i":return fo.mat2x2i;case"mat2x3i":return fo.mat2x3i;case"mat2x4i":return fo.mat2x4i;case"mat3x2i":return fo.mat3x2i;case"mat3x3i":return fo.mat3x3i;case"mat3x4i":return fo.mat3x4i;case"mat4x2i":return fo.mat4x2i;case"mat4x3i":return fo.mat4x3i;case"mat4x4i":return fo.mat4x4i;case"mat2x2u":return fo.mat2x2u;case"mat2x3u":return fo.mat2x3u;case"mat2x4u":return fo.mat2x4u;case"mat3x2u":return fo.mat3x2u;case"mat3x3u":return fo.mat3x3u;case"mat3x4u":return fo.mat3x4u;case"mat4x2u":return fo.mat4x2u;case"mat4x3u":return fo.mat4x3u;case"mat4x4u":return fo.mat4x4u}return null}_validateTypeRange(e,t){if("i32"===t.name){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if("u32"===t.name&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(Xo.tokens.ident)){const e=this._previous().toString();if(this._check(Xo.tokens.paren_left)){const t=this._argument_expression_list(),n=this._getType(e);return null!==n?this._updateNode(new bo(n,t)):this._updateNode(new vo(e,t))}if(this._context.constants.has(e)){const t=this._context.constants.get(e);return this._updateNode(new wo(e,t.value))}return this._updateNode(new xo(e))}if(this._match(Xo.tokens.int_literal)){const e=this._previous().toString();let t=e.endsWith("i")||e.endsWith("i")?co.i32:e.endsWith("u")||e.endsWith("U")?co.u32:co.x32;const n=parseInt(e);return this._validateTypeRange(n,t),this._updateNode(new Eo(new jo(n,this._exec.getTypeInfo(t)),t))}if(this._match(Xo.tokens.uint_literal)){const e=parseInt(this._previous().toString());return this._validateTypeRange(e,co.u32),this._updateNode(new Eo(new jo(e,this._exec.getTypeInfo(co.u32)),co.u32))}if(this._match([Xo.tokens.decimal_float_literal,Xo.tokens.hex_float_literal])){let e=this._previous().toString(),t=e.endsWith("h");t&&(e=e.substring(0,e.length-1));const n=parseFloat(e);this._validateTypeRange(n,t?co.f16:co.f32);const s=t?co.f16:co.f32;return this._updateNode(new Eo(new jo(n,this._exec.getTypeInfo(s)),s))}if(this._match([Xo.keywords.true,Xo.keywords.false])){let e=this._previous().toString()===Xo.keywords.true.rule;return this._updateNode(new Eo(new jo(e?1:0,this._exec.getTypeInfo(co.bool)),co.bool))}if(this._check(Xo.tokens.paren_left))return this._paren_expression();if(this._match(Xo.keywords.bitcast)){this._consume(Xo.tokens.less_than,"Expected '<'.");const e=this._type_decl();this._consume(Xo.tokens.greater_than,"Expected '>'.");const t=this._paren_expression();return this._updateNode(new To(e,t))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new bo(e,t))}_argument_expression_list(){if(!this._match(Xo.tokens.paren_left))return null;const e=[];do{if(this._check(Xo.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(Xo.tokens.comma));return this._consume(Xo.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(Xo.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(Xo.tokens.paren_right),e}_paren_expression(){this._consume(Xo.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(Xo.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(Xo.keywords.struct))return null;const e=this._currentLine,t=this._consume(Xo.tokens.ident,"Expected name for struct.").toString();this._consume(Xo.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(Xo.tokens.brace_right);){const e=this._attribute(),t=this._consume(Xo.tokens.name,"Expected variable name.").toString();this._consume(Xo.tokens.colon,"Expected ':' for struct member type.");const s=this._attribute(),r=this._type_decl();null!=r&&(r.attributes=s),this._check(Xo.tokens.brace_right)?this._match(Xo.tokens.comma):this._consume(Xo.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new Oo(t,r,e)))}this._consume(Xo.tokens.brace_right,"Expected '}' after struct body.");const s=this._currentLine,r=this._updateNode(new ho(t,n,e,s),e);return this._context.structs.set(t,r),r}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(Xo.tokens.equal)){const t=this._const_expression();e.value=t}if(null!==e.type&&e.value instanceof Eo){if("x32"!==e.value.type.name&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else null===e.type&&e.value instanceof Eo&&(e.type="x32"===e.value.type.name?co.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(Xo.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(Xo.keywords.const))return null;const t=this._consume(Xo.tokens.name,"Expected variable name"),n=this._currentLine;let s=null;if(this._match(Xo.tokens.colon)){const e=this._attribute();s=this._type_decl(),null!=s&&(s.attributes=e)}let r=null;this._consume(Xo.tokens.equal,"const declarations require an assignment");const i=this._short_circuit_or_expression();try{let e=[co.f32],n=i.constEvaluate(this._exec,e);n instanceof jo&&this._validateTypeRange(n.value,e[0]),e[0]instanceof fo&&null===e[0].format&&n.typeInfo instanceof ci&&null!==n.typeInfo.format&&("f16"===n.typeInfo.format.name?e[0].format=co.f16:"f32"===n.typeInfo.format.name?e[0].format=co.f32:"i32"===n.typeInfo.format.name?e[0].format=co.i32:"u32"===n.typeInfo.format.name?e[0].format=co.u32:"bool"===n.typeInfo.format.name&&(e[0].format=co.bool)),r=this._updateNode(new Eo(n,e[0])),this._exec.context.setVariable(t.toString(),n)}catch(a){r=i}if(null!==s&&r instanceof Eo){if("x32"!==r.type.name&&s.getTypeName()!==r.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${r.type.name} to ${s.name}. Line:${this._currentLine}`);r.type=s,r.isScalar&&this._validateTypeRange(r.scalarValue,r.type)}else null===s&&r instanceof Eo&&(s=null!==(e=null==r?void 0:r.type)&&void 0!==e?e:co.f32,s===co.x32&&(s=co.i32));const o=this._updateNode(new Wi(t.toString(),s,"","",r),n);return this._context.constants.set(o.name,o),o}_global_let_decl(){if(!this._match(Xo.keywords.let))return null;const e=this._currentLine,t=this._consume(Xo.tokens.name,"Expected variable name");let n=null;if(this._match(Xo.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}let s=null;if(this._match(Xo.tokens.equal)&&(s=this._const_expression()),null!==n&&s instanceof Eo){if("x32"!==s.type.name&&n.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${n.name}. Line:${this._currentLine}`);s.type=n}else null===n&&s instanceof Eo&&(n="x32"===s.type.name?co.i32:s.type);return s instanceof Eo&&s.isScalar&&this._validateTypeRange(s.scalarValue,n),this._updateNode(new zi(t.toString(),n,"","",s),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(Xo.keywords.var))return null;const e=this._currentLine;let t="",n="";this._match(Xo.tokens.less_than)&&(t=this._consume(Xo.storage_class,"Expected storage_class.").toString(),this._match(Xo.tokens.comma)&&(n=this._consume(Xo.access_mode,"Expected access_mode.").toString()),this._consume(Xo.tokens.greater_than,"Expected '>'."));const s=this._consume(Xo.tokens.name,"Expected variable name");let r=null;if(this._match(Xo.tokens.colon)){const e=this._attribute();r=this._type_decl(),null!=r&&(r.attributes=e)}return this._updateNode(new Gi(s.toString(),r,t,n,null),e)}_override_decl(){if(!this._match(Xo.keywords.override))return null;const e=this._consume(Xo.tokens.name,"Expected variable name");let t=null;if(this._match(Xo.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}return this._updateNode(new Vi(e.toString(),t,null))}_diagnostic(){this._consume(Xo.tokens.paren_left,"Expected '('");const e=this._consume(Xo.tokens.ident,"Expected severity control name.");this._consume(Xo.tokens.comma,"Expected ','");let t=this._consume(Xo.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(Xo.tokens.period)&&(t+=`.${this._consume(Xo.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(Xo.tokens.paren_right,"Expected ')'"),this._updateNode(new ro(e.toString(),t))}_enable_directive(){const e=this._consume(Xo.tokens.ident,"identity expected.");return this._updateNode(new no(e.toString()))}_requires_directive(){const e=[this._consume(Xo.tokens.ident,"identity expected.").toString()];for(;this._match(Xo.tokens.comma);){const t=this._consume(Xo.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new so(e))}_type_alias(){const e=this._consume(Xo.tokens.ident,"identity expected.");this._consume(Xo.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(null===t)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=this._updateNode(new io(e.toString(),t));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([Xo.tokens.ident,...Xo.texel_format,Xo.keywords.bool,Xo.keywords.f32,Xo.keywords.i32,Xo.keywords.u32])){const e=this._advance().toString();if(this._context.structs.has(e))return this._context.structs.get(e);if(this._context.aliases.has(e))return this._context.aliases.get(e).type;if(!this._getType(e)){const t=this._updateNode(new uo(e));return this._forwardTypeCount++,t}return this._updateNode(new co(e))}let e=this._texture_sampler_types();if(e)return e;if(this._check(Xo.template_types)){let e=this._advance().toString(),t=null,n=null;return this._match(Xo.tokens.less_than)&&(t=this._type_decl(),n=null,this._match(Xo.tokens.comma)&&(n=this._consume(Xo.access_mode,"Expected access_mode for pointer").toString()),this._consume(Xo.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new fo(e,t,n))}if(this._match(Xo.keywords.ptr)){let e=this._previous().toString();this._consume(Xo.tokens.less_than,"Expected '<' for pointer.");const t=this._consume(Xo.storage_class,"Expected storage_class for pointer");this._consume(Xo.tokens.comma,"Expected ',' for pointer.");const n=this._type_decl();let s=null;return this._match(Xo.tokens.comma)&&(s=this._consume(Xo.access_mode,"Expected access_mode for pointer").toString()),this._consume(Xo.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new po(e,t.toString(),n,s))}const t=this._attribute();if(this._match(Xo.keywords.array)){let e=null,s=-1;const r=this._previous();let i=null;if(this._match(Xo.tokens.less_than)){e=this._type_decl(),this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);let t="";if(this._match(Xo.tokens.comma)){i=this._shift_expression();try{t=i.constEvaluate(this._exec).toString(),i=null}catch(n){t="1"}}this._consume(Xo.tokens.greater_than,"Expected '>' for array."),s=t?parseInt(t):0}const o=this._updateNode(new go(r.toString(),t,e,s));return i&&this._deferArrayCountEval.push({arrayType:o,countNode:i}),o}return null}_texture_sampler_types(){if(this._match(Xo.sampler_type))return this._updateNode(new mo(this._previous().toString(),null,null));if(this._match(Xo.depth_texture_type))return this._updateNode(new mo(this._previous().toString(),null,null));if(this._match(Xo.sampled_texture_type)||this._match(Xo.multisampled_texture_type)){const e=this._previous();this._consume(Xo.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(Xo.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new mo(e.toString(),t,null))}if(this._match(Xo.storage_texture_type)){const e=this._previous();this._consume(Xo.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(Xo.texel_format,"Invalid texel format.").toString();this._consume(Xo.tokens.comma,"Expected ',' after texel format.");const n=this._consume(Xo.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(Xo.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new mo(e.toString(),t,n))}return null}_attribute(){let e=[];for(;this._match(Xo.tokens.attr);){const t=this._consume(Xo.attribute_name,"Expected attribute name"),n=this._updateNode(new Fo(t.toString(),null));if(this._match(Xo.tokens.paren_left)){if(n.value=this._consume(Xo.literal_or_ident,"Expected attribute value").toString(),this._check(Xo.tokens.comma)){this._advance();do{const e=this._consume(Xo.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(e)}while(this._match(Xo.tokens.comma))}this._consume(Xo.tokens.paren_right,"Expected ')'")}e.push(n)}return 0==e.length?null:e}}class xa extends ca{constructor(e){super(),e&&this.update(e)}update(e){const t=(new va).parse(e);this.updateAST(t)}}function wa(e){return(null==e?void 0:e.format)?`${e.name}<${e.format.name}>`:e.name}globalThis.mathgl=globalThis.mathgl||{config:{EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1}};const Ea=globalThis.mathgl.config;function Ta(e,{precision:t=Ea.precision}={}){return e=function(e){return Math.round(e/Ea.EPSILON)*Ea.EPSILON}(e),`${parseFloat(e.toPrecision(t))}`}function Sa(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Aa(e,t,n){return function(e,t,n){if(Sa(e)){const s=e;n=n||function(e){return e.clone?e.clone():new Array(e.length)}(s);for(let r=0;r<n.length&&r<s.length;++r){const s="number"==typeof e?e:e[r];n[r]=t(s)}return n}return t(e)}(e,e=>Math.max(t,Math.min(n,e)))}function Ra(e,t,n){return Sa(e)?e.map((e,s)=>Ra(e,t[s],n)):n*t+(1-n)*e}function Ca(e,t,n){const s=Ea.EPSILON;try{if(e===t)return!0;if(Sa(e)&&Sa(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Ca(e[n],t[n]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):"number"==typeof e&&"number"==typeof t&&Math.abs(e-t)<=Ea.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))}finally{Ea.EPSILON=s}}class Pa extends Array{clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(e=[],t=0){for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Sa(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Ea)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+Ta(this[n],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Ca(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(void 0===n)return this.lerp(this,e,t);for(let s=0;s<this.ELEMENTS;++s){const r=e[s],i="number"==typeof t?t:t[s];this[s]=r+n*(i-r)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]+=t[e];return this.check()}subtract(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]-=t[e];return this.check()}scale(e){if("number"==typeof e)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(Ea.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}}function ka(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function Ia(e,t,n=""){if(Ea.debug&&!function(e,t){if(e.length!==t)return!1;for(let n=0;n<e.length;++n)if(!Number.isFinite(e[n]))return!1;return!0}(e,t))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return e}function Ma(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}class La extends Pa{get x(){return this[0]}set x(e){this[0]=ka(e)}get y(){return this[1]}set y(e){this[1]=ka(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const s=this[n]-e[n];t+=s*s}return ka(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return ka(t)}normalize(){const e=this.magnitude();if(0!==e)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t[e];return this.check()}divide(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t[e];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Ma(e>=0&&e<this.ELEMENTS,"index is out of range"),ka(this[e])}setComponent(e,t){return Ma(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const Na=1e-6;let Oa="undefined"!=typeof Float32Array?Float32Array:Array;function Fa(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function Da(e,t,n,s){const r=t[0],i=t[1];return e[0]=r+s*(n[0]-r),e[1]=i+s*(n[1]-i),e}function Ba(e,t,n){const s=t[0],r=t[1],i=t[2],o=n[3]*s+n[7]*r+n[11]*i||1;return e[0]=(n[0]*s+n[4]*r+n[8]*i)/o,e[1]=(n[1]*s+n[5]*r+n[9]*i)/o,e[2]=(n[2]*s+n[6]*r+n[10]*i)/o,e}function Ua(e,t,n){const s=t[0],r=t[1],i=t[2];let o=n[3]*s+n[7]*r+n[11]*i+n[15];return o=o||1,e[0]=(n[0]*s+n[4]*r+n[8]*i+n[12])/o,e[1]=(n[1]*s+n[5]*r+n[9]*i+n[13])/o,e[2]=(n[2]*s+n[6]*r+n[10]*i+n[14])/o,e}!function(){const e=new Oa(2);Oa!=Float32Array&&(e[0]=0,e[1]=0)}();const ja=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},Ga=function(e){const t=e[0],n=e[1],s=e[2];return t*t+n*n+s*s};!function(){const e=new Oa(3);Oa!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0)}();const Va=[0,0,0];let za;class Wa extends La{static get ZERO(){return za||(za=new Wa(0,0,0),Object.freeze(za)),za}constructor(e=0,t=0,n=0){super(-0,-0,-0),1===arguments.length&&Sa(e)?this.copy(e):(Ea.debug&&(ka(e),ka(t),ka(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Ea.debug&&(ka(e.x),ka(e.y),ka(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=ka(e)}angle(e){return function(e,t){const n=e[0],s=e[1],r=e[2],i=t[0],o=t[1],a=t[2],l=Math.sqrt((n*n+s*s+r*r)*(i*i+o*o+a*a)),c=l&&function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))}(this,e)}cross(e){return function(e,t,n){const s=t[0],r=t[1],i=t[2],o=n[0],a=n[1],l=n[2];e[0]=r*l-i*a,e[1]=i*o-s*l,e[2]=s*a-r*o}(this,this,e),this.check()}rotateX({radians:e,origin:t=Va}){return function(e,t,n,s){const r=[],i=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],i[0]=r[0],i[1]=r[1]*Math.cos(s)-r[2]*Math.sin(s),i[2]=r[1]*Math.sin(s)+r[2]*Math.cos(s),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2]}(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Va}){return function(e,t,n,s){const r=[],i=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],i[0]=r[2]*Math.sin(s)+r[0]*Math.cos(s),i[1]=r[1],i[2]=r[2]*Math.cos(s)-r[0]*Math.sin(s),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2]}(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Va}){return function(e,t,n,s){const r=[],i=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],i[0]=r[0]*Math.cos(s)-r[1]*Math.sin(s),i[1]=r[0]*Math.sin(s)+r[1]*Math.cos(s),i[2]=r[2],e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2]}(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Ua(this,this,e),this.check()}transformAsVector(e){return Ba(this,this,e),this.check()}transformByMatrix3(e){return function(e,t,n){const s=t[0],r=t[1],i=t[2];e[0]=s*n[0]+r*n[3]+i*n[6],e[1]=s*n[1]+r*n[4]+i*n[7],e[2]=s*n[2]+r*n[5]+i*n[8]}(this,this,e),this.check()}transformByMatrix2(e){return function(e,t,n){const s=t[0],r=t[1];e[0]=n[0]*s+n[2]*r,e[1]=n[1]*s+n[3]*r,e[2]=t[2]}(this,this,e),this.check()}transformByQuaternion(e){return function(e,t,n){const s=n[0],r=n[1],i=n[2],o=n[3],a=t[0],l=t[1],c=t[2];let u=r*c-i*l,h=i*a-s*c,d=s*l-r*a,f=r*d-i*h,p=i*u-s*d,g=s*h-r*u;const m=2*o;u*=m,h*=m,d*=m,f*=2,p*=2,g*=2,e[0]=a+u+f,e[1]=l+h+p,e[2]=c+d+g}(this,this,e),this.check()}}class Ha extends Pa{toString(){let e="[";if(Ea.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=ka(n),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let s=0;s<this.RANK;++s)t[s]=this[n+s];return t}setColumn(e,t){const n=e*this.RANK;for(let s=0;s<this.RANK;++s)this[n+s]=t[s];return this}}function $a(e,t){const n=t[0],s=t[1],r=t[2],i=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11],p=t[12],g=t[13],m=t[14],_=t[15],y=n*a-s*o,b=n*l-r*o,v=n*c-i*o,x=s*l-r*a,w=s*c-i*a,E=r*c-i*l,T=u*g-h*p,S=u*m-d*p,A=u*_-f*p,R=h*m-d*g,C=h*_-f*g,P=d*_-f*m;let k=y*P-b*C+v*R+x*A-w*S+E*T;return k?(k=1/k,e[0]=(a*P-l*C+c*R)*k,e[1]=(r*C-s*P-i*R)*k,e[2]=(g*E-m*w+_*x)*k,e[3]=(d*w-h*E-f*x)*k,e[4]=(l*A-o*P-c*S)*k,e[5]=(n*P-r*A+i*S)*k,e[6]=(m*v-p*E-_*b)*k,e[7]=(u*E-d*v+f*b)*k,e[8]=(o*C-a*A+c*T)*k,e[9]=(s*A-n*C-i*T)*k,e[10]=(p*w-g*v+_*y)*k,e[11]=(h*v-u*w-f*y)*k,e[12]=(a*S-o*R-l*T)*k,e[13]=(n*R-s*S+r*T)*k,e[14]=(g*b-p*x-m*y)*k,e[15]=(u*x-h*b+d*y)*k,e):null}function Xa(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],g=t[12],m=t[13],_=t[14],y=t[15];let b=n[0],v=n[1],x=n[2],w=n[3];return e[0]=b*s+v*a+x*h+w*g,e[1]=b*r+v*l+x*d+w*m,e[2]=b*i+v*c+x*f+w*_,e[3]=b*o+v*u+x*p+w*y,b=n[4],v=n[5],x=n[6],w=n[7],e[4]=b*s+v*a+x*h+w*g,e[5]=b*r+v*l+x*d+w*m,e[6]=b*i+v*c+x*f+w*_,e[7]=b*o+v*u+x*p+w*y,b=n[8],v=n[9],x=n[10],w=n[11],e[8]=b*s+v*a+x*h+w*g,e[9]=b*r+v*l+x*d+w*m,e[10]=b*i+v*c+x*f+w*_,e[11]=b*o+v*u+x*p+w*y,b=n[12],v=n[13],x=n[14],w=n[15],e[12]=b*s+v*a+x*h+w*g,e[13]=b*r+v*l+x*d+w*m,e[14]=b*i+v*c+x*f+w*_,e[15]=b*o+v*u+x*p+w*y,e}function qa(e,t,n){const s=n[0],r=n[1],i=n[2];let o,a,l,c,u,h,d,f,p,g,m,_;return t===e?(e[12]=t[0]*s+t[4]*r+t[8]*i+t[12],e[13]=t[1]*s+t[5]*r+t[9]*i+t[13],e[14]=t[2]*s+t[6]*r+t[10]*i+t[14],e[15]=t[3]*s+t[7]*r+t[11]*i+t[15]):(o=t[0],a=t[1],l=t[2],c=t[3],u=t[4],h=t[5],d=t[6],f=t[7],p=t[8],g=t[9],m=t[10],_=t[11],e[0]=o,e[1]=a,e[2]=l,e[3]=c,e[4]=u,e[5]=h,e[6]=d,e[7]=f,e[8]=p,e[9]=g,e[10]=m,e[11]=_,e[12]=o*s+u*r+p*i+t[12],e[13]=a*s+h*r+g*i+t[13],e[14]=l*s+d*r+m*i+t[14],e[15]=c*s+f*r+_*i+t[15]),e}function Ya(e,t,n){const s=n[0],r=n[1],i=n[2];return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ka(e,t,n){const s=Math.sin(n),r=Math.cos(n),i=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*r+c*s,e[5]=o*r+u*s,e[6]=a*r+h*s,e[7]=l*r+d*s,e[8]=c*r-i*s,e[9]=u*r-o*s,e[10]=h*r-a*s,e[11]=d*r-l*s,e}function Za(e,t,n){const s=Math.sin(n),r=Math.cos(n),i=t[0],o=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*r+c*s,e[1]=o*r+u*s,e[2]=a*r+h*s,e[3]=l*r+d*s,e[4]=c*r-i*s,e[5]=u*r-o*s,e[6]=h*r-a*s,e[7]=d*r-l*s,e}function Qa(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function Ja(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3];return e[0]=n[0]*s+n[4]*r+n[8]*i+n[12]*o,e[1]=n[1]*s+n[5]*r+n[9]*i+n[13]*o,e[2]=n[2]*s+n[6]*r+n[10]*i+n[14]*o,e[3]=n[3]*s+n[7]*r+n[11]*i+n[15]*o,e}var el,tl;!function(){const e=new Oa(4);Oa!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}(),(tl=el||(el={}))[tl.COL0ROW0=0]="COL0ROW0",tl[tl.COL0ROW1=1]="COL0ROW1",tl[tl.COL0ROW2=2]="COL0ROW2",tl[tl.COL0ROW3=3]="COL0ROW3",tl[tl.COL1ROW0=4]="COL1ROW0",tl[tl.COL1ROW1=5]="COL1ROW1",tl[tl.COL1ROW2=6]="COL1ROW2",tl[tl.COL1ROW3=7]="COL1ROW3",tl[tl.COL2ROW0=8]="COL2ROW0",tl[tl.COL2ROW1=9]="COL2ROW1",tl[tl.COL2ROW2=10]="COL2ROW2",tl[tl.COL2ROW3=11]="COL2ROW3",tl[tl.COL3ROW0=12]="COL3ROW0",tl[tl.COL3ROW1=13]="COL3ROW1",tl[tl.COL3ROW2=14]="COL3ROW2",tl[tl.COL3ROW3=15]="COL3ROW3";const nl=45*Math.PI/180,sl=1,rl=.1,il=500,ol=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class al extends Ha{static get IDENTITY(){return cl||(cl=new al,Object.freeze(cl)),cl}static get ZERO(){return ll||(ll=new al([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(ll)),ll}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return el}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,s,r,i,o,a,l,c,u,h,d,f,p,g){return this[0]=e,this[1]=t,this[2]=n,this[3]=s,this[4]=r,this[5]=i,this[6]=o,this[7]=a,this[8]=l,this[9]=c,this[10]=u,this[11]=h,this[12]=d,this[13]=f,this[14]=p,this[15]=g,this.check()}setRowMajor(e,t,n,s,r,i,o,a,l,c,u,h,d,f,p,g){return this[0]=e,this[1]=r,this[2]=l,this[3]=d,this[4]=t,this[5]=i,this[6]=c,this[7]=f,this[8]=n,this[9]=o,this[10]=u,this[11]=p,this[12]=s,this[13]=a,this[14]=h,this[15]=g,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(ol)}fromObject(e){return this.check()}fromQuaternion(e){return function(e,t){const n=t[0],s=t[1],r=t[2],i=t[3],o=n+n,a=s+s,l=r+r,c=n*o,u=s*o,h=s*a,d=r*o,f=r*a,p=r*l,g=i*o,m=i*a,_=i*l;e[0]=1-h-p,e[1]=u+_,e[2]=d-m,e[3]=0,e[4]=u-_,e[5]=1-c-p,e[6]=f+g,e[7]=0,e[8]=d+m,e[9]=f-g,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(this,e),this.check()}frustum(e){const{left:t,right:n,bottom:s,top:r,near:i=rl,far:o=il}=e;return o===1/0?function(e,t,n,s,r,i){const o=2*i/(n-t),a=2*i/(r-s),l=(n+t)/(n-t),c=(r+s)/(r-s),u=-2*i;e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=l,e[9]=c,e[10]=-1,e[11]=-1,e[12]=0,e[13]=0,e[14]=u,e[15]=0}(this,t,n,s,r,i):function(e,t,n,s,r,i,o){const a=1/(n-t),l=1/(r-s),c=1/(i-o);e[0]=2*i*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*i*l,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(r+s)*l,e[10]=(o+i)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*i*2*c,e[15]=0}(this,t,n,s,r,i,o),this.check()}lookAt(e){const{eye:t,center:n=[0,0,0],up:s=[0,1,0]}=e;return function(e,t,n,s){let r,i,o,a,l,c,u,h,d,f;const p=t[0],g=t[1],m=t[2],_=s[0],y=s[1],b=s[2],v=n[0],x=n[1],w=n[2];Math.abs(p-v)<Na&&Math.abs(g-x)<Na&&Math.abs(m-w)<Na?function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(e):(h=p-v,d=g-x,f=m-w,r=1/Math.sqrt(h*h+d*d+f*f),h*=r,d*=r,f*=r,i=y*f-b*d,o=b*h-_*f,a=_*d-y*h,r=Math.sqrt(i*i+o*o+a*a),r?(r=1/r,i*=r,o*=r,a*=r):(i=0,o=0,a=0),l=d*a-f*o,c=f*i-h*a,u=h*o-d*i,r=Math.sqrt(l*l+c*c+u*u),r?(r=1/r,l*=r,c*=r,u*=r):(l=0,c=0,u=0),e[0]=i,e[1]=l,e[2]=h,e[3]=0,e[4]=o,e[5]=c,e[6]=d,e[7]=0,e[8]=a,e[9]=u,e[10]=f,e[11]=0,e[12]=-(i*p+o*g+a*m),e[13]=-(l*p+c*g+u*m),e[14]=-(h*p+d*g+f*m),e[15]=1)}(this,t,n,s),this.check()}ortho(e){const{left:t,right:n,bottom:s,top:r,near:i=rl,far:o=il}=e;return function(e,t,n,s,r,i,o){const a=1/(t-n),l=1/(s-r),c=1/(i-o);e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(r+s)*l,e[14]=(o+i)*c,e[15]=1}(this,t,n,s,r,i,o),this.check()}orthographic(e){const{fovy:t=nl,aspect:n=sl,focalDistance:s=1,near:r=rl,far:i=il}=e;ul(t);const o=t/2,a=s*Math.tan(o),l=a*n;return this.ortho({left:-l,right:l,bottom:-a,top:a,near:r,far:i})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:n=1,near:s=.1,far:r=500}=e;return ul(t),function(e,t,n,s,r){const i=1/Math.tan(t/2);if(e[0]=i/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0){const t=1/(s-r);e[10]=(r+s)*t,e[14]=2*r*s*t}else e[10]=-1,e[14]=-2*s}(this,t,n,s,r),this.check()}determinant(){return function(e){const t=e[0],n=e[1],s=e[2],r=e[3],i=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],f=e[12],p=e[13],g=e[14],m=t*o-n*i,_=t*a-s*i,y=n*a-s*o,b=c*p-u*f,v=c*g-h*f,x=u*g-h*p;return l*(t*x-n*v+s*b)-r*(i*x-o*v+a*b)+e[15]*(c*y-u*_+h*m)-d*(f*y-p*_+g*m)}(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),s=1/n[0],r=1/n[1],i=1/n[2];return e[0]=this[0]*s,e[1]=this[1]*r,e[2]=this[2]*i,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*r,e[6]=this[6]*i,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*r,e[10]=this[10]*i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),s=1/n[0],r=1/n[1],i=1/n[2];return e[0]=this[0]*s,e[1]=this[1]*r,e[2]=this[2]*i,e[3]=this[4]*s,e[4]=this[5]*r,e[5]=this[6]*i,e[6]=this[8]*s,e[7]=this[9]*r,e[8]=this[10]*i,e}transpose(){return function(e,t){if(e===t){const n=t[1],s=t[2],r=t[3],i=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=s,e[9]=i,e[11]=t[14],e[12]=r,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15]}(this,this),this.check()}invert(){return $a(this,this),this.check()}multiplyLeft(e){return Xa(this,e,this),this.check()}multiplyRight(e){return Xa(this,this,e),this.check()}rotateX(e){return Ka(this,this,e),this.check()}rotateY(e){return function(e,t,n){const s=Math.sin(n),r=Math.cos(n),i=t[0],o=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*r-c*s,e[1]=o*r-u*s,e[2]=a*r-h*s,e[3]=l*r-d*s,e[8]=i*s+c*r,e[9]=o*s+u*r,e[10]=a*s+h*r,e[11]=l*s+d*r}(this,this,e),this.check()}rotateZ(e){return Za(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return function(e,t,n,s){let r,i,o,a,l,c,u,h,d,f,p,g,m,_,y,b,v,x,w,E,T,S,A,R,C=s[0],P=s[1],k=s[2],I=Math.sqrt(C*C+P*P+k*k);I<Na||(I=1/I,C*=I,P*=I,k*=I,i=Math.sin(n),r=Math.cos(n),o=1-r,a=t[0],l=t[1],c=t[2],u=t[3],h=t[4],d=t[5],f=t[6],p=t[7],g=t[8],m=t[9],_=t[10],y=t[11],b=C*C*o+r,v=P*C*o+k*i,x=k*C*o-P*i,w=C*P*o-k*i,E=P*P*o+r,T=k*P*o+C*i,S=C*k*o+P*i,A=P*k*o-C*i,R=k*k*o+r,e[0]=a*b+h*v+g*x,e[1]=l*b+d*v+m*x,e[2]=c*b+f*v+_*x,e[3]=u*b+p*v+y*x,e[4]=a*w+h*E+g*T,e[5]=l*w+d*E+m*T,e[6]=c*w+f*E+_*T,e[7]=u*w+p*E+y*T,e[8]=a*S+h*A+g*R,e[9]=l*S+d*A+m*R,e[10]=c*S+f*A+_*R,e[11]=u*S+p*A+y*R,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}(this,this,e,t),this.check()}scale(e){return Ya(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return qa(this,this,e),this.check()}transform(e,t){return 4===e.length?(Ia(t=Ja(t||[-0,-0,-0,-0],e,this),4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;let s;switch(n){case 2:s=function(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[4]*r+n[12],e[1]=n[1]*s+n[5]*r+n[13],e}(t||[-0,-0],e,this);break;case 3:s=Ua(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Ia(s,e.length),s}transformAsVector(e,t){let n;switch(e.length){case 2:n=function(e,t,n){const s=t[0],r=t[1],i=n[3]*s+n[7]*r||1;return e[0]=(n[0]*s+n[4]*r)/i,e[1]=(n[1]*s+n[5]*r)/i,e}(t||[-0,-0],e,this);break;case 3:n=Ba(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Ia(n,e.length),n}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}}let ll,cl;function ul(e){if(e>2*Math.PI)throw Error("expected radians")}function hl(e,t=[],n=0){const s=Math.fround(e),r=e-s;return t[n]=s,t[n+1]=r,t}const dl={name:"fp64arithmetic",vs:"\nuniform fp64arithmeticUniforms {\n  uniform float ONE;\n} fp64;\n\n/*\nAbout LUMA_FP64_CODE_ELIMINATION_WORKAROUND\n\nThe purpose of this workaround is to prevent shader compilers from\noptimizing away necessary arithmetic operations by swapping their sequences\nor transform the equation to some 'equivalent' form.\n\nThe method is to multiply an artifical variable, ONE, which will be known to\nthe compiler to be 1 only at runtime. The whole expression is then represented\nas a polynomial with respective to ONE. In the coefficients of all terms, only one a\nand one b should appear\n\nerr = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE\n*/\n\n// Divide float number to high and low floats to extend fraction bits\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float a_hi = t * fp64.ONE - (t - a);\n  float a_lo = a * fp64.ONE - a_hi;\n#else\n  float a_hi = t - (t - a);\n  float a_lo = a - a_hi;\n#endif\n  return vec2(a_hi, a_lo);\n}\n\n// Divide float number again when high float uses too many fraction bits\nvec2 split2(vec2 a) {\n  vec2 b = split(a.x);\n  b.y += a.y;\n  return b;\n}\n\n// Special sum operation when a > b\nvec2 quickTwoSum(float a, float b) {\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float sum = (a + b) * fp64.ONE;\n  float err = b - (sum - a) * fp64.ONE;\n#else\n  float sum = a + b;\n  float err = b - (sum - a);\n#endif\n  return vec2(sum, err);\n}\n\n// General sum operation\nvec2 twoSum(float a, float b) {\n  float s = (a + b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * fp64.ONE - a) * fp64.ONE;\n  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) + (b - v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSub(float a, float b) {\n  float s = (a - b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * fp64.ONE - a) * fp64.ONE;\n  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) - (b + v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *\n    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;\n#else\n  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n#endif\n  return vec2(prod, err);\n}\n\nvec2 twoProd(float a, float b) {\n  float prod = a * b;\n  vec2 a_fp64 = split(a);\n  vec2 b_fp64 = split(b);\n  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\n    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\n  return vec2(prod, err);\n}\n\nvec2 sum_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSum(a.x, b.x);\n  t = twoSum(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 sub_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSub(a.x, b.x);\n  t = twoSub(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 mul_fp64(vec2 a, vec2 b) {\n  vec2 prod = twoProd(a.x, b.x);\n  // y component is for the error\n  prod.y += a.x * b.y;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  prod.y += a.y * b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  return prod;\n}\n\nvec2 div_fp64(vec2 a, vec2 b) {\n  float xn = 1.0 / b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  vec2 yn = mul_fp64(a, vec2(xn, 0));\n#else\n  vec2 yn = a * xn;\n#endif\n  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;\n  vec2 prod = twoProd(xn, diff);\n  return sum_fp64(yn, prod);\n}\n\nvec2 sqrt_fp64(vec2 a) {\n  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n\n  float x = 1.0 / sqrt(a.x);\n  float yn = a.x * x;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;\n#else\n  vec2 yn_sqr = twoSqr(yn);\n#endif\n  float diff = sub_fp64(a, yn_sqr).x;\n  vec2 prod = twoProd(x * 0.5, diff);\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  return sum_fp64(split(yn), prod);\n#else\n  return sum_fp64(vec2(yn, 0.0), prod);\n#endif\n}\n",defaultUniforms:{ONE:1},uniformTypes:{ONE:"f32"},fp64ify:hl,fp64LowPart:function(e){return e-Math.fround(e)},fp64ifyMatrix4:function(e){const t=new Float32Array(32);for(let n=0;n<4;++n)for(let s=0;s<4;++s){const r=4*n+s;hl(e[4*s+n],t,2*r)}return t}},fl={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:[0,1,1,1]},vs:"uniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nout vec4 picking_vRGBcolor_Avalid;\n\n// Normalize unsigned byte color to 0-1 range\nvec3 picking_normalizeColor(vec3 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\n// Normalize unsigned byte color to 0-1 range\nvec4 picking_normalizeColor(vec4 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\nbool picking_isColorZero(vec3 color) {\n  return dot(color, vec3(1.0)) < 0.00001;\n}\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.00001;\n}\n\n// Check if this vertex is highlighted \nbool isVertexHighlighted(vec3 vertexColor) {\n  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);\n  return\n    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));\n}\n\n// Set the current picking color\nvoid picking_setPickingColor(vec3 pickingColor) {\n  pickingColor = picking_normalizeColor(pickingColor);\n\n  if (bool(picking.isActive)) {\n    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    if (!bool(picking.isAttribute)) {\n      // Stores the picking color so that the fragment shader can render it during picking\n      picking_vRGBcolor_Avalid.rgb = pickingColor;\n    }\n  } else {\n    // Do the comparison with selected item color in vertex shader as it should mean fewer compares\n    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec2 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec3 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n",fs:"uniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nin vec4 picking_vRGBcolor_Avalid;\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 picking_filterHighlightColor(vec4 color) {\n  // If we are still picking, we don't highlight\n  if (picking.isActive > 0.5) {\n    return color;\n  }\n\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    // Blend in highlight color based on its alpha value\n    float highLightAlpha = picking.highlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 picking_filterPickingColor(vec4 color) {\n  if (bool(picking.isActive)) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 picking_filterColor(vec4 color) {\n  vec4 highlightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highlightColor);\n}\n",getUniforms:function(e={},t){const n={};if(void 0===e.highlightedObjectColor);else if(null===e.highlightedObjectColor)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const t=e.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=t}if(e.highlightColor){const t=Array.from(e.highlightColor,e=>e/255);Number.isFinite(t[3])||(t[3]=1),n.highlightColor=t}return void 0!==e.isActive&&(n.isActive=Boolean(e.isActive),n.isAttribute=Boolean(e.isAttribute)),void 0!==e.useFloatColors&&(n.useFloatColors=Boolean(e.useFloatColors)),n}},pl="uniform layerUniforms {\n  uniform float opacity;\n} layer;\n",gl={name:"layer",vs:pl,fs:pl,getUniforms:e=>({opacity:Math.pow(e.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},ml={name:"color",dependencies:[],source:"\n\nstruct ColorUniforms {\n  opacity: f32,\n};\n\nvar<private> color: ColorUniforms = ColorUniforms(1.0);\n// TODO (kaapp) avoiding binding index collisions to handle layer opacity \n// requires some thought.\n// @group(0) @binding(0) var<uniform> color: ColorUniforms;\n\n@must_use\nfn deckgl_premultiplied_alpha(fragColor: vec4<f32>) -> vec4<f32> {\n    return vec4(fragColor.rgb * fragColor.a, fragColor.a); \n};\n",getUniforms:e=>({}),uniformTypes:{opacity:"f32"}},_l="#define SMOOTH_EDGE_RADIUS 0.5",yl={name:"geometry",source:"const SMOOTH_EDGE_RADIUS: f32 = 0.5;\n\nstruct VertexGeometry {\n  position: vec4<f32>,\n  worldPosition: vec3<f32>,\n  worldPositionAlt: vec3<f32>,\n  normal: vec3<f32>,\n  uv: vec2<f32>,\n  pickingColor: vec3<f32>,\n};\n\nvar<private> geometry_: VertexGeometry = VertexGeometry(\n  vec4<f32>(0.0, 0.0, 1.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0),\n  vec2<f32>(0.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0)\n);\n\nstruct FragmentGeometry {\n  uv: vec2<f32>,\n};\n\nvar<private> fragmentGeometry: FragmentGeometry;\n\nfn smoothedge(edge: f32, x: f32) -> f32 {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n",vs:`${_l}\n\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry = VertexGeometry(\n  vec4(0.0, 0.0, 1.0, 0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec2(0.0),\n  vec3(0.0)\n);\n`,fs:`${_l}\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n`};var bl,vl,xl,wl,El,Tl;(vl=bl||(bl={}))[vl.Start=1]="Start",vl[vl.Move=2]="Move",vl[vl.End=4]="End",vl[vl.Cancel=8]="Cancel",(wl=xl||(xl={}))[wl.None=0]="None",wl[wl.Left=1]="Left",wl[wl.Right=2]="Right",wl[wl.Up=4]="Up",wl[wl.Down=8]="Down",wl[wl.Horizontal=3]="Horizontal",wl[wl.Vertical=12]="Vertical",wl[wl.All=15]="All",(Tl=El||(El={}))[Tl.Possible=1]="Possible",Tl[Tl.Began=2]="Began",Tl[Tl.Changed=4]="Changed",Tl[Tl.Ended=8]="Ended",Tl[Tl.Recognized=8]="Recognized",Tl[Tl.Cancelled=16]="Cancelled",Tl[Tl.Failed=32]="Failed";const Sl="manipulation",Al="none",Rl="pan-x",Cl="pan-y";class Pl{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){"compute"===e&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return function(e){if(e.includes(Al))return Al;const t=e.includes(Rl),n=e.includes(Cl);return t&&n?Al:t||n?t?Rl:Cl:e.includes(Sl)?Sl:"auto"}(e.join(" "))}}function kl(e){return e.trim().split(/\s+/g)}function Il(e,t,n){if(e)for(const s of kl(t))e.addEventListener(s,n,!1)}function Ml(e,t,n){if(e)for(const s of kl(t))e.removeEventListener(s,n,!1)}function Ll(e){return(e.ownerDocument||e).defaultView}function Nl(e){const t=e.length;if(1===t)return{x:Math.round(e[0].clientX),y:Math.round(e[0].clientY)};let n=0,s=0,r=0;for(;r<t;)n+=e[r].clientX,s+=e[r].clientY,r++;return{x:Math.round(n/t),y:Math.round(s/t)}}function Ol(e){const t=[];let n=0;for(;n<e.pointers.length;)t[n]={clientX:Math.round(e.pointers[n].clientX),clientY:Math.round(e.pointers[n].clientY)},n++;return{timeStamp:Date.now(),pointers:t,center:Nl(t),deltaX:e.deltaX,deltaY:e.deltaY}}function Fl(e,t){const n=t.x-e.x,s=t.y-e.y;return Math.sqrt(n*n+s*s)}function Dl(e,t){const n=t.clientX-e.clientX,s=t.clientY-e.clientY;return Math.sqrt(n*n+s*s)}function Bl(e,t){const n=t.clientX-e.clientX,s=t.clientY-e.clientY;return 180*Math.atan2(s,n)/Math.PI}function Ul(e,t){return e===t?xl.None:Math.abs(e)>=Math.abs(t)?e<0?xl.Left:xl.Right:t<0?xl.Up:xl.Down}function jl(e,t,n){return{x:t/e||0,y:n/e||0}}let Gl=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=e=>{this.manager.options.enable&&this.handler(e)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){!function(e,t,n){const s=n.pointers.length,r=n.changedPointers.length,i=t&bl.Start&&s-r===0,o=t&(bl.End|bl.Cancel)&&s-r===0;n.isFirst=Boolean(i),n.isFinal=Boolean(o),i&&(e.session={}),n.eventType=t;const a=function(e,t){const{session:n}=e,{pointers:s}=t,{length:r}=s;n.firstInput||(n.firstInput=Ol(t)),r>1&&!n.firstMultiple?n.firstMultiple=Ol(t):1===r&&(n.firstMultiple=!1);const{firstInput:i,firstMultiple:o}=n,a=o?o.center:i.center,l=t.center=Nl(s);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-i.timeStamp,t.angle=function(e,t){const n=t.x-e.x,s=t.y-e.y;return 180*Math.atan2(s,n)/Math.PI}(a,l),t.distance=Fl(a,l);const{deltaX:c,deltaY:u}=function(e,t){const n=t.center;let s=e.offsetDelta,r=e.prevDelta;const i=e.prevInput;return t.eventType!==bl.Start&&(null==i?void 0:i.eventType)!==bl.End||(r=e.prevDelta={x:(null==i?void 0:i.deltaX)||0,y:(null==i?void 0:i.deltaY)||0},s=e.offsetDelta={x:n.x,y:n.y}),{deltaX:r.x+(n.x-s.x),deltaY:r.y+(n.y-s.y)}}(n,t);t.deltaX=c,t.deltaY=u,t.offsetDirection=Ul(t.deltaX,t.deltaY);const h=jl(t.deltaTime,t.deltaX,t.deltaY);var d,f;t.overallVelocityX=h.x,t.overallVelocityY=h.y,t.overallVelocity=Math.abs(h.x)>Math.abs(h.y)?h.x:h.y,t.scale=o?(d=o.pointers,Dl((f=s)[0],f[1])/Dl(d[0],d[1])):1,t.rotation=o?function(e,t){return Bl(t[1],t[0])-Bl(e[1],e[0])}(o.pointers,s):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length;let p=e.element;return function(e,t){let n=e;for(;n;){if(n===t)return!0;n=n.parentNode}return!1}(t.srcEvent.target,p)&&(p=t.srcEvent.target),t.target=p,function(e,t){const n=e.lastInterval||t,s=t.timeStamp-n.timeStamp;let r,i,o,a;if(t.eventType!==bl.Cancel&&(s>25||void 0===n.velocity)){const l=t.deltaX-n.deltaX,c=t.deltaY-n.deltaY,u=jl(s,l,c);i=u.x,o=u.y,r=Math.abs(u.x)>Math.abs(u.y)?u.x:u.y,a=Ul(l,c),e.lastInterval=t}else r=n.velocity,i=n.velocityX,o=n.velocityY,a=n.direction;t.velocity=r,t.velocityX=i,t.velocityY=o,t.direction=a}(n,t),t}(e,n);e.emit("hammer.input",a),e.recognize(a),e.session.prevInput=a}(this.manager,e,t)}init(){Il(this.element,this.evEl,this.domHandler),Il(this.target,this.evTarget,this.domHandler),Il(Ll(this.element),this.evWin,this.domHandler)}destroy(){Ml(this.element,this.evEl,this.domHandler),Ml(this.target,this.evTarget,this.domHandler),Ml(Ll(this.element),this.evWin,this.domHandler)}};const Vl={pointerdown:bl.Start,pointermove:bl.Move,pointerup:bl.End,pointercancel:bl.Cancel,pointerout:bl.Cancel};class zl extends Gl{constructor(e){super(e),this.evEl="pointerdown",this.evWin="pointermove pointerup pointercancel",this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let n=!1;const s=Vl[e.type],r=e.pointerType,i="touch"===r;let o=t.findIndex(t=>t.pointerId===e.pointerId);s&bl.Start&&(e.buttons||i)?o<0&&(t.push(e),o=t.length-1):s&(bl.End|bl.Cancel)&&(n=!0),o<0||(t[o]=e,this.callback(s,{pointers:t,changedPointers:[e],eventType:s,pointerType:r,srcEvent:e}),n&&t.splice(o,1))}}const Wl=["","webkit","Moz","MS","ms","o"];function Hl(e,t){const n=t[0].toUpperCase()+t.slice(1);for(const s of Wl){const r=s?s+n:t;if(r in e)return r}}const $l={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class Xl{constructor(e,t){this.options={...$l,...t,cssProps:{...$l.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new zl(this),this.touchAction=new Pl(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?2:1}recognize(e){const{session:t}=this;if(t.stopped)return;let n;this.session.prevented&&e.srcEvent.preventDefault();const{recognizers:s}=this;let{curRecognizer:r}=t;(!r||r&&r.state&El.Recognized)&&(r=t.curRecognizer=null);let i=0;for(;i<s.length;)n=s[i],2===t.stopped||r&&n!==r&&!n.canRecognizeWith(r)?n.reset():n.recognize(e),!r&&n.state&(El.Began|El.Changed|El.Ended)&&(r=t.curRecognizer=n),i++}get(e){const{recognizers:t}=this;for(let n=0;n<t.length;n++)if(t[n].options.event===e)return t[n];return null}add(e){if(Array.isArray(e)){for(const t of e)this.add(t);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const t of e)this.remove(t);return this}const t="string"==typeof e?this.get(e):e;if(t){const{recognizers:e}=this,n=e.indexOf(t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:n}=this;for(const s of kl(e))n[s]=n[s]||[],n[s].push(t)}off(e,t){if(!e)return;const{handlers:n}=this;for(const s of kl(e))t?n[s]&&n[s].splice(n[s].indexOf(t),1):delete n[s]}emit(e,t){const n=this.handlers[e]&&this.handlers[e].slice();if(!n||!n.length)return;const s=t;s.type=e,s.preventDefault=function(){t.srcEvent.preventDefault()};let r=0;for(;r<n.length;)n[r](s),r++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[n,s]of Object.entries(this.options.cssProps)){const r=Hl(t.style,n);e?(this.oldCssProps[r]=t.style[r],t.style[r]=s):t.style[r]=this.oldCssProps[r]||""}e||(this.oldCssProps={})}}}let ql=1;function Yl(e){return e&El.Cancelled?"cancel":e&El.Ended?"end":e&El.Changed?"move":e&El.Began?"start":""}class Kl{constructor(e){this.options=e,this.id=ql++,this.state=El.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const t of e)this.recognizeWith(t);return this}let t;if("string"==typeof e){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:n}=this;return n[t.id]||(n[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const t of e)this.dropRecognizeWith(t);return this}let t;return t="string"==typeof e?this.manager.get(e):e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const t of e)this.requireFailure(t);return this}let t;if("string"==typeof e){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:n}=this;return-1===n.indexOf(t)&&(n.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const t of e)this.dropRequireFailure(t);return this}let t;if(t="string"==typeof e?this.manager.get(e):e,t){const e=this.requireFail.indexOf(t);e>-1&&this.requireFail.splice(e,1)}return this}hasRequireFailures(){return Boolean(this.requireFail.find(e=>e.options.enable))}canRecognizeWith(e){return Boolean(this.simultaneous[e.id])}emit(e){if(!e)return;const{state:t}=this;t<El.Ended&&this.manager.emit(this.options.event+Yl(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=El.Ended&&this.manager.emit(this.options.event+Yl(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=El.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(El.Failed|El.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable)return this.reset(),void(this.state=El.Failed);this.state&(El.Recognized|El.Cancelled|El.Failed)&&(this.state=El.Possible),this.state=this.process(t),this.state&(El.Began|El.Changed|El.Ended|El.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class Zl extends Kl{attrTest(e){const t=this.options.pointers;return 0===t||e.pointers.length===t}process(e){const{state:t}=this,{eventType:n}=e,s=t&(El.Began|El.Changed),r=this.attrTest(e);return s&&(n&bl.Cancel||!r)?t|El.Cancelled:s||r?n&bl.End?t|El.Ended:t&El.Began?t|El.Changed:El.Began:El.Failed}}class Ql extends Kl{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[Sl]}process(e){const{options:t}=this,n=e.pointers.length===t.pointers,s=e.distance<t.threshold,r=e.deltaTime<t.time;if(this.reset(),e.eventType&bl.Start&&0===this.count)return this.failTimeout();if(s&&r&&n){if(e.eventType!==bl.End)return this.failTimeout();const n=!this.pTime||e.timeStamp-this.pTime<t.interval,s=!this.pCenter||Fl(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,s&&n?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=El.Recognized,this.tryEmit(this._input)},t.interval),El.Began):El.Recognized}return El.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=El.Failed},this.options.interval),El.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===El.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const Jl=["","start","move","end","cancel","up","down","left","right"];class ec extends Zl{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:xl.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&xl.Horizontal&&t.push(Cl),e&xl.Vertical&&t.push(Rl),t}getEventNames(){return Jl.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let n=!0,{distance:s}=e,{direction:r}=e;const i=e.deltaX,o=e.deltaY;return r&t.direction||(t.direction&xl.Horizontal?(r=0===i?xl.None:i<0?xl.Left:xl.Right,n=i!==this.pX,s=Math.abs(e.deltaX)):(r=0===o?xl.None:o<0?xl.Up:xl.Down,n=o!==this.pY,s=Math.abs(e.deltaY))),e.direction=r,n&&s>t.threshold&&Boolean(r&t.direction)}attrTest(e){return super.attrTest(e)&&(Boolean(this.state&El.Began)||!(this.state&El.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=xl[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const tc=["","start","move","end","cancel","in","out"];class nc{constructor(e,t,n){this.element=e,this.callback=t,this.options=n}}const sc=-1!==("undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"").indexOf("firefox"),rc=4.000244140625;class ic extends nc{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=e=>{if(!this.options.enable)return;let t=e.deltaY;globalThis.WheelEvent&&(sc&&e.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(t/=globalThis.devicePixelRatio),e.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(t*=40)),0!==t&&t%rc===0&&(t=Math.floor(t/rc)),e.shiftKey&&t&&(t*=.25),this.callback({type:"wheel",center:{x:e.clientX,y:e.clientY},delta:-t,srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){"wheel"===e&&(this.options.enable=t)}}const oc=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class ac extends nc{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=e=>{this.handleOverEvent(e),this.handleOutEvent(e),this.handleEnterEvent(e),this.handleLeaveEvent(e),this.handleMoveEvent(e)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,oc.forEach(t=>e.addEventListener(t,this.handleEvent))}destroy(){oc.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t}}handleOverEvent(e){this.enableOverEvent&&"mouseover"===e.type&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&"mouseout"===e.type&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&"mouseenter"===e.type&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&"mouseleave"===e.type&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":0===e.buttons&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const lc=["keydown","keyup"];class cc extends nc{constructor(e,t,n){super(e,t,{enable:!0,tabIndex:0,...n}),this.handleEvent=e=>{const t=e.target||e.srcElement;"INPUT"===t.tagName&&"text"===t.type||"TEXTAREA"===t.tagName||(this.enableDownEvent&&"keydown"===e.type&&this.callback({type:"keydown",srcEvent:e,key:e.key,target:e.target}),this.enableUpEvent&&"keyup"===e.type&&this.callback({type:"keyup",srcEvent:e,key:e.key,target:e.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",lc.forEach(t=>e.addEventListener(t,this.handleEvent))}destroy(){lc.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){"keydown"===e&&(this.enableDownEvent=t),"keyup"===e&&(this.enableUpEvent=t)}}class uc extends nc{constructor(e,t,n){super(e,t,n),this.handleEvent=e=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){"contextmenu"===e&&(this.options.enable=t)}}const hc={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4};function dc(e){const t=hc[e.srcEvent.type];if(!t)return null;const{buttons:n,button:s}=e.srcEvent;let r=!1,i=!1,o=!1;return 2===t?(r=Boolean(1&n),i=Boolean(4&n),o=Boolean(2&n)):(r=0===s,i=1===s,o=2===s),{leftButton:r,middleButton:i,rightButton:o}}function fc(e,t){const n=e.center;if(!n)return null;const s=t.getBoundingClientRect(),r=s.width/t.offsetWidth||1,i=s.height/t.offsetHeight||1;return{center:n,offsetCenter:{x:(n.x-s.left-t.clientLeft)/r,y:(n.y-s.top-t.clientTop)/i}}}const pc={srcElement:"root",priority:0};class gc{constructor(e,t){this.handleEvent=e=>{if(this.isEmpty())return;const t=this._normalizeEvent(e);let n=e.srcEvent.target;for(;n&&n!==t.rootElement;){if(this._emit(t,n),t.handled)return;n=n.parentNode}this._emit(t,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,n,s=!1,r=!1){const{handlers:i,handlersByElement:o}=this,a={...pc,...n};let l=o.get(a.srcElement);l||(l=[],o.set(a.srcElement,l));const c={type:e,handler:t,srcElement:a.srcElement,priority:a.priority};s&&(c.once=!0),r&&(c.passive=!0),i.push(c),this._active=this._active||!c.passive;let u=l.length-1;for(;u>=0&&!(l[u].priority>=c.priority);)u--;l.splice(u+1,0,c)}remove(e,t){const{handlers:n,handlersByElement:s}=this;for(let r=n.length-1;r>=0;r--){const i=n[r];if(i.type===e&&i.handler===t){n.splice(r,1);const e=s.get(i.srcElement);e.splice(e.indexOf(i),1),0===e.length&&s.delete(i.srcElement)}}this._active=n.some(e=>!e.passive)}_emit(e,t){const n=this.handlersByElement.get(t);if(n){let t=!1;const s=()=>{e.handled=!0},r=()=>{e.handled=!0,t=!0},i=[];for(let o=0;o<n.length;o++){const{type:a,handler:l,once:c}=n[o];if(l({...e,type:a,stopPropagation:s,stopImmediatePropagation:r}),c&&i.push(n[o]),t)break}for(let e=0;e<i.length;e++){const{type:t,handler:n}=i[e];this.remove(t,n)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...dc(e),...fc(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function mc(e){if("recognizer"in e)return e;let t;const n=Array.isArray(e)?[...e]:[e];return t="function"==typeof n[0]?new(n.shift())(n.shift()||{}):n.shift(),{recognizer:t,recognizeWith:"string"==typeof n[0]?[n[0]]:n[0],requireFailure:"string"==typeof n[1]?[n[1]]:n[1]}}class _c{constructor(e=null,t={}){if(this._onBasicInput=e=>{this.manager.emit(e.srcEvent.type,e)},this._onOtherEvent=e=>{this.manager.emit(e.type,e)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,e){this.manager=new Xl(e,this.options);for(const e of this.options.recognizers){const{recognizer:t,recognizeWith:n,requireFailure:s}=mc(e);this.manager.add(t),n&&t.recognizeWith(n),s&&t.requireFailure(s)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new ic(e,this._onOtherEvent,{enable:!1}),this.moveInput=new ac(e,this._onOtherEvent,{enable:!1}),this.keyInput=new cc(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new uc(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,n){this._addEventHandler(e,t,n,!1)}once(e,t,n){this._addEventHandler(e,t,n,!0)}watch(e,t,n){this._addEventHandler(e,t,n,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){var n,s,r,i;const{manager:o}=this;if(!o)return;const a=o.get(e);a&&(a.set({enable:t}),o.touchAction.update()),null==(n=this.wheelInput)||n.enableEventType(e,t),null==(s=this.moveInput)||s.enableEventType(e,t),null==(r=this.keyInput)||r.enableEventType(e,t),null==(i=this.contextmenuInput)||i.enableEventType(e,t)}_addEventHandler(e,t,n,s,r){if("string"!=typeof e){n=t;for(const[t,i]of Object.entries(e))this._addEventHandler(t,i,n,s,r);return}const{manager:i,events:o}=this;if(!i)return;let a=o.get(e);if(!a){const t=this._getRecognizerName(e)||e;a=new gc(this,t),o.set(e,a),i&&i.on(e,a.handleEvent)}a.add(e,t,n,s,r),a.isEmpty()||this._toggleRecognizer(a.recognizerName,!0)}_removeEventHandler(e,t){if("string"!=typeof e){for(const[t,n]of Object.entries(e))this._removeEventHandler(t,n);return}const{events:n}=this,s=n.get(e);if(s&&(s.remove(e,t),s.isEmpty())){const{recognizerName:e}=s;let t=!1;for(const s of n.values())if(s.recognizerName===e&&!s.isEmpty()){t=!0;break}t||this._toggleRecognizer(e,!1)}}_getRecognizerName(e){var t;return null==(t=this.manager.recognizers.find(t=>t.getEventNames().includes(e)))?void 0:t.options.event}}const yc={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(yc,"IDENTITY",{get:()=>(On.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const bc={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},vc={common:0,meters:1,pixels:2},xc={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},wc={multipan:[ec,{threshold:10,direction:xl.Vertical,pointers:2}],pinch:[class extends Zl{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Al]}getEventNames(){return tc.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||Boolean(this.state&El.Began))}emit(e){if(1!==e.scale){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}},{},null,["multipan"]],pan:[ec,{threshold:1},["pinch"],["multipan"]],dblclick:[Ql,{event:"dblclick",taps:2}],click:[Ql,{event:"click"},null,["dblclick"]]};function Ec(e,t){if(e===t)return!0;if(Array.isArray(e)){const n=e.length;if(!t||t.length!==n)return!1;for(let s=0;s<n;s++)if(e[s]!==t[s])return!1;return!0}return!1}function Tc(e){let t,n={};return s=>{for(const r in s)if(!Ec(s[r],n[r])){t=e(s),n=s;break}return t}}const Sc=[0,0,0,0],Ac=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Rc=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Cc=[0,0,0],Pc=[0,0,0],kc=Tc(function({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:s}){const{projectionCenter:r,viewProjectionMatrix:i,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=function(e,t,n){const{viewMatrixUncentered:s,projectionMatrix:r}=e;let{viewMatrix:i,viewProjectionMatrix:o}=e,a=Sc,l=Sc,c=e.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:d}=Ic(e,t,n);return d&&(l=e.projectPosition(u||h),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=Ja([],l,o),i=s||i,o=Xa([],r,i),o=Xa([],o,Ac)),{viewMatrix:i,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:h,geospatialOrigin:u}}(e,n,s),u=e.getDistanceScales(),h=[e.width*t,e.height*t],d=Ja([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,f={coordinateSystem:n,projectionMode:e.projectionMode,coordinateOrigin:l,commonOrigin:o.slice(0,3),center:r,pseudoMeters:Boolean(e._pseudoMeters),viewportSize:h,devicePixelRatio:t,focalDistance:d,commonUnitsPerMeter:u.unitsPerMeter,commonUnitsPerWorldUnit:u.unitsPerMeter,commonUnitsPerWorldUnit2:Cc,scale:e.scale,wrapLongitude:!1,viewProjectionMatrix:i,modelMatrix:Rc,cameraPosition:a};if(c){const t=e.getDistanceScales(c);switch(n){case yc.METER_OFFSETS:f.commonUnitsPerWorldUnit=t.unitsPerMeter,f.commonUnitsPerWorldUnit2=t.unitsPerMeter2;break;case yc.LNGLAT:case yc.LNGLAT_OFFSETS:e._pseudoMeters||(f.commonUnitsPerMeter=t.unitsPerMeter),f.commonUnitsPerWorldUnit=t.unitsPerDegree,f.commonUnitsPerWorldUnit2=t.unitsPerDegree2;break;case yc.CARTESIAN:f.commonUnitsPerWorldUnit=[1,1,t.unitsPerMeter[2]],f.commonUnitsPerWorldUnit2=[0,0,t.unitsPerMeter2[2]]}}return f});function Ic(e,t,n=Pc){n.length<3&&(n=[n[0],n[1],0]);let s,r=n,i=!0;switch(s=t===yc.LNGLAT_OFFSETS||t===yc.METER_OFFSETS?n:e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case bc.WEB_MERCATOR:t!==yc.LNGLAT&&t!==yc.CARTESIAN||(s=[0,0,0],i=!1);break;case bc.WEB_MERCATOR_AUTO_OFFSET:t===yc.LNGLAT?r=s:t===yc.CARTESIAN&&(r=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],s=e.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case bc.IDENTITY:r=e.position.map(Math.fround),r[2]=r[2]||0;break;case bc.GLOBE:i=!1,s=null;break;default:i=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:r,offsetMode:i}}const Mc=`${Object.keys(yc).map(e=>`const COORDINATE_SYSTEM_${e}: i32 = ${yc[e]};`).join("")}\n${Object.keys(bc).map(e=>`const PROJECTION_MODE_${e}: i32 = ${bc[e]};`).join("")}\n${Object.keys(vc).map(e=>`const UNIT_${e.toUpperCase()}: i32 = ${vc[e]};`).join("")}\n\nconst TILE_SIZE: f32 = 512.0;\nconst PI: f32 = 3.1415926536;\nconst WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);\nconst ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);\nconst EARTH_RADIUS: f32 = 6370972.0; // meters\nconst GLOBE_RADIUS: f32 = 256.0;\n\n// -----------------------------------------------------------------------------\n// Uniform block (converted from GLSL uniform block)\n// -----------------------------------------------------------------------------\nstruct ProjectUniforms {\n  wrapLongitude: i32,\n  coordinateSystem: i32,\n  commonUnitsPerMeter: vec3<f32>,\n  projectionMode: i32,\n  scale: f32,\n  commonUnitsPerWorldUnit: vec3<f32>,\n  commonUnitsPerWorldUnit2: vec3<f32>,\n  center: vec4<f32>,\n  modelMatrix: mat4x4<f32>,\n  viewProjectionMatrix: mat4x4<f32>,\n  viewportSize: vec2<f32>,\n  devicePixelRatio: f32,\n  focalDistance: f32,\n  cameraPosition: vec3<f32>,\n  coordinateOrigin: vec3<f32>,\n  commonOrigin: vec3<f32>,\n  pseudoMeters: i32,\n};\n\n@group(0) @binding(0)\nvar<uniform> project: ProjectUniforms;\n\n// -----------------------------------------------------------------------------\n// Geometry data\n// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,\n// you might supply this via vertex attributes or a uniform. Here we define a\n// uniform struct for demonstration.)\n// -----------------------------------------------------------------------------\n\n// Structure to carry additional geometry data used by deck.gl filters.\nstruct Geometry {\n  worldPosition: vec3<f32>,\n  worldPositionAlt: vec3<f32>,\n  position: vec4<f32>,\n  normal: vec3<f32>,\n  uv: vec2<f32>,\n  pickingColor: vec3<f32>,\n};\n\n// @group(0) @binding(1)\nvar<private> geometry: Geometry;\n\n\n// -----------------------------------------------------------------------------\n// Functions\n// -----------------------------------------------------------------------------\n\n// Returns an adjustment factor for commonUnitsPerMeter\nfn _project_size_at_latitude(lat: f32) -> f32 {\n  let y = clamp(lat, -89.9, 89.9);\n  return 1.0 / cos(radians(y));\n}\n\n// Overloaded version: scales a value in meters at a given latitude.\nfn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {\n  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);\n}\n\n// Computes a non-linear scale factor based on geometry.\n// (Note: This function relies on "geometry" being provided.)\nfn project_size() -> f32 {\n  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&\n      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\n      project.pseudoMeters == 0) {\n    if (geometry.position.w == 0.0) {\n      return _project_size_at_latitude(geometry.worldPosition.y);\n    }\n    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\n    let y2 = y * y;\n    let y4 = y2 * y2;\n    let y6 = y4 * y2;\n    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n  }\n  return 1.0;\n}\n\n// Overloads to scale offsets (meters to world units)\nfn project_size_float(meters: f32) -> f32 {\n  return meters * project.commonUnitsPerMeter.z * project_size();\n}\n\nfn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {\n  return meters * project.commonUnitsPerMeter.xy * project_size();\n}\n\nfn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {\n  return meters * project.commonUnitsPerMeter * project_size();\n}\n\nfn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {\n  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);\n}\n\n// Returns a rotation matrix aligning the zâ€‘axis with the given up vector.\nfn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {\n  let uz = normalize(up);\n  let ux = select(\n    vec3<f32>(1.0, 0.0, 0.0),\n    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),\n    abs(uz.z) == 1.0\n  );\n  let uy = cross(uz, ux);\n  return mat3x3<f32>(ux, uy, uz);\n}\n\n// Since WGSL does not support "out" parameters, we return a struct.\nstruct RotationResult {\n  needsRotation: bool,\n  transform: mat3x3<f32>,\n};\n\nfn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {\n  if (project.projectionMode == PROJECTION_MODE_GLOBE) {\n    return RotationResult(true, project_get_orientation_matrix(commonPosition));\n  } else {\n    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed\n  };\n}\n\n// Projects a normal vector from the current coordinate system to world space.\nfn project_normal(vector: vec3<f32>) -> vec3<f32> {\n  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);\n  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);\n  let rotResult = project_needs_rotation(geometry.position.xyz);\n  if (rotResult.needsRotation) {\n    n = rotResult.transform * n;\n  }\n  return n;\n}\n\n// Applies a scale offset based on y-offset (dy)\nfn project_offset_(offset: vec4<f32>) -> vec4<f32> {\n  let dy: f32 = offset.y;\n  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;\n  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\n\n// Projects lng/lat coordinates to a unit tile [0,1]\nfn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {\n  var x = lnglat.x;\n  if (project.wrapLongitude != 0) {\n    x = ((x + 180.0) % 360.0) - 180.0;\n  }\n  let y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2<f32>(\n    radians(x) + PI,\n    PI + log(tan(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\n// Projects lng/lat/z coordinates for a globe projection.\nfn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {\n  let lambda = radians(lnglatz.x);\n  let phi = radians(lnglatz.y);\n  let cosPhi = cos(phi);\n  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\n  return vec3<f32>(\n    sin(lambda) * cosPhi,\n    -cos(lambda) * cosPhi,\n    sin(phi)\n  ) * D;\n}\n\n// Projects positions (with an optional 64-bit low part) from the input\n// coordinate system to the common space.\nfn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {\n  var position_world = project.modelMatrix * position;\n\n  // Work around for a Mac+NVIDIA bug:\n  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {\n    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4<f32>(\n        project_mercator_(position_world.xy),\n        _project_size_at_latitude_m(position_world.z, position_world.y),\n        position_world.w\n      );\n    }\n    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\n      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);\n    }\n  }\n  if (project.projectionMode == PROJECTION_MODE_GLOBE) {\n    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4<f32>(\n        project_globe_(position_world.xyz),\n        position_world.w\n      );\n    }\n  }\n  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {\n        return vec4<f32>(\n          project_mercator_(position_world.xy) - project.commonOrigin.xy,\n          project_size_float(position_world.z),\n          position_world.w\n        );\n      }\n    }\n  }\n  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||\n      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\n    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);\n  }\n\n  return project_offset_(position_world) +\n         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));\n}\n\n// Overloaded versions for different input types.\nfn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {\n  return project_position_vec4_f64(position, ZERO_64_LOW);\n}\n\nfn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {\n  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);\n  return projected_position.xyz;\n}\n\nfn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {\n  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);\n  return projected_position.xyz;\n}\n\nfn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {\n  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);\n  return projected_position.xy;\n}\n\n// Transforms a common space position to clip space.\nfn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {\n  return viewProjectionMatrix * position + center;\n}\n\n// Uses the project viewProjectionMatrix and center.\nfn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {\n  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);\n}\n\n// Returns a clip space offset corresponding to a given number of screen pixels.\nfn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {\n  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;\n  return offset * project.focalDistance;\n}\n\nfn project_meter_size_to_pixel(meters: f32) -> f32 {\n  return project_size_float(meters) * project.scale;\n}\n\nfn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {\n  if (unit == UNIT_METERS) {\n    return project_meter_size_to_pixel(size);\n  } else if (unit == UNIT_COMMON) {\n    return size * project.scale;\n  }\n  // UNIT_PIXELS: no scaling applied.\n  return size;\n}\n\nfn project_pixel_size_float(pixels: f32) -> f32 {\n  return pixels / project.scale;\n}\n\nfn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {\n  return pixels / project.scale;\n}\n`,Lc=Object.keys(yc).map(e=>`const int COORDINATE_SYSTEM_${e} = ${yc[e]};`).join(""),Nc=Object.keys(bc).map(e=>`const int PROJECTION_MODE_${e} = ${bc[e]};`).join(""),Oc=Object.keys(vc).map(e=>`const int UNIT_${e.toUpperCase()} = ${vc[e]};`).join(""),Fc={},Dc={name:"project",dependencies:[{name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n\n// All these functions are for substituting tan() function from Intel GPU only\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n\n    // 2pi range reduction\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 1.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 1.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n"},yl],source:Mc,vs:`${Lc}\n${Nc}\n${Oc}\nuniform projectUniforms {\nbool wrapLongitude;\nint coordinateSystem;\nvec3 commonUnitsPerMeter;\nint projectionMode;\nfloat scale;\nvec3 commonUnitsPerWorldUnit;\nvec3 commonUnitsPerWorldUnit2;\nvec4 center;\nmat4 modelMatrix;\nmat4 viewProjectionMatrix;\nvec2 viewportSize;\nfloat devicePixelRatio;\nfloat focalDistance;\nvec3 cameraPosition;\nvec3 coordinateOrigin;\nvec3 commonOrigin;\nbool pseudoMeters;\n} project;\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0;\nconst float GLOBE_RADIUS = 256.0;\nfloat project_size_at_latitude(float lat) {\nfloat y = clamp(lat, -89.9, 89.9);\nreturn 1.0 / cos(radians(y));\n}\nfloat project_size() {\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&\nproject.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\nproject.pseudoMeters == false) {\nif (geometry.position.w == 0.0) {\nreturn project_size_at_latitude(geometry.worldPosition.y);\n}\nfloat y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\nfloat y2 = y * y;\nfloat y4 = y2 * y2;\nfloat y6 = y4 * y2;\nreturn 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n}\nreturn 1.0;\n}\nfloat project_size_at_latitude(float meters, float lat) {\nreturn meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);\n}\nfloat project_size(float meters) {\nreturn meters * project.commonUnitsPerMeter.z * project_size();\n}\nvec2 project_size(vec2 meters) {\nreturn meters * project.commonUnitsPerMeter.xy * project_size();\n}\nvec3 project_size(vec3 meters) {\nreturn meters * project.commonUnitsPerMeter * project_size();\n}\nvec4 project_size(vec4 meters) {\nreturn vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);\n}\nmat3 project_get_orientation_matrix(vec3 up) {\nvec3 uz = normalize(up);\nvec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\nvec3 uy = cross(uz, ux);\nreturn mat3(ux, uy, uz);\n}\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\nif (project.projectionMode == PROJECTION_MODE_GLOBE) {\ntransform = project_get_orientation_matrix(commonPosition);\nreturn true;\n}\nreturn false;\n}\nvec3 project_normal(vec3 vector) {\nvec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);\nvec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);\nmat3 rotation;\nif (project_needs_rotation(geometry.position.xyz, rotation)) {\nn = rotation * n;\n}\nreturn n;\n}\nvec4 project_offset_(vec4 offset) {\nfloat dy = offset.y;\nvec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;\nreturn vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\nfloat x = lnglat.x;\nif (project.wrapLongitude) {\nx = mod(x + 180., 360.0) - 180.;\n}\nfloat y = clamp(lnglat.y, -89.9, 89.9);\nreturn vec2(\nradians(x) + PI,\nPI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))\n) * WORLD_SCALE;\n}\nvec3 project_globe_(vec3 lnglatz) {\nfloat lambda = radians(lnglatz.x);\nfloat phi = radians(lnglatz.y);\nfloat cosPhi = cos(phi);\nfloat D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\nreturn vec3(\nsin(lambda) * cosPhi,\n-cos(lambda) * cosPhi,\nsin(phi)\n) * D;\n}\nvec4 project_position(vec4 position, vec3 position64Low) {\nvec4 position_world = project.modelMatrix * position;\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn vec4(\nproject_mercator_(position_world.xy),\nproject_size_at_latitude(position_world.z, position_world.y),\nposition_world.w\n);\n}\nif (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\nposition_world.xyz += project.coordinateOrigin;\n}\n}\nif (project.projectionMode == PROJECTION_MODE_GLOBE) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn vec4(\nproject_globe_(position_world.xyz),\nposition_world.w\n);\n}\n}\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nif (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {\nreturn vec4(\nproject_mercator_(position_world.xy) - project.commonOrigin.xy,\nproject_size(position_world.z),\nposition_world.w\n);\n}\n}\n}\nif (project.projectionMode == PROJECTION_MODE_IDENTITY ||\n(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\nproject.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\nposition_world.xyz -= project.coordinateOrigin;\n}\nreturn project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));\n}\nvec4 project_position(vec4 position) {\nreturn project_position(position, ZERO_64_LOW);\n}\nvec3 project_position(vec3 position, vec3 position64Low) {\nvec4 projected_position = project_position(vec4(position, 1.0), position64Low);\nreturn projected_position.xyz;\n}\nvec3 project_position(vec3 position) {\nvec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\nreturn projected_position.xyz;\n}\nvec2 project_position(vec2 position) {\nvec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\nreturn projected_position.xy;\n}\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\nreturn viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\nreturn project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\nvec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;\nreturn offset * project.focalDistance;\n}\nfloat project_size_to_pixel(float meters) {\nreturn project_size(meters) * project.scale;\n}\nfloat project_size_to_pixel(float size, int unit) {\nif (unit == UNIT_METERS) return project_size_to_pixel(size);\nif (unit == UNIT_COMMON) return size * project.scale;\nreturn size;\n}\nfloat project_pixel_size(float pixels) {\nreturn pixels / project.scale;\n}\nvec2 project_pixel_size(vec2 pixels) {\nreturn pixels / project.scale;\n}\n`,getUniforms:function(e=Fc){return"viewport"in e?function({viewport:e,devicePixelRatio:t=1,modelMatrix:n=null,coordinateSystem:s=yc.DEFAULT,coordinateOrigin:r=Pc,autoWrapLongitude:i=!1}){s===yc.DEFAULT&&(s=e.isGeospatial?yc.LNGLAT:yc.CARTESIAN);const o=kc({viewport:e,devicePixelRatio:t,coordinateSystem:s,coordinateOrigin:r});return o.wrapLongitude=i,o.modelMatrix=n||Rc,o}(e):{}},uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},Bc={name:"project32",dependencies:[Dc],source:"// Define a structure to hold both the clip-space position and the common position.\nstruct ProjectResult {\n  clipPosition: vec4<f32>,\n  commonPosition: vec4<f32>,\n};\n\n// This function mimics the GLSL version with the 'out' parameter by returning both values.\nfn project_position_to_clipspace_and_commonspace(\n    position: vec3<f32>,\n    position64Low: vec3<f32>,\n    offset: vec3<f32>\n) -> ProjectResult {\n  // Compute the projected position.\n  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);\n\n  // Start with the provided offset.\n  var finalOffset: vec3<f32> = offset;\n\n  // Get whether a rotation is needed and the rotation matrix.\n  let rotationResult = project_needs_rotation(projectedPosition);\n\n  // If rotation is needed, update the offset.\n  if (rotationResult.needsRotation) {\n    finalOffset = rotationResult.transform * offset;\n  }\n\n  // Compute the common position.\n  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);\n\n  // Convert to clip-space.\n  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);\n\n  return ProjectResult(clipPosition, commonPosition);\n}\n\n// A convenience overload that returns only the clip-space position.\nfn project_position_to_clipspace(\n    position: vec3<f32>,\n    position64Low: vec3<f32>,\n    offset: vec3<f32>\n) -> vec4<f32> {\n  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;\n}\n",vs:"vec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  mat3 rotation;\n  if (project_needs_rotation(projectedPosition, rotation)) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n"};function Uc(e,t){const n=Ja([],t,e);return Qa(n,n,1/n[3]),n}function jc(e,t){const n=e%t;return n<0?t+n:n}function Gc(e,t,n){return e<t?t:e>n?n:e}const Vc=Math.log2||function(e){return Math.log(e)*Math.LOG2E};function zc(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const Wc=Math.PI,Hc=Wc/4,$c=Wc/180,Xc=180/Wc,qc=512,Yc=85.051129,Kc=1.5;function Zc(e){const[t,n]=e;zc(Number.isFinite(t)),zc(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const s=n*$c;return[qc*(t*$c+Wc)/(2*Wc),qc*(Wc+Math.log(Math.tan(Hc+.5*s)))/(2*Wc)]}function Qc(e){const[t,n]=e,s=t/qc*(2*Wc)-Wc,r=2*(Math.atan(Math.exp(n/qc*(2*Wc)-Wc))-Hc);return[s*Xc,r*Xc]}function Jc(e){return 12790407194604047e-21/Math.cos(e*$c)}function eu(e){const{latitude:t,longitude:n,highPrecision:s=!1}=e;zc(Number.isFinite(t)&&Number.isFinite(n));const r=Math.cos(t*$c),i=512/360,o=i/r,a=12790407194604047e-21/r,l={unitsPerMeter:[a,a,a],metersPerUnit:[1/a,1/a,1/a],unitsPerDegree:[i,o,a],degreesPerUnit:[.703125,1/o,1/a]};if(s){const e=$c*Math.tan(t*$c)/r,n=i*e/2,s=12790407194604047e-21*e,c=s/o*a;l.unitsPerDegree2=[0,n,s],l.unitsPerMeter2=[c,0,c]}return l}function tu(e,t){const[n,s,r]=e,[i,o,a]=t,{unitsPerMeter:l,unitsPerMeter2:c}=eu({longitude:n,latitude:s,highPrecision:!0}),u=Zc(e);u[0]+=i*(l[0]+c[0]*o),u[1]+=o*(l[1]+c[1]*o);const h=Qc(u),d=(r||0)+(a||0);return Number.isFinite(r)||Number.isFinite(a)?[h[0],h[1],d]:h}function nu(e){return 2*Math.atan(.5/e)*Xc}function su(e){return.5/Math.tan(.5*e*$c)}function ru(e,t){const[n,s,r=0]=e;return zc(Number.isFinite(n)&&Number.isFinite(s)&&Number.isFinite(r)),Uc(t,[n,s,r,1])}function iu(e,t,n=0){const[s,r,i]=e;if(zc(Number.isFinite(s)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(i))return Uc(t,[s,r,i,1]);const o=Uc(t,[s,r,0,1]),a=Uc(t,[s,r,1,1]),l=o[2],c=a[2];return Da([],o,a,l===c?0:((n||0)-l)/(c-l))}const ou=Math.PI/180;function au(e,t,n){const{pixelUnprojectionMatrix:s}=e,r=Uc(s,[t,0,1,1]),i=Uc(s,[t,e.height,1,1]),o=Qc(Da([],r,i,(n*e.distanceScales.unitsPerMeter[2]-r[2])/(i[2]-r[2])));return o.push(n),o}const lu="\nuniform shadowUniforms {\n  bool drawShadowMap;\n  bool useShadowMap;\n  vec4 color;\n  highp int lightId;\n  float lightCount;\n  mat4 viewProjectionMatrix0;\n  mat4 viewProjectionMatrix1;\n  vec4 projectCenter0;\n  vec4 projectCenter1;\n} shadow;\n",cu=`\n${lu}\n\nconst int max_lights = 2;\n\nout vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  mat4 viewProjectionMatrices[max_lights];\n  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;\n  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;\n  vec4 projectCenters[max_lights];\n  projectCenters[0] = shadow.projectCenter0;\n  projectCenters[1] = shadow.projectCenter1;\n\n  if (shadow.drawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);\n  }\n  if (shadow.useShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow.lightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n\n`,uu=`\n${lu}\n\nconst int max_lights = 2;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\n\nin vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow.drawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow.useShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow.lightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow.color.a / shadow.lightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n\n`,hu=Tc(function({viewport:e,center:t}){return new al(e.viewProjectionMatrix).invert().transform(t)}),du=Tc(function({viewport:e,shadowMatrices:t}){const n=[],s=e.pixelUnprojectionMatrix,r=e.isGeospatial?void 0:1,i=[[0,0,r],[e.width,0,r],[0,e.height,r],[e.width,e.height,r],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(e=>function(e,t){const[n,s,r]=e,i=iu([n,s,r],t);return Number.isFinite(r)?i:[i[0],i[1],0]}(e,s));for(const o of t){const t=o.clone().translate(new Wa(e.center).negate()),s=i.map(e=>t.transform(e)),r=(new al).ortho({left:Math.min(...s.map(e=>e[0])),right:Math.max(...s.map(e=>e[0])),bottom:Math.min(...s.map(e=>e[1])),top:Math.max(...s.map(e=>e[1])),near:Math.min(...s.map(e=>-e[2])),far:Math.max(...s.map(e=>-e[2]))});n.push(r.multiplyRight(o))}return n}),fu=[0,0,0,1],pu=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],gu={name:"shadow",dependencies:[Dc],vs:cu,fs:uu,inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    position = shadow_setVertexPosition(geometry.position);\n    ","fs:DECKGL_FILTER_COLOR":"\n    color = shadow_filterShadowColor(color);\n    "},getUniforms:function(e){const{shadowEnabled:t=!0,project:n}=e;if(!(t&&n&&e.shadowMatrices&&e.shadowMatrices.length))return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};const s=Dc.getUniforms(n),r=hu({viewport:n.viewport,center:s.center}),i=[],o=du({shadowMatrices:e.shadowMatrices,viewport:n.viewport}).slice();for(let l=0;l<e.shadowMatrices.length;l++){const e=o[l],t=e.clone().translate(new Wa(n.viewport.center).negate());s.coordinateSystem===yc.LNGLAT&&s.projectionMode===bc.WEB_MERCATOR?(o[l]=t,i[l]=r):(o[l]=e.clone().multiplyRight(pu),i[l]=t.transform(r))}const a={drawShadowMap:Boolean(e.drawToShadowMap),useShadowMap:!!e.shadowMaps&&e.shadowMaps.length>0,color:e.shadowColor||fu,lightId:e.shadowLightId||0,lightCount:e.shadowMatrices.length,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};for(let l=0;l<o.length;l++)a[`viewProjectionMatrix${l}`]=o[l],a[`projectCenter${l}`]=i[l];for(let l=0;l<2;l++)a[`shadow_uShadowMap${l}`]=e.shadowMaps&&e.shadowMaps[l]||e.dummyShadowMap;return a},uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},mu={...fl,defaultUniforms:{...fl.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    // for picking depth values\n    picking_setPickingAttribute(position.z / position.w);\n  ","vs:DECKGL_FILTER_COLOR":"\n  picking_setPickingColor(geometry.pickingColor);\n  ","fs:DECKGL_FILTER_COLOR":{order:99,injection:"\n  // use highlight color if this fragment belongs to the selected object.\n  color = picking_filterHighlightColor(color);\n\n  // use picking color if rendering to picking FBO.\n  color = picking_filterPickingColor(color);\n    "}}},_u=[yl],yu=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],bu=[];function vu(e){const t=xs.getDefaultShaderAssembler();for(const s of _u)t.addDefaultModule(s);t._hookFunctions.length=0;const n="glsl"===e?yu:bu;for(const s of n)t.addShaderHook(s);return t}const xu=[255,255,255],wu=1;let Eu=0;class Tu{constructor(e={}){this.type="ambient";const{color:t=xu}=e,{intensity:n=wu}=e;this.id=e.id||"ambient-"+Eu++,this.color=t,this.intensity=n}}const Su=[255,255,255],Au=1,Ru=[0,0,-1];let Cu=0;class Pu{constructor(e={}){this.type="directional";const{color:t=Su}=e,{intensity:n=Au}=e,{direction:s=Ru}=e,{_shadow:r=!1}=e;this.id=e.id||"directional-"+Cu++,this.color=t,this.intensity=n,this.type="directional",this.direction=new Wa(s).normalize().toArray(),this.shadow=r}getProjectedLight(e){return this}}class ku{constructor(e,t={id:"pass"}){const{id:n}=t;this.id=n,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Iu extends ku{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,n]=this.device.canvasContext.getDrawingBufferSize(),s=e.clearCanvas??!0,r=e.clearColor??(!!s&&[0,0,0,0]),i=!!s&&1,o=!!s&&0,a=e.colorMask??15,l={viewport:[0,0,t,n]};e.colorMask&&(l.colorMask=a),e.scissorRect&&(l.scissorRect=e.scissorRect);const c=this.device.beginRenderPass({framebuffer:e.target,parameters:l,clearColor:r,clearDepth:i,clearStencil:o});try{return this._drawLayers(c,e)}finally{c.end(),this.device.submit()}}_drawLayers(e,t){const{target:n,shaderModuleProps:s,viewports:r,views:i,onViewportActive:o,clearStack:a=!0}=t;t.pass=t.pass||"unknown",a&&(this._lastRenderIndex=-1);const l=[];for(const c of r){const r=i&&i[c.id];null==o||o(c);const a=this._getDrawLayerParams(c,t),u=c.subViewports||[c];for(const i of u){const o=this._drawLayersInViewport(e,{target:n,shaderModuleProps:s,viewport:i,view:r,pass:t.pass,layers:t.layers},a);l.push(o)}}return l}_getDrawLayerParams(e,{layers:t,pass:n,isPicking:s=!1,layerFilter:r,cullRect:i,effects:o,shaderModuleProps:a},l=!1){var c;const u=[],h=Mu(this._lastRenderIndex+1),d={layer:t[0],viewport:e,isPicking:s,renderPass:n,cullRect:i},f={};for(let p=0;p<t.length;p++){const s=t[p],i=this._shouldDrawLayer(s,d,r,f),g={shouldDrawLayer:i};i&&!l&&(g.shouldDrawLayer=!0,g.layerRenderIndex=h(s,i),g.shaderModuleProps=this._getShaderModuleProps(s,o,n,a),g.layerParameters={...null==(c=s.context.deck)?void 0:c.props.parameters,...this.getLayerParameters(s,p,e)}),u[p]=g}return u}_drawLayersInViewport(e,{layers:t,shaderModuleProps:n,pass:s,target:r,viewport:i,view:o},a){const l=function(e,{shaderModuleProps:t,target:n,viewport:s}){var r;const i=(null==(r=null==t?void 0:t.project)?void 0:r.devicePixelRatio)??e.canvasContext.cssToDeviceRatio(),[,o]=e.canvasContext.getDrawingBufferSize(),a=n?n.height:o,l=s;return[l.x*i,a-(l.y+l.height)*i,l.width*i,l.height*i]}(this.device,{shaderModuleProps:n,target:r,viewport:i});if(o){const{clear:e,clearColor:t,clearDepth:n,clearStencil:s}=o.props;if(e){let e=[0,0,0,0],i=1,o=0;Array.isArray(t)?e=[...t.slice(0,3),t[3]||255].map(e=>e/255):!1===t&&(e=!1),void 0!==n&&(i=n),void 0!==s&&(o=s),this.device.beginRenderPass({framebuffer:r,parameters:{viewport:l,scissorRect:l},clearColor:e,clearDepth:i,clearStencil:o}).end()}}const c={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:l});for(let h=0;h<t.length;h++){const n=t[h],r=a[h],{shouldDrawLayer:o}=r;if(o&&n.props.pickable&&c.pickableCount++,n.isComposite&&c.compositeCount++,n.isDrawable&&r.shouldDrawLayer){const{layerRenderIndex:t,shaderModuleProps:o,layerParameters:a}=r;c.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,t),o.project&&(o.project.viewport=i),n.context.renderPass=e;try{n._drawLayer({renderPass:e,shaderModuleProps:o,uniforms:{layerIndex:t},parameters:a})}catch(u){n.raiseError(u,`drawing ${n} to ${s}`)}}}return c}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,n){return null}getLayerParameters(e,t,n){return e.props.parameters}_shouldDrawLayer(e,t,n,s){if(!e.props.visible||!this.shouldDrawLayer(e))return!1;t.layer=e;let r=e.parent;for(;r;){if(!r.props.visible||!r.filterSubLayer(t))return!1;t.layer=r,r=r.parent}if(n){const e=t.layer.id;if(e in s||(s[e]=n(t)),!s[e])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,n,s){var r,i;const o=this.device.canvasContext.cssToDeviceRatio(),a=(null==(r=e.internalState)?void 0:r.propsInTransition)||e.props,l={layer:a,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:o,modelMatrix:a.modelMatrix,coordinateSystem:a.coordinateSystem,coordinateOrigin:a.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const c of t)Lu(l,null==(i=c.getShaderModuleProps)?void 0:i.call(c,e,l));return Lu(l,this.getShaderModuleProps(e,t,l),s)}}function Mu(e=0,t={}){const n={},s=(r,i)=>{const o=r.props._offset,a=r.id,l=r.parent&&r.parent.id;let c;if(l&&!(l in t)&&s(r.parent,!1),l in n){const e=n[l]=n[l]||Mu(t[l],t);c=e(r,i),n[a]=e}else Number.isFinite(o)?(c=o+(t[l]||0),n[a]=null):c=e;return i&&c>=e&&(e=c+1),t[a]=c,c};return s}function Lu(e,...t){for(const n of t)if(n)for(const t in n)e[t]?Object.assign(e[t],n[t]):e[t]=n[t];return e}class Nu extends Iu{constructor(e,t){super(e,t);const n=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),s=e.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:s})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),s=e.viewports[0],r=s.width*n,i=s.height*n;r===t.width&&i===t.height||t.resize({width:r,height:i}),super.render({...e,clearColor:[1,1,1,1],target:t,pass:"shadow"})}getLayerParameters(e,t,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return!1!==e.props.shadowEnabled}getShaderModuleProps(e,t,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const Ou={color:[255,255,255],intensity:1},Fu=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Du=[0,0,0,200/255];class Bu{constructor(e={}){this.id="lighting-effect",this.shadowColor=Du,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),n._addDefaultShaderModule(gu),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const n=e[t];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:n,onViewportActive:s,views:r}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let i=0;i<this.shadowPasses.length;i++)this.shadowPasses[i].render({layers:e,layerFilter:t,viewports:n,onViewportActive:s,views:r,shaderModuleProps:{shadow:{shadowLightId:i,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const n=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(e=>e.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},s={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(t=>t.getProjectedLight({layer:e})),pointLights:this.pointLights.map(t=>t.getProjectedLight({layer:e}))},r=e.props.material;return{shadow:n,lighting:s,phongMaterial:r,gouraudMaterial:r}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(gu))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const n=(new al).lookAt({eye:new Wa(t.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const n=new Nu(e);this.shadowPasses[t]=n}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:n}=this;e||0!==t.length||0!==n.length||(this.ambientLight=new Tu(Ou),this.directionalLights.push(new Pu(Fu[0]),new Pu(Fu[1])))}}const Uu=new class{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:n=1,type:s,padding:r=0,copy:i=!1,initialize:o=!1,maxCount:a}){const l=s||e&&e.constructor||Float32Array,c=t*n+r;if(ArrayBuffer.isView(e)){if(c<=e.length)return e;if(c*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new l(e.buffer,0,c)}let u=1/0;a&&(u=a*n+r);const h=this._allocate(l,c,o,u);return e&&i?h.set(e):o||h.fill(0,0,4),this._release(e),h}release(e){this._release(e)}_allocate(e,t,n,s){let r=Math.max(Math.ceil(t*this.opts.overAlloc),1);r>s&&(r=s);const i=this._pool,o=e.BYTES_PER_ELEMENT*r,a=i.findIndex(e=>e.byteLength>=o);if(a>=0){const t=new e(i.splice(a,1)[0],0,r);return n&&t.fill(0),t}return new e(r)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:n}=e,{byteLength:s}=n,r=t.findIndex(e=>e.byteLength>=s);r<0?t.push(n):(r>0||t.length<this.opts.poolSize)&&t.splice(r,0,n),t.length>this.opts.poolSize&&t.shift()}},ju=new Wa;function Gu(e,t,n,s){ju.set(e,t,n);const r=ju.len();return{distance:s/r,normal:new Wa(-e/r,-t/r,-n/r)}}function Vu(e){return e-Math.fround(e)}let zu;function Wu(e,t){const{size:n=1,startIndex:s=0}=t,r=void 0!==t.endIndex?t.endIndex:e.length,i=(r-s)/n;zu=Uu.allocate(zu,i,{type:Float32Array,size:2*n});let o=s,a=0;for(;o<r;){for(let t=0;t<n;t++){const s=e[o++];zu[a+t]=s,zu[a+t+n]=Vu(s)}a+=2*n}return zu.subarray(0,i*n*2)}function Hu(e){let t=null,n=!1;for(const s of e)s&&(t?(n||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],n=!0),t[0][0]=Math.min(t[0][0],s[0][0]),t[0][1]=Math.min(t[0][1],s[0][1]),t[1][0]=Math.max(t[1][0],s[1][0]),t[1][1]=Math.max(t[1][1],s[1][1])):t=s);return t}const $u=Math.PI/180,Xu=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],qu=[0,0,0],Yu={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class Ku{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||Yu,this.focalDistance=e.focalDistance||1,this.position=e.position||qu,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?bc.WEB_MERCATOR:bc.WEB_MERCATOR_AUTO_OFFSET:bc.IDENTITY}equals(e){return e instanceof Ku&&(this===e||e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Ca(e.projectionMatrix,this.projectionMatrix)&&Ca(e.viewMatrix,this.viewMatrix))}project(e,{topLeft:t=!0}={}){const n=ru(this.projectPosition(e),this.pixelProjectionMatrix),[s,r]=n,i=t?r:this.height-r;return 2===e.length?[s,i]:[s,i,n[2]]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[s,r,i]=e,o=t?r:this.height-r,a=n&&n*this.distanceScales.unitsPerMeter[2],l=iu([s,o,i],this.pixelUnprojectionMatrix,a),[c,u,h]=this.unprojectPosition(l);return Number.isFinite(i)?[c,u,h]:Number.isFinite(n)?[c,u,n]:[c,u]}projectPosition(e){const[t,n]=this.projectFlat(e);return[t,n,(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(e){const[t,n]=this.unprojectFlat(e);return[t,n,(e[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(e){if(this.isGeospatial){const t=Zc(e);return t[1]=Aa(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?Qc(e):e}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,0],t),s=this.unproject([this.width,0],t),r=this.unproject([0,this.height],t),i=this.unproject([this.width,this.height],t);return[Math.min(n[0],s[0],r[0],i[0]),Math.min(n[1],s[1],r[1],i[1]),Math.max(n[0],s[0],r[0],i[0]),Math.max(n[1],s[1],r[1],i[1])]}getDistanceScales(e){return e&&this.isGeospatial?eu({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:n=1,height:s=1}){return e<this.x+this.width&&this.x<e+n&&t<this.y+this.height&&this.y<t+s}getFrustumPlanes(){return this._frustumPlanes.near||Object.assign(this._frustumPlanes,{left:Gu((e=this.viewProjectionMatrix)[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:Gu(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:Gu(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:Gu(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:Gu(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:Gu(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}),this._frustumPlanes;var e}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=function(e){const{latitude:t}=e;zc(Number.isFinite(t));const n=Math.cos(t*$c);return Vc(4003e4*n)-9}({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||eu({latitude:n,longitude:t}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:r,modelMatrix:i}=e;let o=qu;if(r&&(o=i?new al(i).transformAsVector(r,[]):r),this.isGeospatial){const e=this.projectPosition([t,n,0]);this.center=new Wa(o).scale(this.distanceScales.unitsPerMeter).add(e)}else this.center=this.projectPosition(o)}_initMatrices(e){const{viewMatrix:t=Xu,projectionMatrix:n=null,orthographic:s=!1,fovyRadians:r,fovy:i=75,near:o=.1,far:a=1e3,padding:l=null,focalDistance:c=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=(new al).multiplyRight(t).translate(new Wa(this.center).negate()),this.projectionMatrix=n||function({width:e,height:t,orthographic:n,fovyRadians:s,focalDistance:r,padding:i,near:o,far:a}){const l=e/t,c=n?(new al).orthographic({fovy:s,aspect:l,focalDistance:r,near:o,far:a}):(new al).perspective({fovy:s,aspect:l,near:o,far:a});if(i){const{left:n=0,right:s=0,top:r=0,bottom:o=0}=i,a=Aa((n+e-s)/2,0,e)-e/2,l=Aa((r+t-o)/2,0,t)-t/2;c[8]-=2*a/e,c[9]+=2*l/t}return c}({width:this.width,height:this.height,orthographic:s,fovyRadians:r||i*$u,focalDistance:c,padding:l,near:o,far:a});const u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var h;Xa(u,u,this.projectionMatrix),Xa(u,u,this.viewMatrix),this.viewProjectionMatrix=u,this.viewMatrixInverse=$a([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=[(h=this.viewMatrixInverse)[12],h[13],h[14]];const d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],f=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Ya(d,d,[this.width/2,-this.height/2,1]),qa(d,d,[1,-1,0]),Xa(f,d,this.viewProjectionMatrix),this.pixelProjectionMatrix=f,this.pixelUnprojectionMatrix=$a([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||On.warn("Pixel project matrix not invertible")()}}Ku.displayName="Viewport";class Zu extends Ku{constructor(e={}){const{latitude:t=0,longitude:n=0,zoom:s=0,pitch:r=0,bearing:i=0,nearZMultiplier:o=.1,farZMultiplier:a=1.01,nearZ:l,farZ:c,orthographic:u=!1,projectionMatrix:h,repeat:d=!1,worldOffset:f=0,position:p,padding:g,legacyMeterSizes:m=!1}=e;let{width:_,height:y,altitude:b=1.5}=e;const v=Math.pow(2,s);let x;_=_||1,y=y||1;let w=null;if(h)b=h[5]/2,x=nu(b);else{let n;if(e.fovy?(x=e.fovy,b=su(x)):x=nu(b),g){const{top:e=0,bottom:t=0}=g;n=[0,Aa((e+y-t)/2,0,y)-y/2]}w=function(e){const{width:t,height:n,altitude:s,pitch:r=0,offset:i,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=e;let{fovy:u=nu(Kc)}=e;void 0!==s&&(u=nu(s));const h=u*$c,d=r*$c,f=su(u);let p=f;o&&(p+=o[2]*a/Math.cos(d)/n);const g=h*(.5+(i?i[1]:0)/n),m=Math.sin(g)*p/Math.sin(Gc(Math.PI/2-d-g,.01,Math.PI-.01)),_=Math.sin(d)*m+p,y=10*p;return{fov:h,aspect:t/n,focalDistance:f,near:l,far:Math.min(_*c,y)}}({width:_,height:y,scale:v,center:p&&[0,0,p[2]*Jc(t)],offset:n,pitch:r,fovy:x,nearZMultiplier:o,farZMultiplier:a}),Number.isFinite(l)&&(w.near=l),Number.isFinite(c)&&(w.far=c)}let E=function(e){const{height:t,pitch:n,bearing:s,altitude:r,scale:i,center:o}=e,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];qa(a,a,[0,0,-r]),Ka(a,a,-n*$c),Za(a,a,s*$c);const l=i/t;var c,u;return Ya(a,a,[l,l,l]),o&&qa(a,a,((c=[])[0]=-(u=o)[0],c[1]=-u[1],c[2]=-u[2],c)),a}({height:y,pitch:r,bearing:i,scale:v,altitude:b});f&&(E=(new al).translate([512*f,0,0]).multiplyLeft(E)),super({...e,width:_,height:y,viewMatrix:E,longitude:n,latitude:t,zoom:s,...w,fovy:x,focalDistance:b}),this.latitude=t,this.longitude=n,this.zoom=s,this.pitch=r,this.bearing=i,this.altitude=b,this.fovy=x,this.orthographic=u,this._subViewports=d?[]:null,this._pseudoMeters=m,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let s=t;s<=n;s++){const e=s?new Zu({...this,worldOffset:s}):this;this._subViewports.push(e)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,n]=this.projectFlat(e);return[t,n,(e[2]||0)*Jc(e[1])]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,n]=this.unprojectFlat(e);return[t,n,(e[2]||0)/Jc(n)]}addMetersToLngLat(e,t){return tu(e,t)}panByPosition(e,t){const n=iu(t,this.pixelUnprojectionMatrix),s=Fa([],this.projectFlat(e),((r=[])[0]=-(i=n)[0],r[1]=-i[1],r));var r,i;const o=Fa([],this.center,s),[a,l]=this.unprojectFlat(o);return{longitude:a,latitude:l}}getBounds(e={}){const t=function(e,t=0){const{width:n,height:s,unproject:r}=e,i={targetZ:t},o=r([0,s],i),a=r([n,s],i);let l,c;return(e.fovy?.5*e.fovy*ou:Math.atan(.5/e.altitude))>(90-e.pitch)*ou-.01?(l=au(e,0,t),c=au(e,n,t)):(l=r([0,0],i),c=r([n,0],i)),[o,a,c,l]}(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:n,height:s}=this,{longitude:r,latitude:i,zoom:o}=function(e){const{width:t,height:n,bounds:s,minExtent:r=0,maxZoom:i=24,offset:o=[0,0]}=e,[[a,l],[c,u]]=s,h=function(e=0){return"number"==typeof e?{top:e,bottom:e,left:e,right:e}:(zc(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}(e.padding),d=Zc([a,Gc(u,-85.051129,Yc)]),f=Zc([c,Gc(l,-85.051129,Yc)]),p=[Math.max(Math.abs(f[0]-d[0]),r),Math.max(Math.abs(f[1]-d[1]),r)],g=[t-h.left-h.right-2*Math.abs(o[0]),n-h.top-h.bottom-2*Math.abs(o[1])];zc(g[0]>0&&g[1]>0);const m=g[0]/p[0],_=g[1]/p[1],y=(h.right-h.left)/2/m,b=(h.top-h.bottom)/2/_,v=Qc([(f[0]+d[0])/2+y,(f[1]+d[1])/2+b]),x=Math.min(i,Vc(Math.abs(Math.min(m,_))));return zc(Number.isFinite(x)),{longitude:v[0],latitude:v[1],zoom:x}}({width:n,height:s,bounds:e,...t});return new Zu({width:n,height:s,longitude:r,latitude:i,zoom:o})}}Zu.displayName="WebMercatorViewport";const Qu=[0,0,0];function Ju(e,t,n=!1){const s=t.projectPosition(e);if(n&&t instanceof Zu){const[n,r,i=0]=e,o=t.getDistanceScales([n,r]);s[2]=i*o.unitsPerMeter[2]}return s}function eh(e,{viewport:t,modelMatrix:n,coordinateSystem:s,coordinateOrigin:r,offsetMode:i}){let[o,a,l=0]=e;switch(n&&([o,a,l]=Ja([],[o,a,l,1],n)),s){case yc.LNGLAT:return Ju([o,a,l],t,i);case yc.LNGLAT_OFFSETS:return Ju([o+r[0],a+r[1],l+(r[2]||0)],t,i);case yc.METER_OFFSETS:return Ju(tu(r,[o,a,l]),t,i);default:return t.isGeospatial?[o+r[0],a+r[1],l+r[2]]:t.projectPosition([o,a,l])}}let th=1,nh=1;class sh{constructor(){s(this,"time",0),s(this,"channels",new Map),s(this,"animations",new Map),s(this,"playing",!1),s(this,"lastEngineTime",-1)}addChannel(e){const{delay:t=0,duration:n=Number.POSITIVE_INFINITY,rate:s=1,repeat:r=1}=e,i=th++,o={time:0,delay:t,duration:n,rate:s,repeat:r};return this._setChannelTime(o,this.time),this.channels.set(i,o),i}removeChannel(e){this.channels.delete(e);for(const[t,n]of this.animations)n.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}getTime(e){if(void 0===e)return this.time;const t=this.channels.get(e);return void 0===t?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const s of t)this._setChannelTime(s,this.time);const n=this.animations.values();for(const s of n){const{animation:e,channel:t}=s;e.setTime(this.getTime(t))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const n=nh++;return this.animations.set(n,{animation:e,channel:t}),e.setTime(this.getTime(t)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const n=t-e.delay;n>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}let rh=0;const ih=class e{constructor(t){if(s(this,"device",null),s(this,"canvas",null),s(this,"props"),s(this,"animationProps",null),s(this,"timeline",null),s(this,"stats"),s(this,"cpuTime"),s(this,"gpuTime"),s(this,"frameRate"),s(this,"display"),s(this,"needsRedraw","initialized"),s(this,"_initialized",!1),s(this,"_running",!1),s(this,"_animationFrameId",null),s(this,"_nextFramePromise",null),s(this,"_resolveNextFrame",null),s(this,"_cpuStartTime",0),s(this,"_error",null),this.props={...e.defaultAnimationLoopProps,...t},!(t=this.props).device)throw new Error("No device provided");this.stats=t.stats||new wt({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:t.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(e){this.props.onError(e),this._error=e}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(!1!==e&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(null==(e=this.device)?void 0:e.isLost)||this._error||(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers()),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){var e;this._running&&(this._animationFrameId=(e=this._animationFrame.bind(this),"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)))}_cancelAnimationFrame(){var e;null!==this._animationFrameId&&(e=this._animationFrameId,"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var t;this.display?this.display._renderFrame(e):(this.props.onRender(this._getAnimationProps()),null==(t=this.device)||t.submit())}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){var e;const t=null==(e=this.device)?void 0:e.getDefaultCanvasContext();if(!this.device||!t)throw new Error("loop");const n=null==t?void 0:t.canvas,s=t.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:t,canvas:n,useDevicePixels:s,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:n}=this._getSizeAndAspect();e===this.animationProps.width&&t===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){var e,t;if(!this.device)return{width:1,height:1,aspect:1};const[n,s]=(null==(e=this.device)?void 0:e.getDefaultCanvasContext().getDevicePixelSize())||[1,1];let r=1;const i=null==(t=this.device)?void 0:t.getDefaultCanvasContext().canvas;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:n>0&&s>0&&(r=n/s),{width:n,height:s,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}};s(ih,"defaultAnimationLoopProps",{device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>{},stats:ar.stats.get("animation-loop-"+rh++),autoResizeViewport:!1});let oh=ih;const ah={};function lh(e="id"){return ah[e]=ah[e]||1,`${e}-${ah[e]++}`}class ch{constructor(e){if(s(this,"id"),s(this,"userData",{}),s(this,"topology"),s(this,"bufferLayout",[]),s(this,"vertexCount"),s(this,"indices"),s(this,"attributes"),this.id=e.id||lh("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Ps.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;null==(e=this.indices)||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}const uh=class e{constructor(e){s(this,"device"),s(this,"cachingEnabled"),s(this,"destroyPolicy"),s(this,"debug"),s(this,"_hashCounter",0),s(this,"_hashes",{}),s(this,"_renderPipelineCache",{}),s(this,"_computePipelineCache",{}),this.device=e,this.cachingEnabled=e.props._cachePipelines,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=e.props.debugFactories}static getDefaultPipelineFactory(t){return t._lumaData.defaultPipelineFactory=t._lumaData.defaultPipelineFactory||new e(t),t._lumaData.defaultPipelineFactory}get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}createRenderPipeline(e){var t;if(!this.cachingEnabled)return this.device.createRenderPipeline(e);const n={...Ir.defaultProps,...e},s=this._renderPipelineCache,r=this._hashRenderPipeline(n);let i=null==(t=s[r])?void 0:t.pipeline;return i?(s[r].useCount++,this.debug&&Ts.log(3,`${this}: ${s[r].pipeline} reused, count=${s[r].useCount}, (id=${e.id})`)()):(i=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:lh("unnamed-cached")}),i.hash=r,s[r]={pipeline:i,useCount:1},this.debug&&Ts.log(3,`${this}: ${i} created, count=${s[r].useCount}`)()),i}createComputePipeline(e){var t;if(!this.cachingEnabled)return this.device.createComputePipeline(e);const n={...Or.defaultProps,...e},s=this._computePipelineCache,r=this._hashComputePipeline(n);let i=null==(t=s[r])?void 0:t.pipeline;return i?(s[r].useCount++,this.debug&&Ts.log(3,`${this}: ${s[r].pipeline} reused, count=${s[r].useCount}, (id=${e.id})`)()):(i=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0}),i.hash=r,s[r]={pipeline:i,useCount:1},this.debug&&Ts.log(3,`${this}: ${i} created, count=${s[r].useCount}`)()),i}release(e){if(!this.cachingEnabled)return void e.destroy();const t=this._getCache(e),n=e.hash;t[n].useCount--,0===t[n].useCount?(this._destroyPipeline(e),this.debug&&Ts.log(3,`${this}: ${e} released and destroyed`)()):t[n].useCount<0?(Ts.error(`${this}: ${e} released, useCount < 0, resetting`)(),t[n].useCount=0):this.debug&&Ts.log(3,`${this}: ${e} released, count=${t[n].useCount}`)()}_destroyPipeline(e){const t=this._getCache(e);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete t[e.hash],e.destroy(),!0}}_getCache(e){let t;if(e instanceof Or&&(t=this._computePipelineCache),e instanceof Ir&&(t=this._renderPipelineCache),!t)throw new Error(`${this}`);if(!t[e.hash])throw new Error(`${this}: ${e} matched incorrect entry`);return t}_hashComputePipeline(e){const{type:t}=this.device;return`${t}/C/${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,s=this._getHash(JSON.stringify(e.bufferLayout)),{type:r}=this.device;if("webgl"===r)return`${r}/R/${t}/${n}V-BL${s}`;{const i=this._getHash(JSON.stringify(e.parameters));return`${r}/R/${t}/${n}V-T${e.topology}P${i}BL${s}`}}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};s(uh,"defaultProps",{...Ir.defaultProps});let hh=uh;const dh=class e{constructor(e){s(this,"device"),s(this,"cachingEnabled"),s(this,"destroyPolicy"),s(this,"debug"),s(this,"_cache",{}),this.device=e,this.cachingEnabled=e.props._cacheShaders,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=!0}static getDefaultShaderFactory(t){var n;return(n=t._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new e(t)),t._lumaData.defaultShaderFactory}get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}createShader(e){if(!this.cachingEnabled)return this.device.createShader(e);const t=this._hashShader(e);let n=this._cache[t];if(n)n.useCount++,this.debug&&Ts.log(3,`${this}: Reusing shader ${n.shader.id} count=${n.useCount}`)();else{const s=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=n={shader:s,useCount:1},this.debug&&Ts.log(3,`${this}: Created new shader ${s.id}`)()}return n.shader}release(e){if(!this.cachingEnabled)return void e.destroy();const t=this._hashShader(e),n=this._cache[t];if(n)if(n.useCount--,0===n.useCount)"unused"===this.destroyPolicy&&(delete this._cache[t],n.shader.destroy(),this.debug&&Ts.log(3,`${this}: Releasing shader ${e.id}, destroyed`)());else{if(n.useCount<0)throw new Error(`ShaderFactory: Shader ${e.id} released too many times`);this.debug&&Ts.log(3,`${this}: Releasing shader ${e.id} count=${n.useCount}`)()}}_hashShader(e){return`${e.stage}:${e.source}`}};s(dh,"defaultProps",{...Ar.defaultProps});let fh=dh,ph=null,gh=null;function mh(e,t,n){if(e===t)return!0;if(!n||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!mh(e[s],t[s],n-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){const s=Object.keys(e),r=Object.keys(t);if(s.length!==r.length)return!1;for(const i of s){if(!t.hasOwnProperty(i))return!1;if(!mh(e[i],t[i],n-1))return!1}return!0}return!1}class _h{constructor(e){s(this,"bufferLayouts"),this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){var t;return e.attributes?null==(t=e.attributes)?void 0:t.map(e=>e.attribute):[e.name]}mergeBufferLayouts(e,t){const n=[...e];for(const s of t){const e=n.findIndex(e=>e.name===s.name);e<0?n.push(s):n[e]=s}return n}getBufferIndex(e){const t=this.bufferLayouts.findIndex(t=>t.name===e);return-1===t&&Ts.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function yh(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach(n=>{const s=e[n];var r;!function(e){return function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(e)||function(e){return!!Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}(e)}(r=s)&&"number"!=typeof r&&"boolean"!=typeof r?t.bindings[n]=s:t.uniforms[n]=s}),t}class bh{constructor(e,t){s(this,"options",{disableWarnings:!1}),s(this,"modules"),s(this,"moduleUniforms"),s(this,"moduleBindings"),Object.assign(this.options,t);const n=ns(Object.values(e).filter(e=>e.dependencies));for(const s of n)e[s.name]=s;Ts.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[s,r]of Object.entries(e))this._addModule(r),r.name&&s!==r.name&&!this.options.disableWarnings&&Ts.warn(`Module name: ${s} vs ${r.name}`)()}destroy(){}setProps(e){var t;for(const n of Object.keys(e)){const s=n,r=e[s]||{},i=this.modules[s];if(!i){this.options.disableWarnings||Ts.warn(`Module ${n} not found`)();continue}const o=this.moduleUniforms[s],a=this.moduleBindings[s],l=(null==(t=i.getUniforms)?void 0:t.call(i,r,o))||r,{uniforms:c,bindings:u}=yh(l);this.moduleUniforms[s]={...o,...c},this.moduleBindings[s]={...a,...u}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var e;const t={};for(const[n,s]of Object.entries(this.moduleUniforms))for(const[r,i]of Object.entries(s))t[`${n}.${r}`]={type:null==(e=this.modules[n].uniformTypes)?void 0:e[r],value:String(i)};return t}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}const vh=["+X","-X","+Y","-Y","+Z","-Z"],xh=["+X","-X","+Y","-Y","+Z","-Z"],wh=class e{constructor(t,n){s(this,"device"),s(this,"id"),s(this,"props"),s(this,"texture"),s(this,"sampler"),s(this,"view"),s(this,"ready"),s(this,"isReady",!1),s(this,"destroyed",!1),s(this,"resolveReady",()=>{}),s(this,"rejectReady",()=>{}),this.device=t;const r=lh("async-texture");this.props={...e.defaultProps,id:r,...n},this.id=this.props.id,"string"==typeof(null==(n={...n})?void 0:n.data)&&"2d"===n.dimension&&(n.data=async function(e){const t=new Image;return t.crossOrigin="anonymous",t.src=e.startsWith("http")?e:""+e,await t.decode(),await createImageBitmap(t)}(n.data)),n.mipmaps&&(n.mipLevels="auto"),this.ready=new Promise((e,t)=>{this.resolveReady=()=>{this.isReady=!0,e()},this.rejectReady=t}),this.initAsync(n)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){const t=e.data,n=await Th(t).then(void 0,this.rejectReady);if(this.destroyed)return;const s=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(n);if(!s)throw new Error("Texture size could not be determined");const r={...s,...e,data:void 0,mipLevels:1},i=this.device.getMipLevelCount(r.width,r.height);if(r.mipLevels="auto"===this.props.mipLevels?i:Math.min(i,this.props.mipLevels),this.texture=this.device.createTexture(r),this.sampler=this.texture.sampler,this.view=this.texture.view,e.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,n);break;case"2d":this._setTexture2DData(n);break;case"3d":this._setTexture3DData(this.texture,n);break;case"2d-array":this._setTextureArrayData(this.texture,n);break;case"cube":this._setTextureCubeData(this.texture,n);break;case"cube-array":this._setTextureCubeArrayData(this.texture,n)}this.props.mipmaps&&this.generateMipmaps(),Ts.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(e={}){this.texture.setSampler(e instanceof _r?e:this.device.createSampler(e))}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}isTextureLevelData(e){const t=null==e?void 0:e.data;return ArrayBuffer.isView(t)}getTextureDataSize(e){if(!e)return null;if(ArrayBuffer.isView(e))return null;if(Array.isArray(e))return this.getTextureDataSize(e[0]);if(this.device.isExternalImage(e))return this.device.getExternalImageSize(e);if(e&&"object"==typeof e&&e.constructor===Object){const t=Object.values(e)[0];return{width:t.width,height:t.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}setTextureData(e){}_setTexture1DData(e,t){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(e,t=0){if(!this.texture)throw new Error("Texture not initialized");const n=this._normalizeTextureData(e);n.length>1&&!1!==this.props.mipmaps&&Ts.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let s=0;s<n.length;s++){const e=n[s];this.device.isExternalImage(e)?this.texture.copyExternalImage({image:e,depth:t,mipLevel:s,flipY:!0}):this.texture.copyImageData({data:e.data,mipLevel:s})}}_setTexture3DData(e,t){var n;if("3d"!==(null==(n=this.texture)?void 0:n.props.dimension))throw new Error(this.id);for(let s=0;s<t.length;s++)this._setTexture2DData(t[s],s)}_setTextureCubeData(e,t){var n;if("cube"!==(null==(n=this.texture)?void 0:n.props.dimension))throw new Error(this.id);for(const[s,r]of Object.entries(t)){const e=xh.indexOf(s);this._setTexture2DData(r,e)}}_setTextureArrayData(e,t){var n;if("2d-array"!==(null==(n=this.texture)?void 0:n.props.dimension))throw new Error(this.id);for(let s=0;s<t.length;s++)this._setTexture2DData(t[s],s)}_setTextureCubeArrayData(e,t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(e,t,n,s=0){Array.isArray(t)&&t.length>1&&!1!==this.props.mipmaps&&Ts.warn(`${this.id} has mipmap and multiple LODs.`)();const r=vh.indexOf(n);this._setTexture2DData(t,r)}_normalizeTextureData(e){const t=this.texture;let n;return n=ArrayBuffer.isView(e)?[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?e:[e],n}};s(wh,"defaultProps",{...vr.defaultProps,data:null,mipmaps:!1});let Eh=wh;async function Th(e){if(e=await e,Array.isArray(e))return await Promise.all(e.map(Th));if(e&&"object"==typeof e&&e.constructor===Object){const t=e,n=await Promise.all(Object.values(t)),s=Object.keys(t),r={};for(let e=0;e<s.length;e++)r[s[e]]=n[e];return r}return e}const Sh=class e{constructor(t,n){var r,i,o,a;s(this,"device"),s(this,"id"),s(this,"source"),s(this,"vs"),s(this,"fs"),s(this,"pipelineFactory"),s(this,"shaderFactory"),s(this,"userData",{}),s(this,"parameters"),s(this,"topology"),s(this,"bufferLayout"),s(this,"isInstanced"),s(this,"instanceCount",0),s(this,"vertexCount"),s(this,"indexBuffer",null),s(this,"bufferAttributes",{}),s(this,"constantAttributes",{}),s(this,"bindings",{}),s(this,"vertexArray"),s(this,"transformFeedback",null),s(this,"pipeline"),s(this,"shaderInputs"),s(this,"_uniformStore"),s(this,"_attributeInfos",{}),s(this,"_gpuGeometry",null),s(this,"props"),s(this,"_pipelineNeedsUpdate","newly created"),s(this,"_needsRedraw","initializing"),s(this,"_destroyed",!1),s(this,"_lastDrawTimestamp",-1),s(this,"_lastLogTime",0),s(this,"_logOpen",!1),s(this,"_drawCount",0),this.props={...e.defaultProps,...n},n=this.props,this.id=n.id||lh("model"),this.device=t,Object.assign(this.userData,n.userData);const l=Object.fromEntries((null==(r=this.props.modules)?void 0:r.map(e=>[e.name,e]))||[]),c=n.shaderInputs||new bh(l,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(c);const u=function(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}(t),h=((null==(i=this.props.modules)?void 0:i.length)>0?this.props.modules:null==(o=this.shaderInputs)?void 0:o.getModules())||[];if("webgpu"===this.device.type&&this.props.source){const{source:e,getUniforms:t}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:u,...this.props,modules:h});this.source=e,this._getModuleUniforms=t,(a=this.props).shaderLayout||(a.shaderLayout=function(e){var t;const n={attributes:[],bindings:[]};let s;try{s=function(e){try{return new xa(e)}catch(t){if(t instanceof Error)throw t;let e="WGSL parse error";throw"object"==typeof t&&(null==t?void 0:t.message)&&(e+=`: ${t.message} `),"object"==typeof t&&(null==t?void 0:t.token)&&(e+=t.token.line||""),new Error(e,{cause:t})}}(e)}catch(o){return Ts.error(o.message)(),n}for(const a of s.uniforms){const e=[];for(const n of(null==(t=a.type)?void 0:t.members)||[])e.push({name:n.name,type:wa(n.type)});n.bindings.push({type:"uniform",name:a.name,group:a.group,location:a.binding,members:e})}for(const a of s.textures)n.bindings.push({type:"texture",name:a.name,group:a.group,location:a.binding});for(const a of s.samplers)n.bindings.push({type:"sampler",name:a.name,group:a.group,location:a.binding});const r=s.entry.vertex[0],i=(null==r?void 0:r.inputs.length)||0;for(let a=0;a<i;a++){const e=r.inputs[a];if("location"===e.locationType){const t=wa(e.type);n.attributes.push({name:e.name,location:Number(e.location),type:t})}}return n}(this.source))}else{const{vs:e,fs:t,getUniforms:n}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:u,...this.props,modules:h});this.vs=e,this.fs=t,this._getModuleUniforms=n}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||hh.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||fh.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=t.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in n&&(this.isInstanced=n.isInstanced),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.vertexCount&&this.setVertexCount(n.vertexCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),null==(e=this._gpuGeometry)||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return Ts.info(2,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const t=this._getBindings();this.pipeline.setBindings(t,{disableWarnings:this.props.disableWarnings});const{indexBuffer:s}=this.vertexArray,r=s?s.byteLength/("uint32"===s.indexType?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:r,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var t;null==(t=this._gpuGeometry)||t.destroy();const n=e&&function(e,t){if(t instanceof ch)return t;const n=function(e,t){if(!t.indices)return;const n=t.indices.value;return e.createBuffer({usage:Ps.INDEX,data:n})}(e,t),{attributes:s,bufferLayout:r}=function(e,t){const n=[],s={};for(const[r,i]of Object.entries(t.attributes)){let t=r;switch(r){case"POSITION":t="positions";break;case"NORMAL":t="normals";break;case"TEXCOORD_0":t="texCoords";break;case"COLOR_0":t="colors"}if(i){s[t]=e.createBuffer({data:i.value,id:`${r}-buffer`});const{value:o,size:a,normalized:l}=i;n.push({name:t,format:Fs(o,a,l)})}}return{attributes:s,bufferLayout:n,vertexCount:t._calculateVertexCount(t.attributes,t.indices)}}(e,t);return new ch({topology:t.topology||"triangle-list",bufferLayout:r,vertexCount:t.vertexCount,indices:n,attributes:s})}(this.device,e);if(n){this.setTopology(n.topology||"triangle-list");const e=new _h(this.bufferLayout);this.bufferLayout=e.mergeBufferLayouts(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)}this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new _h(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){mh(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,void 0===this.isInstanced&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new si(this.shaderInputs.modules);for(const[t,n]of Object.entries(this.shaderInputs.modules))if(Rh(n)){const e=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=e}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const n=(null==t?void 0:t.disableWarnings)??this.props.disableWarnings;e.indices&&Ts.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=function(e,t){const n=Object.fromEntries(e.attributes.map(e=>[e.name,e.location])),s=t.slice();return s.sort((e,t)=>{const s=e.attributes?e.attributes.map(e=>e.attribute):[e.name],r=t.attributes?t.attributes.map(e=>e.attribute):[t.name];return Math.min(...s.map(e=>n[e]))-Math.min(...r.map(e=>n[e]))}),s}(this.pipeline.shaderLayout,this.bufferLayout);const s=new _h(this.bufferLayout);for(const[r,i]of Object.entries(e)){const e=s.getBufferLayout(r);if(!e){n||Ts.warn(`Model(${this.id}): Missing layout for buffer "${r}".`)();continue}const t=s.getAttributeNamesForBuffer(e);let o=!1;for(const n of t){const e=this._attributeInfos[n];if(e){const t="webgpu"===this.device.type?s.getBufferIndex(e.bufferName):e.location;this.vertexArray.setBuffer(t,i),o=!0}}o||n||Ts.warn(`Model(${this.id}): Ignoring buffer "${i.id}" for unknown attribute "${r}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[n,s]of Object.entries(e)){const e=this._attributeInfos[n];e?this.vertexArray.setConstantWebGL(e.location,s):((null==t?void 0:t.disableWarnings)??this.props.disableWarnings)||Ts.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Eh&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,n]of Object.entries(this.bindings))n instanceof Eh?n.isReady&&(e[t]=n.texture):e[t]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof wr?e=Math.max(e,t.texture.updateTimestamp):t instanceof Ps||t instanceof vr?e=Math.max(e,t.updateTimestamp):t instanceof Eh?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof _r||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[n]of Object.entries(t))this.pipeline.shaderLayout.attributes.find(e=>e.name===n)||"positions"===n||delete t[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(Ts.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let s=null;this.source?s=n:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:s}),this._attributeInfos=Wr(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=Ts.level>3?0:1e4;Ts.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Ts.group(2,`>>> DRAWING MODEL ${this.id}`,{collapsed:Ts.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=function(e){var t;const n={},s="Values";if(0===e.attributes.length&&!(null==(t=e.varyings)?void 0:t.length))return{"No attributes or varyings":{[s]:"N/A"}};for(const r of e.attributes)r&&(n[`in ${r.location} ${r.name}: ${r.type}`]={[s]:r.stepMode||"vertex"});for(const r of e.varyings||[])n[`out ${r.location} ${r.name}`]={[s]:JSON.stringify(r)};return n}(this.pipeline.shaderLayout,this.id);Ts.table(2,e)();const t=this.shaderInputs.getDebugTable();Ts.table(2,t)();const n=this._getAttributeDebugTable();Ts.table(2,this._attributeInfos)(),Ts.table(2,n)(),Ts.groupEnd(2)(),this._logOpen=!1}}_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const n=e.props.framebuffer;n&&function(e,{id:t,minimap:n,opaque:s,top:r="0",left:i="0",rgbaScale:o=1}){ph||(ph=document.createElement("canvas"),ph.id=t,ph.title=t,ph.style.zIndex="100",ph.style.position="absolute",ph.style.top=r,ph.style.left=i,ph.style.border="blue 5px solid",ph.style.transform="scaleY(-1)",document.body.appendChild(ph),gh=ph.getContext("2d")),ph.width===e.width&&ph.height===e.height||(ph.width=e.width/2,ph.height=e.height/2,ph.style.width="400px",ph.style.height="400px");const a=e.device.readPixelsToArrayWebGL(e),l=null==gh?void 0:gh.createImageData(e.width,e.height);if(l){const e=0;for(let t=0;t<a.length;t+=4)l.data[e+t+0]=a[t+0]*o,l.data[e+t+1]=a[t+1]*o,l.data[e+t+2]=a[t+2]*o,l.data[e+t+3]=s?255:a[t+3]*o;null==gh||gh.putImageData(l,0,0)}}(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,n]of Object.entries(this._attributeInfos)){const s=this.vertexArray.attributes[n.location];e[n.location]={name:t,type:n.shaderType,values:s?this._getBufferOrConstantValues(s,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,n="uint32"===t.indexType?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,t){const n=Ls(t);return(e instanceof Ps?new n(e.debugData):e).toString()}};s(Sh,"defaultProps",{...Ir.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:xs.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Ah=Sh;function Rh(e){return Boolean(e.uniformTypes&&!function(e){for(const t in e)return!1;return!0}(e.uniformTypes))}const Ch=class e{constructor(t,n=e.defaultProps){if(s(this,"device"),s(this,"model"),s(this,"transformFeedback"),!e.isSupported(t))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=t,this.model=new Ah(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||ws(),topology:n.topology||"point-list",varyings:n.outputs||n.varyings,...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var t;return"webgl"===(null==(t=null==e?void 0:e.info)?void 0:t.type)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){(null==e?void 0:e.inputBuffers)&&this.model.setAttributes(e.inputBuffers),(null==e?void 0:e.outputBuffers)&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof Ps)return t.readAsync();const{buffer:n,byteOffset:s=0,byteLength:r=n.byteLength}=t;return n.readAsync(s,r)}};s(Ch,"defaultProps",{...Ah.defaultProps,outputs:void 0,feedbackBuffers:void 0});let Ph=Ch;class kh{constructor(e){s(this,"id"),s(this,"topology"),s(this,"vertexCount"),s(this,"indices"),s(this,"attributes"),s(this,"userData",{});const{attributes:t={},indices:n=null,vertexCount:r=null}=e;this.id=e.id||lh("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[s,i]of Object.entries(t)){const e=ArrayBuffer.isView(i)?{value:i}:i;if(!ArrayBuffer.isView(e.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if("POSITION"!==s&&"positions"!==s||e.size||(e.size=3),"indices"===s){if(this.indices)throw new Error("Multiple indices detected");this.indices=e}else this.attributes[s]=e}this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=r||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let n=1/0;for(const s of Object.values(e)){const{value:e,size:t,constant:r}=s;!r&&e&&void 0!==t&&t>=1&&(n=Math.min(n,e.length/t))}return n}}const Ih={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class Mh extends Iu{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:n,viewports:s,onViewportActive:r,pickingFBO:i,deviceRect:{x:o,y:a,width:l,height:c},cullRect:u,effects:h,pass:d="picking",pickZ:f,shaderModuleProps:p}){this.pickZ=f;const g=this._resetColorEncoder(f),m=[o,a,l,c],_=super.render({target:i,layers:e,layerFilter:t,views:n,viewports:s,onViewportActive:r,cullRect:u,effects:null==h?void 0:h.filter(e=>e.useInPicking),pass:d,isPicking:!0,shaderModuleProps:p,clearColor:[0,0,0,0],colorMask:15,scissorRect:m});return this._colorEncoderState=null,{decodePickingColor:g&&Lh.bind(null,g),stats:_}}shouldDrawLayer(e){const{pickable:t,operation:n}=e.props;return t&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(e,t,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,n){const s={...e.props.parameters},{pickable:r,operation:i}=e.props;return!this._colorEncoderState||i.includes("terrain")?s.blend=!1:r&&i.includes("draw")&&(Object.assign(s,Ih),s.blend=!0,s.blendColor=function(e,t,n){const{byLayer:s,byAlpha:r}=e;let i,o=s.get(t);return o?(o.viewports.push(n),i=o.a):(i=s.size+1,i<=255?(o={a:i,layer:t,viewports:[n]},s.set(t,o),r[i]=o):(On.warn("Too many pickable layers, only picking the first 255")(),i=0)),[0,0,0,i/255]}(this._colorEncoderState,e,n)),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function Lh(e,t){const n=e.byAlpha[t[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(t)}}const Nh=Symbol.for("component"),Oh=Symbol.for("propTypes"),Fh=Symbol.for("deprecatedProps"),Dh=Symbol.for("asyncPropDefaults"),Bh=Symbol.for("asyncPropOriginal"),Uh=Symbol.for("asyncPropResolved");function jh(e,t=()=>!0){return Array.isArray(e)?Gh(e,t,[]):t(e)?[e]:[]}function Gh(e,t,n){let s=-1;for(;++s<e.length;){const r=e[s];Array.isArray(r)?Gh(r,t,n):t(r)&&n.push(r)}return n}function Vh({target:e,source:t,start:n=0,count:s=1}){const r=t.length,i=s*r;let o=0;for(let a=n;o<r;o++)e[a++]=t[o];for(;o<i;)o<i-o?(e.copyWithin(n+o,n,n+o),o*=2):(e.copyWithin(n+o,n,n+i-o),o=i);return e}class zh{constructor(e,t,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const n=++this._loadCount;let s=e;"string"==typeof e&&(s=_n(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(e=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=e)}).catch(e=>{this._loadCount===n&&(this.isLoaded=!0,this._error=e||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const r of this._subscribers)r.onChange(this.getData())}}class Wh{constructor(e){var t;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:null==(t=e.device)?void 0:t.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return!!e.startsWith(this.protocol)||e in this._resources}add({resourceId:e,data:t,forceUpdate:n=!1,persistent:s=!0}){let r=this._resources[e];r?r.setData(t,n):(r=new zh(e,t,this._context),this._resources[e]=r),r.persistent=s}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const e in t){const n=t[e],s=this._resources[n.resourceId];s&&s.unsubscribe(n)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:n,requestId:s="default"}){const{_resources:r,protocol:i}=this;e.startsWith(i)&&(r[e=e.replace(i,"")]||this.add({resourceId:e,data:null,persistent:!1}));const o=r[e];if(this._track(n,s,o,t),o)return o.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,n,s){const r=this._consumers,i=r[e]=r[e]||{};let o=i[t];const a=o&&o.resourceId&&this._resources[o.resourceId];a&&(a.unsubscribe(o),this.prune()),n&&(o?(o.onChange=s,o.resourceId=n.id):o={onChange:s,resourceId:n.id},i[t]=o,n.subscribe(o))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];t.persistent||t.inUse()||(t.delete(),delete this._resources[e])}}}class Hh{constructor(e,t){var n;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=e=>{Bn("layerManager.activateViewport",this,e),e&&(this.context.viewport=e)};const{deck:s,stats:r,viewport:i,timeline:o}=t||{};this.layers=[],this.resourceManager=new Wh({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:null==e?void 0:e.gl,deck:s,shaderAssembler:vu((null==(n=null==e?void 0:e.info)?void 0:n.shadingLanguage)||"glsl"),defaultShaderModules:[gl],renderPass:void 0,stats:r||new wt({id:"deck.gl"}),viewport:i||new Ku({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new sh,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const s=n.getNeedsRedraw(e);t=t||s}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(e=>0===t.id.indexOf(e))):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Bn("layerManager.setLayers",this,t,e),this._lastRenderedLayers=e;const n=jh(e,Boolean);for(const s of n)s.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(t=>t.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,n=t.findIndex(t=>t.name===e.name);n>=0&&(t.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,n){n.raiseError(t,`${e} of ${n}`)}_updateLayers(e,t){const n={};for(const i of e)n[i.id]?On.warn(`Multiple old layers with same id ${i.id}`)():n[i.id]=i;if(this._defaultShaderModulesChanged){for(const t of e)t.setNeedsUpdate(),t.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(t,n,s),this._finalizeOldLayers(n);let r=!1;for(const i of s)if(i.hasUniformTransition()){r=`Uniform transition in ${i}`;break}this._needsUpdate=r,this.layers=s}_updateSublayersRecursively(e,t,n){for(const r of e){r.context=this.context;const e=t[r.id];null===e&&On.warn(`Multiple new layers with same id ${r.id}`)(),t[r.id]=null;let i=null;try{this._debug&&e!==r&&r.validateProps(),e?(this._transferLayerState(e,r),this._updateLayer(r)):this._initializeLayer(r),n.push(r),i=r.isComposite?r.getSubLayers():null}catch(s){this._handleError("matching",s,r)}i&&this._updateSublayersRecursively(i,t,n)}}_finalizeOldLayers(e){for(const t in e){const n=e[t];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle="Initialized"}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle="Matched. State transferred from previous layer",t!==e&&(e.lifecycle="Discarded. Awaiting garbage collection")}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle="No longer matched. Awaiting garbage collection";try{e._finalize(),e.lifecycle="Finalized! Awaiting garbage collection"}catch(t){this._handleError("finalization",t,e)}}}function $h(e,t,n){if(e===t)return!0;if(!n||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!$h(e[s],t[s],n-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){const s=Object.keys(e),r=Object.keys(t);if(s.length!==r.length)return!1;for(const i of s){if(!t.hasOwnProperty(i))return!1;if(!$h(e[i],t[i],n-1))return!1}return!0}return!1}class Xh{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t="string"==typeof e?this.getView(e):e,n=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,t){const n=this.getViewports(),s={x:e[0],y:e[1]};for(let r=n.length-1;r>=0;--r){const i=n[r];if(i.containsPixel(s)){const n=e.slice();return n[0]-=i.x,n[1]-=i.y,i.unproject(n,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){e===this.width&&t===this.height||(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=jh(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!$h(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):On.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const n=new(0,t.type)({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:t=>{var n;return null==(n=this.getView(e.id))?void 0:n.makeViewport({viewState:t,width:this.width,height:this.height})}});return n}_updateController(e,t,n,s){const r=e.controller;if(r&&n){const i={...t,...r,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return s&&s.constructor===r.type||(s=this._createController(e,i)),s&&s.setProps(i),s}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let s=e.length;s--;){const r=e[s],i=this.getViewState(r),o=r.makeViewport({viewState:i,width:this.width,height:this.height});let a=t[r.id];const l=Boolean(r.controller);l&&!a&&(n=!0),!n&&l||!a||(a.finalize(),a=null),this.controllers[r.id]=this._updateController(r,i,o,a),o&&this._viewports.unshift(o)}for(const s in t){const e=t[s];e&&!this.controllers[s]&&e.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length||e.some((n,s)=>!e[s].equals(t[s]))}}const qh=/([0-9]+\.?[0-9]*)(%|px)/;function Yh(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":const t=qh.exec(e);if(t&&t.length>=3){const e="%"===t[2],n=parseFloat(t[1]);return{position:e?n/100:n,relative:e}}default:throw new Error(`Could not parse position string ${e}`)}}function Kh(e,t){return e.relative?Math.round(e.position*t):e.position}class Zh{constructor(e){const{id:t,x:n=0,y:s=0,width:r="100%",height:i="100%",padding:o=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Yh(n),this._y=Yh(s),this._width=Yh(r),this._height=Yh(i),this._padding=o&&{left:Yh(o.left||0),right:Yh(o.right||0),top:Yh(o.top||0),bottom:Yh(o.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e||this.constructor===e.constructor&&$h(this.props,e.props,2)}clone(e){return new(0,this.constructor)({...this.props,...e})}makeViewport({width:e,height:t,viewState:n}){n=this.filterViewState(n);const s=this.getDimensions({width:e,height:t});return s.height&&s.width?new(this.getViewportType(n))({...n,...this.props,...s}):null}getViewStateId(){const{viewState:e}=this.props;return"string"==typeof e?e:(null==e?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&"object"==typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const e in this.props.viewState)"id"!==e&&(t[e]=this.props.viewState[e]);return t}return e}getDimensions({width:e,height:t}){const n={x:Kh(this._x,e),y:Kh(this._y,t),width:Kh(this._width,e),height:Kh(this._height,t)};return this._padding&&(n.padding={left:Kh(this._padding.left,e),top:Kh(this._padding.top,t),right:Kh(this._padding.right,e),bottom:Kh(this._padding.bottom,t)}),n}get controller(){const e=this.props.controller;return e?!0===e?{type:this.ControllerType}:"function"==typeof e?{type:e}:{type:this.ControllerType,...e}:null}}class Qh{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,n;this.cancel(),this.settings=e,this._inProgress=!0,null==(n=(t=this.settings).onStart)||n.call(t,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,null==(t=(e=this.settings).onEnd)||t.call(e,this))}cancel(){var e,t;this._inProgress&&(null==(t=(e=this.settings).onInterrupt)||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(null===this._handle){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),null==(t=(e=this.settings).onUpdate)||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Jh=()=>{},ed=e=>e;class td{constructor(e){this._onTransitionUpdate=e=>{const{time:t,settings:{interpolator:n,startProps:s,endProps:r,duration:i,easing:o}}=e,a=o(t/i),l=n.interpolateProps(s,r,a);this.propsInTransition=this.getControllerState({...this.props,...l}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Qh(e.timeline),this.onViewStateChange=e.onViewStateChange||Jh,this.onStateChange=e.onStateChange||Jh}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let s=n;if(this.transition.inProgress){const{interruption:e,endProps:t}=this.transition.settings;s={...n,...2===e?t:this.propsInTransition||n}}this._triggerTransition(s,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:n}=e;return(t>0||"auto"===t)&&Boolean(n)}_isUpdateDueToCurrentTransition(e){return!(!this.transition.inProgress||!this.propsInTransition)&&this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition)}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?3===this.transition.settings.interruption||this._isUpdateDueToCurrentTransition(t):!this._isTransitionEnabled(t)||t.transitionInterpolator.arePropsEqual(e,t)}_triggerTransition(e,t){const n=this.getControllerState(e),s=this.getControllerState(t).shortestPathFrom(n),r=t.transitionInterpolator,i=r.getDuration?r.getDuration(e,t):t.transitionDuration;if(0===i)return;const o=r.initializeProps(e,s);this.propsInTransition={};const a={duration:i,easing:t.transitionEasing||ed,interpolator:r,interruption:t.transitionInterruption||1,startProps:o.start,endProps:o.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(a),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),null==e||e(t)}}}function nd(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}class sd{constructor(e){const{compare:t,extract:n,required:s}=e;this._propsToCompare=t,this._propsToExtract=n||t,this._requiredProps=s}arePropsEqual(e,t){for(const n of this._propsToCompare)if(!(n in e)||!(n in t)||!Ca(e[n],t[n]))return!1;return!0}initializeProps(e,t){const n={},s={};for(const r of this._propsToExtract)(r in e||r in t)&&(n[r]=e[r],s[r]=t[r]);return this._checkRequiredProps(n),this._checkRequiredProps(s),{start:n,end:s}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const n=e[t];nd(Number.isFinite(n)||Array.isArray(n),`${t} is required for transition`)})}}const rd=["longitude","latitude","zoom","bearing","pitch"],id=["longitude","latitude","zoom"];class od extends sd{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:rd,required:id},super(n.transitionProps),this.opts=n}initializeProps(e,t){const n=super.initializeProps(e,t),{makeViewport:s,around:r}=this.opts;if(s&&r){const i=s(e),o=s(t),a=i.unproject(r);n.start.around=r,Object.assign(n.end,{around:o.project(a),aroundPosition:a,width:t.width,height:t.height})}return n}interpolateProps(e,t,n){const s={};for(const r of this._propsToExtract)s[r]=Ra(e[r]||0,t[r]||0,n);if(t.aroundPosition&&this.opts.makeViewport){const r=this.opts.makeViewport({...t,...s});Object.assign(s,r.panByPosition(t.aroundPosition,Ra(e.around,t.around,n)))}return s}}const ad={transitionDuration:0},ld=e=>1-(1-e)*(1-e),cd=["wheel"],ud=["panstart","panmove","panend"],hd=["pinchstart","pinchmove","pinchend"],dd=["multipanstart","multipanmove","multipanend"],fd=["dblclick"],pd=["keydown"],gd={};class md{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new td({...e,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const t in this._events)this._events[t]&&(null==(e=this.eventManager)||e.off(t,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return!t&&this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return!t&&this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return!t&&this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:n}=this.props,{offsetCenter:s}=e;return[s.x-t,s.y-n]}isPointInBounds(e,t){const{width:n,height:s}=this.props;if(t&&t.handled)return!1;const r=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=s;return r&&t&&t.stopPropagation(),r}isFunctionKeyPressed(e){const{srcEvent:t}=e;return Boolean(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:!0===t?300:0;const{scrollZoom:n=!0,dragPan:s=!0,dragRotate:r=!0,doubleClickZoom:i=!0,touchZoom:o=!0,touchRotate:a=!1,keyboard:l=!0}=e,c=Boolean(this.onViewStateChange);this.toggleEvents(cd,c&&n),this.toggleEvents(ud,c),this.toggleEvents(hd,c&&(o||a)),this.toggleEvents(dd,c&&a),this.toggleEvents(fd,c&&i),this.toggleEvents(pd,c&&l),this.scrollZoom=n,this.dragPan=s,this.dragRotate=r,this.doubleClickZoom=i,this.touchZoom=o,this.touchRotate=a,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(e=>{this._events[e]!==t&&(this._events[e]=t,t?this.eventManager.on(e,this.handleEvent):this.eventManager.off(e,this.handleEvent))})}updateViewport(e,t=null,n={}){const s={...e.getViewportProps(),...t},r=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),r){const e=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:e,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||"pan"===this.dragMode)&&(n=!n);const s=this.controllerState[n?"panStart":"rotateStart"]({pos:t});return this._panMove=n,this.updateViewport(s,ad,{isDragging:!0}),!0}_onPan(e){return!!this.isDragging()&&(this._panMove?this._onPanMove(e):this._onPanRotate(e))}_onPanEnd(e){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e))}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),n=this.controllerState.pan({pos:t});return this.updateViewport(n,ad,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const n=this.getCenter(e),s=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],r=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:ld},{isDragging:!1,isPanning:!0})}else{const e=this.controllerState.panEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),n=this.controllerState.rotate({pos:t});return this.updateViewport(n,ad,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const n=this.getCenter(e),s=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],r=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:ld},{isDragging:!1,isRotating:!0})}else{const e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:s=!1}=!0===this.scrollZoom?{}:this.scrollZoom,{delta:r}=e;let i=2/(1+Math.exp(-Math.abs(r*n)));r<0&&0!==i&&(i=1/i);const o=s?{...this._getTransitionProps({around:t}),transitionDuration:250}:ad,a=this.controllerState.zoom({pos:t,scale:i});return this.updateViewport(a,o,{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.rotateStart({pos:t});return this.updateViewport(n,ad,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate)return!1;if(!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const n=this.controllerState.rotate({pos:t});return this.updateViewport(n,ad,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const n=this.getCenter(e),s=[n[0],n[1]+=e.velocityY*t/2],r=this.controllerState.rotate({pos:s});this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:ld},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return gd._startPinchRotation=e.rotation,gd._lastPinchEvent=e,this.updateViewport(n,ad,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate)return!1;if(!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:n}=e,s=this.getCenter(e);t=t.zoom({pos:s,scale:n})}if(this.touchRotate){const{rotation:n}=e;t=t.rotate({deltaAngleX:gd._startPinchRotation-n})}return this.updateViewport(t,ad,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),gd._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:n}=gd;if(this.touchZoom&&t&&n&&e.scale!==n.scale){const s=this.getCenter(e);let r=this.controllerState.rotateEnd();const i=Math.log2(e.scale),o=(i-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),a=Math.pow(2,i+o*t/2);r=r.zoom({pos:s,scale:a}).zoomEnd(),this.updateViewport(r,{...this._getTransitionProps({around:s}),transitionDuration:t,transitionEasing:ld},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const e=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return gd._startPinchRotation=null,gd._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:t,scale:n?.5:2});return this.updateViewport(s,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:s,rotateSpeedX:r,rotateSpeedY:i}=!0===this.keyboard?{}:this.keyboard,{controllerState:o}=this;let a;const l={};switch(e.srcEvent.code){case"Minus":a=t?o.zoomOut(n).zoomOut(n):o.zoomOut(n),l.isZooming=!0;break;case"Equal":a=t?o.zoomIn(n).zoomIn(n):o.zoomIn(n),l.isZooming=!0;break;case"ArrowLeft":t?(a=o.rotateLeft(r),l.isRotating=!0):(a=o.moveLeft(s),l.isPanning=!0);break;case"ArrowRight":t?(a=o.rotateRight(r),l.isRotating=!0):(a=o.moveRight(s),l.isPanning=!0);break;case"ArrowUp":t?(a=o.rotateUp(i),l.isRotating=!0):(a=o.moveUp(s),l.isPanning=!0);break;case"ArrowDown":t?(a=o.rotateDown(i),l.isRotating=!0):(a=o.moveDown(s),l.isPanning=!0);break;default:return!1}return this.updateViewport(a,this._getTransitionProps(),l),!0}_getTransitionProps(e){const{transition:t}=this;return t&&t.transitionInterpolator?e?{...t,transitionInterpolator:new od({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t:ad}}class _d{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}class yd extends _d{constructor(e){const{width:t,height:n,latitude:s,longitude:r,zoom:i,bearing:o=0,pitch:a=0,altitude:l=1.5,position:c=[0,0,0],maxZoom:u=20,minZoom:h=0,maxPitch:d=60,minPitch:f=0,startPanLngLat:p,startZoomLngLat:g,startRotatePos:m,startBearing:_,startPitch:y,startZoom:b,normalize:v=!0}=e;nd(Number.isFinite(r)),nd(Number.isFinite(s)),nd(Number.isFinite(i)),super({width:t,height:n,latitude:s,longitude:r,zoom:i,bearing:o,pitch:a,altitude:l,maxZoom:u,minZoom:h,maxPitch:d,minPitch:f,normalize:v,position:c},{startPanLngLat:p,startZoomLngLat:g,startRotatePos:m,startBearing:_,startPitch:y,startZoom:b}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const n=this.getState().startPanLngLat||this._unproject(t);if(!n)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:n=0}){const{startRotatePos:s,startBearing:r,startPitch:i}=this.getState();if(!s||void 0===r||void 0===i)return this;let o;return o=e?this._getNewRotation(e,s,i,r):{bearing:r+t,pitch:i+n},this._getUpdatedState(o)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:n}){let{startZoom:s,startZoomLngLat:r}=this.getState();if(r||(s=this.getViewportProps().zoom,r=this._unproject(t)||this._unproject(e)),!r)return this;const{maxZoom:i,minZoom:o}=this.getViewportProps();let a=s+Math.log2(n);a=Aa(a,o,i);const l=this.makeViewport({...this.getViewportProps(),zoom:a});return this._getUpdatedState({zoom:a,...l.panByPosition(r,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),n={...this.getViewportProps()},{bearing:s,longitude:r}=n;return Math.abs(s-t.bearing)>180&&(n.bearing=s<0?s+360:s-360),Math.abs(r-t.longitude)>180&&(n.longitude=r<0?r+360:r-360),n}applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:s}=e;e.zoom=Aa(s,n,t);const{maxPitch:r,minPitch:i,pitch:o}=e;e.pitch=Aa(o,i,r);const{normalize:a=!0}=e;return a&&Object.assign(e,function(e){const{width:t,height:n,pitch:s=0}=e;let{longitude:r,latitude:i,zoom:o,bearing:a=0}=e;(r<-180||r>180)&&(r=jc(r+180,360)-180),(a<-180||a>180)&&(a=jc(a+180,360)-180);const l=Vc(n/512);if(o<=l)o=l,i=0;else{const e=n/2/Math.pow(2,o),t=Qc([0,e])[1];if(i<t)i=t;else{const t=Qc([0,512-e])[1];i>t&&(i=t)}}return{width:t,height:n,longitude:r,latitude:i,zoom:o,pitch:s,bearing:a}}(e)),e}_zoomFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.zoom({pos:[t/2,n/2],scale:e})}_panFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.pan({startPos:[t/2,n/2],pos:[t/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,n,s){const r=e[0]-t[0],i=e[1]-t[1],o=e[1],a=t[1],{width:l,height:c}=this.getViewportProps(),u=r/l;let h=0;i>0?Math.abs(c-a)>5&&(h=i/(a-c)*1.2):i<0&&a>5&&(h=1-o/a),h=Aa(h,-1,1);const{minPitch:d,maxPitch:f}=this.getViewportProps();let p=n;return h>0?p=n+h*(f-n):h<0&&(p=n-h*(d-n)),{pitch:p,bearing:s+180*u}}}class bd extends md{constructor(){super(...arguments),this.ControllerState=yd,this.transition={transitionDuration:300,transitionInterpolator:new od({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class vd extends Zh{constructor(e={}){super(e)}getViewportType(){return Zu}get ControllerType(){return bd}}vd.displayName="MapView";const xd=new Bu;class wd{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(t=>t.id===e.id)){const n=t.findIndex(t=>function(e,t){return(e.order??1/0)-(t.order??1/0)}(t,e)>0);n<0?t.push(e):t.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&($h(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const s of this.effects)t[s.id]=s;const n=[];for(const s of e){const e=t[s.id];let r=s;e&&e!==s?e.setProps?(e.setProps(s.props),r=e):e.cleanup(this._context):e||s.setup(this._context),n.push(r),delete t[s.id]}for(const s in t)t[s].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(e=>e instanceof Bu)||this._resolvedEffects.push(xd),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class Ed extends Iu{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}class Td{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Ed(e),this.pickLayersPass=new Mh(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const s=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const r=t.render({...n,target:s});n.effects&&(this.lastPostProcessEffect&&(n.clearCanvas=void 0===e.clearCanvas||e.clearCanvas),this._postRender(n.effects,n)),this.renderCount++,Bn("deckRenderer.renderLayers",this,r,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const n of e)t.preRenderStats[n.id]=n.preRender(t),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize(),[n,s]=t;0===e.length&&[0,1].map(t=>{const r=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:n,height:s});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${t}`,colorAttachments:[r]}))});for(const r of e)r.resize(t)}_postRender(e,t){const{renderBuffers:n}=this,s={...t,inputBuffer:n[0],swapBuffer:n[1]};for(const r of e)if(r.postRender){s.target=r.id===this.lastPostProcessEffect?t.target:void 0;const e=r.postRender(s);s.inputBuffer=e,s.swapBuffer=e===n[0]?n[1]:n[0]}}}const Sd={pickedColor:null,pickedObjectIndex:-1};function Ad({pickedColors:e,decodePickingColor:t,deviceX:n,deviceY:s,deviceRadius:r,deviceRect:i}){const{x:o,y:a,width:l,height:c}=i;let u=r*r,h=-1,d=0;for(let f=0;f<c;f++){const t=f+a-s,r=t*t;if(r>u)d+=4*l;else for(let s=0;s<l;s++){if(e[d+3]-1>=0){const e=s+o-n,t=e*e+r;t<=u&&(u=t,h=d)}d+=4}}if(h>=0){const n=e.slice(h,h+4),s=t(n);if(s){const e=Math.floor(h/4/l),t=h/4-e*l;return{...s,pickedColor:n,pickedX:o+t,pickedY:a+e}}On.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Sd}function Rd({pickedColors:e,decodePickingColor:t}){const n=new Map;if(e)for(let s=0;s<e.length;s+=4)if(e[s+3]-1>=0){const r=e.slice(s,s+4),i=r.join(",");if(!n.has(i)){const e=t(r);e?n.set(i,{...e,color:r}):On.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return Array.from(n.values())}function Cd({pickInfo:e,viewports:t,pixelRatio:n,x:s,y:r,z:i}){let o,a=t[0];if(t.length>1&&(a=function(e,t){for(let n=e.length-1;n>=0;n--){const s=e[n];if(s.containsPixel(t))return s}return e[0]}((null==e?void 0:e.pickedViewports)||t,{x:s,y:r})),a){const e=[s-a.x,r-a.y];void 0!==i&&(e[2]=i),o=a.unproject(e)}return{color:null,layer:null,viewport:a,index:-1,picked:!1,x:s,y:r,pixel:[s,r],coordinate:o,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:n}}function Pd(e){const{pickInfo:t,lastPickedInfo:n,mode:s,layers:r}=e,{pickedColor:i,pickedLayer:o,pickedObjectIndex:a}=t,l=o?[o]:[];if("hover"===s){const e=n.index,t=n.layerId,s=o?o.props.id:null;if(s!==t||a!==e){if(s!==t){const e=r.find(e=>e.props.id===t);e&&l.unshift(e)}n.layerId=s,n.index=a,n.info=null}}const c=Cd(e),u=new Map;return u.set(null,c),l.forEach(e=>{let t={...c};e===o&&(t.color=i,t.index=a,t.picked=!0),t=kd({layer:e,info:t,mode:s});const r=t.layer;e===o&&"hover"===s&&(n.info=t),u.set(r.id,t),"hover"===s&&r.updateAutoHighlight(t)}),u}function kd({layer:e,info:t,mode:n}){for(;e&&t;){const s=t.layer||null;t.sourceLayer=s,t.layer=e,t=e.getPickingInfo({info:t,mode:n,sourceLayer:s}),e=e.parent}return t}class Id{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new Mh(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(e){return this._pickClosestObjectAsync(e)}pickObjectsAsync(e){return this._pickVisibleObjectsAsync(e)}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:n,viewports:s},r=this.lastPickedInfo.info){const i=r&&r.layer&&r.layer.id,o=r&&r.viewport&&r.viewport.id,a=i?n.find(e=>e.id===i):null,l=o&&s.find(e=>e.id===o)||s[0],c=l&&l.unproject([e-l.x,t-l.y]),u={x:e,y:t,viewport:l,coordinate:c,layer:a};return{...r,...u}}_resizeBuffer(){var e,t;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const e=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=e}const{canvas:n}=this.device.getDefaultCanvasContext();null==(e=this.pickingFBO)||e.resize({width:n.width,height:n.height}),null==(t=this.depthFBO)||t.resize({width:n.width,height:n.height})}_getPickable(e){if(!1===this._pickable)return null;const t=e.filter(e=>this.pickLayersPass.shouldDrawLayer(e)&&!e.isComposite);return t.length?t:null}async _pickClosestObjectAsync({layers:e,views:t,viewports:n,x:s,y:r,radius:i=0,depth:o=1,mode:a="query",unproject3D:l,onViewportActive:c,effects:u}){const h=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(e);if(!d||0===n.length)return{result:[],emptyInfo:Cd({viewports:n,x:s,y:r,pixelRatio:h})};this._resizeBuffer();const f=this.device.canvasContext.cssToDevicePixels([s,r],!0),p=[f.x+Math.floor(f.width/2),f.y+Math.floor(f.height/2)],g=Math.round(i*h),{width:m,height:_}=this.pickingFBO,y=this._getPickingRect({deviceX:p[0],deviceY:p[1],deviceRadius:g,deviceWidth:m,deviceHeight:_}),b={x:s-i,y:r-i,width:2*i+1,height:2*i+1};let v;const x=[],w=new Set;for(let E=0;E<o;E++){let e,i;if(e=y?Ad({...this._drawAndSample({layers:d,views:t,viewports:n,onViewportActive:c,deviceRect:y,cullRect:b,effects:u,pass:`picking:${a}`}),deviceX:p[0],deviceY:p[1],deviceRadius:g,deviceRect:y}):{pickedColor:null,pickedObjectIndex:-1},e.pickedLayer&&l&&this.depthFBO){const{pickedColors:s}=this._drawAndSample({layers:[e.pickedLayer],views:t,viewports:n,onViewportActive:c,deviceRect:{x:e.pickedX,y:e.pickedY,width:1,height:1},cullRect:b,effects:u,pass:`picking:${a}:z`},!0);s[3]&&(i=s[0])}e.pickedLayer&&E+1<o&&(w.add(e.pickedLayer),e.pickedLayer.disablePickingIndex(e.pickedObjectIndex)),v=Pd({pickInfo:e,lastPickedInfo:this.lastPickedInfo,mode:a,layers:d,viewports:n,x:s,y:r,z:i,pixelRatio:h});for(const t of v.values())t.layer&&x.push(t);if(!e.pickedColor)break}for(const E of w)E.restorePickingColors();return{result:x,emptyInfo:v.get(null)}}_pickClosestObject({layers:e,views:t,viewports:n,x:s,y:r,radius:i=0,depth:o=1,mode:a="query",unproject3D:l,onViewportActive:c,effects:u}){const h=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(e);if(!d||0===n.length)return{result:[],emptyInfo:Cd({viewports:n,x:s,y:r,pixelRatio:h})};this._resizeBuffer();const f=this.device.canvasContext.cssToDevicePixels([s,r],!0),p=[f.x+Math.floor(f.width/2),f.y+Math.floor(f.height/2)],g=Math.round(i*h),{width:m,height:_}=this.pickingFBO,y=this._getPickingRect({deviceX:p[0],deviceY:p[1],deviceRadius:g,deviceWidth:m,deviceHeight:_}),b={x:s-i,y:r-i,width:2*i+1,height:2*i+1};let v;const x=[],w=new Set;for(let E=0;E<o;E++){let e,i;if(e=y?Ad({...this._drawAndSample({layers:d,views:t,viewports:n,onViewportActive:c,deviceRect:y,cullRect:b,effects:u,pass:`picking:${a}`}),deviceX:p[0],deviceY:p[1],deviceRadius:g,deviceRect:y}):{pickedColor:null,pickedObjectIndex:-1},e.pickedLayer&&l&&this.depthFBO){const{pickedColors:s}=this._drawAndSample({layers:[e.pickedLayer],views:t,viewports:n,onViewportActive:c,deviceRect:{x:e.pickedX,y:e.pickedY,width:1,height:1},cullRect:b,effects:u,pass:`picking:${a}:z`},!0);s[3]&&(i=s[0])}e.pickedLayer&&E+1<o&&(w.add(e.pickedLayer),e.pickedLayer.disablePickingIndex(e.pickedObjectIndex)),v=Pd({pickInfo:e,lastPickedInfo:this.lastPickedInfo,mode:a,layers:d,viewports:n,x:s,y:r,z:i,pixelRatio:h});for(const t of v.values())t.layer&&x.push(t);if(!e.pickedColor)break}for(const E of w)E.restorePickingColors();return{result:x,emptyInfo:v.get(null)}}async _pickVisibleObjectsAsync({layers:e,views:t,viewports:n,x:s,y:r,width:i=1,height:o=1,mode:a="query",maxObjects:l=null,onViewportActive:c,effects:u}){const h=this._getPickable(e);if(!h||0===n.length)return[];this._resizeBuffer();const d=this.device.canvasContext.cssToDeviceRatio(),f=this.device.canvasContext.cssToDevicePixels([s,r],!0),p=f.x,g=f.y+f.height,m=this.device.canvasContext.cssToDevicePixels([s+i,r+o],!0),_=m.x+m.width,y=m.y,b={x:p,y:y,width:_-p,height:g-y},v=Rd(this._drawAndSample({layers:h,views:t,viewports:n,onViewportActive:c,deviceRect:b,cullRect:{x:s,y:r,width:i,height:o},effects:u,pass:`picking:${a}`})),x=new Map,w=[],E=Number.isFinite(l);for(let T=0;T<v.length&&!(E&&w.length>=l);T++){const e=v[T];let t={color:e.pickedColor,layer:null,index:e.pickedObjectIndex,picked:!0,x:s,y:r,pixelRatio:d};t=kd({layer:e.pickedLayer,info:t,mode:a});const n=t.layer.id;x.has(n)||x.set(n,new Set);const i=x.get(n),o=t.object??t.index;i.has(o)||(i.add(o),w.push(t))}return w}_pickVisibleObjects({layers:e,views:t,viewports:n,x:s,y:r,width:i=1,height:o=1,mode:a="query",maxObjects:l=null,onViewportActive:c,effects:u}){const h=this._getPickable(e);if(!h||0===n.length)return[];this._resizeBuffer();const d=this.device.canvasContext.cssToDeviceRatio(),f=this.device.canvasContext.cssToDevicePixels([s,r],!0),p=f.x,g=f.y+f.height,m=this.device.canvasContext.cssToDevicePixels([s+i,r+o],!0),_=m.x+m.width,y=m.y,b={x:p,y:y,width:_-p,height:g-y},v=Rd(this._drawAndSample({layers:h,views:t,viewports:n,onViewportActive:c,deviceRect:b,cullRect:{x:s,y:r,width:i,height:o},effects:u,pass:`picking:${a}`})),x=new Map,w=[],E=Number.isFinite(l);for(let T=0;T<v.length&&!(E&&w.length>=l);T++){const e=v[T];let t={color:e.pickedColor,layer:null,index:e.pickedObjectIndex,picked:!0,x:s,y:r,pixelRatio:d};t=kd({layer:e.pickedLayer,info:t,mode:a});const n=t.layer.id;x.has(n)||x.set(n,new Set);const i=x.get(n),o=t.object??t.index;i.has(o)||(i.add(o),w.push(t))}return w}async _drawAndSampleAsync({layers:e,views:t,viewports:n,onViewportActive:s,deviceRect:r,cullRect:i,effects:o,pass:a},l=!1){const c=l?this.depthFBO:this.pickingFBO,u={layers:e,layerFilter:this.layerFilter,views:t,viewports:n,onViewportActive:s,pickingFBO:c,deviceRect:r,cullRect:i,effects:o,pass:a,pickZ:l,preRenderStats:{},isPicking:!0};for(const _ of o)_.useInPicking&&(u.preRenderStats[_.id]=_.preRender(u));const{decodePickingColor:h}=this.pickLayersPass.render(u),{x:d,y:f,width:p,height:g}=r,m=new(l?Float32Array:Uint8Array)(p*g*4);return this.device.readPixelsToArrayWebGL(c,{sourceX:d,sourceY:f,sourceWidth:p,sourceHeight:g,target:m}),{pickedColors:m,decodePickingColor:h}}_drawAndSample({layers:e,views:t,viewports:n,onViewportActive:s,deviceRect:r,cullRect:i,effects:o,pass:a},l=!1){const c=l?this.depthFBO:this.pickingFBO,u={layers:e,layerFilter:this.layerFilter,views:t,viewports:n,onViewportActive:s,pickingFBO:c,deviceRect:r,cullRect:i,effects:o,pass:a,pickZ:l,preRenderStats:{},isPicking:!0};for(const _ of o)_.useInPicking&&(u.preRenderStats[_.id]=_.preRender(u));const{decodePickingColor:h}=this.pickLayersPass.render(u),{x:d,y:f,width:p,height:g}=r,m=new(l?Float32Array:Uint8Array)(p*g*4);return this.device.readPixelsToArrayWebGL(c,{sourceX:d,sourceY:f,sourceWidth:p,sourceHeight:g,target:m}),{pickedColors:m,decodePickingColor:h}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:n,deviceWidth:s,deviceHeight:r}){const i=Math.max(0,e-n),o=Math.max(0,t-n),a=Math.min(s,e+n+1)-i,l=Math.min(r,t+n+1)-o;return a<=0||l<=0?null:{x:i,y:o,width:a,height:l}}}const Md={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},Ld="top-left",Nd="__root";class Od{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,null==t||t.classList.add("deck-widget-container"),this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){if(e.widgets&&!$h(e.widgets,this.widgets,1)){const t=e.widgets.filter(Boolean);this._setWidgets(t)}}finalize(){for(const e of this.getWidgets())this._removeWidget(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._addWidget(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}onRedraw({viewports:e,layers:t}){var n,s;const r=e.reduce((e,t)=>(e[t.id]=t,e),{});for(const i of this.getWidgets()){const{viewId:o}=i;if(o){const e=r[o];e&&(i.onViewportChange&&i.onViewportChange(e),null==(n=i.onRedraw)||n.call(i,{viewports:[e],layers:t}))}else{if(i.onViewportChange)for(const t of e)i.onViewportChange(t);null==(s=i.onRedraw)||s.call(i,{viewports:e,layers:t})}}this.lastViewports=r,this._updateContainers()}onHover(e,t){var n,s;for(const r of this.getWidgets()){const{viewId:i}=r;i&&i!==(null==(n=e.viewport)?void 0:n.id)||null==(s=r.onHover)||s.call(r,e,t)}}onEvent(e,t){var n,s;const r=xc[t.type];if(r)for(const i of this.getWidgets()){const{viewId:o}=i;o&&o!==(null==(n=e.viewport)?void 0:n.id)||null==(s=i[r])||s.call(i,e,t)}}_setWidgets(e){const t={};for(const n of this.resolvedWidgets)t[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)t[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const e=t[n.id];e?e.viewId!==n.viewId||e.placement!==n.placement?(this._removeWidget(e),this._addWidget(n)):n!==e&&(e.setProps(n.props),n=e):this._addWidget(n),t[n.id]=null,this.resolvedWidgets.push(n)}for(const n in t){const e=t[n];e&&this._removeWidget(e)}this.widgets=e}_addWidget(e){const{viewId:t=null,placement:n=Ld}=e;e.widgetManager=this,e.deck=this.deck,e.rootElement=e._onAdd({deck:this.deck,viewId:t}),e.rootElement&&this._getContainer(t,n).append(e.rootElement),e.updateHTML()}_removeWidget(e){var t;null==(t=e.onRemove)||t.call(e),e.rootElement&&e.rootElement.remove(),e.rootElement=void 0,e.deck=void 0,e.widgetManager=void 0}_getContainer(e,t){var n;const s=e||Nd;let r=this.containers[s];r||(r=document.createElement("div"),r.style.pointerEvents="none",r.style.position="absolute",r.style.overflow="hidden",null==(n=this.parentElement)||n.append(r),this.containers[s]=r);let i=r.querySelector(`.${t}`);return i||(i=globalThis.document.createElement("div"),i.className=t,i.style.position="absolute",i.style.zIndex="2",Object.assign(i.style,Md[t]),r.append(i)),i}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const n in this.containers){const s=this.lastViewports[n]||null,r=n===Nd||s,i=this.containers[n];r?(i.style.display="block",i.style.left=`${s?s.x:0}px`,i.style.top=`${s?s.y:0}px`,i.style.width=`${s?s.width:e}px`,i.style.height=`${s?s.height:t}px`):i.style.display="none"}}}function Fd(e,t){t&&Object.entries(t).map(([t,n])=>{t.startsWith("--")?e.style.setProperty(t,n):e.style[t]=n})}class Dd{constructor(e){this.viewId=null,this.props={...this.constructor.defaultProps,...e},this.id=this.props.id}setProps(e){const t=this.props,n=this.rootElement;var s,r;n&&t.className!==e.className&&(t.className&&n.classList.remove(t.className),e.className&&n.classList.add(e.className)),n&&!$h(t.style,e.style,1)&&(s=n,(r=t.style)&&Object.keys(r).map(e=>{e.startsWith("--")?s.style.removeProperty(e):s.style[e]=""}),Fd(n,e.style)),Object.assign(this.props,e),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){const e=["deck-widget",this.className,this.props.className],t=document.createElement("div");return e.filter(e=>"string"==typeof e&&e.length>0).forEach(e=>t.classList.add(e)),Fd(t,this.props.style),t}_onAdd(e){return this.onAdd(e)??this.onCreateRootElement()}onAdd(e){}onRemove(){}onViewportChange(e){}onRedraw(e){}onHover(e,t){}onClick(e,t){}onDrag(e,t){}onDragStart(e,t){}onDragEnd(e,t){}}Dd.defaultProps={id:"widget",style:{},className:""};const Bd={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class Ud extends Dd{constructor(e={}){super(e),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(e)}onCreateRootElement(){const e=document.createElement("div");return e.className=this.className,Object.assign(e.style,Bd),e}onRenderHTML(e){}onViewportChange(e){var t;this.isVisible&&e.id===(null==(t=this.lastViewport)?void 0:t.id)&&!e.equals(this.lastViewport)&&this.setTooltip(null),this.lastViewport=e}onHover(e){const{deck:t}=this,n=t&&t.props.getTooltip;if(!n)return;const s=n(e);this.setTooltip(s,e.x,e.y)}setTooltip(e,t,n){const s=this.rootElement;if(s){if("string"==typeof e)s.innerText=e;else{if(!e)return this.isVisible=!1,void(s.style.display="none");e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className)}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${t}px, ${n}px)`,e&&"object"==typeof e&&"style"in e&&Object.assign(s.style,e.style)}}}var jd,Gd;Ud.defaultProps={...Dd.defaultProps},(Gd=jd||(jd={}))[Gd.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",Gd[Gd.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",Gd[Gd.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",Gd[Gd.POINTS=0]="POINTS",Gd[Gd.LINES=1]="LINES",Gd[Gd.LINE_LOOP=2]="LINE_LOOP",Gd[Gd.LINE_STRIP=3]="LINE_STRIP",Gd[Gd.TRIANGLES=4]="TRIANGLES",Gd[Gd.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",Gd[Gd.TRIANGLE_FAN=6]="TRIANGLE_FAN",Gd[Gd.ZERO=0]="ZERO",Gd[Gd.ONE=1]="ONE",Gd[Gd.SRC_COLOR=768]="SRC_COLOR",Gd[Gd.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",Gd[Gd.SRC_ALPHA=770]="SRC_ALPHA",Gd[Gd.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",Gd[Gd.DST_ALPHA=772]="DST_ALPHA",Gd[Gd.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",Gd[Gd.DST_COLOR=774]="DST_COLOR",Gd[Gd.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",Gd[Gd.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",Gd[Gd.CONSTANT_COLOR=32769]="CONSTANT_COLOR",Gd[Gd.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",Gd[Gd.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",Gd[Gd.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",Gd[Gd.FUNC_ADD=32774]="FUNC_ADD",Gd[Gd.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",Gd[Gd.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",Gd[Gd.BLEND_EQUATION=32777]="BLEND_EQUATION",Gd[Gd.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",Gd[Gd.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",Gd[Gd.BLEND_DST_RGB=32968]="BLEND_DST_RGB",Gd[Gd.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",Gd[Gd.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",Gd[Gd.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",Gd[Gd.BLEND_COLOR=32773]="BLEND_COLOR",Gd[Gd.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",Gd[Gd.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",Gd[Gd.LINE_WIDTH=2849]="LINE_WIDTH",Gd[Gd.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",Gd[Gd.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",Gd[Gd.CULL_FACE_MODE=2885]="CULL_FACE_MODE",Gd[Gd.FRONT_FACE=2886]="FRONT_FACE",Gd[Gd.DEPTH_RANGE=2928]="DEPTH_RANGE",Gd[Gd.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",Gd[Gd.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",Gd[Gd.DEPTH_FUNC=2932]="DEPTH_FUNC",Gd[Gd.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",Gd[Gd.STENCIL_FUNC=2962]="STENCIL_FUNC",Gd[Gd.STENCIL_FAIL=2964]="STENCIL_FAIL",Gd[Gd.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",Gd[Gd.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",Gd[Gd.STENCIL_REF=2967]="STENCIL_REF",Gd[Gd.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",Gd[Gd.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",Gd[Gd.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",Gd[Gd.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",Gd[Gd.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",Gd[Gd.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",Gd[Gd.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",Gd[Gd.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",Gd[Gd.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",Gd[Gd.VIEWPORT=2978]="VIEWPORT",Gd[Gd.SCISSOR_BOX=3088]="SCISSOR_BOX",Gd[Gd.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",Gd[Gd.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",Gd[Gd.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",Gd[Gd.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",Gd[Gd.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",Gd[Gd.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",Gd[Gd.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",Gd[Gd.RED_BITS=3410]="RED_BITS",Gd[Gd.GREEN_BITS=3411]="GREEN_BITS",Gd[Gd.BLUE_BITS=3412]="BLUE_BITS",Gd[Gd.ALPHA_BITS=3413]="ALPHA_BITS",Gd[Gd.DEPTH_BITS=3414]="DEPTH_BITS",Gd[Gd.STENCIL_BITS=3415]="STENCIL_BITS",Gd[Gd.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",Gd[Gd.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",Gd[Gd.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",Gd[Gd.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",Gd[Gd.SAMPLES=32937]="SAMPLES",Gd[Gd.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",Gd[Gd.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",Gd[Gd.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",Gd[Gd.VENDOR=7936]="VENDOR",Gd[Gd.RENDERER=7937]="RENDERER",Gd[Gd.VERSION=7938]="VERSION",Gd[Gd.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",Gd[Gd.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",Gd[Gd.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",Gd[Gd.STATIC_DRAW=35044]="STATIC_DRAW",Gd[Gd.STREAM_DRAW=35040]="STREAM_DRAW",Gd[Gd.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",Gd[Gd.ARRAY_BUFFER=34962]="ARRAY_BUFFER",Gd[Gd.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",Gd[Gd.BUFFER_SIZE=34660]="BUFFER_SIZE",Gd[Gd.BUFFER_USAGE=34661]="BUFFER_USAGE",Gd[Gd.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",Gd[Gd.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",Gd[Gd.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",Gd[Gd.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",Gd[Gd.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",Gd[Gd.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",Gd[Gd.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",Gd[Gd.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",Gd[Gd.CULL_FACE=2884]="CULL_FACE",Gd[Gd.FRONT=1028]="FRONT",Gd[Gd.BACK=1029]="BACK",Gd[Gd.FRONT_AND_BACK=1032]="FRONT_AND_BACK",Gd[Gd.BLEND=3042]="BLEND",Gd[Gd.DEPTH_TEST=2929]="DEPTH_TEST",Gd[Gd.DITHER=3024]="DITHER",Gd[Gd.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",Gd[Gd.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",Gd[Gd.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",Gd[Gd.SCISSOR_TEST=3089]="SCISSOR_TEST",Gd[Gd.STENCIL_TEST=2960]="STENCIL_TEST",Gd[Gd.NO_ERROR=0]="NO_ERROR",Gd[Gd.INVALID_ENUM=1280]="INVALID_ENUM",Gd[Gd.INVALID_VALUE=1281]="INVALID_VALUE",Gd[Gd.INVALID_OPERATION=1282]="INVALID_OPERATION",Gd[Gd.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",Gd[Gd.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",Gd[Gd.CW=2304]="CW",Gd[Gd.CCW=2305]="CCW",Gd[Gd.DONT_CARE=4352]="DONT_CARE",Gd[Gd.FASTEST=4353]="FASTEST",Gd[Gd.NICEST=4354]="NICEST",Gd[Gd.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",Gd[Gd.BYTE=5120]="BYTE",Gd[Gd.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",Gd[Gd.SHORT=5122]="SHORT",Gd[Gd.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",Gd[Gd.INT=5124]="INT",Gd[Gd.UNSIGNED_INT=5125]="UNSIGNED_INT",Gd[Gd.FLOAT=5126]="FLOAT",Gd[Gd.DOUBLE=5130]="DOUBLE",Gd[Gd.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",Gd[Gd.ALPHA=6406]="ALPHA",Gd[Gd.RGB=6407]="RGB",Gd[Gd.RGBA=6408]="RGBA",Gd[Gd.LUMINANCE=6409]="LUMINANCE",Gd[Gd.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",Gd[Gd.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",Gd[Gd.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",Gd[Gd.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",Gd[Gd.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",Gd[Gd.VERTEX_SHADER=35633]="VERTEX_SHADER",Gd[Gd.COMPILE_STATUS=35713]="COMPILE_STATUS",Gd[Gd.DELETE_STATUS=35712]="DELETE_STATUS",Gd[Gd.LINK_STATUS=35714]="LINK_STATUS",Gd[Gd.VALIDATE_STATUS=35715]="VALIDATE_STATUS",Gd[Gd.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",Gd[Gd.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",Gd[Gd.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",Gd[Gd.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",Gd[Gd.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",Gd[Gd.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",Gd[Gd.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",Gd[Gd.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",Gd[Gd.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",Gd[Gd.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",Gd[Gd.SHADER_TYPE=35663]="SHADER_TYPE",Gd[Gd.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",Gd[Gd.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",Gd[Gd.NEVER=512]="NEVER",Gd[Gd.LESS=513]="LESS",Gd[Gd.EQUAL=514]="EQUAL",Gd[Gd.LEQUAL=515]="LEQUAL",Gd[Gd.GREATER=516]="GREATER",Gd[Gd.NOTEQUAL=517]="NOTEQUAL",Gd[Gd.GEQUAL=518]="GEQUAL",Gd[Gd.ALWAYS=519]="ALWAYS",Gd[Gd.KEEP=7680]="KEEP",Gd[Gd.REPLACE=7681]="REPLACE",Gd[Gd.INCR=7682]="INCR",Gd[Gd.DECR=7683]="DECR",Gd[Gd.INVERT=5386]="INVERT",Gd[Gd.INCR_WRAP=34055]="INCR_WRAP",Gd[Gd.DECR_WRAP=34056]="DECR_WRAP",Gd[Gd.NEAREST=9728]="NEAREST",Gd[Gd.LINEAR=9729]="LINEAR",Gd[Gd.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",Gd[Gd.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",Gd[Gd.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",Gd[Gd.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",Gd[Gd.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",Gd[Gd.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",Gd[Gd.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",Gd[Gd.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",Gd[Gd.TEXTURE_2D=3553]="TEXTURE_2D",Gd[Gd.TEXTURE=5890]="TEXTURE",Gd[Gd.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",Gd[Gd.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",Gd[Gd.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",Gd[Gd.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",Gd[Gd.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",Gd[Gd.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",Gd[Gd.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",Gd[Gd.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",Gd[Gd.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",Gd[Gd.TEXTURE0=33984]="TEXTURE0",Gd[Gd.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",Gd[Gd.REPEAT=10497]="REPEAT",Gd[Gd.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",Gd[Gd.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",Gd[Gd.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",Gd[Gd.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",Gd[Gd.FLOAT_VEC2=35664]="FLOAT_VEC2",Gd[Gd.FLOAT_VEC3=35665]="FLOAT_VEC3",Gd[Gd.FLOAT_VEC4=35666]="FLOAT_VEC4",Gd[Gd.INT_VEC2=35667]="INT_VEC2",Gd[Gd.INT_VEC3=35668]="INT_VEC3",Gd[Gd.INT_VEC4=35669]="INT_VEC4",Gd[Gd.BOOL=35670]="BOOL",Gd[Gd.BOOL_VEC2=35671]="BOOL_VEC2",Gd[Gd.BOOL_VEC3=35672]="BOOL_VEC3",Gd[Gd.BOOL_VEC4=35673]="BOOL_VEC4",Gd[Gd.FLOAT_MAT2=35674]="FLOAT_MAT2",Gd[Gd.FLOAT_MAT3=35675]="FLOAT_MAT3",Gd[Gd.FLOAT_MAT4=35676]="FLOAT_MAT4",Gd[Gd.SAMPLER_2D=35678]="SAMPLER_2D",Gd[Gd.SAMPLER_CUBE=35680]="SAMPLER_CUBE",Gd[Gd.LOW_FLOAT=36336]="LOW_FLOAT",Gd[Gd.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",Gd[Gd.HIGH_FLOAT=36338]="HIGH_FLOAT",Gd[Gd.LOW_INT=36339]="LOW_INT",Gd[Gd.MEDIUM_INT=36340]="MEDIUM_INT",Gd[Gd.HIGH_INT=36341]="HIGH_INT",Gd[Gd.FRAMEBUFFER=36160]="FRAMEBUFFER",Gd[Gd.RENDERBUFFER=36161]="RENDERBUFFER",Gd[Gd.RGBA4=32854]="RGBA4",Gd[Gd.RGB5_A1=32855]="RGB5_A1",Gd[Gd.RGB565=36194]="RGB565",Gd[Gd.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",Gd[Gd.STENCIL_INDEX=6401]="STENCIL_INDEX",Gd[Gd.STENCIL_INDEX8=36168]="STENCIL_INDEX8",Gd[Gd.DEPTH_STENCIL=34041]="DEPTH_STENCIL",Gd[Gd.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",Gd[Gd.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",Gd[Gd.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",Gd[Gd.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",Gd[Gd.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",Gd[Gd.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",Gd[Gd.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",Gd[Gd.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",Gd[Gd.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",Gd[Gd.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",Gd[Gd.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",Gd[Gd.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",Gd[Gd.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",Gd[Gd.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",Gd[Gd.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",Gd[Gd.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",Gd[Gd.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",Gd[Gd.NONE=0]="NONE",Gd[Gd.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",Gd[Gd.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",Gd[Gd.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",Gd[Gd.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",Gd[Gd.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",Gd[Gd.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",Gd[Gd.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",Gd[Gd.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",Gd[Gd.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",Gd[Gd.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",Gd[Gd.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",Gd[Gd.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",Gd[Gd.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",Gd[Gd.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",Gd[Gd.READ_BUFFER=3074]="READ_BUFFER",Gd[Gd.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",Gd[Gd.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",Gd[Gd.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",Gd[Gd.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",Gd[Gd.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",Gd[Gd.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",Gd[Gd.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",Gd[Gd.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",Gd[Gd.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",Gd[Gd.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",Gd[Gd.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",Gd[Gd.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",Gd[Gd.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",Gd[Gd.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",Gd[Gd.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",Gd[Gd.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",Gd[Gd.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",Gd[Gd.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",Gd[Gd.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",Gd[Gd.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",Gd[Gd.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",Gd[Gd.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",Gd[Gd.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",Gd[Gd.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",Gd[Gd.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",Gd[Gd.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",Gd[Gd.RED=6403]="RED",Gd[Gd.RGB8=32849]="RGB8",Gd[Gd.RGBA8=32856]="RGBA8",Gd[Gd.RGB10_A2=32857]="RGB10_A2",Gd[Gd.TEXTURE_3D=32879]="TEXTURE_3D",Gd[Gd.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",Gd[Gd.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",Gd[Gd.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",Gd[Gd.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",Gd[Gd.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",Gd[Gd.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",Gd[Gd.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",Gd[Gd.SRGB=35904]="SRGB",Gd[Gd.SRGB8=35905]="SRGB8",Gd[Gd.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",Gd[Gd.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",Gd[Gd.RGBA32F=34836]="RGBA32F",Gd[Gd.RGB32F=34837]="RGB32F",Gd[Gd.RGBA16F=34842]="RGBA16F",Gd[Gd.RGB16F=34843]="RGB16F",Gd[Gd.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",Gd[Gd.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",Gd[Gd.R11F_G11F_B10F=35898]="R11F_G11F_B10F",Gd[Gd.RGB9_E5=35901]="RGB9_E5",Gd[Gd.RGBA32UI=36208]="RGBA32UI",Gd[Gd.RGB32UI=36209]="RGB32UI",Gd[Gd.RGBA16UI=36214]="RGBA16UI",Gd[Gd.RGB16UI=36215]="RGB16UI",Gd[Gd.RGBA8UI=36220]="RGBA8UI",Gd[Gd.RGB8UI=36221]="RGB8UI",Gd[Gd.RGBA32I=36226]="RGBA32I",Gd[Gd.RGB32I=36227]="RGB32I",Gd[Gd.RGBA16I=36232]="RGBA16I",Gd[Gd.RGB16I=36233]="RGB16I",Gd[Gd.RGBA8I=36238]="RGBA8I",Gd[Gd.RGB8I=36239]="RGB8I",Gd[Gd.RED_INTEGER=36244]="RED_INTEGER",Gd[Gd.RGB_INTEGER=36248]="RGB_INTEGER",Gd[Gd.RGBA_INTEGER=36249]="RGBA_INTEGER",Gd[Gd.R8=33321]="R8",Gd[Gd.RG8=33323]="RG8",Gd[Gd.R16F=33325]="R16F",Gd[Gd.R32F=33326]="R32F",Gd[Gd.RG16F=33327]="RG16F",Gd[Gd.RG32F=33328]="RG32F",Gd[Gd.R8I=33329]="R8I",Gd[Gd.R8UI=33330]="R8UI",Gd[Gd.R16I=33331]="R16I",Gd[Gd.R16UI=33332]="R16UI",Gd[Gd.R32I=33333]="R32I",Gd[Gd.R32UI=33334]="R32UI",Gd[Gd.RG8I=33335]="RG8I",Gd[Gd.RG8UI=33336]="RG8UI",Gd[Gd.RG16I=33337]="RG16I",Gd[Gd.RG16UI=33338]="RG16UI",Gd[Gd.RG32I=33339]="RG32I",Gd[Gd.RG32UI=33340]="RG32UI",Gd[Gd.R8_SNORM=36756]="R8_SNORM",Gd[Gd.RG8_SNORM=36757]="RG8_SNORM",Gd[Gd.RGB8_SNORM=36758]="RGB8_SNORM",Gd[Gd.RGBA8_SNORM=36759]="RGBA8_SNORM",Gd[Gd.RGB10_A2UI=36975]="RGB10_A2UI",Gd[Gd.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",Gd[Gd.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",Gd[Gd.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",Gd[Gd.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",Gd[Gd.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",Gd[Gd.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",Gd[Gd.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",Gd[Gd.HALF_FLOAT=5131]="HALF_FLOAT",Gd[Gd.RG=33319]="RG",Gd[Gd.RG_INTEGER=33320]="RG_INTEGER",Gd[Gd.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",Gd[Gd.CURRENT_QUERY=34917]="CURRENT_QUERY",Gd[Gd.QUERY_RESULT=34918]="QUERY_RESULT",Gd[Gd.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",Gd[Gd.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",Gd[Gd.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",Gd[Gd.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",Gd[Gd.DRAW_BUFFER0=34853]="DRAW_BUFFER0",Gd[Gd.DRAW_BUFFER1=34854]="DRAW_BUFFER1",Gd[Gd.DRAW_BUFFER2=34855]="DRAW_BUFFER2",Gd[Gd.DRAW_BUFFER3=34856]="DRAW_BUFFER3",Gd[Gd.DRAW_BUFFER4=34857]="DRAW_BUFFER4",Gd[Gd.DRAW_BUFFER5=34858]="DRAW_BUFFER5",Gd[Gd.DRAW_BUFFER6=34859]="DRAW_BUFFER6",Gd[Gd.DRAW_BUFFER7=34860]="DRAW_BUFFER7",Gd[Gd.DRAW_BUFFER8=34861]="DRAW_BUFFER8",Gd[Gd.DRAW_BUFFER9=34862]="DRAW_BUFFER9",Gd[Gd.DRAW_BUFFER10=34863]="DRAW_BUFFER10",Gd[Gd.DRAW_BUFFER11=34864]="DRAW_BUFFER11",Gd[Gd.DRAW_BUFFER12=34865]="DRAW_BUFFER12",Gd[Gd.DRAW_BUFFER13=34866]="DRAW_BUFFER13",Gd[Gd.DRAW_BUFFER14=34867]="DRAW_BUFFER14",Gd[Gd.DRAW_BUFFER15=34868]="DRAW_BUFFER15",Gd[Gd.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",Gd[Gd.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",Gd[Gd.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",Gd[Gd.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",Gd[Gd.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",Gd[Gd.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",Gd[Gd.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",Gd[Gd.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",Gd[Gd.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",Gd[Gd.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",Gd[Gd.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",Gd[Gd.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",Gd[Gd.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",Gd[Gd.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",Gd[Gd.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",Gd[Gd.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",Gd[Gd.SAMPLER_3D=35679]="SAMPLER_3D",Gd[Gd.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",Gd[Gd.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",Gd[Gd.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",Gd[Gd.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",Gd[Gd.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",Gd[Gd.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",Gd[Gd.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",Gd[Gd.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",Gd[Gd.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",Gd[Gd.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",Gd[Gd.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",Gd[Gd.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",Gd[Gd.MAX_SAMPLES=36183]="MAX_SAMPLES",Gd[Gd.SAMPLER_BINDING=35097]="SAMPLER_BINDING",Gd[Gd.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",Gd[Gd.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",Gd[Gd.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",Gd[Gd.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",Gd[Gd.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",Gd[Gd.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",Gd[Gd.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",Gd[Gd.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",Gd[Gd.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",Gd[Gd.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",Gd[Gd.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",Gd[Gd.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",Gd[Gd.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",Gd[Gd.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",Gd[Gd.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",Gd[Gd.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",Gd[Gd.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",Gd[Gd.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",Gd[Gd.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",Gd[Gd.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",Gd[Gd.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",Gd[Gd.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",Gd[Gd.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",Gd[Gd.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",Gd[Gd.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",Gd[Gd.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",Gd[Gd.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",Gd[Gd.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",Gd[Gd.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",Gd[Gd.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",Gd[Gd.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",Gd[Gd.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",Gd[Gd.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",Gd[Gd.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",Gd[Gd.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",Gd[Gd.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",Gd[Gd.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",Gd[Gd.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",Gd[Gd.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",Gd[Gd.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",Gd[Gd.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",Gd[Gd.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",Gd[Gd.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",Gd[Gd.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",Gd[Gd.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",Gd[Gd.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",Gd[Gd.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",Gd[Gd.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",Gd[Gd.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",Gd[Gd.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",Gd[Gd.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",Gd[Gd.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",Gd[Gd.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",Gd[Gd.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",Gd[Gd.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",Gd[Gd.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",Gd[Gd.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",Gd[Gd.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",Gd[Gd.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",Gd[Gd.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",Gd[Gd.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",Gd[Gd.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",Gd[Gd.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",Gd[Gd.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",Gd[Gd.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",Gd[Gd.UNIFORM_TYPE=35383]="UNIFORM_TYPE",Gd[Gd.UNIFORM_SIZE=35384]="UNIFORM_SIZE",Gd[Gd.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",Gd[Gd.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",Gd[Gd.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",Gd[Gd.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",Gd[Gd.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",Gd[Gd.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",Gd[Gd.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",Gd[Gd.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",Gd[Gd.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",Gd[Gd.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",Gd[Gd.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",Gd[Gd.OBJECT_TYPE=37138]="OBJECT_TYPE",Gd[Gd.SYNC_CONDITION=37139]="SYNC_CONDITION",Gd[Gd.SYNC_STATUS=37140]="SYNC_STATUS",Gd[Gd.SYNC_FLAGS=37141]="SYNC_FLAGS",Gd[Gd.SYNC_FENCE=37142]="SYNC_FENCE",Gd[Gd.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",Gd[Gd.UNSIGNALED=37144]="UNSIGNALED",Gd[Gd.SIGNALED=37145]="SIGNALED",Gd[Gd.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",Gd[Gd.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",Gd[Gd.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",Gd[Gd.WAIT_FAILED=37149]="WAIT_FAILED",Gd[Gd.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",Gd[Gd.COLOR=6144]="COLOR",Gd[Gd.DEPTH=6145]="DEPTH",Gd[Gd.STENCIL=6146]="STENCIL",Gd[Gd.MIN=32775]="MIN",Gd[Gd.MAX=32776]="MAX",Gd[Gd.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",Gd[Gd.STREAM_READ=35041]="STREAM_READ",Gd[Gd.STREAM_COPY=35042]="STREAM_COPY",Gd[Gd.STATIC_READ=35045]="STATIC_READ",Gd[Gd.STATIC_COPY=35046]="STATIC_COPY",Gd[Gd.DYNAMIC_READ=35049]="DYNAMIC_READ",Gd[Gd.DYNAMIC_COPY=35050]="DYNAMIC_COPY",Gd[Gd.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",Gd[Gd.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",Gd[Gd.INVALID_INDEX=4294967295]="INVALID_INDEX",Gd[Gd.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",Gd[Gd.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",Gd[Gd.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",Gd[Gd.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",Gd[Gd.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",Gd[Gd.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",Gd[Gd.R16_EXT=33322]="R16_EXT",Gd[Gd.RG16_EXT=33324]="RG16_EXT",Gd[Gd.RGB16_EXT=32852]="RGB16_EXT",Gd[Gd.RGBA16_EXT=32859]="RGBA16_EXT",Gd[Gd.R16_SNORM_EXT=36760]="R16_SNORM_EXT",Gd[Gd.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",Gd[Gd.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",Gd[Gd.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",Gd[Gd.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",Gd[Gd.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",Gd[Gd.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",Gd[Gd.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",Gd[Gd.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",Gd[Gd.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",Gd[Gd.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",Gd[Gd.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",Gd[Gd.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",Gd[Gd.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",Gd[Gd.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",Gd[Gd.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",Gd[Gd.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",Gd[Gd.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",Gd[Gd.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",Gd[Gd.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",Gd[Gd.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",Gd[Gd.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",Gd[Gd.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",Gd[Gd.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",Gd[Gd.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",Gd[Gd.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",Gd[Gd.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",Gd[Gd.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",Gd[Gd.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",Gd[Gd.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",Gd[Gd.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",Gd[Gd.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",Gd[Gd.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",Gd[Gd.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",Gd[Gd.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",Gd[Gd.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",Gd[Gd.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",Gd[Gd.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",Gd[Gd.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",Gd[Gd.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",Gd[Gd.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",Gd[Gd.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",Gd[Gd.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",Gd[Gd.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",Gd[Gd.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",Gd[Gd.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",Gd[Gd.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",Gd[Gd.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",Gd[Gd.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",Gd[Gd.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",Gd[Gd.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",Gd[Gd.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",Gd[Gd.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",Gd[Gd.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",Gd[Gd.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",Gd[Gd.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",Gd[Gd.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",Gd[Gd.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",Gd[Gd.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",Gd[Gd.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",Gd[Gd.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",Gd[Gd.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",Gd[Gd.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",Gd[Gd.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",Gd[Gd.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",Gd[Gd.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",Gd[Gd.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",Gd[Gd.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",Gd[Gd.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",Gd[Gd.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",Gd[Gd.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",Gd[Gd.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",Gd[Gd.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",Gd[Gd.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",Gd[Gd.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",Gd[Gd.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",Gd[Gd.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",Gd[Gd.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",Gd[Gd.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",Gd[Gd.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",Gd[Gd.LINE_WEBGL=6913]="LINE_WEBGL",Gd[Gd.FILL_WEBGL=6914]="FILL_WEBGL",Gd[Gd.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",Gd[Gd.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",Gd[Gd.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",Gd[Gd.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",Gd[Gd.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",Gd[Gd.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",Gd[Gd.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",Gd[Gd.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",Gd[Gd.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",Gd[Gd.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",Gd[Gd.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",Gd[Gd.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",Gd[Gd.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",Gd[Gd.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",Gd[Gd.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",Gd[Gd.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",Gd[Gd.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",Gd[Gd.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",Gd[Gd.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",Gd[Gd.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",Gd[Gd.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",Gd[Gd.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",Gd[Gd.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",Gd[Gd.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT";const Vd={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},zd=e=>({drawBuffersWEBGL:t=>e.drawBuffers(t),COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),Wd=e=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES:()=>e.createVertexArray(),deleteVertexArrayOES:t=>e.deleteVertexArray(t),isVertexArrayOES:t=>e.isVertexArray(t),bindVertexArrayOES:t=>e.bindVertexArray(t)}),Hd=e=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE:(...t)=>e.drawArraysInstanced(...t),drawElementsInstancedANGLE:(...t)=>e.drawElementsInstanced(...t),vertexAttribDivisorANGLE:(...t)=>e.vertexAttribDivisor(...t)});async function $d(e,t){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const s=document.createElement("script");return s.setAttribute("type","text/javascript"),s.setAttribute("src",e),new Promise((t,r)=>{s.onload=t,s.onerror=t=>r(new Error(`Unable to load script '${e}': ${t}`)),n.appendChild(s)})}let Xd=null,qd=!1;const Yd={debugSpectorJS:Ts.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};function Kd(e){return e.luma=e.luma||{},e.luma}function Zd(e,t={}){return t.debugWebGL||t.traceWebGL?function(e,t){if(!globalThis.WebGLDebugUtils)return Ts.warn("webgl-debug not loaded")(),e;const n=Kd(e);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...jd,...e});const s=globalThis.WebGLDebugUtils.makeDebugContext(e,Jd.bind(null,t),ef.bind(null,t));for(const o in jd)o in s||"number"!=typeof jd[o]||(s[o]=jd[o]);class r{}Object.setPrototypeOf(s,Object.getPrototypeOf(e)),Object.setPrototypeOf(r,s);const i=Object.create(r);return n.realContext=e,n.debugContext=i,i.debug=!0,i}(e,t):function(e){const t=Kd(e);return t.realContext?t.realContext:e}(e)}function Qd(e,t){t=Array.from(t).map(e=>void 0===e?"undefined":e);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${e}(${n})`}function Jd(e,t,n,s){s=Array.from(s).map(e=>void 0===e?"undefined":e);const r=`${globalThis.WebGLDebugUtils.glEnumToString(t)} in gl.${n}(${globalThis.WebGLDebugUtils.glFunctionArgsToString(n,s)})`;Ts.error(r)()}function ef(e,t,n){let s="";Ts.level>=1&&(s=Qd(t,n),e.traceWebGL&&Ts.log(1,s)());for(const r of n)void 0===r&&(s=s||Qd(t,n))}const tf=new class extends lr{constructor(){super(),s(this,"type","webgl"),rr.defaultProps={...rr.defaultProps,...Yd}}enforceWebGL2(e){!function(e=!0){const t=HTMLCanvasElement.prototype;if(!e&&t.originalGetContext)return t.getContext=t.originalGetContext,void(t.originalGetContext=void 0);t.originalGetContext=t.getContext,t.getContext=function(e,t){if("webgl"===e||"experimental-webgl"===e){const e=this.originalGetContext("webgl2",t);return e instanceof HTMLElement&&function(e){e.getExtension("EXT_color_buffer_float");const t={...Vd,WEBGL_disjoint_timer_query:e.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:zd(e),OES_vertex_array_object:Wd(e),ANGLE_instanced_arrays:Hd(e)},n=e.getExtension;e.getExtension=function(s){return n.call(e,s)||(s in t?t[s]:null)};const s=e.getSupportedExtensions;e.getSupportedExtensions=function(){const n=s.apply(e)||[];return null==n?void 0:n.concat(Object.keys(t))}}(e),e}return this.originalGetContext(e,t)}}(e)}isSupported(){return"undefined"!=typeof WebGL2RenderingContext}isDeviceHandle(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||("undefined"!=typeof WebGLRenderingContext&&e instanceof WebGLRenderingContext&&Ts.warn("WebGL1 is not supported",e)(),!1)}async attach(e,t={}){const{WebGLDevice:n}=await l(async()=>{const{WebGLDevice:e}=await Promise.resolve().then(()=>Lp);return{WebGLDevice:e}},void 0);if(e instanceof n)return e;if((null==e?void 0:e.device)instanceof n)return e.device;if(!function(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&Number.isFinite(e._version))}(e))throw new Error("Invalid WebGL2RenderingContext");const s=!0===t.createCanvasContext?{}:t.createCanvasContext;return new n({...t,_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1,...s}})}async create(e={}){const{WebGLDevice:t}=await l(async()=>{const{WebGLDevice:e}=await Promise.resolve().then(()=>Lp);return{WebGLDevice:e}},void 0);Ts.groupCollapsed(1,"WebGLDevice created")();try{const n=[];(e.debugWebGL||e.debug)&&n.push(async function(){Le()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await $d("https://unpkg.com/webgl-debug@2.0.1/index.js"))}()),e.debugSpectorJS&&n.push(async function(e){if(!globalThis.SPECTOR)try{await $d(e.debugSpectorJSUrl||Yd.debugSpectorJSUrl)}catch(t){Ts.warn(String(t))}}(e));const s=await Promise.allSettled(n);for(const e of s)"rejected"===e.status&&Ts.error(`Failed to initialize debug libraries ${e.reason}`)();const r=new t(e),i=`${r._reused?"Reusing":"Created"} device with WebGL2 ${r.props.debug?"debug ":""}context: ${r.info.vendor}, ${r.info.renderer} for canvas: ${r.canvasContext.id}`;return Ts.probe(1,i)(),Ts.table(1,r.info)(),r}finally{Ts.groupEnd(1)()}}},nf={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},sf=(e,t,n)=>t?e.enable(n):e.disable(n),rf=(e,t,n)=>e.hint(n,t),of=(e,t,n)=>e.pixelStorei(n,t),af=(e,t,n)=>{const s=36006===n?36009:36008;return e.bindFramebuffer(s,t)},lf=(e,t,n)=>{const s={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];e.bindBuffer(s,t)};function cf(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}const uf={3042:sf,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:sf,2885:(e,t)=>e.cullFace(t),2929:sf,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:sf,35723:rf,35725:(e,t)=>e.useProgram(t),36007:(e,t)=>e.bindRenderbuffer(36161,t),36389:(e,t)=>{var n;return null==(n=e.bindTransformFeedback)?void 0:n.call(e,36386,t)},34229:(e,t)=>e.bindVertexArray(t),36006:af,36010:af,34964:lf,36662:lf,36663:lf,35053:lf,35055:lf,2886:(e,t)=>e.frontFace(t),33170:rf,2849:(e,t)=>e.lineWidth(t),32823:sf,32824:"polygonOffset",10752:"polygonOffset",35977:sf,32926:sf,32928:sf,32938:"sampleCoverage",32939:"sampleCoverage",3089:sf,3088:(e,t)=>e.scissor(...t),2960:sf,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),34383:sf,10754:sf,12288:sf,12289:sf,12290:sf,12291:sf,12292:sf,12293:sf,12294:sf,12295:sf,3333:of,3317:of,37440:of,37441:of,37443:of,3330:of,3332:of,3331:of,3314:of,32878:of,3316:of,3315:of,32877:of,framebuffer:(e,t)=>{const n=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,n)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{const n="number"==typeof t?[t,t]:t;e.blendEquationSeparate(...n)},blendFunc:(e,t)=>{const n=2===(null==t?void 0:t.length)?[...t,...t]:t;e.blendFuncSeparate(...n)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(t[0],t[1]||!1),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=cf(t)?t:[t,t];const[n,s]=t;e.stencilMaskSeparate(1028,n),e.stencilMaskSeparate(1029,s)},stencilFunc:(e,t)=>{t=cf(t)&&3===t.length?[...t,...t]:t;const[n,s,r,i,o,a]=t;e.stencilFuncSeparate(1028,n,s,r),e.stencilFuncSeparate(1029,i,o,a)},stencilOp:(e,t)=>{t=cf(t)&&3===t.length?[...t,...t]:t;const[n,s,r,i,o,a]=t;e.stencilOpSeparate(1028,n,s,r),e.stencilOpSeparate(1029,i,o,a)},viewport:(e,t)=>e.viewport(...t)};function hf(e,t,n){return void 0!==t[e]?t[e]:n[e]}const df={blendEquation:(e,t,n)=>e.blendEquationSeparate(hf(32777,t,n),hf(34877,t,n)),blendFunc:(e,t,n)=>e.blendFuncSeparate(hf(32969,t,n),hf(32968,t,n),hf(32971,t,n),hf(32970,t,n)),polygonOffset:(e,t,n)=>e.polygonOffset(hf(32824,t,n),hf(10752,t,n)),sampleCoverage:(e,t,n)=>e.sampleCoverage(hf(32938,t,n),hf(32939,t,n)),stencilFuncFront:(e,t,n)=>e.stencilFuncSeparate(1028,hf(2962,t,n),hf(2967,t,n),hf(2963,t,n)),stencilFuncBack:(e,t,n)=>e.stencilFuncSeparate(1029,hf(34816,t,n),hf(36003,t,n),hf(36004,t,n)),stencilOpFront:(e,t,n)=>e.stencilOpSeparate(1028,hf(2964,t,n),hf(2965,t,n),hf(2966,t,n)),stencilOpBack:(e,t,n)=>e.stencilOpSeparate(1029,hf(34817,t,n),hf(34818,t,n),hf(34819,t,n))},ff={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,n)=>e({[t]:n}),hint:(e,t,n)=>e({[t]:n}),useProgram:(e,t)=>e({35725:t}),bindRenderbuffer:(e,t,n)=>e({36007:n}),bindTransformFeedback:(e,t,n)=>e({36389:n}),bindVertexArray:(e,t)=>e({34229:t}),bindFramebuffer:(e,t,n)=>{switch(t){case 36160:return e({36006:n,36010:n});case 36009:return e({36006:n});case 36008:return e({36010:n});default:return null}},bindBuffer:(e,t,n)=>{const s={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return s?e({[s]:n}):{valueChanged:!0}},blendColor:(e,t,n,s,r)=>e({32773:new Float32Array([t,n,s,r])}),blendEquation:(e,t)=>e({32777:t,34877:t}),blendEquationSeparate:(e,t,n)=>e({32777:t,34877:n}),blendFunc:(e,t,n)=>e({32969:t,32968:n,32971:t,32970:n}),blendFuncSeparate:(e,t,n,s,r)=>e({32969:t,32968:n,32971:s,32970:r}),clearColor:(e,t,n,s,r)=>e({3106:new Float32Array([t,n,s,r])}),clearDepth:(e,t)=>e({2931:t}),clearStencil:(e,t)=>e({2961:t}),colorMask:(e,t,n,s,r)=>e({3107:[t,n,s,r]}),cullFace:(e,t)=>e({2885:t}),depthFunc:(e,t)=>e({2932:t}),depthRange:(e,t,n)=>e({2928:new Float32Array([t,n])}),depthMask:(e,t)=>e({2930:t}),frontFace:(e,t)=>e({2886:t}),lineWidth:(e,t)=>e({2849:t}),polygonOffset:(e,t,n)=>e({32824:t,10752:n}),sampleCoverage:(e,t,n)=>e({32938:t,32939:n}),scissor:(e,t,n,s,r)=>e({3088:new Int32Array([t,n,s,r])}),stencilMask:(e,t)=>e({2968:t,36005:t}),stencilMaskSeparate:(e,t,n)=>e({[1028===t?2968:36005]:n}),stencilFunc:(e,t,n,s)=>e({2962:t,2967:n,2963:s,34816:t,36003:n,36004:s}),stencilFuncSeparate:(e,t,n,s,r)=>e({[1028===t?2962:34816]:n,[1028===t?2967:36003]:s,[1028===t?2963:36004]:r}),stencilOp:(e,t,n,s)=>e({2964:t,2965:n,2966:s,34817:t,34818:n,34819:s}),stencilOpSeparate:(e,t,n,s,r)=>e({[1028===t?2964:34817]:n,[1028===t?2965:34818]:s,[1028===t?2966:34819]:r}),viewport:(e,t,n,s,r)=>e({2978:[t,n,s,r]})},pf=(e,t)=>e.isEnabled(t),gf={3042:pf,2884:pf,2929:pf,3024:pf,32823:pf,32926:pf,32928:pf,3089:pf,2960:pf,35977:pf},mf=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function _f(e,t){if(function(e){for(const t in e)return!1;return!0}(t))return;const n={};for(const r in t){const s=Number(r),i=uf[r];i&&("string"==typeof i?n[i]=!0:i(e,t[r],s))}const s=e.state&&e.state.cache;if(s)for(const r in n)(0,df[r])(e,t,s)}function yf(e,t=nf){if("number"==typeof t){const n=t,s=gf[n];return s?s(e,n):e.getParameter(n)}const n=Array.isArray(t)?t:Object.keys(t),s={};for(const r of n){const t=gf[r];s[r]=t?t(e,Number(r)):e.getParameter(Number(r))}return s}function bf(e,t){if(e===t)return!0;if(vf(e)&&vf(t)&&e.length===t.length){for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}return!1}function vf(e){return Array.isArray(e)||ArrayBuffer.isView(e)}class xf{constructor(e,t){s(this,"gl"),s(this,"program",null),s(this,"stateStack",[]),s(this,"enable",!0),s(this,"cache",null),s(this,"log"),s(this,"initialized",!1),this.gl=e,this.log=(null==t?void 0:t.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];_f(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=(null==t?void 0:t.copyState)?yf(e):Object.assign({},nf),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,function(e){const t=e.useProgram.bind(e);e.useProgram=function(n){const s=xf.get(e);s.program!==n&&(t(n),s.program=n)}}(e);for(const n in ff)Ef(e,n,ff[n]);wf(e,"getParameter"),wf(e,"isEnabled")}_updateCache(e){let t,n=!1;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const r in e){const i=e[r],o=this.cache[r];bf(i,o)||(n=!0,t=o,s&&!(r in s)&&(s[r]=o),this.cache[r]=i)}return{valueChanged:n,oldValue:t}}}function wf(e,t){const n=e[t].bind(e);e[t]=function(t){if(void 0===t||mf.has(t))return n(t);const s=xf.get(e);return t in s.cache||(s.cache[t]=n(t)),s.enable?s.cache[t]:n(t)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function Ef(e,t,n){if(!e[t])return;const s=e[t].bind(e);e[t]=function(...t){const r=xf.get(e),{valueChanged:i,oldValue:o}=n(r._updateCache,...t);return i&&s(...t),o},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}function Tf(e,t,n){return void 0===n[t]&&(n[t]=e.getExtension(t)||null),n[t]}function Sf(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}function Af(e){switch(e){case"uint8":case"unorm8":return 5121;case"sint8":case"snorm8":return 5120;case"uint16":case"unorm16":return 5123;case"sint16":case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(e))}const Rf="WEBGL_compressed_texture_s3tc",Cf="WEBGL_compressed_texture_s3tc_srgb",Pf="EXT_texture_compression_rgtc",kf="EXT_texture_compression_bptc",If="EXT_texture_norm16",Mf="EXT_render_snorm",Lf={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[Mf],"norm16-renderable-webgl":[If],"snorm16-renderable-webgl":[If,Mf],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Rf,Cf,Pf,kf],"texture-compression-bc5-webgl":[Pf],"texture-compression-bc7-webgl":[kf],"texture-compression-etc2":["WEBGL_compressed_texture_etc"],"texture-compression-astc":["WEBGL_compressed_texture_astc"],"texture-compression-etc1-webgl":["WEBGL_compressed_texture_etc1"],"texture-compression-pvrtc-webgl":["WEBGL_compressed_texture_pvrtc"],"texture-compression-atc-webgl":["WEBGL_compressed_texture_atc"]},Nf={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},r16unorm:{gl:33322,rb:!0},r16snorm:{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},rg16unorm:{gl:33324},rg16snorm:{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},rgb10a2uint:{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},rgba16unorm:{gl:32859,rb:!0},rgba16snorm:{gl:36763},"rgb32float-webgl":{gl:34837,x:"EXT_color_buffer_float",dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Rf},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Cf},"bc1-rgba-unorm":{gl:33777,x:Rf},"bc1-rgba-unorm-srgb":{gl:35916,x:Cf},"bc2-rgba-unorm":{gl:33778,x:Rf},"bc2-rgba-unorm-srgb":{gl:35918,x:Cf},"bc3-rgba-unorm":{gl:33779,x:Rf},"bc3-rgba-unorm-srgb":{gl:35919,x:Cf},"bc4-r-unorm":{gl:36283,x:Pf},"bc4-r-snorm":{gl:36284,x:Pf},"bc5-rg-unorm":{gl:36285,x:Pf},"bc5-rg-snorm":{gl:36286,x:Pf},"bc6h-rgb-ufloat":{gl:36495,x:kf},"bc6h-rgb-float":{gl:36494,x:kf},"bc7-rgba-unorm":{gl:36492,x:kf},"bc7-rgba-unorm-srgb":{gl:36493,x:kf},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function Of(e){var t;const n=Nf[e],s=function(e){const t=Nf[e],n=null==t?void 0:t.gl;if(void 0===n)throw new Error(`Unsupported texture format ${e}`);return n}(e),r=Js.getInfo(e);return r.compressed&&(n.dataFormat=s),{internalFormat:s,format:(null==n?void 0:n.dataFormat)||Ff(r.channels,r.integer,r.normalized,s),type:r.dataType?Af(r.dataType):(null==(t=null==n?void 0:n.types)?void 0:t[0])||5121,compressed:r.compressed||!1}}function Ff(e,t,n,s){if(6408===s||6407===s)return s;switch(e){case"r":return t&&!n?36244:6403;case"rg":return t&&!n?33320:33319;case"rgb":return t&&!n?36248:6407;case"rgba":return t&&!n?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}const Df={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class Bf extends nr{constructor(e,t,n){super([],n),s(this,"gl"),s(this,"extensions"),s(this,"testedFeatures",new Set),this.gl=e,this.extensions=t,Tf(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){const e=this.getFeatures();for(const t of e)this.has(t)&&(yield t);return[]}has(e){var t;return!(null==(t=this.disabledFeatures)?void 0:t[e])&&(this.testedFeatures.has(e)||(this.testedFeatures.add(e),function(e){return e in Lf}(e)&&function(e,t,n){return(Lf[t]||[]).every(t=>Tf(e,t,n))}(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(e=>"polygon-mode-webgl"!==e);for(const t of e)this.has(t)}getFeatures(){return[...Object.keys(Df),...Object.keys(Lf)]}getWebGLFeature(e){const t=Df[e];return"string"==typeof t?Boolean(Tf(this.gl,t,this.extensions)):Boolean(t)}}class Uf extends tr{constructor(e){super(),s(this,"gl"),s(this,"limits",{}),this.gl=e}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderVariables(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(e){return void 0===this.limits[e]&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class jf extends Pr{constructor(e,t){super(e,t),s(this,"device"),s(this,"gl"),s(this,"handle"),s(this,"colorAttachments",[]),s(this,"depthStencilAttachment",null);const n=null===t.handle;this.device=e,this.gl=e.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),n||(e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),this.destroyed||null===this.handle||this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let t=0;t<this.colorAttachments.length;++t){const e=this.colorAttachments[t];if(e){const n=36064+t;this._attachTextureView(n,e)}}if(this.depthStencilAttachment){const e=function(e){switch(Js.getInfo(e).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${e}`)}}(this.depthStencilAttachment.props.format);this._attachTextureView(e,this.depthStencilAttachment)}if(this.device.props.debug){const e=this.gl.checkFramebufferStatus(36160);if(36053!==e)throw new Error(`Framebuffer ${function(e){switch(e){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${e}`}}(e)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,t){const{gl:n}=this.device,{texture:s}=t,r=t.props.baseMipLevel,i=t.props.baseArrayLayer;switch(n.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:n.framebufferTextureLayer(36160,e,s.handle,r,i);break;case 34067:const t=function(e){return e<34069?e+34069:e}(i);n.framebufferTexture2D(36160,e,t,s.handle,r);break;case 3553:n.framebufferTexture2D(36160,e,3553,s.handle,r);break;default:throw new Error("Illegal texture type")}n.bindTexture(s.glTarget,null)}}class Gf extends fr{constructor(e,t){super(t),s(this,"device"),s(this,"handle",null),s(this,"_framebuffer",null),this.device=e,this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this._updateDevice()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this._framebuffer=this._framebuffer||new jf(this.device,{handle:null}),this._framebuffer}_updateDevice(){}}const Vf={};function zf(e="id"){return Vf[e]=Vf[e]||1,`${e}-${Vf[e]++}`}class Wf extends Ps{constructor(e,t={}){super(e,t),s(this,"device"),s(this,"gl"),s(this,"handle"),s(this,"glTarget"),s(this,"glUsage"),s(this,"glIndexType",5123),s(this,"byteLength",0),s(this,"bytesUsed",0),this.device=e,this.gl=this.device.gl;const n="object"==typeof t?t.handle:void 0;var r;this.handle=n||this.gl.createBuffer(),e._setWebGLDebugMetadata(this.handle,this,{spector:{...this.props,data:typeof this.props.data}}),this.glTarget=(r=this.props.usage)&Ps.INDEX?34963:r&Ps.VERTEX?34962:r&Ps.UNIFORM?35345:34962,this.glUsage=function(e){return e&Ps.INDEX||e&Ps.VERTEX?35044:e&Ps.UNIFORM?35048:35044}(this.props.usage),this.glIndexType="uint32"===this.props.indexType?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}_initWithData(e,t=0,n=e.byteLength+t){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,n,this.glUsage),this.gl.bufferSubData(s,t,e),this.gl.bindBuffer(s,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(e,t,n),this.trackAllocatedMemory(n)}_initWithByteLength(e){let t=e;0===e&&(t=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,t,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}write(e,t=0){const n=ArrayBuffer.isView(e)?e:new Uint8Array(e),s=36663;this.gl.bindBuffer(s,this.handle),this.gl.bufferSubData(s,t,n),this.gl.bindBuffer(s,null),this._setDebugData(e,t,e.byteLength)}async mapAndWriteAsync(e,t=0,n=this.byteLength-t){const s=new ArrayBuffer(n);await e(s,"copied"),this.write(s,t)}async readAsync(e=0,t){return this.readSyncWebGL(e,t)}async mapAndReadAsync(e,t=0,n){const s=await this.readAsync(t,n);return await e(s.buffer,"copied")}readSyncWebGL(e=0,t){t=t??this.byteLength-e;const n=new Uint8Array(t);return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,n,0,t),this.gl.bindBuffer(36662,null),this._setDebugData(n,e,t),n}}function Hf(e){const t=e.toLowerCase();return["warning","error","info"].includes(t)?t:"info"}class $f extends Ar{constructor(e,t){switch(super(e,t),s(this,"device"),s(this,"handle"),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0,this.handle.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>(this._getCompilationStatus(),this.compilationStatus))}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?function(e){const t=e.split(/\r?\n/),n=[];for(const s of t){if(s.length<=1)continue;const e=s.split(":");if(2===e.length){const[t,s]=e;n.push({message:s.trim(),type:Hf(t),lineNum:0,linePos:0});continue}const[t,r,i,...o]=e;let a=parseInt(i,10);isNaN(a)&&(a=0);let l=parseInt(r,10);isNaN(l)&&(l=0),n.push({message:o.join(":").trim(),type:Hf(t),lineNum:a,linePos:l})}return n}(e):[]}getTranslatedSource(){const e=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(null==e?void 0:e.getTranslatedShaderSource(this.handle))||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es\n${e}`;const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),this.device.props.debug){if(this.device.features.has("compilation-status-async-webgl"))Ts.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Ts.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader();else if(this._getCompilationStatus(),this.debugShader(),"error"===this.compilationStatus)throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`)}else this.compilationStatus="pending"}async _waitForCompilationComplete(){const e=async e=>await new Promise(t=>setTimeout(t,e));if(!this.device.features.has("compilation-status-async-webgl"))return void(await e(10));const{gl:t}=this.device;for(;;){if(t.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function Xf(e,t){return Zf(e,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function qf(e,t){return Zf(e,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function Yf(e,t){return Zf(e,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Kf(e,t,n="color"){return Zf(e,t,{one:1,zero:0,src:768,"one-minus-src":769,dst:774,"one-minus-dst":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,constant:"color"===n?32769:32771,"one-minus-constant":"color"===n?32770:32772,src1:768,"one-minus-src1":769,"src1-alpha":770,"one-minus-src1-alpha":771})}function Zf(e,t,n){if(!(t in n))throw new Error(function(e,t){return`Illegal parameter ${t} for ${e}`}(e,t));return n[t]}function Qf(e){const t={};return e.addressModeU&&(t[10242]=Jf(e.addressModeU)),e.addressModeV&&(t[10243]=Jf(e.addressModeV)),e.addressModeW&&(t[32882]=Jf(e.addressModeW)),e.magFilter&&(t[10240]=ep(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[10241]=function(e,t="none"){if(!t)return ep(e);switch(t){case"none":return ep(e);case"nearest":switch(e){case"nearest":return 9984;case"linear":return 9985}break;case"linear":switch(e){case"nearest":return 9986;case"linear":return 9987}}}(e.minFilter||"linear",e.mipmapFilter)),void 0!==e.lodMinClamp&&(t[33082]=e.lodMinClamp),void 0!==e.lodMaxClamp&&(t[33083]=e.lodMaxClamp),"comparison-sampler"===e.type&&(t[34892]=34894),e.compare&&(t[34893]=Xf("compare",e.compare)),e.maxAnisotropy&&(t[34046]=e.maxAnisotropy),t}function Jf(e){switch(e){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function ep(e){switch(e){case"nearest":return 9728;case"linear":return 9729}}class tp extends _r{constructor(e,t){super(e,t),s(this,"device"),s(this,"handle"),s(this,"parameters"),this.device=e,this.parameters=Qf(t),this.handle=t.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[t,n]of Object.entries(e)){const e=Number(t);switch(e){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,e,n);break;default:this.device.gl.samplerParameteri(this.handle,e,n)}}}}function np(e,t,n){if(function(e){for(const t in e)return!1;return!0}(t))return n(e);const{nocatch:s=!0}=t,r=xf.get(e);let i;if(r.push(),_f(e,t),s)i=n(e),r.pop();else try{i=n(e)}finally{r.pop()}return i}class sp extends wr{constructor(e,t){super(e,{...vr.defaultProps,...t}),s(this,"device"),s(this,"gl"),s(this,"handle"),s(this,"texture"),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}class rp extends vr{constructor(e,t){super(e,t),s(this,"device"),s(this,"gl"),s(this,"handle"),s(this,"sampler"),s(this,"view"),s(this,"glTarget"),s(this,"glFormat"),s(this,"glType"),s(this,"glInternalFormat"),s(this,"compressed"),s(this,"_textureUnit",0),this.device=e,this.gl=this.device.gl;const n=Of(this.props.format);this.glTarget=function(e){switch(e){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(e)}(this.props.dimension),this.glInternalFormat=n.internalFormat,this.glFormat=n.format,this.glType=n.type,this.compressed=n.compressed,this.handle=this.props.handle||this.gl.createTexture(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.gl.bindTexture(this.glTarget,this.handle);const{dimension:r,width:i,height:o,depth:a,mipLevels:l,glTarget:c,glInternalFormat:u}=this;switch(r){case"2d":case"cube":this.gl.texStorage2D(c,l,u,i,o);break;case"2d-array":case"3d":this.gl.texStorage3D(c,l,u,i,o,a);break;default:throw new Error(r)}this.gl.bindTexture(this.glTarget,null),this._initializeData(t.data),this.setSampler(this.props.sampler),this.view=new sp(this.device,{...this.props,texture:this}),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new sp(this.device,{...e,texture:this})}setSampler(e={}){super.setSampler(e);const t=Qf(this.sampler.props);this._setSamplerParameters(t)}copyImageData(e){const t=this._normalizeCopyImageDataOptions(e),n=t.data,{width:s,height:r,depth:i}=this,{mipLevel:o=0,byteOffset:a=0,x:l=0,y:c=0,z:u=0}=t,{glFormat:h,glType:d,compressed:f}=this,p=ip(this.glTarget,this.dimension,u);let g;if(!this.compressed){const{bytesPerPixel:e}=this.device.getTextureFormatInfo(this.format);if(e){if(t.bytesPerRow%e!==0)throw new Error(`bytesPerRow (${t.bytesPerRow}) must be a multiple of bytesPerPixel (${e}) for ${this.format}`);g=t.bytesPerRow/e}}const m=this.compressed?{}:{...void 0!==g?{3314:g}:{},32878:t.rowsPerImage};this.gl.bindTexture(p,this.handle),np(this.gl,m,()=>{switch(this.dimension){case"2d":case"cube":f?this.gl.compressedTexSubImage2D(p,o,l,c,s,r,h,n,a):this.gl.texSubImage2D(p,o,l,c,s,r,h,d,n,a);break;case"2d-array":case"3d":f?this.gl.compressedTexSubImage3D(p,o,l,c,u,s,r,i,h,n,a):this.gl.texSubImage3D(p,o,l,c,u,s,r,i,h,d,n,a)}}),this.gl.bindTexture(p,null)}copyExternalImage(e){const t=this._normalizeCopyExternalImageOptions(e);if(t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");const{glFormat:n,glType:s}=this,{image:r,depth:i,mipLevel:o,x:a,y:l,z:c,width:u,height:h}=t,d=ip(this.glTarget,this.dimension,i),f=t.flipY?{37440:!0}:{};return this.gl.bindTexture(this.glTarget,this.handle),np(this.gl,f,()=>{switch(this.dimension){case"2d":case"cube":this.gl.texSubImage2D(d,o,a,l,u,h,n,s,r);break;case"2d-array":case"3d":this.gl.texSubImage3D(d,o,a,l,c,u,h,i,n,s,r)}}),this.gl.bindTexture(this.glTarget,null),{width:t.width,height:t.height}}generateMipmapsWebGL(e){if(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format)||(Ts.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),null==e?void 0:e.force))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(t){Ts.warn(`Error generating mipmap for ${this}: ${t.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}_setSamplerParameters(e){Ts.log(2,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[t,n]of Object.entries(e)){const e=Number(t),s=n;switch(e){case 33082:case 33083:this.gl.texParameterf(this.glTarget,e,s);break;case 10240:case 10241:case 10242:case 10243:case 32882:case 34892:case 34893:this.gl.texParameteri(this.glTarget,e,s);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,e,s)}}this.gl.bindTexture(this.glTarget,null)}_getActiveUnit(){return this.gl.getParameter(34016)-33984}_bind(e){const{gl:t}=this;return void 0!==e&&(this._textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,this.handle),e}_unbind(e){const{gl:t}=this;return void 0!==e&&(this._textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,null),e}}function ip(e,t,n){return"cube"===t?34069+n:e}function op(e){return cp[e]}function ap(e){return Boolean(up[e])}function lp(e){return up[e]}const cp={5126:"f32",35664:"vec2<f32>",35665:"vec3<f32>",35666:"vec4<f32>",5124:"i32",35667:"vec2<i32>",35668:"vec3<i32>",35669:"vec4<i32>",5125:"u32",36294:"vec2<u32>",36295:"vec3<u32>",36296:"vec4<u32>",35670:"f32",35671:"vec2<f32>",35672:"vec3<f32>",35673:"vec4<f32>",35674:"mat2x2<f32>",35685:"mat2x3<f32>",35686:"mat2x4<f32>",35687:"mat3x2<f32>",35675:"mat3x3<f32>",35688:"mat3x4<f32>",35689:"mat4x2<f32>",35690:"mat4x3<f32>",35676:"mat4x4<f32>"},up={35678:{viewDimension:"2d",sampleType:"float"},35680:{viewDimension:"cube",sampleType:"float"},35679:{viewDimension:"3d",sampleType:"float"},35682:{viewDimension:"3d",sampleType:"depth"},36289:{viewDimension:"2d-array",sampleType:"float"},36292:{viewDimension:"2d-array",sampleType:"depth"},36293:{viewDimension:"cube",sampleType:"float"},36298:{viewDimension:"2d",sampleType:"sint"},36299:{viewDimension:"3d",sampleType:"sint"},36300:{viewDimension:"cube",sampleType:"sint"},36303:{viewDimension:"2d-array",sampleType:"uint"},36306:{viewDimension:"2d",sampleType:"uint"},36307:{viewDimension:"3d",sampleType:"uint"},36308:{viewDimension:"cube",sampleType:"uint"},36311:{viewDimension:"2d-array",sampleType:"uint"}},hp={uint8:5121,sint8:5120,unorm8:5121,snorm8:5120,uint16:5123,sint16:5122,unorm16:5123,snorm16:5122,uint32:5125,sint32:5124,float16:5131,float32:5126};function dp(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:t[1],length:t[2]?1:0,isArray:Boolean(t[2])}}function fp(e,t,n,s){const r=e;let i=s;!0===i&&(i=1),!1===i&&(i=0);const o="number"==typeof i?[i]:i;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if("number"!=typeof s)throw new Error("samplers must be set to integers");return e.uniform1i(t,s);case 5126:return e.uniform1fv(t,o);case 35664:return e.uniform2fv(t,o);case 35665:return e.uniform3fv(t,o);case 35666:return e.uniform4fv(t,o);case 5124:case 35670:return e.uniform1iv(t,o);case 35667:case 35671:return e.uniform2iv(t,o);case 35668:case 35672:return e.uniform3iv(t,o);case 35669:case 35673:return e.uniform4iv(t,o);case 5125:return r.uniform1uiv(t,o,1);case 36294:return r.uniform2uiv(t,o,2);case 36295:return r.uniform3uiv(t,o,3);case 36296:return r.uniform4uiv(t,o,4);case 35674:return e.uniformMatrix2fv(t,!1,o);case 35675:return e.uniformMatrix3fv(t,!1,o);case 35676:return e.uniformMatrix4fv(t,!1,o);case 35685:return r.uniformMatrix2x3fv(t,!1,o);case 35686:return r.uniformMatrix2x4fv(t,!1,o);case 35687:return r.uniformMatrix3x2fv(t,!1,o);case 35688:return r.uniformMatrix3x4fv(t,!1,o);case 35689:return r.uniformMatrix4x2fv(t,!1,o);case 35690:return r.uniformMatrix4x3fv(t,!1,o)}throw new Error("Illegal uniform")}class pp extends Ir{constructor(e,t){super(e,t),s(this,"device"),s(this,"handle"),s(this,"vs"),s(this,"fs"),s(this,"introspectedLayout"),s(this,"uniforms",{}),s(this,"bindings",{}),s(this,"varyings",null),s(this,"_uniformCount",0),s(this,"_uniformSetters",{}),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:{id:this.props.id}}),this.vs=t.vs,this.fs=t.fs;const{varyings:n,bufferMode:r=35981}=t;n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,r)),this._linkShaders(),Ts.time(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=function(e,t){const n={attributes:[],bindings:[]};n.attributes=function(e,t){const n=[],s=e.getProgramParameter(t,35721);for(let r=0;r<s;r++){const s=e.getActiveAttrib(t,r);if(!s)throw new Error("activeInfo");const{name:i,type:o}=s,a=e.getAttribLocation(t,i);if(a>=0){const e=op(o),t=/instance/i.test(i)?"instance":"vertex";n.push({name:i,location:a,stepMode:t,type:e})}}return n.sort((e,t)=>e.location-t.location),n}(e,t);const s=function(e,t){const n=(n,s)=>e.getActiveUniformBlockParameter(t,n,s),s=[],r=e.getProgramParameter(t,35382);for(let i=0;i<r;i++){const r={name:e.getActiveUniformBlockName(t,i)||"",location:n(i,35391),byteLength:n(i,35392),vertex:n(i,35396),fragment:n(i,35398),uniformCount:n(i,35394),uniforms:[]},o=n(i,35395)||[],a=e.getActiveUniforms(t,o,35383),l=e.getActiveUniforms(t,o,35384),c=e.getActiveUniforms(t,o,35387),u=e.getActiveUniforms(t,o,35388);for(let n=0;n<r.uniformCount;++n){const s=e.getActiveUniform(t,o[n]);if(!s)throw new Error("activeInfo");const i=op(a[n]);r.uniforms.push({name:s.name,format:i,type:a[n],arrayLength:l[n],byteOffset:c[n],byteStride:u[n]})}s.push(r)}return s.sort((e,t)=>e.location-t.location),s}(e,t);for(const a of s){const e=a.uniforms.map(e=>({name:e.name,format:e.format,byteOffset:e.byteOffset,byteStride:e.byteStride,arrayLength:e.arrayLength}));n.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:e})}const r=function(e,t){const n=[],s=e.getProgramParameter(t,35718);for(let r=0;r<s;r++){const s=e.getActiveUniform(t,r);if(!s)throw new Error("activeInfo");const{name:i,size:o,type:a}=s,{name:l,isArray:c}=dp(i);let u=e.getUniformLocation(t,l);const h={location:u,name:l,size:o,type:a,isArray:c};if(n.push(h),h.size>1)for(let r=0;r<h.size;r++){const s=`${l}[${r}]`;u=e.getUniformLocation(t,s);const i={...h,name:s,location:u};n.push(i)}}return n}(e,t);let i=0;for(const a of r)if(ap(a.type)){const{viewDimension:e,sampleType:t}=lp(a.type);n.bindings.push({type:"texture",name:a.name,group:0,location:i,viewDimension:e,sampleType:t}),a.textureUnit=i,i+=1}r.length&&(n.uniforms=r);const o=function(e,t){const n=[],s=e.getProgramParameter(t,35971);for(let r=0;r<s;r++){const s=e.getTransformFeedbackVarying(t,r);if(!s)throw new Error("activeInfo");const{name:i,type:o,size:a}=s,l=op(o),{type:c,components:u}=jr(l);n.push({location:r,name:i,type:c,size:a*u})}return n.sort((e,t)=>e.location-t.location),n}(e,t);return(null==o?void 0:o.length)&&(n.varyings=o),n}(this.device.gl,this.handle),Ts.timeEnd(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=t.shaderLayout?function(e,t){const n={...e,attributes:e.attributes.map(e=>({...e}))};for(const s of(null==t?void 0:t.attributes)||[]){const e=n.attributes.find(e=>e.name===s.name);e?(e.type=s.type||e.type,e.stepMode=s.stepMode||e.stepMode):Ts.warn(`shader layout attribute ${s.name} not present in shader`)}return n}(this.introspectedLayout,t.shaderLayout):this.introspectedLayout}get[Symbol.toStringTag](){return"WEBGLRenderPipeline"}destroy(){this.handle&&(this.device.gl.useProgram(null),this.device.gl.deleteProgram(this.handle),this.destroyed=!0,this.handle.destroyed=!0,this.handle=null)}setBindings(e,t){for(const[n,s]of Object.entries(e)){const e=this.shaderLayout.bindings.find(e=>e.name===n)||this.shaderLayout.bindings.find(e=>e.name===`${n}Uniforms`);if(!e){const e=this.shaderLayout.bindings.map(e=>`"${e.name}"`).join(", ");(null==t?void 0:t.disableWarnings)||Ts.warn(`No binding "${n}" in render pipeline "${this.id}", expected one of ${e}`,s)();continue}switch(s||Ts.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),e.type){case"uniform":if(!(s instanceof Wf||s.buffer instanceof Wf))throw new Error("buffer value");break;case"texture":if(!(s instanceof sp||s instanceof rp||s instanceof jf))throw new Error(`${this} Bad texture binding for ${n}`);break;case"sampler":Ts.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(e.type)}this.bindings[n]=s}}draw(e){var t;const{renderPass:n,parameters:s=this.props.parameters,topology:r=this.props.topology,vertexArray:i,vertexCount:o,instanceCount:a,isInstanced:l=!1,firstVertex:c=0,transformFeedback:u}=e,h=function(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(e)}}(r),d=Boolean(i.indexBuffer),f=null==(t=i.indexBuffer)?void 0:t.glIndexType;if("success"!==this.linkStatus)return Ts.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return Ts.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),i.bindBeforeRender(n),u&&u.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const p=n;return function(e,t,n,s){if(function(e){let t=!0;for(const n in e){t=!1;break}return t}(t))return s(e);const r=e;r.pushState();try{return function(e,t){const n=e,{gl:s}=n;if(t.cullMode)switch(t.cullMode){case"none":s.disable(2884);break;case"front":s.enable(2884),s.cullFace(1028);break;case"back":s.enable(2884),s.cullFace(1029)}if(t.frontFace&&s.frontFace(Zf("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&e.features.has("depth-clip-control")&&s.enable(34383),void 0!==t.depthBias&&(s.enable(32823),s.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&e.features.has("provoking-vertex-webgl")){const e=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,s=Zf("provokingVertex",t.provokingVertex,{first:36429,last:36430});null==e||e.provokingVertexWEBGL(s)}if((t.polygonMode||t.polygonOffsetLine)&&e.features.has("polygon-mode-webgl")){if(t.polygonMode){const e=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,s=Zf("polygonMode",t.polygonMode,{fill:6914,line:6913});null==e||e.polygonModeWEBGL(1028,s),null==e||e.polygonModeWEBGL(1029,s)}t.polygonOffsetLine&&s.enable(10754)}if(e.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&s.enable(12288),t.clipDistance1&&s.enable(12289),t.clipDistance2&&s.enable(12290),t.clipDistance3&&s.enable(12291),t.clipDistance4&&s.enable(12292),t.clipDistance5&&s.enable(12293),t.clipDistance6&&s.enable(12294),t.clipDistance7&&s.enable(12295)),void 0!==t.depthWriteEnabled&&s.depthMask(t.depthWriteEnabled),t.depthCompare&&("always"!==t.depthCompare?s.enable(2929):s.disable(2929),s.depthFunc(Xf("depthCompare",t.depthCompare))),t.stencilWriteMask){const e=t.stencilWriteMask;s.stencilMaskSeparate(1028,e),s.stencilMaskSeparate(1029,e)}if(t.stencilReadMask&&Ts.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){const e=t.stencilReadMask||4294967295,n=Xf("depthCompare",t.stencilCompare);"always"!==t.stencilCompare?s.enable(2960):s.disable(2960),s.stencilFuncSeparate(1028,n,0,e),s.stencilFuncSeparate(1029,n,0,e)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){const e=qf("stencilPassOperation",t.stencilPassOperation),n=qf("stencilFailOperation",t.stencilFailOperation),r=qf("stencilDepthFailOperation",t.stencilDepthFailOperation);s.stencilOpSeparate(1028,n,r,e),s.stencilOpSeparate(1029,n,r,e)}switch(t.blend){case!0:s.enable(3042);break;case!1:s.disable(3042)}if(t.blendColorOperation||t.blendAlphaOperation){const e=Yf("blendColorOperation",t.blendColorOperation||"add"),n=Yf("blendAlphaOperation",t.blendAlphaOperation||"add");s.blendEquationSeparate(e,n);const r=Kf("blendColorSrcFactor",t.blendColorSrcFactor||"one"),i=Kf("blendColorDstFactor",t.blendColorDstFactor||"zero"),o=Kf("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),a=Kf("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");s.blendFuncSeparate(r,i,o,a)}}(e,t),_f(r.gl,n),s(e)}finally{r.popState()}}(this.device,s,p.glParameters,()=>{d&&l?this.device.gl.drawElementsInstanced(h,o||0,f,c,a||0):d?this.device.gl.drawElements(h,o||0,f,c):l?this.device.gl.drawArraysInstanced(h,c,o||0,a||0):this.device.gl.drawArrays(h,c,o||0),u&&u.end()}),i.unbindAfterRender(n),!0}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Ts.time(4,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),Ts.timeEnd(4,`linkProgram for ${this.id}`)(),Ts.level,!this.device.features.has("compilation-status-async-webgl")){const e=this._getLinkStatus();return void this._reportLinkStatus(e)}Ts.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Ts.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const t=this._getLinkStatus();this._reportLinkStatus(t)}async _reportLinkStatus(e){var t;if("success"!==e){const n="link-error"===e?"Link error":"Validation error";switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`${this} ${n} during compilation of ${this.vs}`);case"pending":await this.vs.asyncCompilationStatus,this.vs.debugShader()}switch(null==(t=this.fs)?void 0:t.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`${this} ${n} during compilation of ${this.fs}`);case"pending":await this.fs.asyncCompilationStatus,this.fs.debugShader()}const s=this.device.gl.getProgramInfoLog(this.handle);this.device.reportError(new Error(`${n} during ${e}: ${s}`),this)(),this.device.debug()}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation-error")):(this.linkStatus="error","link-error")}async _waitForLinkComplete(){const e=async e=>await new Promise(t=>setTimeout(t,e));if(!this.device.features.has("compilation-status-async-webgl"))return void(await e(10));const{gl:t}=this.device;for(;;){if(t.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const t of this.shaderLayout.bindings)this.bindings[t.name]||this.bindings[t.name.replace(/Uniforms$/,"")]||(Ts.warn(`Binding ${t.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if("success"!==this.linkStatus)return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,n=0;for(const s of this.shaderLayout.bindings){const r=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!r)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:i}=s,o=e.getUniformBlockIndex(this.handle,i);if(4294967295===o)throw new Error(`Invalid uniform block name ${i}`);e.uniformBlockBinding(this.handle,n,o),r instanceof Wf?e.bindBufferBase(35345,n,r.handle):e.bindBufferRange(35345,n,r.buffer.handle,r.offset||0,r.size||r.buffer.byteLength-r.offset),n+=1;break;case"texture":if(!(r instanceof sp||r instanceof rp||r instanceof jf))throw new Error("texture");let a;if(r instanceof sp)a=r.texture;else if(r instanceof rp)a=r;else{if(!(r instanceof jf&&r.colorAttachments[0]instanceof sp))throw new Error("No texture");Ts.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),a=r.colorAttachments[0].texture}e.activeTexture(33984+t),e.bindTexture(a.glTarget,a.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:t,location:n,type:s,textureUnit:r}=e,i=this.uniforms[t]??r;void 0!==i&&fp(this.device.gl,n,s,i)}}}class gp extends Ur{constructor(e){super(e,{}),s(this,"device"),s(this,"handle",null),s(this,"commands",[]),this.device=e}_executeCommands(e=this.commands){for(const t of e)switch(t.name){case"copy-buffer-to-buffer":mp(this.device,t.options);break;case"copy-buffer-to-texture":_p(this.device,t.options);break;case"copy-texture-to-buffer":yp(this.device,t.options);break;case"copy-texture-to-texture":bp(this.device,t.options);break;default:throw new Error(t.name)}}}function mp(e,t){const n=t.sourceBuffer,s=t.destinationBuffer;e.gl.bindBuffer(36662,n.handle),e.gl.bindBuffer(36663,s.handle),e.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),e.gl.bindBuffer(36662,null),e.gl.bindBuffer(36663,null)}function _p(e,t){throw new Error("Not implemented")}function yp(e,t){const{sourceTexture:n,mipLevel:s=0,aspect:r="all",width:i=t.sourceTexture.width,height:o=t.sourceTexture.height,depthOrArrayLayers:a=0,origin:l=[0,0],destinationBuffer:c,byteOffset:u=0,bytesPerRow:h,rowsPerImage:d}=t;if("all"!==r)throw new Error("aspect not supported in WebGL");if(0!==s||0!==a||h||d)throw new Error("not implemented");const{framebuffer:f,destroyFramebuffer:p}=vp(n);let g;try{const t=c,n=i||f.width,s=o||f.height,r=Of(f.colorAttachments[0].texture.props.format),a=r.format,h=r.type;e.gl.bindBuffer(35051,t.handle),g=e.gl.bindFramebuffer(36160,f.handle),e.gl.readPixels(l[0],l[1],n,s,a,h,u)}finally{e.gl.bindBuffer(35051,null),void 0!==g&&e.gl.bindFramebuffer(36160,g),p&&f.destroy()}}function bp(e,t){const{sourceTexture:n,destinationMipLevel:s=0,origin:r=[0,0],destinationOrigin:i=[0,0],destinationTexture:o}=t;let{width:a=t.destinationTexture.width,height:l=t.destinationTexture.height}=t;const{framebuffer:c,destroyFramebuffer:u}=vp(n),[h,d]=r,[f,p,g]=i,m=e.gl.bindFramebuffer(36160,c.handle);let _,y;if(!(o instanceof rp))throw new Error("invalid destination");switch(_=o,a=Number.isFinite(a)?a:_.width,l=Number.isFinite(l)?l:_.height,_._bind(0),y=_.glTarget,y){case 3553:case 34067:e.gl.copyTexSubImage2D(y,s,f,p,h,d,a,l);break;case 35866:case 32879:e.gl.copyTexSubImage3D(y,s,f,p,g,h,d,a,l)}_&&_._unbind(),e.gl.bindFramebuffer(36160,m),u&&c.destroy()}function vp(e){if(e instanceof vr){const{width:t,height:n,id:s}=e;return{framebuffer:e.device.createFramebuffer({id:`framebuffer-for-${s}`,width:t,height:n,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}const xp=[1,2,4,8];class wp extends Lr{constructor(e,t){var n;let r;if(super(e,t),s(this,"device"),s(this,"handle",null),s(this,"glParameters",{}),this.device=e,!(null==(n=null==t?void 0:t.parameters)?void 0:n.viewport))if(null==t?void 0:t.framebuffer){const{width:e,height:n}=t.framebuffer;r=[0,0,e,n]}else{const[t,n]=e.getDefaultCanvasContext().getDrawingBufferSize();r=[0,0,t,n]}this.device.pushState(),this.setParameters({viewport:r,...this.props.parameters});const i=this.props.framebuffer;if(this.props.framebuffer&&(null==i?void 0:i.handle)){const e=this.props.framebuffer.colorAttachments.map((e,t)=>36064+t);this.device.gl.drawBuffers(e)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const t={...this.glParameters};t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(t[2967]=e.stencilReference),"colorMask"in e&&(t.colorMask=xp.map(t=>Boolean(t&e.colorMask))),this.glParameters=t,_f(this.device.gl,t)}beginOcclusionQuery(e){const t=this.props.occlusionQuerySet;null==t||t.beginOcclusionQuery()}endOcclusionQuery(){const e=this.props.occlusionQuerySet;null==e||e.endOcclusionQuery()}clear(){const e={...this.glParameters};let t=0;this.props.clearColors&&this.props.clearColors.forEach((e,t)=>{e&&this.clearColorBuffer(t,e)}),!1!==this.props.clearColor&&void 0===this.props.clearColors&&(t|=16384,e.clearColor=this.props.clearColor),!1!==this.props.clearDepth&&(t|=256,e.clearDepth=this.props.clearDepth),!1!==this.props.clearStencil&&(t|=1024,e.clearStencil=this.props.clearStencil),0!==t&&np(this.device.gl,e,()=>{this.device.gl.clear(t)})}clearColorBuffer(e=0,t=[0,0,0,0]){np(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,t);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,t);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}class Ep extends Dr{constructor(e,t){super(e,t),s(this,"device"),s(this,"handle",null),s(this,"commandBuffer"),this.device=e,this.commandBuffer=new gp(e)}destroy(){}finish(){return this.commandBuffer}beginRenderPass(e){return new wp(this.device,e)}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,n){}}class Tp extends Xr{constructor(e,t){super(e,t),s(this,"device"),s(this,"handle"),s(this,"buffer",null),s(this,"bufferValue",null),this.device=e,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(e){return"Chrome"==(Le()?Me()?"Electron":(Ie.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node")}destroy(){var e;super.destroy(),this.buffer&&(null==(e=this.buffer)||e.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&34963!==t.glTarget)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){const n=t;if(34963===n.glTarget)throw new Error("Use .setIndexBuffer()");const{size:s,type:r,stride:i,offset:o,normalized:a,integer:l,divisor:c}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),l?this.device.gl.vertexAttribIPointer(e,s,r,i,o):this.device.gl.vertexAttribPointer(e,s,r,a,i,o),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,c||0),this.attributes[e]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error(`Unknown attribute location ${e}`);const n=Af(t.bufferDataType);return{size:t.bufferComponents,type:n,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:"instance"===t.stepMode?1:0}}_enable(e,t=!0){const n=Tp.isConstantAttributeZeroSupported(this.device);(t||n||0!==e)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const n=(i=t,Array.isArray(i)?new Float32Array(i):i),s=n.byteLength*e,r=n.length*e;var i;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let o=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),o||(o=!function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(n,this.bufferValue)),o){const e=function(e,t){return new e(Jr(e.BYTES_PER_ELEMENT*t),0,t)}(t.constructor,r);!function(e){const{target:t,source:n,start:s=0,count:r=1}=e,i=n.length,o=r*i;let a=0;for(let l=s;a<i;a++)t[l++]=n[a];for(;a<o;)a<o-a?(t.copyWithin(s+a,s,s+a),a*=2):(t.copyWithin(s+a,s,s+o-a),a=o)}({target:e,source:n,start:0,count:r}),this.buffer.write(e),this.bufferValue=t}return this.buffer}}class Sp extends Yr{constructor(e,t){super(e,t),s(this,"device"),s(this,"gl"),s(this,"handle"),s(this,"layout"),s(this,"buffers",{}),s(this,"unusedBuffers",{}),s(this,"bindOnUse",!0),s(this,"_bound",!1),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(function(e){switch(e){case"point-list":return 0;case"line-list":case"line-strip":return 1;case"triangle-list":case"triangle-strip":return 4;default:throw new Error(e)}}(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])})}setBuffer(e,t){const n=this._getVaryingIndex(e),{buffer:s,byteLength:r,byteOffset:i}=this._getBufferRange(t);if(n<0)return this.unusedBuffers[e]=s,void Ts.warn(`${this.id} unusedBuffers varying buffer ${e}`)();this.buffers[n]={buffer:s,byteLength:r,byteOffset:i},this.bindOnUse||this._bindBuffer(n,s,i,r)}getBuffer(e){if(Ap(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e=this.handle){if("function"!=typeof e)return this.gl.bindTransformFeedback(36386,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof Wf)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:n=0,byteLength:s=e.buffer.byteLength}=e;return{buffer:t,byteOffset:n,byteLength:s}}_getVaryingIndex(e){if(Ap(e))return Number(e);for(const t of this.layout.varyings||[])if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:n,byteOffset:s}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,s,n)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t,n=0,s){const r=t&&t.handle;r&&void 0!==s?this.gl.bindBufferRange(35982,e,r,n,s):this.gl.bindBufferBase(35982,e,r)}}function Ap(e){return"number"==typeof e?Number.isInteger(e):/^\d+$/.test(e)}class Rp extends Qr{constructor(e,t){if(super(e,t),s(this,"device"),s(this,"handle"),s(this,"target",null),s(this,"_queryPending",!1),s(this,"_pollingPromise",null),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");const n=this.device.gl.createQuery();if(!n)throw new Error("WebGL query not supported");this.handle=n,Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin((null==e?void 0:e.conservative)?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((n,s)=>{const r=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):t++>e?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(r)};requestAnimationFrame(r)}),this._pollingPromise}}function Cp(e){switch(e){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}const Pp={5124:"sint32",5125:"uint32",5122:"sint16",5123:"uint16",5120:"sint8",5121:"uint8",5126:"float32",5131:"float16",33635:"uint16",32819:"uint16",32820:"uint16",33640:"uint32",35899:"uint32",35902:"uint32",34042:"uint32",36269:"uint32"};function kp(e){return e instanceof Pr?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:Ip(e),deleteFramebuffer:!0}}function Ip(e,t){const{device:n,width:s,height:r,id:i}=e;return n.createFramebuffer({...t,id:`framebuffer-for-${i}`,width:s,height:r,colorAttachments:[e]})}class Mp extends rr{constructor(e){var t,n;super({...e,id:e.id||zf("webgl-device")}),s(this,"type","webgl"),s(this,"handle"),s(this,"features"),s(this,"limits"),s(this,"info"),s(this,"canvasContext"),s(this,"preferredColorFormat","rgba8unorm"),s(this,"preferredDepthFormat","depth24plus"),s(this,"commandEncoder"),s(this,"lost"),s(this,"_resolveContextLost"),s(this,"gl"),s(this,"_constants"),s(this,"_extensions",{}),s(this,"_polyfilled",!1),s(this,"spectorJS");const r=rr._getCanvasContextProps(e);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=null==(n=null==(t=r.canvas)?void 0:t.gl)?void 0:n.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new Gf(this,r),this.lost=new Promise(e=>{this._resolveContextLost=e});const o={...e.webgl};"premultiplied"===r.alphaMode&&(o.premultipliedAlpha=!0),void 0!==e.powerPreference&&(o.powerPreference=e.powerPreference);const a=this.props._handle||function(e,t,n){let s="";const r={preserveDrawingBuffer:!0,...n};let i=null;if(i||(i=e.getContext("webgl2",r)),r.failIfMajorPerformanceCaveat&&(s||(s="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),i||n.failIfMajorPerformanceCaveat||(r.failIfMajorPerformanceCaveat=!1,i=e.getContext("webgl2",r),i.luma||(i.luma={}),i.luma.softwareRenderer=!0),i||(i=e.getContext("webgl",{}),i&&(i=null,s||(s="Your browser only supports WebGL1"))),!i)throw s||(s="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${s}`);const{onContextLost:o,onContextRestored:a}=t;return e.addEventListener("webglcontextlost",e=>o(e),!1),e.addEventListener("webglcontextrestored",e=>a(e),!1),i.luma||(i.luma={}),i}(this.canvasContext.canvas,{onContextLost:e=>{var t;return null==(t=this._resolveContextLost)?void 0:t.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:e=>{}},o);if(!a)throw new Error("WebGL context creation failed");if(i=a.device,i){if(e._reuseDevices)return Ts.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=a,this.gl=a,this.spectorJS=function(e){var t;if(!(e={...Yd,...e}).debugSpectorJS)return null;if(!Xd&&globalThis.SPECTOR&&!(null==(t=globalThis.luma)?void 0:t.spector)){Ts.probe(1,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;Xd=new e,globalThis.luma&&(globalThis.luma.spector=Xd)}if(!Xd)return null;if(qd||(qd=!0,Xd.spyCanvases(),null==Xd||Xd.onCaptureStarted.add(e=>Ts.info("Spector capture started:",e)()),null==Xd||Xd.onCapture.add(e=>{Ts.info("Spector capture complete:",e)(),null==Xd||Xd.getResultUI(),null==Xd||Xd.resultView.display(),null==Xd||Xd.resultView.addCapture(e)})),e.gl){const t=e.gl,n=t.device;null==Xd||Xd.startCapture(e.gl,500),t.device=n,new Promise(e=>setTimeout(e,2e3)).then(e=>{Ts.info("Spector capture stopped after 2 seconds")(),null==Xd||Xd.stopCapture()})}return Xd}({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=function(e,t){const n=e.getParameter(7936),s=e.getParameter(7937);Tf(e,"WEBGL_debug_renderer_info",t);const r=t.WEBGL_debug_renderer_info,i=e.getParameter(r?r.UNMASKED_VENDOR_WEBGL:7936)||n,o=e.getParameter(r?r.UNMASKED_RENDERER_WEBGL:7937)||s,a=e.getParameter(7938),l=Sf(i,o),c=function(e,t){return/Metal/i.exec(e)||/Metal/i.exec(t)?"metal":/ANGLE/i.exec(e)||/ANGLE/i.exec(t)?"opengl":"unknown"}(i,o),u=function(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(Sf(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}(i,o);return{type:"webgl",gpu:l,gpuType:u,gpuBackend:c,vendor:i,renderer:o,version:a,shadingLanguage:"glsl",shadingLanguageVersion:300}}(this.gl,this._extensions),this.limits=new Uf(this.gl),this.features=new Bf(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),new xf(this.gl,{log:(...e)=>Ts.log(1,...e)()}).trackState(this.gl,{copyState:!1});const l=e.debugWebGL||e.debug,c=e.debugWebGL;l&&(this.gl=Zd(this.gl,{debugWebGL:l,traceWebGL:c}),Ts.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(Ts.level=Math.max(Ts.level,1))),this.commandEncoder=new Ep(this,{id:`${this}-command-encoder`})}get[Symbol.toStringTag](){return"WebGLDevice"}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}isVertexFormatSupported(e){return"unorm8x4-bgra"!==e}destroy(){this.props._reuseDevices||this._reused||delete this.gl.device}get isLost(){return this.gl.isContextLost()}getTextureByteAlignment(){return 4}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._normalizeBufferProps(e);return new Wf(this,t)}createTexture(e){return new rp(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new tp(this,e)}createShader(e){return new $f(this,e)}createFramebuffer(e){return new jf(this,e)}createVertexArray(e){return new Tp(this,e)}createTransformFeedback(e){return new Sp(this,e)}createQuerySet(e){return new Rp(this,e)}createRenderPipeline(e){return new pp(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}createCommandEncoder(e={}){return new Ep(this,e)}submit(e){e||(e=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:`${this.id}-default-encoder`})),e._executeCommands()}readPixelsToArrayWebGL(e,t){return function(e,t){var n;const{sourceX:s=0,sourceY:r=0,sourceAttachment:i=0}=t||{};let{target:o=null,sourceWidth:a,sourceHeight:l,sourceDepth:c,sourceFormat:u,sourceType:h}=t||{};const{framebuffer:d,deleteFramebuffer:f}=kp(e),{gl:p,handle:g}=d;a||(a=d.width),l||(l=d.height);const m=null==(n=d.colorAttachments[i])?void 0:n.texture;if(!m)throw new Error(`Invalid framebuffer attachment ${i}`);c=(null==m?void 0:m.depth)||1,u||(u=(null==m?void 0:m.glFormat)||6408),h||(h=(null==m?void 0:m.glType)||5121),_=o,y=h,b=u,v=a,x=l,o=_||(y||(y=5121),new(Ls(Pp[y]))(v*x*Cp(b)));var _,y,b,v,x;const w=Ms(o);h=h||hp[w];const E=p.bindFramebuffer(36160,g);return p.readBuffer(36064+i),p.readPixels(s,r,a,l,u,h,o),p.readBuffer(36064),p.bindFramebuffer(36160,E||null),f&&d.destroy(),o}(e,t)}readPixelsToBufferWebGL(e,t){return function(e,t){const{target:n,sourceX:s=0,sourceY:r=0,sourceFormat:i=6408,targetByteOffset:o=0}=t||{};let{sourceWidth:a,sourceHeight:l,sourceType:c}=t||{};const{framebuffer:u,deleteFramebuffer:h}=kp(e);a=a||u.width,l=l||u.height;const d=u;c=c||5121;let f=n;if(!f){const e=o+a*l*Cp(i)*function(e){switch(e){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}(c);f=d.device.createBuffer({byteLength:e})}const p=e.device.createCommandEncoder();return p.copyTextureToBuffer({sourceTexture:e,width:a,height:l,origin:[s,r],destinationBuffer:f,byteOffset:o}),p.destroy(),h&&u.destroy(),f}(e,t)}setParametersWebGL(e){_f(this.gl,e)}getParametersWebGL(e){return yf(this.gl,e)}withParametersWebGL(e,t){return np(this.gl,e,t)}resetWebGL(){Ts.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),_f(this.gl,nf)}_getDeviceSpecificTextureFormatCapabilities(e){return function(e,t,n){let s=t.create;const r=Nf[t.format];return void 0===(null==r?void 0:r.gl)&&(s=!1),(null==r?void 0:r.x)&&(s=s&&Boolean(Tf(e,r.x,n))),{format:t.format,create:s&&t.create,render:s&&t.render,filter:s&&t.filter,blend:s&&t.blend,store:s&&t.store}}(this.gl,e,this._extensions)}loseDevice(){var e;let t=!1;const n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(t=!0,n.loseContext()),null==(e=this._resolveContextLost)||e.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){xf.get(this.gl).push()}popState(){xf.get(this.gl).pop()}getGLKey(e,t){const n=Number(e);for(const s in this.gl)if(this.gl[s]===n)return`GL.${s}`;return(null==t?void 0:t.emptyIfUnknown)?"":String(e)}getGLKeys(e){const t={emptyIfUnknown:!0};return Object.entries(e).reduce((e,[n,s])=>(e[`${n}:${this.getGLKey(n,t)}`]=`${s}:${this.getGLKey(s,t)}`,e),{})}setConstantAttributeWebGL(e,t){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const s=this._constants[e];switch(s&&function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(s,t)&&Ts.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:!function(e,t,n){switch(n.length){case 1:e.gl.vertexAttrib1fv(t,n);break;case 2:e.gl.vertexAttrib2fv(t,n);break;case 3:e.gl.vertexAttrib3fv(t,n);break;case 4:e.gl.vertexAttrib4fv(t,n)}}(this,e,t);break;case Int32Array:!function(e,t,n){e.gl.vertexAttribI4iv(t,n)}(this,e,t);break;case Uint32Array:!function(e,t,n){e.gl.vertexAttribI4uiv(t,n)}(this,e,t);break;default:throw new Error("constant")}}getExtension(e){return Tf(this.gl,e,this._extensions),this._extensions}_setWebGLDebugMetadata(e,t,n){e.luma=t;const s={props:n.spector,id:n.spector.id};e.__SPECTOR_Metadata=s}}const Lp=Object.freeze(Object.defineProperty({__proto__:null,WebGLDevice:Mp},Symbol.toStringTag,{value:"Module"}));function Np(){}const Op={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Np,onWebGLInitialized:Np,onResize:Np,onViewStateChange:Np,onInteractionStateChange:Np,onBeforeRender:Np,onAfterRender:Np,onLoad:Np,onError:e=>On.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:({isDragging:e})=>e?"grabbing":"grab",getTooltip:null,debug:!1,drawPickingColors:!1};class Fp{constructor(e){var t;this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new wt({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=e=>{const{_pickRequest:t}=this;if("pointerleave"===e.type)t.x=-1,t.y=-1,t.radius=0;else{if(e.leftButton||e.rightButton)return;{const n=e.offsetCenter;if(!n)return;t.x=n.x,t.y=n.y,t.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:t.x,y:t.y}),t.event=e},this._onEvent=e=>{const t=xc[e.type],n=e.offsetCenter;if(!t||!n||!this.layerManager)return;const s=this.layerManager.getLayers(),r=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:s,viewports:this.getViewports(n)},this._lastPointerDownInfo),{layer:i}=r,o=i&&(i[t]||i.props[t]),a=this.props[t];let l=!1;o&&(l=o.call(i,r,e)),l||(null==a||a(r,e),this.widgetManager.onEvent(r,e))},this._onPointerDown=e=>{var t;if("webgpu"===(null==(t=this.device)?void 0:t.type))return;const n=e.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:n.x,y:n.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...Op,...e},(e=this.props).viewState&&e.initialViewState&&On.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let n=this.device;if(!n&&e.gl){e.gl instanceof WebGLRenderingContext&&On.error("WebGL1 context not supported.")();const s=null==(t=this.props.deviceProps)?void 0:t.onResize;n=tf.attach(e.gl,{...this.props.deviceProps,onResize:(e,t)=>{const{width:n,height:r}=e.canvas;e.drawingBufferWidth=n,e.drawingBufferHeight=r,this._needsRedraw="Canvas resized",null==s||s(e,t)}})}n||(n=this._createDevice(e)),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&Uu.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,n,s,r,i,o,a,l,c;null==(e=this.animationLoop)||e.stop(),null==(t=this.animationLoop)||t.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,null==(n=this.layerManager)||n.finalize(),this.layerManager=null,null==(s=this.viewManager)||s.finalize(),this.viewManager=null,null==(r=this.effectManager)||r.finalize(),this.effectManager=null,null==(i=this.deckRenderer)||i.finalize(),this.deckRenderer=null,null==(o=this.deckPicker)||o.finalize(),this.deckPicker=null,null==(a=this.eventManager)||a.destroy(),this.eventManager=null,null==(l=this.widgetManager)||l.finalize(),this.widgetManager=null,this.props.canvas||this.props.device||this.props.gl||!this.canvas||(null==(c=this.canvas.parentElement)||c.removeChild(this.canvas),this.canvas=null)}setProps(e){var t,n,s,r,i,o,a;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&On.removed("onLayerHover","onHover")(),"onLayerClick"in e&&On.removed("onLayerClick","onClick")(),e.initialViewState&&!$h(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const l=Object.create(this.props);Object.assign(l,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),e.device&&e.device.id!==(null==(t=this.device)?void 0:t.id)&&(null==(n=this.animationLoop)||n.stop(),this.canvas!==(null==(s=e.device.canvasContext)?void 0:s.canvas)&&(null==(r=this.canvas)||r.remove(),null==(i=this.eventManager)||i.destroy(),this.canvas=null),On.log(`recreating animation loop for new device! id=${e.device.id}`)(),this.animationLoop=this._createAnimationLoop(e.device,e),this.animationLoop.start()),null==(o=this.animationLoop)||o.setProps(l),void 0!==e.useDevicePixels&&(null==(a=this.device)?void 0:a.canvasContext)&&this.device.canvasContext.setProps({useDevicePixels:e.useDevicePixels}),this.layerManager&&(this.viewManager.setProps(l),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(l),this.effectManager.setProps(l),this.deckRenderer.setProps(l),this.deckPicker.setProps(l),this.widgetManager.setProps(l)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),r=this.effectManager.needsRedraw(e),i=this.deckRenderer.needsRedraw(e);return t=t||n||s||r||i,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return null!==this.viewManager}getViews(){return nd(this.viewManager),this.viewManager.views}getViewports(e){return nd(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var t;null==(t=this.layerManager)||t.removeDefaultShaderModule(e)}_pick(e,t,n){nd(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(t).timeStart();const r=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return s.get(t).timeEnd(),r}_createCanvas(e){let t=e.canvas;return"string"==typeof t&&(t=document.getElementById(t),nd(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",e.width&&"number"==typeof e.width&&(t.width=e.width),e.height&&"number"==typeof e.height&&(t.height=e.height),(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){var t;if(!this.canvas)return;const{width:n,height:s}=e;if(n||0===n){const e=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=e}if(s||0===s){const n=Number.isFinite(s)?`${s}px`:s;this.canvas.style.position=(null==(t=e.style)?void 0:t.position)||"absolute",this.canvas.style.height=n}}_updateCanvasSize(){var e,t;const{canvas:n}=this;if(!n)return;const s=n.clientWidth??n.width,r=n.clientHeight??n.height;s===this.width&&r===this.height||(this.width=s,this.height=r,null==(e=this.viewManager)||e.setProps({width:s,height:r}),null==(t=this.layerManager)||t.activateViewport(this.getViewports()[0]),this.props.onResize({width:s,height:r}))}_createAnimationLoop(e,t){const{gl:n,onError:s}=t;return new oh({device:e,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:e=>this._setDevice(e.device),onRender:this._onRenderFrame.bind(this),onError:s})}_createDevice(e){var t,n,s;const r=null==(t=this.props.deviceProps)?void 0:t.createCanvasContext,i="object"==typeof r?r:void 0,o={adapters:[],_cacheShaders:!0,_cachePipelines:!0,...e.deviceProps};o.adapters.includes(tf)||o.adapters.push(tf);const a={alphaMode:"webgpu"===(null==(n=this.props.deviceProps)?void 0:n.type)?"premultiplied":void 0},l=null==(s=this.props.deviceProps)?void 0:s.onResize;return ar.createDevice({_reuseDevices:!0,type:"webgl",...o,createCanvasContext:{...a,...i,canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!0},onResize:(e,t)=>{this._needsRedraw="Canvas resized",null==l||l(e,t)}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new vd({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var e,t,n,s;if("webgpu"===(null==(e=this.device)?void 0:e.type))return;const{_pickRequest:r}=this;if(r.event){const{result:e,emptyInfo:i}=this._pick("pickObject","pickObject Time",r);this.cursorState.isHovering=e.length>0;let o=i,a=!1;for(const n of e)o=n,a=(null==(t=n.layer)?void 0:t.onHover(n,r.event))||a;a||(null==(s=(n=this.props).onHover)||s.call(n,o,r.event),this.widgetManager.onHover(o,r.event)),r.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var t,n;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=null==(t=this.device.canvasContext)?void 0:t.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),"webgl"===this.device.type&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),"webgl"===this.device.type&&this.props.onWebGLInitialized(this.device.gl);const s=new sh;s.play(),this.animationLoop.attachTimeline(s),this.eventManager=new _c(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(wc).map(e=>{var t;const[n,s,r,i]=wc[e];return{recognizer:new n({...s,...null==(t=this.props.eventRecognizerOptions)?void 0:t[e],event:e}),recognizeWith:r,requestFailure:i}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in xc)this.eventManager.on(i,this._onEvent);this.viewManager=new Xh({timeline:s,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new Hh(this.device,{deck:this,stats:this.stats,viewport:r,timeline:s}),this.effectManager=new wd({deck:this,device:this.device}),this.deckRenderer=new Td(this.device),this.deckPicker=new Id(this.device),this.widgetManager=new Od({deck:this,parentElement:null==(n=this.canvas)?void 0:n.parentElement}),this.widgetManager.addDefault(new Ud),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){var n;const{device:s,gl:r}=this.layerManager.context;this.props.onBeforeRender({device:s,gl:r});const i={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};null==(n=this.deckRenderer)||n.renderLayers(i),"screen"===i.pass&&this.widgetManager.onRedraw({viewports:i.viewports,layers:i.layers}),this.props.onAfterRender({device:s,gl:r})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),On.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),"webgpu"!==(null==(e=this.device)?void 0:e.type)&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const n=ar.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}Fp.defaultProps=Op,Fp.VERSION=jn;const Dp=Ms;function Bp(e,t,n){const s="webgpu"===n&&"uint8"===t.type?"unorm8":t.type;return{attribute:e,format:t.size>1?`${s}x${t.size}`:t.type,byteOffset:t.offset||0}}function Up(e){return e.stride||e.size*e.bytesPerElement}function jp(e,t){t.offset&&On.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Up(e),s=(void 0!==t.vertexOffset?t.vertexOffset:e.vertexOffset||0)*n+(t.elementOffset||0)*e.bytesPerElement+(e.offset||0);return{...t,offset:s,stride:n}}class Gp{constructor(e,t,n){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const s=t.logicalType||t.type,r="float64"===s;let i,{defaultValue:o}=t;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0),i=r?"float32":!s&&t.isIndexed?"uint32":s||"float32";let a=function(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return Ls(e)}}(s||i);this.doublePrecision=r,r&&!1===t.fp64&&(a=Float32Array),this.value=null,this.settings={...t,defaultType:a,defaultValue:o,logicalType:s,type:i,normalized:i.includes("norm"),size:this.size,bytesPerElement:a.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Up(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Uu.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const n={};if(this.state.constant){const s=this.value;if(t){const r=jp(this.getAccessor(),t),i=r.offset/s.BYTES_PER_ELEMENT,o=r.size||this.size;n[e]=s.subarray(i,i+o)}else n[e]=s}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(e=this.id,t=null){const n=this.getAccessor(),s=[],r={name:this.id,byteStride:Up(n),attributes:s};if(this.doublePrecision){const r=function(e,t){const n=jp(e,t);return{high:n,low:{...n,offset:n.offset+4*e.size}}}(n,t||{});s.push(Bp(e,{...n,...r.high},this.device.type),Bp(`${e}64Low`,{...n,...r.low},this.device.type))}else if(t){const r=jp(n,t);s.push(Bp(e,{...n,...r},this.device.type))}else s.push(Bp(e,n,this.device.type));return r}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:n,size:s}=this,r=n*s;if(t&&r&&t.length>=r){const n=new Array(s).fill(1/0),i=new Array(s).fill(-1/0);for(let e=0;e<r;)for(let r=0;r<s;r++){const s=t[e++];s<n[r]&&(n[r]=s),s>i[r]&&(i[r]=s)}e=[n,i]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let n;n=ArrayBuffer.isView(e)?{value:e}:e instanceof Ps?{buffer:e}:e;const s={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)s.type="float32";else{const e=Dp(n.value);s.type=s.normalized?e.replace("int","norm"):e}s.bytesPerElement=n.value.BYTES_PER_ELEMENT,s.stride=Up(s)}if(t.bounds=null,n.constant){let e=n.value;if(e=this._normalizeValue(e,[],0),this.settings.normalized&&(e=this.normalizeConstant(e)),t.constant&&this._areValuesEqual(e,this.value))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(e)?e:new Float32Array(e)}else if(n.buffer){const e=n.buffer;t.externalBuffer=e,t.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let e=n.value;t.externalBuffer=null,t.constant=!1,this.value=e;let{buffer:r}=this;const i=Up(s),o=(s.vertexOffset||0)*i;if(this.doublePrecision&&e instanceof Float64Array&&(e=Wu(e,s)),this.settings.isIndexed){const t=this.settings.defaultType;e.constructor!==t&&(e=new t(e))}const a=e.byteLength+o+2*i;(!r||r.byteLength<a)&&(r=this._createBuffer(a)),r.write(e,o)}return this.setAccessor(s),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:n=0,endOffset:s}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?Wu(t,{size:this.size,startIndex:n,endIndex:s}):t.subarray(n,s),n*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:n}=this,s=n.allocatedValue,r=Uu.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=r;const{byteOffset:i}=this;let{buffer:o}=this;return(!o||o.byteLength<r.byteLength+i)&&(o=this._createBuffer(r.byteLength+i),t&&s&&o.write(s instanceof Float64Array?Wu(s,this):s,i)),n.allocatedValue=r,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=t.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);t instanceof n||!this.settings.normalized||"normalized"in e||On.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(e=>(e+128)/255*2-1);case"snorm16":return new Float32Array(e).map(e=>(e+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(e=>e/255);case"unorm16":return new Float32Array(e).map(e=>e/65535);default:return e}}_normalizeValue(e,t,n){const{defaultValue:s,size:r}=this.settings;if(Number.isFinite(e))return t[n]=e,t;if(!e){let e=r;for(;--e>=0;)t[n+e]=s[e];return t}switch(r){case 4:t[n+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:t[n+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:t[n+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:t[n+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let i=r;for(;--i>=0;)t[n+i]=Number.isFinite(e[i])?e[i]:s[i]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:n}=this;for(let s=0;s<n;s++)if(e[s]!==t[s])return!1;return!0}_createBuffer(e){var t;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:s}=this.settings;return this._buffer=this.device.createBuffer({...null==(t=this._buffer)?void 0:t.props,id:this.id,usage:(n?Ps.INDEX:Ps.VERTEX)|Ps.COPY_DST,indexType:n?s:void 0,byteLength:e}),this._buffer}}const Vp=[],zp=[];function Wp(e,t=0,n=1/0){let s=Vp;const r={index:-1,data:e,target:[]};return e?"function"==typeof e[Symbol.iterator]?s=e:e.length>0&&(zp.length=e.length,s=zp):s=Vp,(t>0||Number.isFinite(n))&&(s=(Array.isArray(s)?s:Array.from(s)).slice(t,n),r.index=t-1),{iterable:s,objectInfo:r}}function Hp(e){return e&&e[Symbol.asyncIterator]}function $p(e,t){const{size:n,stride:s,offset:r,startIndices:i,nested:o}=t,a=e.BYTES_PER_ELEMENT,l=s?s/a:n,c=r?r/a:0,u=Math.floor((e.length-c)/l);return(t,{index:s,target:r})=>{if(!i){const t=s*l+c;for(let s=0;s<n;s++)r[s]=e[t+s];return r}const a=i[s],h=i[s+1]||u;let d;if(o){d=new Array(h-a);for(let t=a;t<h;t++){const s=t*l+c;r=new Array(n);for(let t=0;t<n;t++)r[t]=e[s+t];d[t-a]=r}}else if(l===n)d=e.subarray(a*n+c,h*n+c);else{d=new e.constructor((h-a)*n);let t=0;for(let s=a;s<h;s++){const r=s*l+c;for(let s=0;s<n;s++)d[t++]=e[r+s]}}return d}}const Xp=[],qp=[[0,1/0]],Yp={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function Kp(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});const n=e.type||"interpolation";return{...Yp[n],...t,...e,type:n}}class Zp extends Gp{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:qp}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t,n,s;(t=this.state).layoutChanged||(t.layoutChanged=(n=e,s=this.getAccessor(),!(n.type===s.type&&n.size===s.size&&Up(n)===Up(s)&&(n.offset||0)===(s.offset||0)))),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat("function"!=typeof e&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,n=this.settings.transition;return Kp(Array.isArray(t)?e[t.find(t=>e[t])]:e[t],n)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:e=0,endRow:n=1/0}=t;this.state.updateRanges=function(e,t){if(e===qp)return e;if(t[0]<0&&(t[0]=0),t[0]>=t[1])return e;const n=[],s=e.length;let r=0;for(let i=0;i<s;i++){const s=e[i];s[1]<t[0]?(n.push(s),r=i+1):s[0]>t[1]?n.push(s):t=[Math.min(s[0],t[0]),Math.max(s[1],t[1])]}return n.splice(r,0,t),n}(this.state.updateRanges,[e,n])}else this.state.updateRanges=qp}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=Xp}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:n}=this;return!n.noAlloc&&!!n.update&&(super.allocate(e,t.updateRanges!==qp),!0)}updateBuffer({numInstances:e,data:t,props:n,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:r},settings:{update:i,noAlloc:o}}=this;let a=!0;if(i){for(const[o,a]of r)i.call(s,this,{data:t,startRow:o,endRow:a,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[t,n]of r){const s=Number.isFinite(t)?this.getVertexOffset(t):0,r=Number.isFinite(n)?this.getVertexOffset(n):o||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:s,endOffset:r})}this._checkAttributeArray()}else a=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),a}setConstantValue(e,t){const n="webgpu"===this.device.type;if(n||void 0===t||"function"==typeof t){if(n&&"function"!=typeof t){const e=this._normalizeValue(t,[],0);this._areValuesEqual(e,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}const s=this.settings.transform&&e?this.settings.transform.call(e,t):t;return this.setData({constant:!0,value:s})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:n,settings:s}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),s.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const r=e;nd(ArrayBuffer.isView(r.value),`invalid ${s.accessor}`);const i=Boolean(r.size)&&r.size!==this.size;return n.binaryAccessor=$p(r.value,{size:r.size||this.size,stride:r.stride,offset:r.offset,startIndices:t,nested:i}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const n in e)Object.assign(t,super.getValue(n,e[n]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:s}=this.settings;if(n.stepMode="dynamic"===s?e?e.isInstanced?"instance":"vertex":"instance":s??"vertex",!t)return n;for(const r in t){const e=super._getBufferLayout(r,t[r]);n.attributes.push(...e.attributes)}return n}_autoUpdater(e,{data:t,startRow:n,endRow:s,props:r,numInstances:i}){if(e.constant&&"webgpu"!==this.context.device.type)return;const{settings:o,state:a,value:l,size:c,startIndices:u}=e,{accessor:h,transform:d}=o;let f=a.binaryAccessor||("function"==typeof h?h:r[h]);"function"!=typeof f&&"string"==typeof h&&(f=()=>r[h]),nd("function"==typeof f,`accessor "${h}" is not a function`);let p=e.getVertexOffset(n);const{iterable:g,objectInfo:m}=Wp(t,n,s);for(const _ of g){m.index++;let t=f(_,m);if(d&&(t=d.call(this,t)),u){const n=(m.index<u.length-1?u[m.index+1]:i)-u[m.index];if(t&&Array.isArray(t[0])){let n=p;for(const s of t)e._normalizeValue(s,l,n),n+=c}else t&&t.length>c?l.set(t,p):(e._normalizeValue(t,m.target,0),Vh({target:l,source:m.target,start:p,count:n}));p+=n*c}else e._normalizeValue(t,l,p),p+=c}}_validateAttributeUpdaters(){const{settings:e}=this;if(!e.noAlloc&&"function"!=typeof e.update)throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let n=!0;switch(t){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Qp(e){const{source:t,target:n,start:s=0,size:r,getData:i}=e,o=e.end||n.length,a=t.length,l=o-s;if(a>l)return void n.set(t.subarray(0,l),s);if(n.set(t,s),!i)return;let c=a;for(;c<l;){const e=i(c,t);for(let t=0;t<r;t++)n[s+c]=e[t]||0,c++}}function Jp(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${e}"`)}}function eg(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function tg(e){e.push(e.shift())}function ng({device:e,source:t,target:n}){return(!n||n.byteLength<t.byteLength)&&(null==n||n.destroy(),n=e.createBuffer({byteLength:t.byteLength,usage:t.usage})),n}function sg({device:e,buffer:t,attribute:n,fromLength:s,toLength:r,fromStartIndices:i,getData:o=e=>e}){const a=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*a,c=n.byteOffset,u=n.settings.bytesPerElement<4?c/n.settings.bytesPerElement*4:c,h=n.startIndices,d=i&&h,f=n.isConstant;if(!d&&t&&s>=r)return t;const p=n.value instanceof Float64Array?Float32Array:n.value.constructor,g=f?n.value:new p(n.getBuffer().readSyncWebGL(c,r*p.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!f){const e=o;o=(t,s)=>n.normalizeConstant(e(t,s))}const m=f?(e,t)=>o(g,t):(e,t)=>o(g.subarray(e+c,e+c+l),t),_=t?new Float32Array(t.readSyncWebGL(u,4*s).buffer):new Float32Array(0),y=new Float32Array(r);return function({source:e,target:t,size:n,getData:s,sourceStartIndices:r,targetStartIndices:i}){if(!r||!i)return Qp({source:e,target:t,size:n,getData:s}),t;let o=0,a=0;const l=s&&((e,t)=>s(e+a,t)),c=Math.min(r.length,i.length);for(let u=1;u<c;u++){const s=r[u]*n,c=i[u]*n;Qp({source:e.subarray(o,s),target:t,start:a,end:c,size:n,getData:l}),o=s,a=c}a<t.length&&Qp({source:[],target:t,start:a,size:n,getData:l})}({source:_,target:y,sourceStartIndices:i,targetStartIndices:h,size:l,getData:m}),(!t||t.byteLength<y.byteLength+u)&&(null==t||t.destroy(),t=e.createBuffer({byteLength:y.byteLength+u,usage:35050})),t.write(y,u),t}class rg{constructor({device:e,attribute:t,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Qh(n),this.attribute=t,this.attributeInTransition=function(e){const{device:t,settings:n,value:s}=e,r=new Zp(t,n);return r.setData({value:s instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),r}(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=function(e,t){const{doublePrecision:n,settings:s,value:r,size:i}=e,o=n&&r instanceof Float64Array?2:1;let a=0;const{shaderAttributes:l}=e.settings;if(l)for(const c of Object.values(l))a=Math.max(a,c.vertexOffset??0);return(s.noAlloc?r.length:(t+a)*i)*o}(this.attribute,t),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}const ig={name:"interpolation",vs:"uniform interpolationUniforms {\n  float time;\n} interpolation;\n",uniformTypes:{time:"f32"}};function og(e){return e.doublePrecision&&e.value instanceof Float64Array}const ag={name:"spring",vs:"uniform springUniforms {\n  float damping;\n  float stiffness;\n} spring;\n",uniformTypes:{damping:"f32",stiffness:"f32"}},lg={interpolation:class extends rg{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="interpolation",this.transform=function(e,t){const n=t.size,s=Jp(n),r=eg(n),i=t.getBufferLayout();return og(t)?new Ph(e,{vs:"#version 300 es\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nin ATTRIBUTE_TYPE aFrom;\nin ATTRIBUTE_TYPE aFrom64Low;\nin ATTRIBUTE_TYPE aTo;\nin ATTRIBUTE_TYPE aTo64Low;\nout ATTRIBUTE_TYPE vCurrent;\nout ATTRIBUTE_TYPE vCurrent64Low;\n\nvec2 mix_fp64(vec2 a, vec2 b, float x) {\n  vec2 range = sub_fp64(b, a);\n  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));\n}\n\nvoid main(void) {\n  for (int i=0; i<ATTRIBUTE_SIZE; i++) {\n    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);\n    vCurrent[i] = value.x;\n    vCurrent64Low[i] = value.y;\n  }\n  gl_Position = vec4(0.0);\n}\n",bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:r,byteOffset:0},{attribute:"aFrom64Low",format:r,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:r,byteOffset:0},{attribute:"aTo64Low",format:r,byteOffset:4*n}]}],modules:[dl,ig],defines:{ATTRIBUTE_TYPE:s,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Ph(e,{vs:"#version 300 es\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nin ATTRIBUTE_TYPE aFrom;\nin ATTRIBUTE_TYPE aTo;\nout ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, interpolation.time);\n  gl_Position = vec4(0.0);\n}\n",bufferLayout:[{name:"aFrom",format:r},{name:"aTo",format:i.attributes[0].format}],modules:[ig],defines:{ATTRIBUTE_TYPE:s},varyings:["vCurrent"],disableWarnings:!0})}(e,t)}start(e,t){const n=this.currentLength,s=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0)return void this.transition.cancel();const{buffers:r,attribute:i}=this;tg(r),r[0]=sg({device:this.device,buffer:r[0],attribute:i,fromLength:n,toLength:this.currentLength,fromStartIndices:s,getData:e.enter}),r[1]=ng({device:this.device,source:r[0],target:r[1]}),this.setBuffer(r[1]);const{transform:o}=this,a=o.model;let l=Math.floor(this.currentLength/i.size);og(i)&&(l/=2),a.setVertexCount(l),i.isConstant?(a.setAttributes({aFrom:r[0]}),a.setConstantAttributes({aTo:i.value})):a.setAttributes({aFrom:r[0],aTo:i.getBuffer()}),o.transformFeedback.setBuffers({vCurrent:r[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:n}=this.transition;let s=n/e;t&&(s=t(s));const{model:r}=this.transform,i={time:s};r.shaderInputs.setProps({interpolation:i}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},spring:class extends rg{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="spring",this.texture=function(e){return e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1})}(e),this.framebuffer=function(e,t){return e.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}(e,this.texture),this.transform=function(e,t){const n=Jp(t.size),s=eg(t.size);return new Ph(e,{vs:"#version 300 es\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nin ATTRIBUTE_TYPE aPrev;\nin ATTRIBUTE_TYPE aCur;\nin ATTRIBUTE_TYPE aTo;\nout ATTRIBUTE_TYPE vNext;\nout float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE force = delta * spring.stiffness;\n  ATTRIBUTE_TYPE resistance = velocity * spring.damping;\n  return force - resistance + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",fs:"#version 300 es\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nin float vIsTransitioningFlag;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  fragColor = vec4(1.0);\n}",bufferLayout:[{name:"aPrev",format:s},{name:"aCur",format:s},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[ag],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}(e,t)}start(e,t){const n=this.currentLength,s=this.currentStartIndices;super.start(e,t);const{buffers:r,attribute:i}=this;for(let a=0;a<2;a++)r[a]=sg({device:this.device,buffer:r[a],attribute:i,fromLength:n,toLength:this.currentLength,fromStartIndices:s,getData:e.enter});r[2]=ng({device:this.device,source:r[0],target:r[2]}),this.setBuffer(r[1]);const{model:o}=this.transform;o.setVertexCount(Math.floor(this.currentLength/i.size)),i.isConstant?o.setConstantAttributes({aTo:i.value}):o.setAttributes({aTo:i.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:n,transition:s}=this,r=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const i={stiffness:r.stiffness,damping:r.damping};t.model.shaderInputs.setProps({spring:i}),t.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),tg(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}};class cg{constructor(e,{id:t,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:n}){this.numInstances=n||1;for(const s in e){const n=e[s],r=n.getTransitionSetting(t);r&&this._updateAttribute(s,n,r)}for(const s in this.transitions){const n=e[s];n&&n.getTransitionSetting(t)||this._removeTransition(s)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const n=this.transitions[t];n.inProgress&&(e[t]=n.attributeInTransition)}return e}run(){if(0===this.numInstances)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,n){const s=this.transitions[e];let r=!s||s.type!==n.type;if(r){s&&this._removeTransition(e);const i=lg[n.type];i?this.transitions[e]=new i({attribute:t,timeline:this.timeline,device:this.device}):(On.error(`unsupported transition type '${n.type}'`)(),r=!1)}(r||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const ug="attributeManager.invalidate";class hg{constructor(e,{id:t="attribute-manager",stats:n,timeline:s}={}){this.mergeBoundsMemoized=Tc(Hu),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new cg(e,{id:`${t}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)void 0!==this.attributes[t]&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const n=this._invalidateTrigger(e,t);Bn(ug,this,e,n)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Bn(ug,this,"all")}update({data:e,numInstances:t,startIndices:n=null,transitions:s,props:r={},buffers:i={},context:o={}}){let a=!1;Bn("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const l in this.attributes){const s=this.attributes[l],c=s.settings.accessor;s.startIndices=n,s.numInstances=t,r[l]&&On.removed(`props.${l}`,`data.attributes.${l}`)(),s.setExternalBuffer(i[l])||s.setBinaryValue("string"==typeof c?i[c]:void 0,e.startIndices)||"string"==typeof c&&!i[c]&&s.setConstantValue(o,r[c])||s.needsUpdate()&&(a=!0,this._updateAttribute({attribute:s,numInstances:t,data:e,props:r,context:o})),this.needsRedraw=this.needsRedraw||s.needsRedraw()}a&&Bn("attributeManager.updateEnd",this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(e=>{var t;return null==(t=this.attributes[e])?void 0:t.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:n}=this,s={...n.getAttributes()};for(const r in t){const i=t[r];i.needsRedraw(e)&&!n.hasAttribute(r)&&(s[r]=i)}return s}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const n in e){const s=e[n],r={...s,id:n,size:(s.isIndexed?1:s.size)||1,...t};this.attributes[n]=new Zp(this.device,r)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(n=>{e[n]||(e[n]=[]),e[n].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:n,updateTriggers:s}=this,r=s[e];return r&&r.forEach(e=>{const s=n[e];s&&s.setNeedsUpdate(s.id,t)}),r}_updateAttribute(e){const{attribute:t,numInstances:n}=e;Bn("attribute.updateStart",t),t.constant?t.setConstantValue(e.context,t.value):(t.allocate(n)&&Bn("attribute.allocate",t,n),t.updateBuffer(e)&&(this.needsRedraw=!0,Bn("attribute.updateEnd",t,n)))}}const dg=1e-5;function fg(e,t,n,s,r){const i=t-e;return(n-t)*r+-i*s+i+t}function pg(e,t){if(Array.isArray(e)){let n=0;for(let s=0;s<e.length;s++){const r=e[s]-t[s];n+=r*r}return Math.sqrt(n)}return Math.abs(e-t)}const gg={interpolation:class extends Qh{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:n,duration:s,easing:r}}=this,i=r(e/s);this._value=Ra(t,n,i)}},spring:class extends Qh{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:n,stiffness:s}=this.settings,{_prevValue:r=e,_currValue:i=e}=this;let o=function(e,t,n,s,r){if(Array.isArray(n)){const i=[];for(let o=0;o<n.length;o++)i[o]=fg(e[o],t[o],n[o],s,r);return i}return fg(e,t,n,s,r)}(r,i,t,n,s);const a=pg(o,t),l=pg(o,i);a<dg&&l<dg&&(o=t,this.end()),this._prevValue=i,this._currValue=o}}};class mg{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,n,s){const{transitions:r}=this;if(r.has(e)){const n=r.get(e),{value:s=n.settings.fromValue}=n;t=s,this.remove(e)}if(!(s=Kp(s)))return;const i=gg[s.type];if(!i)return void On.error(`unsupported transition type '${s.type}'`)();const o=new i(this.timeline);o.start({...s,fromValue:t,toValue:n}),r.set(e,o)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,n]of this.transitions)n.update(),e[t]=n.value,n.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function _g(e,t){if(!e.transitions)return!1;const n={},s=e[Oh];let r=!1;for(const i in e.transitions){const o=s[i],a=o&&o.type;("number"===a||"color"===a||"array"===a)&&bg(e[i],t[i],o)&&(n[i]=!0,r=!0)}return!!r&&n}function yg({newProps:e,oldProps:t,ignoreProps:n={},propTypes:s={},triggerName:r="props"}){if(t===e)return!1;if("object"!=typeof e||null===e)return`${r} changed shallowly`;if("object"!=typeof t||null===t)return`${r} changed shallowly`;for(const i of Object.keys(e))if(!(i in n)){if(!(i in t))return`${r}.${i} added`;const n=bg(e[i],t[i],s[i]);if(n)return`${r}.${i} ${n}`}for(const i of Object.keys(t))if(!(i in n)){if(!(i in e))return`${r}.${i} dropped`;if(!Object.hasOwnProperty.call(e,i)){const n=bg(e[i],t[i],s[i]);if(n)return`${r}.${i} ${n}`}}return!1}function bg(e,t,n){let s=n&&n.equal;return s&&!s(e,t,n)?"changed deeply":s||(s=e&&t&&e.equals,!s||s.call(e,t))?s||t===e?null:"changed shallowly":"changed deeply"}function vg(e,t){if(null===t)return!0;const n=t.extensions,{extensions:s}=e;if(s===n)return!1;if(!n||!s)return!0;if(s.length!==n.length)return!0;for(let r=0;r<s.length;r++)if(!s[r].equals(n[r]))return!0;return!1}function xg(e,t,n){let s=e.updateTriggers[n];s=null==s?{}:s;let r=t.updateTriggers[n];return r=null==r?{}:r,yg({oldProps:r,newProps:s,triggerName:n})}function wg(e,t){if(!t)return e;const n={...e,...t};if("defines"in t&&(n.defines={...e.defines,...t.defines}),"modules"in t&&(n.modules=(e.modules||[]).concat(t.modules),t.modules.some(e=>"project64"===e.name))){const e=n.modules.findIndex(e=>"project32"===e.name);e>=0&&n.modules.splice(e,1)}if("inject"in t)if(e.inject){const s={...e.inject};for(const e in t.inject)s[e]=(s[e]||"")+t.inject[e];n.inject=s}else n.inject=t.inject;return n}const Eg={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Tg={},Sg={boolean:{validate:(e,t)=>!0,equal:(e,t,n)=>Boolean(e)===Boolean(t)},number:{validate:(e,t)=>Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)},color:{validate:(e,t)=>t.optional&&!e||Cg(e)&&(3===e.length||4===e.length),equal:(e,t,n)=>$h(e,t,1)},accessor:{validate(e,t){const n=Pg(e);return"function"===n||n===Pg(t.value)},equal:(e,t,n)=>"function"==typeof t||$h(e,t,1)},array:{validate:(e,t)=>t.optional&&!e||Cg(e),equal(e,t,n){const{compare:s}=n,r=Number.isInteger(s)?s:s?1:0;return s?$h(e,t,r):e===t}},object:{equal(e,t,n){if(n.ignore)return!0;const{compare:s}=n,r=Number.isInteger(s)?s:s?1:0;return s?$h(e,t,r):e===t}},function:{validate:(e,t)=>t.optional&&!e||"function"==typeof e,equal:(e,t,n)=>!n.compare&&!1!==n.ignore||e===t},data:{transform:(e,t,n)=>{if(!e)return e;const{dataTransform:s}=n.props;return s?s(e):"string"==typeof e.shape&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,n)=>{const s=n.context;return s&&s.device?function(e,t,n,s){if(n instanceof vr)return n;n.constructor&&"Object"!==n.constructor.name&&(n={data:n});let r=null;n.compressed&&(r={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const{width:i,height:o}=n.data,a=t.createTexture({...n,sampler:{...Eg,...r,...s},mipLevels:t.getMipLevelCount(i,o)});return a.generateMipmapsWebGL(),Tg[a.id]=e,a}(n.id,s.device,e,{...t.parameters,...n.props.textureParameters}):null},release:(e,t,n)=>{var s,r;s=n.id,(r=e)&&r instanceof vr&&Tg[r.id]===s&&(r.delete(),delete Tg[r.id])}}};function Ag(e,t){switch(Pg(t)){case"object":return Rg(e,t);case"array":return Rg(e,{type:"array",value:t,compare:!1});case"boolean":return Rg(e,{type:"boolean",value:t});case"number":return Rg(e,{type:"number",value:t});case"function":return Rg(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function Rg(e,t){return"type"in t?{name:e,...Sg[t.type],...t}:"value"in t?{name:e,type:Pg(t.value),...t}:{name:e,type:"object",value:t}}function Cg(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function Pg(e){return Cg(e)?"array":null===e?"null":typeof e}function kg(e,t){if(!(e instanceof Og.constructor))return{};let n="_mergedDefaultProps";if(t)for(const s of t){const e=s.constructor;e&&(n+=`:${e.extensionName||e.name}`)}return Lg(e,n)||(e[n]=function(e,t){if(!e.prototype)return null;const n=kg(Object.getPrototypeOf(e)),s=function(e){const t={},n={},s={};for(const[r,i]of Object.entries(e)){const e=null==i?void 0:i.deprecatedFor;if(e)s[r]=Array.isArray(e)?e:[e];else{const e=Ag(r,i);t[r]=e,n[r]=e.value}}return{propTypes:t,defaultProps:n,deprecatedProps:s}}(Lg(e,"defaultProps")||{}),r=Object.assign(Object.create(null),n,s.defaultProps),i=Object.assign(Object.create(null),null==n?void 0:n[Oh],s.propTypes),o=Object.assign(Object.create(null),null==n?void 0:n[Fh],s.deprecatedProps);for(const a of t){const e=kg(a.constructor);e&&(Object.assign(r,e),Object.assign(i,e[Oh]),Object.assign(o,e[Fh]))}return function(e,t){const n=function(e){const t=e.componentName;return t||On.warn(`${e.name}.componentName not specified`)(),t||e.name}(t);Object.defineProperties(e,{id:{writable:!0,value:n}})}(r,e),function(e,t){const n={},s={};for(const r in t){const e=t[r],{name:i,value:o}=e;e.async&&(n[i]=o,s[i]=Ig(i))}e[Dh]=n,e[Bh]={},Object.defineProperties(e,s)}(r,i),function(e,t){for(const n in t)Object.defineProperty(e,n,{enumerable:!1,set(e){const s=`${this.id}: ${n}`;for(const r of t[n])Mg(this,r)||(this[r]=e);On.deprecated(s,t[n].join("/"))()}})}(r,o),r[Oh]=i,r[Fh]=o,0!==t.length||Mg(e,"_propTypes")||(e._propTypes=i),r}(e,t||[]))}function Ig(e){return{enumerable:!0,set(t){"string"==typeof t||t instanceof Promise||Hp(t)?this[Bh][e]=t:this[Uh][e]=t},get(){if(this[Uh]){if(e in this[Uh])return this[Uh][e]||this[Dh][e];if(e in this[Bh]){const t=this[Nh]&&this[Nh].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[Dh][e]}}return this[Dh][e]}}}function Mg(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Lg(e,t){return Mg(e,t)&&e[t]}let Ng=0;class Og{constructor(...e){this.props=function(e,t){let n;for(let i=t.length-1;i>=0;i--){const e=t[i];"extensions"in e&&(n=e.extensions)}const s=kg(e.constructor,n),r=Object.create(s);r[Nh]=e,r[Bh]={},r[Uh]={};for(let i=0;i<t.length;++i){const e=t[i];for(const t in e)r[t]=e[t]}return Object.freeze(r),r}(this,e),this.id=this.props.id,this.count=Ng++}clone(e){const{props:t}=this,n={};for(const s in t[Dh])s in t[Uh]?n[s]=t[Uh][s]:s in t[Bh]&&(n[s]=t[Bh][s]);return new this.constructor({...t,...n,...e})}}Og.componentName="Component",Og.defaultProps={};const Fg=Object.freeze({});class Dg{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||Fg}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return Boolean(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[Nh]||this.component;const t=e[Uh]||{},n=e[Bh]||e,s=e[Dh]||{};for(const r in t){const e=t[r];this._createAsyncPropData(r,s[r]),this._updateAsyncProp(r,e),t[r]=this.getAsyncProp(r)}for(const r in n){const e=n[r];this._createAsyncPropData(r,s[r]),this._updateAsyncProp(r,e)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){this._didAsyncInputValueChange(e,t)&&("string"==typeof t&&(t=this._fetch(e,t)),t instanceof Promise?this._watchPromise(e,t):Hp(t)?this._resolveAsyncIterable(e,t):this._setPropValue(e,t))}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const n=this.asyncProps[e];return t!==n.resolvedValue&&t!==n.lastValue&&(n.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(t=this._postProcessValue(n,t),n.resolvedValue=t,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,t,n){const s=this.asyncProps[e];s&&n>=s.resolvedLoadCount&&void 0!==t&&(this._freezeAsyncOldProps(),s.resolvedValue=t,s.resolvedLoadCount=n,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const s=n.pendingLoadCount;t.then(t=>{this.component&&(t=this._postProcessValue(n,t),this._setAsyncPropValue(e,t,s),this._onResolve(e,t))}).catch(t=>{this._onError(e,t)})}}async _resolveAsyncIterable(e,t){if("data"!==e)return void this._setPropValue(e,t);const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const s=n.pendingLoadCount;let r=[],i=0;for await(const o of t){if(!this.component)return;const{dataTransform:t}=this.component.props;r=t?t(o,r):r.concat(o),Object.defineProperty(r,"__diff",{enumerable:!1,value:[{startRow:i,endRow:r.length}]}),i=r.length,this._setAsyncPropValue(e,r,s)}this._onResolve(e,r)}_postProcessValue(e,t){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(t,n,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const n=this.component&&this.component.props[Oh];this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class Bg extends Dg{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const n=this.layer,s=null==n?void 0:n.props.fetch;return s?s(t,{propName:e,layer:n}):super._fetch(e,t)}_onResolve(e,t){const n=this.layer;if(n){const s=n.props.onDataLoad;"data"===e&&s&&s(t,{propName:e,layer:n})}}_onError(e,t){const n=this.layer;n&&n.raiseError(t,`loading ${e} of ${this.layer}`)}}const Ug=2**24-1,jg=Object.freeze([]),Gg=Tc(({oldViewport:e,viewport:t})=>e.equals(t));let Vg=new Uint8ClampedArray(0);const zg={data:{type:"data",value:jg,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:n,loaders:s,loadOptions:r,signal:i})=>{const{resourceManager:o}=n.context;r=r||n.getLoadOptions(),s=s||n.props.loaders,i&&(r={...r,fetch:{...null==r?void 0:r.fetch,signal:i}});let a=o.contains(e);return a||r||(o.add({resourceId:e,data:_n(e,s),persistent:!1}),a=!0),a?o.subscribe({resourceId:e,onChange:e=>{var s;return null==(s=n.internalState)?void 0:s.reloadAsyncProp(t,e)},consumerId:n.id,requestId:t}):_n(e,s,r)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:yc.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,100*-e]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Wg extends Og{constructor(){super(...arguments),this.internalState=null,this.lifecycle="Awaiting state",this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){nd(this.internalState);const t=this.internalState.viewport||this.context.viewport,n=eh(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,r,i]=ru(n,t.pixelProjectionMatrix);return 2===e.length?[s,r]:[s,r,i]}unproject(e){return nd(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){return nd(this.internalState),function(e,t){const{viewport:n,coordinateSystem:s,coordinateOrigin:r,modelMatrix:i,fromCoordinateSystem:o,fromCoordinateOrigin:a}=function(e){const{viewport:t,modelMatrix:n,coordinateOrigin:s}=e;let{coordinateSystem:r,fromCoordinateSystem:i,fromCoordinateOrigin:o}=e;return r===yc.DEFAULT&&(r=t.isGeospatial?yc.LNGLAT:yc.CARTESIAN),void 0===i&&(i=r),void 0===o&&(o=s),{viewport:t,coordinateSystem:r,coordinateOrigin:s,modelMatrix:n,fromCoordinateSystem:i,fromCoordinateOrigin:o}}(t),{autoOffset:l=!0}=t,{geospatialOrigin:c=Qu,shaderCoordinateOrigin:u=Qu,offsetMode:h=!1}=l?Ic(n,s,r):{},d=eh(e,{viewport:n,modelMatrix:i,coordinateSystem:o,coordinateOrigin:a,offsetMode:h});if(h){const e=n.projectPosition(c||u);ja(d,d,e)}return d}(e,{viewport:this.internalState.viewport||this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return!!this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===yc.DEFAULT||e===yc.LNGLAT||e===yc.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){nd(e instanceof Uint8Array);const[t,n,s]=e;return t+256*n+65536*s-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:function(e){if(null===(t=e)||"object"!=typeof t)throw new Error("count(): argument not an object");var t;if("function"==typeof e.count)return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(function(e){return null!==e&&"object"==typeof e&&e.constructor===Object}(e))return Object.keys(e).length;throw new Error("count(): argument not a container")}(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return null==(e=this.getAttributeManager())?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=wg(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=wg(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&t)if(Array.isArray(n))for(const s of n)t.invalidateAll(s);else t.invalidateAll();if(t){const{props:n}=e,s=this.internalState.hasPickingBuffer,r=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(e=>e.getNeedsPickingBuffer.call(this,e));if(s!==r){this.internalState.hasPickingBuffer=r;const{pickingColors:e,instancePickingColors:n}=t.attributes,s=e||n;s&&(r&&s.constant&&(s.constant=!1,t.invalidate(s.id)),s.value||r||(s.constant=!0,s.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:n}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,t){var n,s,r,i;t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),(null==(s=(n=this.props).onError)?void 0:s.call(n,e))||null==(i=null==(r=this.context)?void 0:r.onError)||i.call(r,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return!!this.internalState&&(this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()))}hasUniformTransition(){var e;return(null==(e=this.internalState)?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,t&&Gg({oldViewport:t,viewport:e})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&("all"===e?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const n in e)e[n].layoutChanged()&&(t=!0);for(const n of this.getModels())this._setModelAttributes(n,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,n=this.getNumInstances(),s=this.getStartIndices();e.update({data:t.data,numInstances:n,startIndices:s,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const r=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(r)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),n=Object.create(this.props);for(const e in t)Object.defineProperty(n,e,{value:t[e]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const n=Math.floor(Vg.length/4);if(this.internalState.usesPickingColorCache=!0,n<t){t>Ug&&On.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Vg=Uu.allocate(Vg,t,{size:4,copy:!0,maxCount:Math.max(t,Ug)});const e=Math.floor(Vg.length/4),s=[0,0,0];for(let t=n;t<e;t++)this.encodePickingColor(t,s),Vg[4*t+0]=s[0],Vg[4*t+1]=s[1],Vg[4*t+2]=s[2],Vg[4*t+3]=0}e.value=Vg.subarray(0,4*t)}_setModelAttributes(e,t,n=!1){var s;if(!Object.keys(t).length)return;if(n){const n=this.getAttributeManager();e.setBufferLayout(n.getBufferLayouts(e)),t=n.getAttributes()}const r=(null==(s=e.userData)?void 0:s.excludeAttributes)||{},i={},o={};for(const a in t){if(r[a])continue;const n=t[a].getValue();for(const s in n){const r=n[s];r instanceof Ps?t[a].settings.isIndexed?e.setIndexBuffer(r):i[s]=r:r&&(o[s]=r)}}e.setAttributes(i),e.setConstantAttributes(o)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t))return void this._disablePickingIndex(e);const{pickingColors:n,instancePickingColors:s}=this.getAttributeManager().attributes,r=n||s,i=r&&t.attributes&&t.attributes[r.id];if(i&&i.value){const n=i.value,s=this.encodePickingColor(e);for(let e=0;e<t.length;e++){const t=r.getVertexOffset(e);n[t]===s[0]&&n[t+1]===s[1]&&n[t+2]===s[2]&&this._disablePickingIndex(e)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:n}=this.getAttributeManager().attributes,s=t||n;if(!s)return;const r=s.getVertexOffset(e),i=s.getVertexOffset(e+1);s.buffer.write(new Uint8Array(i-r),r)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,n=e||t;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==Vg.buffer&&(n.value=Vg.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){nd(!this.internalState),nd(Number.isFinite(this.props.coordinateSystem)),Bn("layer.initialize",this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Bg({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(On.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new mg(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Bn("layer.matched",this,this===e);const{state:t,internalState:n}=e;this!==e&&(this.internalState=n,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Bn("layer.update",this,e),!e)return;const t=this.props,n=this.context,s=this.internalState,r=n.viewport,i=this._updateUniformTransition();s.propsInTransition=i,n.viewport=s.viewport||r,this.props=i;try{const e=this._getUpdateParams(),t=this.getModels();if(n.device)this.updateState(e);else try{this.updateState(e)}catch(o){}for(const n of this.props.extensions)n.updateState.call(this,e,n);this.setNeedsRedraw(),this._updateAttributes();const s=this.getModels()[0]!==t[0];this._postUpdate(e,s)}finally{n.viewport=r,this.props=t,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){Bn("layer.finalize",this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:n={},parameters:s={}}){this._updateAttributeTransition();const r=this.props,i=this.context;this.props=this.internalState.propsInTransition||r;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:r}=this.props,o=r&&r(n)||[0,0];i.device instanceof Mp&&i.device.setParametersWebGL({polygonOffset:o});for(const e of this.getModels())"webgpu"===e.device.type?e.setParameters({...e.parameters,...s}):e.setParameters(s);if(i.device instanceof Mp)i.device.withParametersWebGL(s,()=>{const r={renderPass:e,shaderModuleProps:t,uniforms:n,parameters:s,context:i};for(const e of this.props.extensions)e.draw.call(this,r,e);this.draw(r)});else{const r={renderPass:e,shaderModuleProps:t,uniforms:n,parameters:s,context:i};for(const e of this.props.extensions)e.draw.call(this,r,e);this.draw(r)}}finally{this.props=r}}getChangeFlags(){var e;return null==(e=this.internalState)?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const s in e)if(e[s]){let n=!1;if("dataChanged"===s){const r=e[s],i=t[s];r&&Array.isArray(i)&&(t.dataChanged=Array.isArray(r)?i.concat(r):r,n=!0)}t[s]||(t[s]=e[s],n=!0),n&&Bn("layer.changeFlag",this,s,e)}const n=Boolean(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=n,t.somethingChanged=n||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){var n;const s=function(e,t){const n=yg({newProps:e,oldProps:t,propTypes:e[Oh],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),s=function(e,t){if(null===t)return"oldProps is null, initial diff";let n=!1;const{dataComparator:s,_dataDiff:r}=e;return s?s(e.data,t.data)||(n="Data comparator detected a change"):e.data!==t.data&&(n="A new data container was supplied"),n&&r&&(n=r(e.data,t.data)||n),n}(e,t);let r=!1;return s||(r=function(e,t){if(null===t)return{all:!0};if("all"in e.updateTriggers&&xg(e,t,"all"))return{all:!0};const n={};let s=!1;for(const r in e.updateTriggers)"all"!==r&&xg(e,t,r)&&(n[r]=!0,s=!0);return!!s&&n}(e,t)),{dataChanged:s,propsChanged:n,updateTriggersChanged:r,extensionsChanged:vg(e,t),transitionsChanged:_g(e,t)}}(e,t);if(s.updateTriggersChanged)for(const r in s.updateTriggersChanged)s.updateTriggersChanged[r]&&this.invalidateAttribute(r);if(s.transitionsChanged)for(const r in s.transitionsChanged)this.internalState.uniformTransitions.add(r,t[r],e[r],null==(n=e.transitions)?void 0:n[r]);return this.setChangeFlags(s)}validateProps(){!function(e){const t=e[Oh];for(const n in t){const s=t[n],{validate:r}=s;if(r&&!r(e[n],s))throw new Error(`Invalid prop ${n}: ${e[n]}`)}}(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&"function"==typeof n&&(t.highlightColor=n(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new hg(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:n,oldProps:s}=e,r=this.state.model;(null==r?void 0:r.isInstanced)&&r.setInstanceCount(this.getNumInstances());const{autoHighlight:i,highlightedObjectIndex:o,highlightColor:a}=n;if(t||s.autoHighlight!==i||s.highlightedObjectIndex!==o||s.highlightColor!==a){const e={};Array.isArray(a)&&(e.highlightColor=a),(t||s.autoHighlight!==i||o!==s.highlightedObjectIndex)&&(e.highlightedObjectColor=Number.isFinite(o)&&o>=0?this.encodePickingColor(o):null),this.setShaderModuleProps({picking:e})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),s=!!n&&n.getNeedsRedraw(e);if(t=t||s,t)for(const r of this.props.extensions)r.onNeedsRedraw.call(this,r);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Wg.defaultProps=zg,Wg.layerName="Layer";const Hg=Math.PI/180,$g=180/Math.PI,Xg=6370972,qg=256;function Yg(){const e=4018225162502676e-20,t=Math.PI/180*qg;return{unitsPerMeter:[e,e,e],unitsPerMeter2:[0,0,0],metersPerUnit:[24886.609375,24886.609375,24886.609375],unitsPerDegree:[t,t,e],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,24886.609375]}}class Kg extends Ku{constructor(e={}){const{longitude:t=0,zoom:n=0,nearZMultiplier:s=.5,farZMultiplier:r=1,resolution:i=10}=e;let{latitude:o=0,height:a,altitude:l=1.5,fovy:c}=e;o=Math.max(Math.min(o,Yc),-85.051129),a=a||1,c?l=su(c):c=nu(l);const u=1/Math.PI/Math.cos(o*Math.PI/180),h=Math.pow(2,n)*u,d=e.nearZ??s,f=e.farZ??(l+512*h/a)*r,p=(new al).lookAt({eye:[0,-l,0],up:[0,0,1]});p.rotateX(o*Hg),p.rotateZ(-t*Hg),p.scale(h/a),super({...e,height:a,viewMatrix:p,longitude:t,latitude:o,zoom:n,distanceScales:Yg(),fovy:c,focalDistance:l,near:d,far:f}),this.scale=h,this.latitude=o,this.longitude=t,this.resolution=i}get projectionMode(){return bc.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,this.height/2],t),s=this.unproject([this.width/2,0],t),r=this.unproject([this.width,this.height/2],t),i=this.unproject([this.width/2,this.height],t);return r[0]<this.longitude&&(r[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],r[0],s[0],i[0]),Math.min(n[1],r[1],s[1],i[1]),Math.max(n[0],r[0],s[0],i[0]),Math.max(n[1],r[1],s[1],i[1])]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[s,r,i]=e,o=t?r:this.height-r,{pixelUnprojectionMatrix:a}=this;let l;if(Number.isFinite(i))l=Zg(a,[s,o,i,1]);else{const e=Zg(a,[s,o,-1,1]),t=Zg(a,[s,o,1,1]),r=((n||0)/Xg+1)*qg,i=Ga(ja([],e,t)),c=Ga(e),u=Ga(t),h=(4*c*u-(i-c-u)**2)/16*4/i;l=function(e,t,n,s){const r=t[0],i=t[1],o=t[2];return e[0]=r+s*(n[0]-r),e[1]=i+s*(n[1]-i),e[2]=o+s*(n[2]-o),e}([],e,t,(Math.sqrt(c-h)-Math.sqrt(Math.max(0,r*r-h)))/Math.sqrt(i))}const[c,u,h]=this.unprojectPosition(l);return Number.isFinite(i)?[c,u,h]:Number.isFinite(n)?[c,u,n]:[c,u]}projectPosition(e){const[t,n,s=0]=e,r=t*Hg,i=n*Hg,o=Math.cos(i),a=(s/Xg+1)*qg;return[Math.sin(r)*o*a,-Math.cos(r)*o*a,Math.sin(i)*a]}unprojectPosition(e){const[t,n,s]=e,r=function(e){const t=e[0],n=e[1],s=e[2];return Math.sqrt(t*t+n*n+s*s)}(e),i=Math.asin(s/r);return[Math.atan2(t,-n)*$g,i*$g,(r/qg-1)*Xg]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const n=this.unproject(t);return{longitude:e[0]-n[0]+this.longitude,latitude:e[1]-n[1]+this.latitude}}}function Zg(e,t){const n=Ja([],t,e);return Qa(n,n,1/n[3]),n}class Qg extends yd{applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:s}=e;e.zoom=Aa(s,n,t);const{longitude:r,latitude:i}=e;return(r<-180||r>180)&&(e.longitude=function(e){const t=e%360;return t<0?360+t:t}(r+180)-180),e.latitude=Aa(i,-85.051129,Yc),e}}class Jg extends md{constructor(){super(...arguments),this.ControllerState=Qg,this.transition={transitionDuration:300,transitionInterpolator:new od(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}}class em extends Zh{constructor(e={}){super(e)}getViewportType(e){return e.zoom>12?Zu:Kg}get ControllerType(){return Jg}}em.displayName="GlobeView";class tm{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=Uu,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:n={},getGeometry:s,geometryBuffer:r,positionFormat:i,dataChanged:o,normalize:a=!0}=this.opts;if(this.data=t,this.getGeometry=s,this.positionSize=r&&r.size||("XY"===i?2:3),this.buffers=n,this.normalize=a,r&&(nd(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(r),a||(n.vertexPositions=r)),this.geometryBuffer=n.vertexPositions,Array.isArray(o))for(const l of o)this._rebuildGeometry(l);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?$p(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:n,buffers:s,_attributeDefs:r,typedArrayManager:i}=this;for(const o in r)if(o in s)i.release(n[o]),n[o]=null;else{const s=r[o];s.copy=t,n[o]=i.allocate(n[o],e,s)}}_forEachGeometry(e,t,n){const{data:s,getGeometry:r}=this,{iterable:i,objectInfo:o}=Wp(s,t,n);for(const a of i)o.index++,e(r?r(a,o):null,o.index)}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:n,instanceCount:s}=this;const{data:r,geometryBuffer:i}=this,{startRow:o=0,endRow:a=1/0}=e||{},l={};if(e||(t=[0],n=[0]),this.normalize||!i)this._forEachGeometry((e,t)=>{const s=e&&this.normalizeGeometry(e);l[t]=s,n[t+1]=n[t]+(s?this.getGeometrySize(s):0)},o,a),s=n[n.length-1];else if(n=r.startIndices,s=n[r.length]||0,ArrayBuffer.isView(i))s=s||i.length/this.positionSize;else if(i instanceof Ps){const e=4*this.positionSize;s=s||i.byteLength/e}else if(i.buffer){const e=i.stride||4*this.positionSize;s=s||i.buffer.byteLength/e}else if(i.value){const e=i.value,t=i.stride/e.BYTES_PER_ELEMENT||this.positionSize;s=s||e.length/t}this._allocate(s,Boolean(e)),this.indexStarts=t,this.vertexStarts=n,this.instanceCount=s;const c={};this._forEachGeometry((e,r)=>{const i=l[r]||e;c.vertexStart=n[r],c.indexStart=t[r];const o=r<n.length-1?n[r+1]:s;c.geometrySize=o-n[r],c.geometryIndex=r,this.updateGeometryAttributes(i,c)},o,a),this.vertexCount=t[t.length-1]}}const nm="mapbox",sm=Math.PI/180;function rm({map:e,gl:t,deck:n}){if(e.__deck)return e.__deck;const s=null==n?void 0:n.props._customRender,r=null==n?void 0:n.props.onLoad,i={...null==n?void 0:n.props,_customRender:()=>{e.triggerRepaint(),null==s||s("")}};let o;return i.parameters={...am(e,!0),...i.parameters},i.views||(i.views=cm(e)),n&&n.props.gl!==t||(Object.assign(i,{gl:t,width:null,height:null,touchAction:"unset",viewState:um(e)}),(null==n?void 0:n.isInitialized)?im(n,e):i.onLoad=()=>{null==r||r(),im(o,e)}),n?(o=n,n.setProps(i),n.userData.isExternal=!0):(o=new Fp(i),e.on("remove",()=>{om(e)})),o.userData.mapboxLayers=new Set,e.__deck=o,e.on("render",()=>{o.isInitialized&&function(e,t){const{mapboxLayers:n,isExternal:s}=e.userData;if(s){const s=Array.from(n,e=>e.id),r=jh(e.props.layers,Boolean).some(e=>e&&!s.includes(e.id));let i=e.getViewports();const o=i.findIndex(e=>e.id===nm),a=i.length>1||o<0;(r||a)&&(o>=0&&(i=i.slice(),i[o]=hm(e,t)),e._drawLayers("mapbox-repaint",{viewports:i,layerFilter:t=>(!e.props.layerFilter||e.props.layerFilter(t))&&(t.viewport.id!==nm||!s.includes(t.layer.id)),clearCanvas:!1}))}e.userData.currentViewport=null}(o,e)}),o}function im(e,t){const n=()=>{e.isInitialized?function(e,t){e.setProps({viewState:um(t)}),e.needsRedraw({clearRedrawFlags:!0})}(e,t):t.off("move",n)};t.on("move",n)}function om(e){var t;null==(t=e.__deck)||t.finalize(),e.__deck=null}function am(e,t){const n=t?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return"globe"===lm(e)&&(n.cullMode="back"),n}function lm(e){var t;const n=null==(t=e.getProjection)?void 0:t.call(e),s=(null==n?void 0:n.type)||(null==n?void 0:n.name);if("globe"===s)return"globe";if(s&&"mercator"!==s)throw new Error("Unsupported projection");return"mercator"}function cm(e){return"globe"===lm(e)?new em({id:nm}):new vd({id:nm})}function um(e){var t;const{lng:n,lat:s}=e.getCenter(),r={longitude:(n+540)%360-180,latitude:s,zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch(),padding:e.getPadding(),repeat:e.getRenderWorldCopies()};return(null==(t=e.getTerrain)?void 0:t.call(e))&&function(e,t){if(e.getFreeCameraOptions){const{position:n}=e.getFreeCameraOptions();if(!n||void 0===n.z)return;const s=e.transform.height,{longitude:r,latitude:i,pitch:o}=t,a=512*n.x,l=512*(1-n.y),c=512*n.z,u=Zc([r,i]),h=a-u[0],d=l-u[1],f=Math.sqrt(h*h+d*d),p=o*sm,g=1.5*s,m=p<.001?g*Math.cos(p)/c:g*Math.sin(p)/f;t.zoom=Math.log2(m);const _=c-g*Math.cos(p)/m;t.position=[0,0,_/Jc(i)]}else"number"==typeof e.transform.elevation&&(t.position=[0,0,e.transform.elevation])}(e,r),r}function hm(e,t,n){const s=um(t),{views:r}=e.props,i=r&&jh(r).find(e=>e.id===nm)||cm(t);n&&(i.props.nearZMultiplier=.2);const o=(null==n?void 0:n.nearZ)??t.transform._nearZ,a=(null==n?void 0:n.farZ)??t.transform._farZ;return Number.isFinite(o)&&(s.nearZ=o/t.transform.height,s.farZ=a/t.transform.height),i.makeViewport({width:e.width,height:e.height,viewState:s})}function dm(e){if(e.userData.isExternal)return;const t=[];e.userData.mapboxLayers.forEach(e=>{const n=new(0,e.props.type)(e.props);t.push(n)}),e.setProps({layers:t})}class fm{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.map=null,this.deck=null,this.props=e}onAdd(e,t){var n;this.map=e,this.deck=rm({map:e,gl:t,deck:this.props.deck}),(n=this.deck).userData.mapboxLayers.add(this),dm(n)}onRemove(){var e;this.deck&&((e=this.deck).userData.mapboxLayers.delete(this),dm(e))}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&dm(this.deck)}render(e,t){!function(e,t,n,s){let{currentViewport:r}=e.userData,i=!1;r||(r=hm(e,t,s),e.userData.currentViewport=r,i=!0),e.isInitialized&&e._drawLayers("mapbox-repaint",{viewports:[r],layerFilter:t=>(!e.props.layerFilter||e.props.layerFilter(t))&&(n.id===t.layer.id||t.layer.props.operation.includes("terrain")),clearStack:i,clearCanvas:!1})}(this.deck,this.map,this,t)}}const pm="__UNDEFINED__";function gm(e,t,n,s){if(!(e&&t&&e.style&&e.style._loaded))return;const r=jh(s,Boolean);if(n!==s){const t=jh(n,Boolean),s=new Set(t.map(e=>e.id));for(const e of r)s.delete(e.id);for(const n of s)e.getLayer(n)&&e.removeLayer(n)}for(const a of r){const n=e.getLayer(a.id);n?(n.implementation||n).setProps(a.props):e.addLayer(new fm({id:a.id,deck:t,slot:a.props.slot}),a.props.beforeId)}const i=e.style._order,o={};for(const a of r){let{beforeId:e}=a.props;e&&i.includes(e)||(e=pm),o[e]=o[e]||[],o[e].push(a.id)}for(const a in o){const t=o[a];let n=a===pm?i.length:i.indexOf(a),s=a===pm?void 0:a;for(let r=t.length-1;r>=0;r--){const o=t[r],a=i.indexOf(o);a!==n-1&&(e.moveLayer(o,s),a>n&&n++),n--,s=o}}}class mm{constructor(e){this._handleStyleChange=()=>{var e;gm(this._map,this._deck,this._props.layers,this._props.layers),this._map&&lm(this._map)&&!this._props.views&&(null==(e=this._deck)||e.setProps({views:cm(this._map)}))},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:e,clientHeight:t}=this._map.getContainer();Object.assign(this._container.style,{width:`${e}px`,height:`${t}px`})}},this._updateViewState=()=>{const e=this._deck,t=this._map;e&&t&&(e.setProps({views:this._props.views||cm(t),viewState:um(t)}),e.isInitialized&&e.redraw())},this._handleMouseEvent=e=>{const t=this._deck;if(!t||!t.isInitialized)return;const n={type:e.type,offsetCenter:e.point,srcEvent:e},s=this._lastMouseDownPoint;switch(!e.point&&s&&(n.deltaX=e.originalEvent.clientX-s.clientX,n.deltaY=e.originalEvent.clientY-s.clientY,n.offsetCenter={x:s.x+n.deltaX,y:s.y+n.deltaY}),n.type){case"mousedown":t._onPointerDown(n),this._lastMouseDownPoint={...e.point,clientX:e.originalEvent.clientX,clientY:e.originalEvent.clientY};break;case"dragstart":n.type="panstart",t._onEvent(n);break;case"drag":n.type="panmove",t._onEvent(n);break;case"dragend":n.type="panend",t._onEvent(n);break;case"click":n.tapCount=1,t._onEvent(n);break;case"dblclick":n.type="click",n.tapCount=2,t._onEvent(n);break;case"mousemove":n.type="pointermove",t._onPointerMove(n);break;case"mouseout":n.type="pointerleave",t._onPointerMove(n);break;default:return}};const{interleaved:t=!1}=e;this._interleaved=t,this._props=this.filterProps(e)}filterProps(e){const{interleaved:t=!1,useDevicePixels:n,...s}=e;return t||void 0===n||(s.useDevicePixels=n),s}setProps(e){this._interleaved&&e.layers&&gm(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,this.filterProps(e)),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...am(this._map,this._interleaved),...this._props.parameters}})}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const t=document.createElement("div");return Object.assign(t.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=t,this._deck=new Fp({...this._props,parent:t,parameters:{...am(e,!1),...this._props.parameters},views:this._props.views||cm(e),viewState:um(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),t}_onAddInterleaved(e){const t=e.painter.context.gl;return t instanceof WebGLRenderingContext&&On.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=rm({map:e,gl:t,deck:new Fp({...this._props,gl:t,parameters:{...am(e,!0),...this._props.parameters}})}),e.on("styledata",this._handleStyleChange),gm(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){var t;e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),null==(t=this._deck)||t.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),gm(e,this._deck,this._props.layers,[]),om(e)}getDefaultPosition(){return"top-left"}pickObject(e){return nd(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return nd(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return nd(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}const _m="uniform scatterplotUniforms {\n  float radiusScale;\n  float radiusMinPixels;\n  float radiusMaxPixels;\n  float lineWidthScale;\n  float lineWidthMinPixels;\n  float lineWidthMaxPixels;\n  float stroked;\n  float filled;\n  bool antialiasing;\n  bool billboard;\n  highp int radiusUnits;\n  highp int lineWidthUnits;\n} scatterplot;\n",ym={name:"scatterplot",vs:_m,fs:_m,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},bm=[0,0,0,255],vm={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:bm},getLineColor:{type:"accessor",value:bm},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class xm extends Wg{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME scatterplot-layer-vertex-shader\nin vec3 positions;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin float instanceRadius;\nin float instanceLineWidths;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin vec3 instancePickingColors;\nout vec4 vFillColor;\nout vec4 vLineColor;\nout vec2 unitPosition;\nout float innerUnitRadius;\nout float outerRadiusPixels;\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\nouterRadiusPixels = clamp(\nproject_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),\nscatterplot.radiusMinPixels, scatterplot.radiusMaxPixels\n);\nfloat lineWidthPixels = clamp(\nproject_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),\nscatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels\n);\nouterRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;\nfloat edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;\nunitPosition = edgePadding * positions.xy;\ngeometry.uv = unitPosition;\ngeometry.pickingColor = instancePickingColors;\ninnerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;\nif (scatterplot.billboard) {\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nvec3 offset = edgePadding * positions * outerRadiusPixels;\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n} else {\nvec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nvFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);\nDECKGL_FILTER_COLOR(vFillColor, geometry);\nvLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);\nDECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME scatterplot-layer-fragment-shader\nprecision highp float;\nin vec4 vFillColor;\nin vec4 vLineColor;\nin vec2 unitPosition;\nin float innerUnitRadius;\nin float outerRadiusPixels;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = unitPosition;\nfloat distToCenter = length(unitPosition) * outerRadiusPixels;\nfloat inCircle = scatterplot.antialiasing ?\nsmoothedge(distToCenter, outerRadiusPixels) :\nstep(distToCenter, outerRadiusPixels);\nif (inCircle == 0.0) {\ndiscard;\n}\nif (scatterplot.stroked > 0.5) {\nfloat isLine = scatterplot.antialiasing ?\nsmoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :\nstep(innerUnitRadius * outerRadiusPixels, distToCenter);\nif (scatterplot.filled > 0.5) {\nfragColor = mix(vFillColor, vLineColor, isLine);\n} else {\nif (isLine == 0.0) {\ndiscard;\n}\nfragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);\n}\n} else if (scatterplot.filled < 0.5) {\ndiscard;\n} else {\nfragColor = vFillColor;\n}\nfragColor.a *= inCircle;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",source:"// Main shaders\n\nstruct ScatterplotUniforms {\n  radiusScale: f32,\n  radiusMinPixels: f32,\n  radiusMaxPixels: f32,\n  lineWidthScale: f32,\n  lineWidthMinPixels: f32,\n  lineWidthMaxPixels: f32,\n  stroked: f32,\n  filled: i32,\n  antialiasing: i32,\n  billboard: i32,\n  radiusUnits: i32,\n  lineWidthUnits: i32,\n};\n\nstruct ConstantAttributeUniforms {\n instancePositions: vec3<f32>,\n instancePositions64Low: vec3<f32>,\n instanceRadius: f32,\n instanceLineWidths: f32,\n instanceFillColors: vec4<f32>,\n instanceLineColors: vec4<f32>,\n instancePickingColors: vec3<f32>,\n\n instancePositionsConstant: i32,\n instancePositions64LowConstant: i32,\n instanceRadiusConstant: i32,\n instanceLineWidthsConstant: i32,\n instanceFillColorsConstant: i32,\n instanceLineColorsConstant: i32,\n instancePickingColorsConstant: i32\n};\n\n@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;\n\nstruct ConstantAttributes {\n  instancePositions: vec3<f32>,\n  instancePositions64Low: vec3<f32>,\n  instanceRadius: f32,\n  instanceLineWidths: f32,\n  instanceFillColors: vec4<f32>,\n  instanceLineColors: vec4<f32>,\n  instancePickingColors: vec3<f32>\n};\n\nconst constants = ConstantAttributes(\n  vec3<f32>(0.0),\n  vec3<f32>(0.0),\n  0.0,\n  0.0,\n  vec4<f32>(0.0, 0.0, 0.0, 1.0),\n  vec4<f32>(0.0, 0.0, 0.0, 1.0),\n  vec3<f32>(0.0)\n);\n\nstruct Attributes {\n  @builtin(instance_index) instanceIndex : u32,\n  @builtin(vertex_index) vertexIndex : u32,\n  @location(0) positions: vec3<f32>,\n  @location(1) instancePositions: vec3<f32>,\n  @location(2) instancePositions64Low: vec3<f32>,\n  @location(3) instanceRadius: f32,\n  @location(4) instanceLineWidths: f32,\n  @location(5) instanceFillColors: vec4<f32>,\n  @location(6) instanceLineColors: vec4<f32>,\n  @location(7) instancePickingColors: vec3<f32>\n};\n\nstruct Varyings {\n  @builtin(position) position: vec4<f32>,\n  @location(0) vFillColor: vec4<f32>,\n  @location(1) vLineColor: vec4<f32>,\n  @location(2) unitPosition: vec2<f32>,\n  @location(3) innerUnitRadius: f32,\n  @location(4) outerRadiusPixels: f32,\n};\n\n@vertex\nfn vertexMain(attributes: Attributes) -> Varyings {\n  var varyings: Varyings;\n\n  // Draw an inline geometry constant array clip space triangle to verify that rendering works.\n  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));\n  // if (attributes.instanceIndex == 0) {\n  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);\n  //   return varyings;\n  // }\n\n  // var geometry: Geometry;\n  // geometry.worldPosition = instancePositions;\n\n  // Multiply out radius and clamp to limits\n  varyings.outerRadiusPixels = clamp(\n    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),\n    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels\n  );\n\n  // Multiply out line width and clamp to limits\n  let lineWidthPixels = clamp(\n    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),\n    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels\n  );\n\n  // outer radius needs to offset by half stroke width\n  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;\n  // Expand geometry to accommodate edge smoothing\n  let edgePadding = select(\n    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,\n    1.0,\n    scatterplot.antialiasing != 0\n  );\n\n  // position on the containing square in [-1, 1] space\n  varyings.unitPosition = edgePadding * attributes.positions.xy;\n  geometry.uv = varyings.unitPosition;\n  geometry.pickingColor = attributes.instancePickingColors;\n\n  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;\n\n  if (scatterplot.billboard != 0) {\n    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);\n    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);\n    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;\n    // DECKGL_FILTER_SIZE(offset, geometry);\n    let clipPixels = project_pixel_size_to_clipspace(offset.xy);\n    varyings.position.x = clipPixels.x;\n    varyings.position.y = clipPixels.y;\n  } else {\n    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);\n    // DECKGL_FILTER_SIZE(offset, geometry);\n    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);\n    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);\n  }\n\n  // Apply opacity to instance color, or return instance picking color\n  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * color.opacity);\n  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);\n  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * color.opacity);\n  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);\n\n  return varyings;\n}\n\n@fragment\nfn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {\n  // var geometry: Geometry;\n  // geometry.uv = unitPosition;\n\n  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;\n  let inCircle = select(\n    smoothedge(distToCenter, varyings.outerRadiusPixels),\n    step(distToCenter, varyings.outerRadiusPixels),\n    scatterplot.antialiasing != 0\n  );\n\n  if (inCircle == 0.0) {\n    discard;\n  }\n\n  var fragColor: vec4<f32>;\n\n  if (scatterplot.stroked != 0) {\n    let isLine = select(\n      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),\n      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),\n      scatterplot.antialiasing != 0\n    );\n\n    if (scatterplot.filled != 0) {\n      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);\n    } else {\n      if (isLine == 0.0) {\n        discard;\n      }\n      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);\n    }\n  } else if (scatterplot.filled == 0) {\n    discard;\n  } else {\n    fragColor = varyings.vFillColor;\n  }\n\n  fragColor.a *= inCircle;\n  // DECKGL_FILTER_COLOR(fragColor, geometry);\n\n  // Apply premultiplied alpha as required by transparent canvas\n  fragColor = deckgl_premultiplied_alpha(fragColor);\n\n  return fragColor;\n  // return vec4<f32>(0, 0, 1, 1);\n}\n",modules:[Bc,ml,mu,ym]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&(null==(t=this.state.model)||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:n,radiusMinPixels:s,radiusMaxPixels:r,stroked:i,filled:o,billboard:a,antialiasing:l,lineWidthUnits:c,lineWidthScale:u,lineWidthMinPixels:h,lineWidthMaxPixels:d}=this.props,f={stroked:i,filled:o,billboard:a,antialiasing:l,radiusUnits:vc[t],radiusScale:n,radiusMinPixels:s,radiusMaxPixels:r,lineWidthUnits:vc[c],lineWidthScale:u,lineWidthMinPixels:h,lineWidthMaxPixels:d},p=this.state.model;p.shaderInputs.setProps({scatterplot:f}),"webgpu"===this.context.device.type&&(p.instanceCount=this.props.data.length),p.draw(this.context.renderPass)}_getModel(){const e="webgpu"===this.context.device.type?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0;return new Ah(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new kh({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0])}}}),isInstanced:!0,parameters:e})}}function wm(e,t){const n=t.length,s=e.length;if(s>0){let r=!0;for(let i=0;i<n;i++)if(e[s-n+i]!==t[i]){r=!1;break}if(r)return!1}for(let r=0;r<n;r++)e[s+r]=t[r];return!0}function Em(e,t){const n=t.length;for(let s=0;s<n;s++)e[s]=t[s]}function Tm(e,t,n,s,r=[]){const i=s+t*n;for(let o=0;o<n;o++)r[o]=e[i+o];return r}function Sm(e,t,n,s,r=[]){let i,o;if(8&n)i=(s[3]-e[1])/(t[1]-e[1]),o=3;else if(4&n)i=(s[1]-e[1])/(t[1]-e[1]),o=1;else if(2&n)i=(s[2]-e[0])/(t[0]-e[0]),o=2;else{if(!(1&n))return null;i=(s[0]-e[0])/(t[0]-e[0]),o=0}for(let a=0;a<e.length;a++)r[a]=(1&o)===a?s[o]:i*(t[a]-e[a])+e[a];return r}function Am(e,t){let n=0;return e[0]<t[0]?n|=1:e[0]>t[2]&&(n|=2),e[1]<t[1]?n|=4:e[1]>t[3]&&(n|=8),n}function Rm(e,t){const{size:n=2,broken:s=!1,gridResolution:r=10,gridOffset:i=[0,0],startIndex:o=0,endIndex:a=e.length}=t||{},l=(a-o)/n;let c=[];const u=[c],h=Tm(e,0,n,o);let d,f;const p=function(e,t,n,s){const r=Math.floor((e[0]-n[0])/t)*t+n[0],i=Math.floor((e[1]-n[1])/t)*t+n[1];return s[0]=r,s[1]=i,s[2]=r+t,s[3]=i+t,s}(h,r,i,[]),g=[];wm(c,h);for(let m=1;m<l;m++){for(d=Tm(e,m,n,o,d),f=Am(d,p);f;){Sm(h,d,f,p,g);const e=Am(g,p);e&&(Sm(h,g,e,p,g),f=e),wm(c,g),Em(h,g),Cm(p,r,f),s&&c.length>n&&(c=[],u.push(c),wm(c,h)),f=Am(d,p)}wm(c,d),Em(h,d)}return s?u:u[0]}function Cm(e,t,n){8&n?(e[1]+=t,e[3]+=t):4&n?(e[1]-=t,e[3]-=t):2&n?(e[0]+=t,e[2]+=t):1&n&&(e[0]-=t,e[2]-=t)}function Pm(e,t){let n;const s=e.length/t;for(let i=0;i<s&&(n=e[i*t],(n+180)%360==0);i++);const r=360*-Math.round(n/360);if(0!==r)for(let i=0;i<s;i++)e[i*t]+=r}xm.defaultProps=vm,xm.layerName="ScatterplotLayer";class km extends tm{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?function(e,t,n,s){let r;if(Array.isArray(e[0])){const n=e.length*t;r=new Array(n);for(let s=0;s<e.length;s++)for(let n=0;n<t;n++)r[s*t+n]=e[s][n]||0}else r=e;return n?Rm(r,{size:t,gridResolution:n}):s?function(e,t){const{size:n=2,startIndex:s=0,endIndex:r=e.length,normalize:i=!0}=t||{},o=e.slice(s,r);!function(e,t,n,s){let r,i=e[0];for(let o=0;o<s;o+=t){r=e[o];const t=r-i;(t>180||t<-180)&&(r-=360*Math.round(t/360)),e[o]=i=r}}(o,n,0,r-s);const a=Rm(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(i)for(const l of a)Pm(l,n);return a}(r,{size:t}):r}(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(Im(e)){let t=0;for(const n of e)t+=this.getGeometrySize(n);return t}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(0!==t.geometrySize)if(e&&Im(e))for(const n of e){const e=this.getGeometrySize(n);t.geometrySize=e,this.updateGeometryAttributes(n,t),t.vertexStart+=e}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const n=this.attributes.segmentTypes,s=!!e&&this.isClosed(e),{vertexStart:r,geometrySize:i}=t;n.fill(0,r,r+i),s?(n[r]=4,n[r+i-2]=4):(n[r]+=1,n[r+i-2]+=2),n[r+i-1]=4}_updatePositions(e,t){const{positions:n}=this.attributes;if(!n||!e)return;const{vertexStart:s,geometrySize:r}=t,i=new Array(3);for(let o=s,a=0;a<r;o++,a++)this.getPointOnPath(e,a,i),n[3*o]=i[0],n[3*o+1]=i[1],n[3*o+2]=i[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,n=[]){const{positionSize:s}=this;t*s>=e.length&&(t+=1-e.length/s);const r=t*s;return n[0]=e[r],n[1]=e[r+1],n[2]=3===s&&e[r+2]||0,n}isClosed(e){if(!this.normalize)return Boolean(this.opts.loop);const{positionSize:t}=this,n=e.length-t;return e[0]===e[n]&&e[1]===e[n+1]&&(2===t||e[2]===e[n+2])}}function Im(e){return Array.isArray(e[0])}const Mm="uniform pathUniforms {\n  float widthScale;\n  float widthMinPixels;\n  float widthMaxPixels;\n  float jointType;\n  float capType;\n  float miterLimit;\n  bool billboard;\n  highp int widthUnits;\n} path;\n",Lm={name:"path",vs:Mm,fs:Mm,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},Nm=[0,0,0,255],Om={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:e=>e.path},getColor:{type:"accessor",value:Nm},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Fm={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class Dm extends Wg{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME path-layer-vertex-shader\nin vec2 positions;\nin float instanceTypes;\nin vec3 instanceStartPositions;\nin vec3 instanceEndPositions;\nin vec3 instanceLeftPositions;\nin vec3 instanceRightPositions;\nin vec3 instanceLeftPositions64Low;\nin vec3 instanceStartPositions64Low;\nin vec3 instanceEndPositions64Low;\nin vec3 instanceRightPositions64Low;\nin float instanceStrokeWidths;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nuniform float opacity;\nout vec4 vColor;\nout vec2 vCornerOffset;\nout float vMiterLength;\nout vec2 vPathPosition;\nout float vPathLength;\nout float vJointType;\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\nfloat flipIfTrue(bool flag) {\nreturn -(float(flag) * 2. - 1.);\n}\nvec3 getLineJoinOffset(\nvec3 prevPoint, vec3 currPoint, vec3 nextPoint,\nvec2 width\n) {\nbool isEnd = positions.x > 0.0;\nfloat sideOfPath = positions.y;\nfloat isJoint = float(sideOfPath == 0.0);\nvec3 deltaA3 = (currPoint - prevPoint);\nvec3 deltaB3 = (nextPoint - currPoint);\nmat3 rotationMatrix;\nbool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);\nif (needsRotation) {\ndeltaA3 = deltaA3 * rotationMatrix;\ndeltaB3 = deltaB3 * rotationMatrix;\n}\nvec2 deltaA = deltaA3.xy / width;\nvec2 deltaB = deltaB3.xy / width;\nfloat lenA = length(deltaA);\nfloat lenB = length(deltaB);\nvec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\nvec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\nvec2 perpA = vec2(-dirA.y, dirA.x);\nvec2 perpB = vec2(-dirB.y, dirB.x);\nvec2 tangent = dirA + dirB;\ntangent = length(tangent) > 0. ? normalize(tangent) : perpA;\nvec2 miterVec = vec2(-tangent.y, tangent.x);\nvec2 dir = isEnd ? dirA : dirB;\nvec2 perp = isEnd ? perpA : perpB;\nfloat L = isEnd ? lenA : lenB;\nfloat sinHalfA = abs(dot(miterVec, perp));\nfloat cosHalfA = abs(dot(dirA, miterVec));\nfloat turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);\nfloat cornerPosition = sideOfPath * turnDirection;\nfloat miterSize = 1.0 / max(sinHalfA, EPSILON);\nmiterSize = mix(\nmin(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),\nmiterSize,\nstep(0.0, cornerPosition)\n);\nvec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))\n* (sideOfPath + isJoint * turnDirection);\nbool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));\nbool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));\nbool isCap = isStartCap || isEndCap;\nif (isCap) {\noffsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);\nvJointType = path.capType;\n} else {\nvJointType = path.jointType;\n}\nvPathLength = L;\nvCornerOffset = offsetVec;\nvMiterLength = dot(vCornerOffset, miterVec * turnDirection);\nvMiterLength = isCap ? isJoint : vMiterLength;\nvec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);\nvPathPosition = vec2(\ndot(offsetFromStartOfPath, perp),\ndot(offsetFromStartOfPath, dir)\n);\ngeometry.uv = vPathPosition;\nfloat isValid = step(instanceTypes, 3.5);\nvec3 offset = vec3(offsetVec * width * isValid, 0.0);\nif (needsRotation) {\noffset = rotationMatrix * offset;\n}\nreturn offset;\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\nif (position.w < EPSILON) {\nfloat r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\nposition = refPosition + (position - refPosition) * r;\n}\n}\nvoid main() {\ngeometry.pickingColor = instancePickingColors;\nvColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);\nfloat isEnd = positions.x;\nvec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\nvec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);\nvec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\nvec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);\nvec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\nvec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);\ngeometry.worldPosition = currPosition;\nvec2 widthPixels = vec2(clamp(\nproject_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),\npath.widthMinPixels, path.widthMaxPixels) / 2.0);\nvec3 width;\nif (path.billboard) {\nvec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);\nvec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);\nvec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);\nclipLine(prevPositionScreen, currPositionScreen);\nclipLine(nextPositionScreen, currPositionScreen);\nclipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\nwidth = vec3(widthPixels, 0.0);\nDECKGL_FILTER_SIZE(width, geometry);\nvec3 offset = getLineJoinOffset(\nprevPositionScreen.xyz / prevPositionScreen.w,\ncurrPositionScreen.xyz / currPositionScreen.w,\nnextPositionScreen.xyz / nextPositionScreen.w,\nproject_pixel_size_to_clipspace(width.xy)\n);\nDECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);\ngl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);\n} else {\nprevPosition = project_position(prevPosition, prevPosition64Low);\ncurrPosition = project_position(currPosition, currPosition64Low);\nnextPosition = project_position(nextPosition, nextPosition64Low);\nwidth = vec3(project_pixel_size(widthPixels), 0.0);\nDECKGL_FILTER_SIZE(width, geometry);\nvec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);\ngeometry.position = vec4(currPosition + offset, 1.0);\ngl_Position = project_common_position_to_clipspace(geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME path-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nin vec2 vCornerOffset;\nin float vMiterLength;\nin vec2 vPathPosition;\nin float vPathLength;\nin float vJointType;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = vPathPosition;\nif (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {\nif (vJointType > 0.5 && length(vCornerOffset) > 1.0) {\ndiscard;\n}\nif (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {\ndiscard;\n}\n}\nfragColor = vColor;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[Bc,mu,Lm]})}get wrapLongitude(){return!1}getBounds(){var e;return null==(e=this.getAttributeManager())?void 0:e.getBounds(["vertexPositions"])}initializeState(){const e=!0;this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:Fm,accessor:"getPath",update:this.calculatePositions,noAlloc:e,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:e},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Fm,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:Fm,defaultValue:Nm},instancePickingColors:{size:4,type:"uint8",accessor:(e,{index:t,target:n})=>this.encodePickingColor(e&&e.__source?e.__source.index:t,n)}}),this.setState({pathTesselator:new km({fp64:this.use64bitPositions()})})}updateState(e){var t;super.updateState(e);const{props:n,changeFlags:s}=e,r=this.getAttributeManager();if(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getPath)){const{pathTesselator:e}=this.state,t=n.data.attributes||{};e.updateGeometry({data:n.data,geometryBuffer:t.getPath,buffers:t,normalize:!n._pathType,loop:"loop"===n._pathType,getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:s.dataChanged}),this.setState({numInstances:e.instanceCount,startIndices:e.vertexStarts}),s.dataChanged||r.invalidateAll()}s.extensionsChanged&&(null==(t=this.state.model)||t.destroy(),this.state.model=this._getModel(),r.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n}=t,s=this.props.data;return s[0]&&s[0].__source&&(t.object=s.find(e=>e.__source.index===n)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let n=0;n<t.length;n++)t[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:n,billboard:s,miterLimit:r,widthUnits:i,widthScale:o,widthMinPixels:a,widthMaxPixels:l}=this.props,c=this.state.model,u={jointType:Number(t),capType:Number(n),billboard:s,widthUnits:vc[i],widthScale:o,miterLimit:r,widthMinPixels:a,widthMaxPixels:l};c.shaderInputs.setProps({path:u}),c.draw(this.context.renderPass)}_getModel(){return new Ah(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new kh({topology:"triangle-list",attributes:{indices:new Uint16Array([0,1,2,1,4,2,1,3,4,3,5,4]),positions:{value:new Float32Array([0,0,0,-1,0,1,1,-1,1,1,1,0]),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}function Bm(e){return"number"==typeof e.lat&&"number"==typeof e.lon&&!isNaN(e.lat)&&!isNaN(e.lon)&&e.lat>=-90&&e.lat<=90&&e.lon>=-180&&e.lon<=180}function Um({coveragePoints:e,visible:t,opacity:n=.8}){const{current:s}=_(),r=f.useRef(null),i=f.useMemo(()=>e&&Array.isArray(e)?e.filter(Bm):[],[e]);return f.useEffect(()=>{const e=null==s?void 0:s.getMap();if(e)return r.current||(r.current=new mm({interleaved:!0,layers:[]}),e.addControl(r.current)),()=>{if(r.current&&e){try{e.removeControl(r.current)}catch{}r.current=null}}},[s]),f.useEffect(()=>{if(!r.current)return;if(!t||0===i.length)return void r.current.setProps({layers:[]});i.length>0&&i[0];const e=new xm({id:"wardriving-heatmap",data:i,getPosition:e=>[e.lon,e.lat],getRadius:500,getFillColor:e=>function(e){const t=[[65,105,225],[0,191,255],[50,205,50],[255,215,0],[255,140,0],[255,69,0]],n=Math.max(0,Math.min(1,e))*(t.length-1),s=Math.floor(n),r=Math.min(s+1,t.length-1),i=n-s,o=t[s],a=t[r];return[Math.round(o[0]+(a[0]-o[0])*i),Math.round(o[1]+(a[1]-o[1])*i),Math.round(o[2]+(a[2]-o[2])*i),180]}(e.weight),radiusMinPixels:4,radiusMaxPixels:30,opacity:n,pickable:!1,stroked:!1});r.current.setProps({layers:[e]})},[i,t,n]),null}function jm(e){let t=!0,n=-90,s=90,r=-180,i=180;for(const o of e.toLowerCase()){const e="0123456789bcdefghjkmnpqrstuvwxyz".indexOf(o);if(-1!==e)for(let o=4;o>=0;o--){const a=e>>o&1;if(t){const e=(r+i)/2;a?r=e:i=e}else{const e=(n+s)/2;a?n=e:s=e}t=!t}}return{lat:(n+s)/2,lon:(r+i)/2}}function Gm(e){const t=function(e){return new Date(6e4*e)}(e);return((new Date).getTime()-t.getTime())/864e5}function Vm(e){return Math.exp(-e*Math.LN2/7)}Dm.defaultProps=Om,Dm.layerName="PathLayer";const zm="pymc-wardriving-url",Wm="pymc-wardriving-enabled";function Hm(e){"undefined"!=typeof localStorage&&(e?localStorage.setItem(zm,e):localStorage.removeItem(zm))}function $m(e){"undefined"!=typeof localStorage&&localStorage.setItem(Wm,String(e))}function Xm(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}function qm(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}var Ym,Km={},Zm={};var Qm,Jm,e_={};var t_,n_,s_=(Jm||(Jm=1,t_=function(){if(Ym)return Zm;Ym=1;var e=m();function t(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=Object.prototype.hasOwnProperty,s=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,r={},i={};function o(e){return!!n.call(i,e)||!n.call(r,e)&&(s.test(e)?i[e]=!0:(r[e]=!0,!1))}function a(e,t,n,s,r,i,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var l={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){l[e]=new a(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];l[t]=new a(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){l[e]=new a(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){l[e]=new a(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){l[e]=new a(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){l[e]=new a(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){l[e]=new a(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){l[e]=new a(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){l[e]=new a(e,5,!1,e.toLowerCase(),null,!1,!1)});var c=/[\-:]([a-z])/g;function u(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(c,u);l[t]=new a(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(c,u);l[t]=new a(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(c,u);l[t]=new a(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){l[e]=new a(e,1,!1,e.toLowerCase(),null,!1,!1)}),l.xlinkHref=new a("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){l[e]=new a(e,1,!1,e.toLowerCase(),null,!0,!0)});var h={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},d=["Webkit","ms","Moz","O"];Object.keys(h).forEach(function(e){d.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),h[t]=h[e]})});var f=/["'&<>]/;function p(e){if("boolean"==typeof e||"number"==typeof e)return""+e;e=""+e;var t=f.exec(e);if(t){var n,s="",r=0;for(n=t.index;n<e.length;n++){switch(e.charCodeAt(n)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#x27;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}r!==n&&(s+=e.substring(r,n)),r=n+1,s+=t}e=r!==n?s+e.substring(r,n):s}return e}var g=/([A-Z])/g,_=/^ms-/,y=Array.isArray;function b(e,t){return{insertionMode:e,selectedValue:t}}var v=new Map;function x(e,s,r){if("object"!=typeof r)throw Error(t(62));for(var i in s=!0,r)if(n.call(r,i)){var o=r[i];if(null!=o&&"boolean"!=typeof o&&""!==o){if(0===i.indexOf("--")){var a=p(i);o=p((""+o).trim())}else{a=i;var l=v.get(a);void 0!==l||(l=p(a.replace(g,"-$1").toLowerCase().replace(_,"-ms-")),v.set(a,l)),a=l,o="number"==typeof o?0===o||n.call(h,i)?""+o:o+"px":p((""+o).trim())}s?(s=!1,e.push(' style="',a,":",o)):e.push(";",a,":",o)}}s||e.push('"')}function w(e,t,n,s){switch(n){case"style":return void x(e,t,s);case"defaultValue":case"defaultChecked":case"innerHTML":case"suppressContentEditableWarning":case"suppressHydrationWarning":return}if(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])if(null!==(t=l.hasOwnProperty(n)?l[n]:null)){switch(typeof s){case"function":case"symbol":return;case"boolean":if(!t.acceptsBooleans)return}switch(n=t.attributeName,t.type){case 3:s&&e.push(" ",n,'=""');break;case 4:!0===s?e.push(" ",n,'=""'):!1!==s&&e.push(" ",n,'="',p(s),'"');break;case 5:isNaN(s)||e.push(" ",n,'="',p(s),'"');break;case 6:!isNaN(s)&&1<=s&&e.push(" ",n,'="',p(s),'"');break;default:t.sanitizeURL&&(s=""+s),e.push(" ",n,'="',p(s),'"')}}else if(o(n)){switch(typeof s){case"function":case"symbol":return;case"boolean":if("data-"!==(t=n.toLowerCase().slice(0,5))&&"aria-"!==t)return}e.push(" ",n,'="',p(s),'"')}}function E(e,n,s){if(null!=n){if(null!=s)throw Error(t(60));if("object"!=typeof n||!("__html"in n))throw Error(t(61));null!=(n=n.__html)&&e.push(""+n)}}function T(e,t,s,r){e.push(R(s));var i,o=s=null;for(i in t)if(n.call(t,i)){var a=t[i];if(null!=a)switch(i){case"children":s=a;break;case"dangerouslySetInnerHTML":o=a;break;default:w(e,r,i,a)}}return e.push(">"),E(e,o,s),"string"==typeof s?(e.push(p(s)),null):s}var S=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,A=new Map;function R(e){var n=A.get(e);if(void 0===n){if(!S.test(e))throw Error(t(65,e));n="<"+e,A.set(e,n)}return n}function C(e,n,s){if(e.push('\x3c!--$?--\x3e<template id="'),null===s)throw Error(t(395));return e.push(s),e.push('"></template>')}var P=/[<\u2028\u2029]/g;function k(e){return JSON.stringify(e).replace(P,function(e){switch(e){case"<":return"\\u003c";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:throw Error("escapeJSStringsForInstructionScripts encountered a match it does not know how to replace. this means the match regex and the replacement characters are no longer in sync. This is a bug in React")}})}function I(e,t,n,s){return n.generateStaticMarkup?(e.push(p(t)),!1):(""===t?e=s:(s&&e.push("\x3c!-- --\x3e"),e.push(p(t)),e=!0),e)}var M=Object.assign,L=Symbol.for("react.element"),N=Symbol.for("react.portal"),O=Symbol.for("react.fragment"),F=Symbol.for("react.strict_mode"),D=Symbol.for("react.profiler"),B=Symbol.for("react.provider"),U=Symbol.for("react.context"),j=Symbol.for("react.forward_ref"),G=Symbol.for("react.suspense"),V=Symbol.for("react.suspense_list"),z=Symbol.for("react.memo"),W=Symbol.for("react.lazy"),H=Symbol.for("react.scope"),$=Symbol.for("react.debug_trace_mode"),X=Symbol.for("react.legacy_hidden"),q=Symbol.for("react.default_value"),Y=Symbol.iterator;function K(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case O:return"Fragment";case N:return"Portal";case D:return"Profiler";case F:return"StrictMode";case G:return"Suspense";case V:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case U:return(e.displayName||"Context")+".Consumer";case B:return(e._context.displayName||"Context")+".Provider";case j:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case z:return null!==(t=e.displayName||null)?t:K(e.type)||"Memo";case W:t=e._payload,e=e._init;try{return K(e(t))}catch(n){}}return null}var Z={};function Q(e,t){if(!(e=e.contextTypes))return Z;var n,s={};for(n in e)s[n]=t[n];return s}var J=null;function ee(e,n){if(e!==n){e.context._currentValue2=e.parentValue,e=e.parent;var s=n.parent;if(null===e){if(null!==s)throw Error(t(401))}else{if(null===s)throw Error(t(401));ee(e,s)}n.context._currentValue2=n.value}}function te(e){e.context._currentValue2=e.parentValue,null!==(e=e.parent)&&te(e)}function ne(e){var t=e.parent;null!==t&&ne(t),e.context._currentValue2=e.value}function se(e,n){if(e.context._currentValue2=e.parentValue,null===(e=e.parent))throw Error(t(402));e.depth===n.depth?ee(e,n):se(e,n)}function re(e,n){var s=n.parent;if(null===s)throw Error(t(402));e.depth===s.depth?ee(e,s):re(e,s),n.context._currentValue2=n.value}function ie(e){var t=J;t!==e&&(null===t?ne(e):null===e?te(t):t.depth===e.depth?ee(t,e):t.depth>e.depth?se(t,e):re(t,e),J=e)}var oe={isMounted:function(){return!1},enqueueSetState:function(e,t){null!==(e=e._reactInternals).queue&&e.queue.push(t)},enqueueReplaceState:function(e,t){(e=e._reactInternals).replace=!0,e.queue=[t]},enqueueForceUpdate:function(){}};function ae(e,t,n,s){var r=void 0!==e.state?e.state:null;e.updater=oe,e.props=n,e.state=r;var i={queue:[],replace:!1};e._reactInternals=i;var o=t.contextType;if(e.context="object"==typeof o&&null!==o?o._currentValue2:s,"function"==typeof(o=t.getDerivedStateFromProps)&&(r=null==(o=o(n,r))?r:M({},r,o),e.state=r),"function"!=typeof t.getDerivedStateFromProps&&"function"!=typeof e.getSnapshotBeforeUpdate&&("function"==typeof e.UNSAFE_componentWillMount||"function"==typeof e.componentWillMount))if(t=e.state,"function"==typeof e.componentWillMount&&e.componentWillMount(),"function"==typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),t!==e.state&&oe.enqueueReplaceState(e,e.state,null),null!==i.queue&&0<i.queue.length)if(t=i.queue,o=i.replace,i.queue=null,i.replace=!1,o&&1===t.length)e.state=t[0];else{for(i=o?t[0]:e.state,r=!0,o=o?1:0;o<t.length;o++){var a=t[o];null!=(a="function"==typeof a?a.call(e,i,n,s):a)&&(r?(r=!1,i=M({},i,a)):M(i,a))}e.state=i}else i.queue=null}var le={id:1,overflow:""};function ce(e,t,n){var s=e.id;e=e.overflow;var r=32-ue(s)-1;s&=~(1<<r),n+=1;var i=32-ue(t)+r;if(30<i){var o=r-r%5;return i=(s&(1<<o)-1).toString(32),s>>=o,r-=o,{id:1<<32-ue(t)+r|n<<r|s,overflow:i+e}}return{id:1<<i|n<<r|s,overflow:e}}var ue=Math.clz32?Math.clz32:function(e){return 0==(e>>>=0)?32:31-(he(e)/de|0)|0},he=Math.log,de=Math.LN2,fe="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},pe=null,ge=null,me=null,_e=null,ye=!1,be=!1,ve=0,xe=null,we=0;function Ee(){if(null===pe)throw Error(t(321));return pe}function Te(){if(0<we)throw Error(t(312));return{memoizedState:null,queue:null,next:null}}function Se(){return null===_e?null===me?(ye=!1,me=_e=Te()):(ye=!0,_e=me):null===_e.next?(ye=!1,_e=_e.next=Te()):(ye=!0,_e=_e.next),_e}function Ae(){ge=pe=null,be=!1,me=null,we=0,_e=xe=null}function Re(e,t){return"function"==typeof t?t(e):t}function Ce(e,t,n){if(pe=Ee(),_e=Se(),ye){var s=_e.queue;if(t=s.dispatch,null!==xe&&void 0!==(n=xe.get(s))){xe.delete(s),s=_e.memoizedState;do{s=e(s,n.action),n=n.next}while(null!==n);return _e.memoizedState=s,[s,t]}return[_e.memoizedState,t]}return e=e===Re?"function"==typeof t?t():t:void 0!==n?n(t):t,_e.memoizedState=e,e=(e=_e.queue={last:null,dispatch:null}).dispatch=ke.bind(null,pe,e),[_e.memoizedState,e]}function Pe(e,t){if(pe=Ee(),t=void 0===t?null:t,null!==(_e=Se())){var n=_e.memoizedState;if(null!==n&&null!==t){var s=n[1];e:if(null===s)s=!1;else{for(var r=0;r<s.length&&r<t.length;r++)if(!fe(t[r],s[r])){s=!1;break e}s=!0}if(s)return n[0]}}return e=e(),_e.memoizedState=[e,t],e}function ke(e,n,s){if(25<=we)throw Error(t(301));if(e===pe)if(be=!0,e={action:s,next:null},null===xe&&(xe=new Map),void 0===(s=xe.get(n)))xe.set(n,e);else{for(n=s;null!==n.next;)n=n.next;n.next=e}}function Ie(){throw Error(t(394))}function Me(){}var Le={readContext:function(e){return e._currentValue2},useContext:function(e){return Ee(),e._currentValue2},useMemo:Pe,useReducer:Ce,useRef:function(e){pe=Ee();var t=(_e=Se()).memoizedState;return null===t?(e={current:e},_e.memoizedState=e):t},useState:function(e){return Ce(Re,e)},useInsertionEffect:Me,useLayoutEffect:function(){},useCallback:function(e,t){return Pe(function(){return e},t)},useImperativeHandle:Me,useEffect:Me,useDebugValue:Me,useDeferredValue:function(e){return Ee(),e},useTransition:function(){return Ee(),[!1,Ie]},useId:function(){var e=ge.treeContext,n=e.overflow;e=((e=e.id)&~(1<<32-ue(e)-1)).toString(32)+n;var s=Ne;if(null===s)throw Error(t(404));return n=ve++,e=":"+s.idPrefix+"R"+e,0<n&&(e+="H"+n.toString(32)),e+":"},useMutableSource:function(e,t){return Ee(),t(e._source)},useSyncExternalStore:function(e,n,s){if(void 0===s)throw Error(t(407));return s()}},Ne=null,Oe=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentDispatcher;function Fe(e){return null}function De(){}function Be(e,t,n,s,r,i,o,a){e.allPendingTasks++,null===n?e.pendingRootTasks++:n.pendingTasks++;var l={node:t,ping:function(){var t=e.pingedTasks;t.push(l),1===t.length&&Je(e)},blockedBoundary:n,blockedSegment:s,abortSet:r,legacyContext:i,context:o,treeContext:a};return r.add(l),l}function Ue(e,t,n,s,r,i){return{status:0,id:-1,index:t,parentFlushed:!1,chunks:[],children:[],formatContext:s,boundary:n,lastPushedText:r,textEmbedded:i}}function je(e,t){if(null!=(e=e.onError(t))&&"string"!=typeof e)throw Error('onError returned something with a type other than "string". onError should return a string and may return null or undefined but must not return anything else. It received something of type "'+typeof e+'" instead');return e}function Ge(e,t){var n=e.onShellError;n(t),(n=e.onFatalError)(t),null!==e.destination?(e.status=2,e.destination.destroy(t)):(e.status=1,e.fatalError=t)}function Ve(e,t,n,s,r){for(pe={},ge=t,ve=0,e=n(s,r);be;)be=!1,ve=0,we+=1,_e=null,e=n(s,r);return Ae(),e}function ze(e,n,s,r){var i=s.render(),o=r.childContextTypes;if(null!=o){var a=n.legacyContext;if("function"!=typeof s.getChildContext)r=a;else{for(var l in s=s.getChildContext())if(!(l in o))throw Error(t(108,K(r)||"Unknown",l));r=M({},a,s)}n.legacyContext=r,$e(e,n,i),n.legacyContext=a}else $e(e,n,i)}function We(e,t){if(e&&e.defaultProps){for(var n in t=M({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function He(s,r,i,a,l){if("function"==typeof i)if(i.prototype&&i.prototype.isReactComponent){l=Q(i,r.legacyContext);var c=i.contextType;ae(c=new i(a,"object"==typeof c&&null!==c?c._currentValue2:l),i,a,l),ze(s,r,c,i)}else{l=Ve(s,r,i,a,c=Q(i,r.legacyContext));var u=0!==ve;if("object"==typeof l&&null!==l&&"function"==typeof l.render&&void 0===l.$$typeof)ae(l,i,a,c),ze(s,r,l,i);else if(u){a=r.treeContext,r.treeContext=ce(a,1,0);try{$e(s,r,l)}finally{r.treeContext=a}}else $e(s,r,l)}else{if("string"!=typeof i){switch(i){case X:case $:case F:case D:case O:case V:return void $e(s,r,a.children);case H:throw Error(t(343));case G:e:{i=r.blockedBoundary,l=r.blockedSegment,c=a.fallback,a=a.children;var h={id:null,rootSegmentID:-1,parentFlushed:!1,pendingTasks:0,forceClientRender:!1,completedSegments:[],byteSize:0,fallbackAbortableTasks:u=new Set,errorDigest:null},d=Ue(0,l.chunks.length,h,l.formatContext,!1,!1);l.children.push(d),l.lastPushedText=!1;var f=Ue(0,0,null,l.formatContext,!1,!1);f.parentFlushed=!0,r.blockedBoundary=h,r.blockedSegment=f;try{if(qe(s,r,a),s.responseState.generateStaticMarkup||f.lastPushedText&&f.textEmbedded&&f.chunks.push("\x3c!-- --\x3e"),f.status=1,Ze(h,f),0===h.pendingTasks)break e}catch(g){f.status=4,h.forceClientRender=!0,h.errorDigest=je(s,g)}finally{r.blockedBoundary=i,r.blockedSegment=l}r=Be(s,c,i,d,u,r.legacyContext,r.context,r.treeContext),s.pingedTasks.push(r)}return}if("object"==typeof i&&null!==i)switch(i.$$typeof){case j:if(a=Ve(s,r,i.render,a,l),0!==ve){i=r.treeContext,r.treeContext=ce(i,1,0);try{$e(s,r,a)}finally{r.treeContext=i}}else $e(s,r,a);return;case z:return void He(s,r,i=i.type,a=We(i,a),l);case B:if(l=a.children,i=i._context,a=a.value,c=i._currentValue2,i._currentValue2=a,J=a={parent:u=J,depth:null===u?0:u.depth+1,context:i,parentValue:c,value:a},r.context=a,$e(s,r,l),null===(s=J))throw Error(t(403));return a=s.parentValue,s.context._currentValue2=a===q?s.context._defaultValue:a,s=J=s.parent,void(r.context=s);case U:return void $e(s,r,a=(a=a.children)(i._currentValue2));case W:return void He(s,r,i=(l=i._init)(i._payload),a=We(i,a),void 0)}throw Error(t(130,null==i?i:typeof i,""))}switch(c=function(s,r,i,a,l){switch(r){case"select":s.push(R("select"));var c=null,u=null;for(g in i)if(n.call(i,g)){var h=i[g];if(null!=h)switch(g){case"children":c=h;break;case"dangerouslySetInnerHTML":u=h;break;case"defaultValue":case"value":break;default:w(s,a,g,h)}}return s.push(">"),E(s,u,c),c;case"option":u=l.selectedValue,s.push(R("option"));var d=h=null,f=null,g=null;for(c in i)if(n.call(i,c)){var m=i[c];if(null!=m)switch(c){case"children":h=m;break;case"selected":f=m;break;case"dangerouslySetInnerHTML":g=m;break;case"value":d=m;default:w(s,a,c,m)}}if(null!=u)if(i=null!==d?""+d:function(t){var n="";return e.Children.forEach(t,function(e){null!=e&&(n+=e)}),n}(h),y(u)){for(a=0;a<u.length;a++)if(""+u[a]===i){s.push(' selected=""');break}}else""+u===i&&s.push(' selected=""');else f&&s.push(' selected=""');return s.push(">"),E(s,g,h),h;case"textarea":for(h in s.push(R("textarea")),g=u=c=null,i)if(n.call(i,h)&&null!=(d=i[h]))switch(h){case"children":g=d;break;case"value":c=d;break;case"defaultValue":u=d;break;case"dangerouslySetInnerHTML":throw Error(t(91));default:w(s,a,h,d)}if(null===c&&null!==u&&(c=u),s.push(">"),null!=g){if(null!=c)throw Error(t(92));if(y(g)&&1<g.length)throw Error(t(93));c=""+g}return"string"==typeof c&&"\n"===c[0]&&s.push("\n"),null!==c&&s.push(p(""+c)),null;case"input":for(u in s.push(R("input")),d=g=h=c=null,i)if(n.call(i,u)&&null!=(f=i[u]))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(t(399,"input"));case"defaultChecked":d=f;break;case"defaultValue":h=f;break;case"checked":g=f;break;case"value":c=f;break;default:w(s,a,u,f)}return null!==g?w(s,a,"checked",g):null!==d&&w(s,a,"checked",d),null!==c?w(s,a,"value",c):null!==h&&w(s,a,"value",h),s.push("/>"),null;case"menuitem":for(var _ in s.push(R("menuitem")),i)if(n.call(i,_)&&null!=(c=i[_]))switch(_){case"children":case"dangerouslySetInnerHTML":throw Error(t(400));default:w(s,a,_,c)}return s.push(">"),null;case"title":for(m in s.push(R("title")),c=null,i)if(n.call(i,m)&&null!=(u=i[m]))switch(m){case"children":c=u;break;case"dangerouslySetInnerHTML":throw Error(t(434));default:w(s,a,m,u)}return s.push(">"),c;case"listing":case"pre":for(d in s.push(R(r)),u=c=null,i)if(n.call(i,d)&&null!=(h=i[d]))switch(d){case"children":c=h;break;case"dangerouslySetInnerHTML":u=h;break;default:w(s,a,d,h)}if(s.push(">"),null!=u){if(null!=c)throw Error(t(60));if("object"!=typeof u||!("__html"in u))throw Error(t(61));null!=(i=u.__html)&&("string"==typeof i&&0<i.length&&"\n"===i[0]?s.push("\n",i):s.push(""+i))}return"string"==typeof c&&"\n"===c[0]&&s.push("\n"),c;case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":for(var b in s.push(R(r)),i)if(n.call(i,b)&&null!=(c=i[b]))switch(b){case"children":case"dangerouslySetInnerHTML":throw Error(t(399,r));default:w(s,a,b,c)}return s.push("/>"),null;case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return T(s,i,r,a);case"html":return 0===l.insertionMode&&s.push("<!DOCTYPE html>"),T(s,i,r,a);default:if(-1===r.indexOf("-")&&"string"!=typeof i.is)return T(s,i,r,a);for(f in s.push(R(r)),u=c=null,i)if(n.call(i,f)&&null!=(h=i[f]))switch(f){case"children":c=h;break;case"dangerouslySetInnerHTML":u=h;break;case"style":x(s,a,h);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":break;default:o(f)&&"function"!=typeof h&&"symbol"!=typeof h&&s.push(" ",f,'="',p(h),'"')}return s.push(">"),E(s,u,c),c}}((l=r.blockedSegment).chunks,i,a,s.responseState,l.formatContext),l.lastPushedText=!1,u=l.formatContext,l.formatContext=function(e,t,n){switch(t){case"select":return b(1,null!=n.value?n.value:n.defaultValue);case"svg":return b(2,null);case"math":return b(3,null);case"foreignObject":return b(1,null);case"table":return b(4,null);case"thead":case"tbody":case"tfoot":return b(5,null);case"colgroup":return b(7,null);case"tr":return b(6,null)}return 4<=e.insertionMode||0===e.insertionMode?b(1,null):e}(u,i,a),qe(s,r,c),l.formatContext=u,i){case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"input":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":break;default:l.chunks.push("</",i,">")}l.lastPushedText=!1}}function $e(e,n,s){if(n.node=s,"object"==typeof s&&null!==s){switch(s.$$typeof){case L:return void He(e,n,s.type,s.props,s.ref);case N:throw Error(t(257));case W:var r=s._init;return void $e(e,n,s=r(s._payload))}if(y(s))return void Xe(e,n,s);if((r=null===s||"object"!=typeof s?null:"function"==typeof(r=Y&&s[Y]||s["@@iterator"])?r:null)&&(r=r.call(s))){if(!(s=r.next()).done){var i=[];do{i.push(s.value),s=r.next()}while(!s.done);Xe(e,n,i)}return}throw e=Object.prototype.toString.call(s),Error(t(31,"[object Object]"===e?"object with keys {"+Object.keys(s).join(", ")+"}":e))}"string"==typeof s?(r=n.blockedSegment).lastPushedText=I(n.blockedSegment.chunks,s,e.responseState,r.lastPushedText):"number"==typeof s&&((r=n.blockedSegment).lastPushedText=I(n.blockedSegment.chunks,""+s,e.responseState,r.lastPushedText))}function Xe(e,t,n){for(var s=n.length,r=0;r<s;r++){var i=t.treeContext;t.treeContext=ce(i,s,r);try{qe(e,t,n[r])}finally{t.treeContext=i}}}function qe(e,t,n){var s=t.blockedSegment.formatContext,r=t.legacyContext,i=t.context;try{return $e(e,t,n)}catch(l){if(Ae(),"object"!=typeof l||null===l||"function"!=typeof l.then)throw t.blockedSegment.formatContext=s,t.legacyContext=r,t.context=i,ie(i),l;n=l;var o=t.blockedSegment,a=Ue(0,o.chunks.length,null,o.formatContext,o.lastPushedText,!0);o.children.push(a),o.lastPushedText=!1,e=Be(e,t.node,t.blockedBoundary,a,t.abortSet,t.legacyContext,t.context,t.treeContext).ping,n.then(e,e),t.blockedSegment.formatContext=s,t.legacyContext=r,t.context=i,ie(i)}}function Ye(e){var t=e.blockedBoundary;(e=e.blockedSegment).status=3,Qe(this,t,e)}function Ke(e,n,s){var r=e.blockedBoundary;e.blockedSegment.status=3,null===r?(n.allPendingTasks--,2!==n.status&&(n.status=2,null!==n.destination&&n.destination.push(null))):(r.pendingTasks--,r.forceClientRender||(r.forceClientRender=!0,e=void 0===s?Error(t(432)):s,r.errorDigest=n.onError(e),r.parentFlushed&&n.clientRenderedBoundaries.push(r)),r.fallbackAbortableTasks.forEach(function(e){return Ke(e,n,s)}),r.fallbackAbortableTasks.clear(),n.allPendingTasks--,0===n.allPendingTasks&&(r=n.onAllReady)())}function Ze(e,t){if(0===t.chunks.length&&1===t.children.length&&null===t.children[0].boundary){var n=t.children[0];n.id=t.id,n.parentFlushed=!0,1===n.status&&Ze(e,n)}else e.completedSegments.push(t)}function Qe(e,n,s){if(null===n){if(s.parentFlushed){if(null!==e.completedRootSegment)throw Error(t(389));e.completedRootSegment=s}e.pendingRootTasks--,0===e.pendingRootTasks&&(e.onShellError=De,(n=e.onShellReady)())}else n.pendingTasks--,n.forceClientRender||(0===n.pendingTasks?(s.parentFlushed&&1===s.status&&Ze(n,s),n.parentFlushed&&e.completedBoundaries.push(n),n.fallbackAbortableTasks.forEach(Ye,e),n.fallbackAbortableTasks.clear()):s.parentFlushed&&1===s.status&&(Ze(n,s),1===n.completedSegments.length&&n.parentFlushed&&e.partialBoundaries.push(n)));e.allPendingTasks--,0===e.allPendingTasks&&(e=e.onAllReady)()}function Je(e){if(2!==e.status){var t=J,n=Oe.current;Oe.current=Le;var s=Ne;Ne=e.responseState;try{var r,i=e.pingedTasks;for(r=0;r<i.length;r++){var o=i[r],a=e,l=o.blockedSegment;if(0===l.status){ie(o.context);try{$e(a,o,o.node),a.responseState.generateStaticMarkup||l.lastPushedText&&l.textEmbedded&&l.chunks.push("\x3c!-- --\x3e"),o.abortSet.delete(o),l.status=1,Qe(a,o.blockedBoundary,l)}catch(f){if(Ae(),"object"==typeof f&&null!==f&&"function"==typeof f.then){var c=o.ping;f.then(c,c)}else{o.abortSet.delete(o),l.status=4;var u=o.blockedBoundary,h=f,d=je(a,h);null===u?Ge(a,h):(u.pendingTasks--,u.forceClientRender||(u.forceClientRender=!0,u.errorDigest=d,u.parentFlushed&&a.clientRenderedBoundaries.push(u))),a.allPendingTasks--,0===a.allPendingTasks&&(0,a.onAllReady)()}}}}i.splice(0,r),null!==e.destination&&it(e,e.destination)}catch(f){je(e,f),Ge(e,f)}finally{Ne=s,Oe.current=n,n===Le&&ie(t)}}}function et(e,n,s){switch(s.parentFlushed=!0,s.status){case 0:var r=s.id=e.nextSegmentId++;return s.lastPushedText=!1,s.textEmbedded=!1,e=e.responseState,n.push('<template id="'),n.push(e.placeholderPrefix),e=r.toString(16),n.push(e),n.push('"></template>');case 1:s.status=2;var i=!0;r=s.chunks;var o=0;s=s.children;for(var a=0;a<s.length;a++){for(i=s[a];o<i.index;o++)n.push(r[o]);i=tt(e,n,i)}for(;o<r.length-1;o++)n.push(r[o]);return o<r.length&&(i=n.push(r[o])),i;default:throw Error(t(390))}}function tt(e,n,s){var r=s.boundary;if(null===r)return et(e,n,s);if(r.parentFlushed=!0,r.forceClientRender)return e.responseState.generateStaticMarkup||(r=r.errorDigest,n.push("\x3c!--$!--\x3e"),n.push("<template"),r&&(n.push(' data-dgst="'),r=p(r),n.push(r),n.push('"')),n.push("></template>")),et(e,n,s),!!e.responseState.generateStaticMarkup||n.push("\x3c!--/$--\x3e");if(0<r.pendingTasks){r.rootSegmentID=e.nextSegmentId++,0<r.completedSegments.length&&e.partialBoundaries.push(r);var i=e.responseState,o=i.nextSuspenseID++;return i=i.boundaryPrefix+o.toString(16),r=r.id=i,C(n,e.responseState,r),et(e,n,s),n.push("\x3c!--/$--\x3e")}if(r.byteSize>e.progressiveChunkSize)return r.rootSegmentID=e.nextSegmentId++,e.completedBoundaries.push(r),C(n,e.responseState,r.id),et(e,n,s),n.push("\x3c!--/$--\x3e");if(e.responseState.generateStaticMarkup||n.push("\x3c!--$--\x3e"),1!==(s=r.completedSegments).length)throw Error(t(391));return tt(e,n,s[0]),!!e.responseState.generateStaticMarkup||n.push("\x3c!--/$--\x3e")}function nt(e,n,s){return function(e,n,s,r){switch(s.insertionMode){case 0:case 1:return e.push('<div hidden id="'),e.push(n.segmentPrefix),n=r.toString(16),e.push(n),e.push('">');case 2:return e.push('<svg aria-hidden="true" style="display:none" id="'),e.push(n.segmentPrefix),n=r.toString(16),e.push(n),e.push('">');case 3:return e.push('<math aria-hidden="true" style="display:none" id="'),e.push(n.segmentPrefix),n=r.toString(16),e.push(n),e.push('">');case 4:return e.push('<table hidden id="'),e.push(n.segmentPrefix),n=r.toString(16),e.push(n),e.push('">');case 5:return e.push('<table hidden><tbody id="'),e.push(n.segmentPrefix),n=r.toString(16),e.push(n),e.push('">');case 6:return e.push('<table hidden><tr id="'),e.push(n.segmentPrefix),n=r.toString(16),e.push(n),e.push('">');case 7:return e.push('<table hidden><colgroup id="'),e.push(n.segmentPrefix),n=r.toString(16),e.push(n),e.push('">');default:throw Error(t(397))}}(n,e.responseState,s.formatContext,s.id),tt(e,n,s),function(e,n){switch(n.insertionMode){case 0:case 1:return e.push("</div>");case 2:return e.push("</svg>");case 3:return e.push("</math>");case 4:return e.push("</table>");case 5:return e.push("</tbody></table>");case 6:return e.push("</tr></table>");case 7:return e.push("</colgroup></table>");default:throw Error(t(397))}}(n,s.formatContext)}function st(e,n,s){for(var r=s.completedSegments,i=0;i<r.length;i++)rt(e,n,s,r[i]);if(r.length=0,e=e.responseState,r=s.id,s=s.rootSegmentID,n.push(e.startInlineScript),e.sentCompleteBoundaryFunction?n.push('$RC("'):(e.sentCompleteBoundaryFunction=!0,n.push('function $RC(a,b){a=document.getElementById(a);b=document.getElementById(b);b.parentNode.removeChild(b);if(a){a=a.previousSibling;var f=a.parentNode,c=a.nextSibling,e=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d)if(0===e)break;else e--;else"$"!==d&&"$?"!==d&&"$!"!==d||e++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;b.firstChild;)f.insertBefore(b.firstChild,c);a.data="$";a._reactRetry&&a._reactRetry()}};$RC("')),null===r)throw Error(t(395));return s=s.toString(16),n.push(r),n.push('","'),n.push(e.segmentPrefix),n.push(s),n.push('")<\/script>')}function rt(e,n,s,r){if(2===r.status)return!0;var i=r.id;if(-1===i){if(-1===(r.id=s.rootSegmentID))throw Error(t(392));return nt(e,n,r)}return nt(e,n,r),e=e.responseState,n.push(e.startInlineScript),e.sentCompleteSegmentFunction?n.push('$RS("'):(e.sentCompleteSegmentFunction=!0,n.push('function $RS(a,b){a=document.getElementById(a);b=document.getElementById(b);for(a.parentNode.removeChild(a);a.firstChild;)b.parentNode.insertBefore(a.firstChild,b);b.parentNode.removeChild(b)};$RS("')),n.push(e.segmentPrefix),i=i.toString(16),n.push(i),n.push('","'),n.push(e.placeholderPrefix),n.push(i),n.push('")<\/script>')}function it(e,n){try{var s=e.completedRootSegment;if(null!==s&&0===e.pendingRootTasks){tt(e,n,s),e.completedRootSegment=null;var r=e.responseState.bootstrapChunks;for(s=0;s<r.length-1;s++)n.push(r[s]);s<r.length&&n.push(r[s])}var i,o=e.clientRenderedBoundaries;for(i=0;i<o.length;i++){var a=o[i];r=n;var l=e.responseState,c=a.id,u=a.errorDigest,h=a.errorMessage,d=a.errorComponentStack;if(r.push(l.startInlineScript),l.sentClientRenderFunction?r.push('$RX("'):(l.sentClientRenderFunction=!0,r.push('function $RX(b,c,d,e){var a=document.getElementById(b);a&&(b=a.previousSibling,b.data="$!",a=a.dataset,c&&(a.dgst=c),d&&(a.msg=d),e&&(a.stck=e),b._reactRetry&&b._reactRetry())};$RX("')),null===c)throw Error(t(395));if(r.push(c),r.push('"'),u||h||d){r.push(",");var f=k(u||"");r.push(f)}if(h||d){r.push(",");var p=k(h||"");r.push(p)}if(d){r.push(",");var g=k(d);r.push(g)}if(!r.push(")<\/script>"))return e.destination=null,i++,void o.splice(0,i)}o.splice(0,i);var m=e.completedBoundaries;for(i=0;i<m.length;i++)if(!st(e,n,m[i]))return e.destination=null,i++,void m.splice(0,i);m.splice(0,i);var _=e.partialBoundaries;for(i=0;i<_.length;i++){var y=_[i];e:{o=e,a=n;var b=y.completedSegments;for(l=0;l<b.length;l++)if(!rt(o,a,y,b[l])){l++,b.splice(0,l);var v=!1;break e}b.splice(0,l),v=!0}if(!v)return e.destination=null,i++,void _.splice(0,i)}_.splice(0,i);var x=e.completedBoundaries;for(i=0;i<x.length;i++)if(!st(e,n,x[i]))return e.destination=null,i++,void x.splice(0,i);x.splice(0,i)}finally{0===e.allPendingTasks&&0===e.pingedTasks.length&&0===e.clientRenderedBoundaries.length&&0===e.completedBoundaries.length&&n.push(null)}}function ot(e,t){try{var n=e.abortableTasks;n.forEach(function(n){return Ke(n,e,t)}),n.clear(),null!==e.destination&&it(e,e.destination)}catch(s){je(e,s),Ge(e,s)}}function at(){}function lt(e,n,s,r){var i=!1,o=null,a="",l={push:function(e){return null!==e&&(a+=e),!0},destroy:function(e){i=!0,o=e}},c=!1;if(e=function(e,t,n,s,r,i,o){var a=[],l=new Set;return(n=Ue(t={destination:null,responseState:t,progressiveChunkSize:s,status:0,fatalError:null,nextSegmentId:0,allPendingTasks:0,pendingRootTasks:0,completedRootSegment:null,abortableTasks:l,pingedTasks:a,clientRenderedBoundaries:[],completedBoundaries:[],partialBoundaries:[],onError:void 0===r?Fe:r,onAllReady:De,onShellReady:void 0===o?De:o,onShellError:De,onFatalError:De},0,null,n,!1,!1)).parentFlushed=!0,e=Be(t,e,null,n,l,Z,null,le),a.push(e),t}(e,function(e,t){return{bootstrapChunks:[],startInlineScript:"<script>",placeholderPrefix:(t=void 0===t?"":t)+"P:",segmentPrefix:t+"S:",boundaryPrefix:t+"B:",idPrefix:t,nextSuspenseID:0,sentCompleteSegmentFunction:!1,sentCompleteBoundaryFunction:!1,sentClientRenderFunction:!1,generateStaticMarkup:e}}(s,n?n.identifierPrefix:void 0),{insertionMode:1,selectedValue:null},1/0,at,0,function(){c=!0}),Je(e),ot(e,r),1===e.status)e.status=2,l.destroy(e.fatalError);else if(2!==e.status&&null===e.destination){e.destination=l;try{it(e,l)}catch(u){je(e,u),Ge(e,u)}}if(i)throw o;if(!c)throw Error(t(426));return a}return Zm.renderToNodeStream=function(){throw Error(t(207))},Zm.renderToStaticMarkup=function(e,t){return lt(e,t,!0,'The server used "renderToStaticMarkup" which does not support Suspense. If you intended to have the server wait for the suspended component please switch to "renderToReadableStream" which supports Suspense on the server')},Zm.renderToStaticNodeStream=function(){throw Error(t(208))},Zm.renderToString=function(e,t){return lt(e,t,!1,'The server used "renderToString" which does not support Suspense. If you intended for this Suspense boundary to render the fallback content on the server consider throwing an Error somewhere within the Suspense boundary. If you intended to have the server wait for the suspended component please switch to "renderToReadableStream" which supports Suspense on the server')},Zm.version="18.3.1",Zm}(),n_=function(){if(Qm)return e_;Qm=1;var e=m();function t(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=null,s=0;function r(e,t){if(0!==t.length)if(512<t.length)0<s&&(e.enqueue(new Uint8Array(n.buffer,0,s)),n=new Uint8Array(512),s=0),e.enqueue(t);else{var r=n.length-s;r<t.length&&(0===r?e.enqueue(n):(n.set(t.subarray(0,r),s),e.enqueue(n),t=t.subarray(r)),n=new Uint8Array(512),s=0),n.set(t,s),s+=t.length}}function i(e,t){return r(e,t),!0}function o(e){n&&0<s&&(e.enqueue(new Uint8Array(n.buffer,0,s)),n=null,s=0)}var a=new TextEncoder;function l(e){return a.encode(e)}function c(e){return a.encode(e)}function u(e,t){"function"==typeof e.error?e.error(t):e.close()}var h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function g(e){return!!h.call(p,e)||!h.call(f,e)&&(d.test(e)?p[e]=!0:(f[e]=!0,!1))}function _(e,t,n,s,r,i,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var y={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){y[e]=new _(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];y[t]=new _(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){y[e]=new _(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){y[e]=new _(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){y[e]=new _(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){y[e]=new _(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){y[e]=new _(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){y[e]=new _(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){y[e]=new _(e,5,!1,e.toLowerCase(),null,!1,!1)});var b=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(b,v);y[t]=new _(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(b,v);y[t]=new _(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(b,v);y[t]=new _(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){y[e]=new _(e,1,!1,e.toLowerCase(),null,!1,!1)}),y.xlinkHref=new _("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){y[e]=new _(e,1,!1,e.toLowerCase(),null,!0,!0)});var x={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},w=["Webkit","ms","Moz","O"];Object.keys(x).forEach(function(e){w.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),x[t]=x[e]})});var E=/["'&<>]/;function T(e){if("boolean"==typeof e||"number"==typeof e)return""+e;e=""+e;var t=E.exec(e);if(t){var n,s="",r=0;for(n=t.index;n<e.length;n++){switch(e.charCodeAt(n)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#x27;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}r!==n&&(s+=e.substring(r,n)),r=n+1,s+=t}e=r!==n?s+e.substring(r,n):s}return e}var S=/([A-Z])/g,A=/^ms-/,R=Array.isArray,C=c("<script>"),P=c("<\/script>"),k=c('<script src="'),I=c('<script type="module" src="'),M=c('" async=""><\/script>'),L=/(<\/|<)(s)(cript)/gi;function N(e,t,n,s){return t+("s"===n?"\\u0073":"\\u0053")+s}function O(e,t){return{insertionMode:e,selectedValue:t}}var F=c("\x3c!-- --\x3e");function D(e,t,n,s){return""===t?s:(s&&e.push(F),e.push(l(T(t))),!0)}var B=new Map,U=c(' style="'),j=c(":"),G=c(";");function V(e,n,s){if("object"!=typeof s)throw Error(t(62));for(var r in n=!0,s)if(h.call(s,r)){var i=s[r];if(null!=i&&"boolean"!=typeof i&&""!==i){if(0===r.indexOf("--")){var o=l(T(r));i=l(T((""+i).trim()))}else{o=r;var a=B.get(o);void 0!==a||(a=c(T(o.replace(S,"-$1").toLowerCase().replace(A,"-ms-"))),B.set(o,a)),o=a,i="number"==typeof i?0===i||h.call(x,r)?l(""+i):l(i+"px"):l(T((""+i).trim()))}n?(n=!1,e.push(U,o,j,i)):e.push(G,o,j,i)}}n||e.push(H)}var z=c(" "),W=c('="'),H=c('"'),$=c('=""');function X(e,t,n,s){switch(n){case"style":return void V(e,t,s);case"defaultValue":case"defaultChecked":case"innerHTML":case"suppressContentEditableWarning":case"suppressHydrationWarning":return}if(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])if(null!==(t=y.hasOwnProperty(n)?y[n]:null)){switch(typeof s){case"function":case"symbol":return;case"boolean":if(!t.acceptsBooleans)return}switch(n=l(t.attributeName),t.type){case 3:s&&e.push(z,n,$);break;case 4:!0===s?e.push(z,n,$):!1!==s&&e.push(z,n,W,l(T(s)),H);break;case 5:isNaN(s)||e.push(z,n,W,l(T(s)),H);break;case 6:!isNaN(s)&&1<=s&&e.push(z,n,W,l(T(s)),H);break;default:t.sanitizeURL&&(s=""+s),e.push(z,n,W,l(T(s)),H)}}else if(g(n)){switch(typeof s){case"function":case"symbol":return;case"boolean":if("data-"!==(t=n.toLowerCase().slice(0,5))&&"aria-"!==t)return}e.push(z,l(n),W,l(T(s)),H)}}var q=c(">"),Y=c("/>");function K(e,n,s){if(null!=n){if(null!=s)throw Error(t(60));if("object"!=typeof n||!("__html"in n))throw Error(t(61));null!=(n=n.__html)&&e.push(l(""+n))}}var Z=c(' selected=""');function Q(e,t,n,s){e.push(ne(n));var r,i=n=null;for(r in t)if(h.call(t,r)){var o=t[r];if(null!=o)switch(r){case"children":n=o;break;case"dangerouslySetInnerHTML":i=o;break;default:X(e,s,r,o)}}return e.push(q),K(e,i,n),"string"==typeof n?(e.push(l(T(n))),null):n}var J=c("\n"),ee=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,te=new Map;function ne(e){var n=te.get(e);if(void 0===n){if(!ee.test(e))throw Error(t(65,e));n=c("<"+e),te.set(e,n)}return n}var se=c("<!DOCTYPE html>"),re=c("</"),ie=c(">"),oe=c('<template id="'),ae=c('"></template>'),le=c("\x3c!--$--\x3e"),ce=c('\x3c!--$?--\x3e<template id="'),ue=c('"></template>'),he=c("\x3c!--$!--\x3e"),de=c("\x3c!--/$--\x3e"),fe=c("<template"),pe=c('"'),ge=c(' data-dgst="');c(' data-msg="'),c(' data-stck="');var me=c("></template>");function _e(e,n,s){if(r(e,ce),null===s)throw Error(t(395));return r(e,s),i(e,ue)}var ye=c('<div hidden id="'),be=c('">'),ve=c("</div>"),xe=c('<svg aria-hidden="true" style="display:none" id="'),we=c('">'),Ee=c("</svg>"),Te=c('<math aria-hidden="true" style="display:none" id="'),Se=c('">'),Ae=c("</math>"),Re=c('<table hidden id="'),Ce=c('">'),Pe=c("</table>"),ke=c('<table hidden><tbody id="'),Ie=c('">'),Me=c("</tbody></table>"),Le=c('<table hidden><tr id="'),Ne=c('">'),Oe=c("</tr></table>"),Fe=c('<table hidden><colgroup id="'),De=c('">'),Be=c("</colgroup></table>"),Ue=c('function $RS(a,b){a=document.getElementById(a);b=document.getElementById(b);for(a.parentNode.removeChild(a);a.firstChild;)b.parentNode.insertBefore(a.firstChild,b);b.parentNode.removeChild(b)};$RS("'),je=c('$RS("'),Ge=c('","'),Ve=c('")<\/script>'),ze=c('function $RC(a,b){a=document.getElementById(a);b=document.getElementById(b);b.parentNode.removeChild(b);if(a){a=a.previousSibling;var f=a.parentNode,c=a.nextSibling,e=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d)if(0===e)break;else e--;else"$"!==d&&"$?"!==d&&"$!"!==d||e++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;b.firstChild;)f.insertBefore(b.firstChild,c);a.data="$";a._reactRetry&&a._reactRetry()}};$RC("'),We=c('$RC("'),He=c('","'),$e=c('")<\/script>'),Xe=c('function $RX(b,c,d,e){var a=document.getElementById(b);a&&(b=a.previousSibling,b.data="$!",a=a.dataset,c&&(a.dgst=c),d&&(a.msg=d),e&&(a.stck=e),b._reactRetry&&b._reactRetry())};$RX("'),qe=c('$RX("'),Ye=c('"'),Ke=c(")<\/script>"),Ze=c(","),Qe=/[<\u2028\u2029]/g;function Je(e){return JSON.stringify(e).replace(Qe,function(e){switch(e){case"<":return"\\u003c";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:throw Error("escapeJSStringsForInstructionScripts encountered a match it does not know how to replace. this means the match regex and the replacement characters are no longer in sync. This is a bug in React")}})}var et=Object.assign,tt=Symbol.for("react.element"),nt=Symbol.for("react.portal"),st=Symbol.for("react.fragment"),rt=Symbol.for("react.strict_mode"),it=Symbol.for("react.profiler"),ot=Symbol.for("react.provider"),at=Symbol.for("react.context"),lt=Symbol.for("react.forward_ref"),ct=Symbol.for("react.suspense"),ut=Symbol.for("react.suspense_list"),ht=Symbol.for("react.memo"),dt=Symbol.for("react.lazy"),ft=Symbol.for("react.scope"),pt=Symbol.for("react.debug_trace_mode"),gt=Symbol.for("react.legacy_hidden"),mt=Symbol.for("react.default_value"),_t=Symbol.iterator;function yt(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case st:return"Fragment";case nt:return"Portal";case it:return"Profiler";case rt:return"StrictMode";case ct:return"Suspense";case ut:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case at:return(e.displayName||"Context")+".Consumer";case ot:return(e._context.displayName||"Context")+".Provider";case lt:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case ht:return null!==(t=e.displayName||null)?t:yt(e.type)||"Memo";case dt:t=e._payload,e=e._init;try{return yt(e(t))}catch(n){}}return null}var bt={};function vt(e,t){if(!(e=e.contextTypes))return bt;var n,s={};for(n in e)s[n]=t[n];return s}var xt=null;function wt(e,n){if(e!==n){e.context._currentValue=e.parentValue,e=e.parent;var s=n.parent;if(null===e){if(null!==s)throw Error(t(401))}else{if(null===s)throw Error(t(401));wt(e,s)}n.context._currentValue=n.value}}function Et(e){e.context._currentValue=e.parentValue,null!==(e=e.parent)&&Et(e)}function Tt(e){var t=e.parent;null!==t&&Tt(t),e.context._currentValue=e.value}function St(e,n){if(e.context._currentValue=e.parentValue,null===(e=e.parent))throw Error(t(402));e.depth===n.depth?wt(e,n):St(e,n)}function At(e,n){var s=n.parent;if(null===s)throw Error(t(402));e.depth===s.depth?wt(e,s):At(e,s),n.context._currentValue=n.value}function Rt(e){var t=xt;t!==e&&(null===t?Tt(e):null===e?Et(t):t.depth===e.depth?wt(t,e):t.depth>e.depth?St(t,e):At(t,e),xt=e)}var Ct={isMounted:function(){return!1},enqueueSetState:function(e,t){null!==(e=e._reactInternals).queue&&e.queue.push(t)},enqueueReplaceState:function(e,t){(e=e._reactInternals).replace=!0,e.queue=[t]},enqueueForceUpdate:function(){}};function Pt(e,t,n,s){var r=void 0!==e.state?e.state:null;e.updater=Ct,e.props=n,e.state=r;var i={queue:[],replace:!1};e._reactInternals=i;var o=t.contextType;if(e.context="object"==typeof o&&null!==o?o._currentValue:s,"function"==typeof(o=t.getDerivedStateFromProps)&&(r=null==(o=o(n,r))?r:et({},r,o),e.state=r),"function"!=typeof t.getDerivedStateFromProps&&"function"!=typeof e.getSnapshotBeforeUpdate&&("function"==typeof e.UNSAFE_componentWillMount||"function"==typeof e.componentWillMount))if(t=e.state,"function"==typeof e.componentWillMount&&e.componentWillMount(),"function"==typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),t!==e.state&&Ct.enqueueReplaceState(e,e.state,null),null!==i.queue&&0<i.queue.length)if(t=i.queue,o=i.replace,i.queue=null,i.replace=!1,o&&1===t.length)e.state=t[0];else{for(i=o?t[0]:e.state,r=!0,o=o?1:0;o<t.length;o++){var a=t[o];null!=(a="function"==typeof a?a.call(e,i,n,s):a)&&(r?(r=!1,i=et({},i,a)):et(i,a))}e.state=i}else i.queue=null}var kt={id:1,overflow:""};function It(e,t,n){var s=e.id;e=e.overflow;var r=32-Mt(s)-1;s&=~(1<<r),n+=1;var i=32-Mt(t)+r;if(30<i){var o=r-r%5;return i=(s&(1<<o)-1).toString(32),s>>=o,r-=o,{id:1<<32-Mt(t)+r|n<<r|s,overflow:i+e}}return{id:1<<i|n<<r|s,overflow:e}}var Mt=Math.clz32?Math.clz32:function(e){return 0==(e>>>=0)?32:31-(Lt(e)/Nt|0)|0},Lt=Math.log,Nt=Math.LN2,Ot="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},Ft=null,Dt=null,Bt=null,Ut=null,jt=!1,Gt=!1,Vt=0,zt=null,Wt=0;function Ht(){if(null===Ft)throw Error(t(321));return Ft}function $t(){if(0<Wt)throw Error(t(312));return{memoizedState:null,queue:null,next:null}}function Xt(){return null===Ut?null===Bt?(jt=!1,Bt=Ut=$t()):(jt=!0,Ut=Bt):null===Ut.next?(jt=!1,Ut=Ut.next=$t()):(jt=!0,Ut=Ut.next),Ut}function qt(){Dt=Ft=null,Gt=!1,Bt=null,Wt=0,Ut=zt=null}function Yt(e,t){return"function"==typeof t?t(e):t}function Kt(e,t,n){if(Ft=Ht(),Ut=Xt(),jt){var s=Ut.queue;if(t=s.dispatch,null!==zt&&void 0!==(n=zt.get(s))){zt.delete(s),s=Ut.memoizedState;do{s=e(s,n.action),n=n.next}while(null!==n);return Ut.memoizedState=s,[s,t]}return[Ut.memoizedState,t]}return e=e===Yt?"function"==typeof t?t():t:void 0!==n?n(t):t,Ut.memoizedState=e,e=(e=Ut.queue={last:null,dispatch:null}).dispatch=Qt.bind(null,Ft,e),[Ut.memoizedState,e]}function Zt(e,t){if(Ft=Ht(),t=void 0===t?null:t,null!==(Ut=Xt())){var n=Ut.memoizedState;if(null!==n&&null!==t){var s=n[1];e:if(null===s)s=!1;else{for(var r=0;r<s.length&&r<t.length;r++)if(!Ot(t[r],s[r])){s=!1;break e}s=!0}if(s)return n[0]}}return e=e(),Ut.memoizedState=[e,t],e}function Qt(e,n,s){if(25<=Wt)throw Error(t(301));if(e===Ft)if(Gt=!0,e={action:s,next:null},null===zt&&(zt=new Map),void 0===(s=zt.get(n)))zt.set(n,e);else{for(n=s;null!==n.next;)n=n.next;n.next=e}}function Jt(){throw Error(t(394))}function en(){}var tn={readContext:function(e){return e._currentValue},useContext:function(e){return Ht(),e._currentValue},useMemo:Zt,useReducer:Kt,useRef:function(e){Ft=Ht();var t=(Ut=Xt()).memoizedState;return null===t?(e={current:e},Ut.memoizedState=e):t},useState:function(e){return Kt(Yt,e)},useInsertionEffect:en,useLayoutEffect:function(){},useCallback:function(e,t){return Zt(function(){return e},t)},useImperativeHandle:en,useEffect:en,useDebugValue:en,useDeferredValue:function(e){return Ht(),e},useTransition:function(){return Ht(),[!1,Jt]},useId:function(){var e=Dt.treeContext,n=e.overflow;e=((e=e.id)&~(1<<32-Mt(e)-1)).toString(32)+n;var s=nn;if(null===s)throw Error(t(404));return n=Vt++,e=":"+s.idPrefix+"R"+e,0<n&&(e+="H"+n.toString(32)),e+":"},useMutableSource:function(e,t){return Ht(),t(e._source)},useSyncExternalStore:function(e,n,s){if(void 0===s)throw Error(t(407));return s()}},nn=null,sn=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentDispatcher;function rn(e){return null}function on(){}function an(e,t,n,s,r,i,o,a){e.allPendingTasks++,null===n?e.pendingRootTasks++:n.pendingTasks++;var l={node:t,ping:function(){var t=e.pingedTasks;t.push(l),1===t.length&&wn(e)},blockedBoundary:n,blockedSegment:s,abortSet:r,legacyContext:i,context:o,treeContext:a};return r.add(l),l}function ln(e,t,n,s,r,i){return{status:0,id:-1,index:t,parentFlushed:!1,chunks:[],children:[],formatContext:s,boundary:n,lastPushedText:r,textEmbedded:i}}function cn(e,t){if(null!=(e=e.onError(t))&&"string"!=typeof e)throw Error('onError returned something with a type other than "string". onError should return a string and may return null or undefined but must not return anything else. It received something of type "'+typeof e+'" instead');return e}function un(e,t){var n=e.onShellError;n(t),(n=e.onFatalError)(t),null!==e.destination?(e.status=2,u(e.destination,t)):(e.status=1,e.fatalError=t)}function hn(e,t,n,s,r){for(Ft={},Dt=t,Vt=0,e=n(s,r);Gt;)Gt=!1,Vt=0,Wt+=1,Ut=null,e=n(s,r);return qt(),e}function dn(e,n,s,r){var i=s.render(),o=r.childContextTypes;if(null!=o){var a=n.legacyContext;if("function"!=typeof s.getChildContext)r=a;else{for(var l in s=s.getChildContext())if(!(l in o))throw Error(t(108,yt(r)||"Unknown",l));r=et({},a,s)}n.legacyContext=r,gn(e,n,i),n.legacyContext=a}else gn(e,n,i)}function fn(e,t){if(e&&e.defaultProps){for(var n in t=et({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function pn(n,s,r,i,o){if("function"==typeof r)if(r.prototype&&r.prototype.isReactComponent){o=vt(r,s.legacyContext);var a=r.contextType;Pt(a=new r(i,"object"==typeof a&&null!==a?a._currentValue:o),r,i,o),dn(n,s,a,r)}else{o=hn(n,s,r,i,a=vt(r,s.legacyContext));var c=0!==Vt;if("object"==typeof o&&null!==o&&"function"==typeof o.render&&void 0===o.$$typeof)Pt(o,r,i,a),dn(n,s,o,r);else if(c){i=s.treeContext,s.treeContext=It(i,1,0);try{gn(n,s,o)}finally{s.treeContext=i}}else gn(n,s,o)}else{if("string"!=typeof r){switch(r){case gt:case pt:case rt:case it:case st:case ut:return void gn(n,s,i.children);case ft:throw Error(t(343));case ct:e:{r=s.blockedBoundary,o=s.blockedSegment,a=i.fallback,i=i.children;var u={id:null,rootSegmentID:-1,parentFlushed:!1,pendingTasks:0,forceClientRender:!1,completedSegments:[],byteSize:0,fallbackAbortableTasks:c=new Set,errorDigest:null},d=ln(0,o.chunks.length,u,o.formatContext,!1,!1);o.children.push(d),o.lastPushedText=!1;var f=ln(0,0,null,o.formatContext,!1,!1);f.parentFlushed=!0,s.blockedBoundary=u,s.blockedSegment=f;try{if(_n(n,s,i),f.lastPushedText&&f.textEmbedded&&f.chunks.push(F),f.status=1,vn(u,f),0===u.pendingTasks)break e}catch(p){f.status=4,u.forceClientRender=!0,u.errorDigest=cn(n,p)}finally{s.blockedBoundary=r,s.blockedSegment=o}s=an(n,a,r,d,c,s.legacyContext,s.context,s.treeContext),n.pingedTasks.push(s)}return}if("object"==typeof r&&null!==r)switch(r.$$typeof){case lt:if(i=hn(n,s,r.render,i,o),0!==Vt){r=s.treeContext,s.treeContext=It(r,1,0);try{gn(n,s,i)}finally{s.treeContext=r}}else gn(n,s,i);return;case ht:return void pn(n,s,r=r.type,i=fn(r,i),o);case ot:if(o=i.children,r=r._context,i=i.value,a=r._currentValue,r._currentValue=i,xt=i={parent:c=xt,depth:null===c?0:c.depth+1,context:r,parentValue:a,value:i},s.context=i,gn(n,s,o),null===(n=xt))throw Error(t(403));return i=n.parentValue,n.context._currentValue=i===mt?n.context._defaultValue:i,n=xt=n.parent,void(s.context=n);case at:return void gn(n,s,i=(i=i.children)(r._currentValue));case dt:return void pn(n,s,r=(o=r._init)(r._payload),i=fn(r,i),void 0)}throw Error(t(130,null==r?r:typeof r,""))}switch(a=function(n,s,r,i,o){switch(s){case"select":n.push(ne("select"));var a=null,c=null;for(p in r)if(h.call(r,p)){var u=r[p];if(null!=u)switch(p){case"children":a=u;break;case"dangerouslySetInnerHTML":c=u;break;case"defaultValue":case"value":break;default:X(n,i,p,u)}}return n.push(q),K(n,c,a),a;case"option":c=o.selectedValue,n.push(ne("option"));var d=u=null,f=null,p=null;for(a in r)if(h.call(r,a)){var m=r[a];if(null!=m)switch(a){case"children":u=m;break;case"selected":f=m;break;case"dangerouslySetInnerHTML":p=m;break;case"value":d=m;default:X(n,i,a,m)}}if(null!=c)if(r=null!==d?""+d:function(t){var n="";return e.Children.forEach(t,function(e){null!=e&&(n+=e)}),n}(u),R(c)){for(i=0;i<c.length;i++)if(""+c[i]===r){n.push(Z);break}}else""+c===r&&n.push(Z);else f&&n.push(Z);return n.push(q),K(n,p,u),u;case"textarea":for(u in n.push(ne("textarea")),p=c=a=null,r)if(h.call(r,u)&&null!=(d=r[u]))switch(u){case"children":p=d;break;case"value":a=d;break;case"defaultValue":c=d;break;case"dangerouslySetInnerHTML":throw Error(t(91));default:X(n,i,u,d)}if(null===a&&null!==c&&(a=c),n.push(q),null!=p){if(null!=a)throw Error(t(92));if(R(p)&&1<p.length)throw Error(t(93));a=""+p}return"string"==typeof a&&"\n"===a[0]&&n.push(J),null!==a&&n.push(l(T(""+a))),null;case"input":for(c in n.push(ne("input")),d=p=u=a=null,r)if(h.call(r,c)&&null!=(f=r[c]))switch(c){case"children":case"dangerouslySetInnerHTML":throw Error(t(399,"input"));case"defaultChecked":d=f;break;case"defaultValue":u=f;break;case"checked":p=f;break;case"value":a=f;break;default:X(n,i,c,f)}return null!==p?X(n,i,"checked",p):null!==d&&X(n,i,"checked",d),null!==a?X(n,i,"value",a):null!==u&&X(n,i,"value",u),n.push(Y),null;case"menuitem":for(var _ in n.push(ne("menuitem")),r)if(h.call(r,_)&&null!=(a=r[_]))switch(_){case"children":case"dangerouslySetInnerHTML":throw Error(t(400));default:X(n,i,_,a)}return n.push(q),null;case"title":for(m in n.push(ne("title")),a=null,r)if(h.call(r,m)&&null!=(c=r[m]))switch(m){case"children":a=c;break;case"dangerouslySetInnerHTML":throw Error(t(434));default:X(n,i,m,c)}return n.push(q),a;case"listing":case"pre":for(d in n.push(ne(s)),c=a=null,r)if(h.call(r,d)&&null!=(u=r[d]))switch(d){case"children":a=u;break;case"dangerouslySetInnerHTML":c=u;break;default:X(n,i,d,u)}if(n.push(q),null!=c){if(null!=a)throw Error(t(60));if("object"!=typeof c||!("__html"in c))throw Error(t(61));null!=(r=c.__html)&&("string"==typeof r&&0<r.length&&"\n"===r[0]?n.push(J,l(r)):n.push(l(""+r)))}return"string"==typeof a&&"\n"===a[0]&&n.push(J),a;case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":for(var y in n.push(ne(s)),r)if(h.call(r,y)&&null!=(a=r[y]))switch(y){case"children":case"dangerouslySetInnerHTML":throw Error(t(399,s));default:X(n,i,y,a)}return n.push(Y),null;case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return Q(n,r,s,i);case"html":return 0===o.insertionMode&&n.push(se),Q(n,r,s,i);default:if(-1===s.indexOf("-")&&"string"!=typeof r.is)return Q(n,r,s,i);for(f in n.push(ne(s)),c=a=null,r)if(h.call(r,f)&&null!=(u=r[f]))switch(f){case"children":a=u;break;case"dangerouslySetInnerHTML":c=u;break;case"style":V(n,i,u);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":break;default:g(f)&&"function"!=typeof u&&"symbol"!=typeof u&&n.push(z,l(f),W,l(T(u)),H)}return n.push(q),K(n,c,a),a}}((o=s.blockedSegment).chunks,r,i,n.responseState,o.formatContext),o.lastPushedText=!1,c=o.formatContext,o.formatContext=function(e,t,n){switch(t){case"select":return O(1,null!=n.value?n.value:n.defaultValue);case"svg":return O(2,null);case"math":return O(3,null);case"foreignObject":return O(1,null);case"table":return O(4,null);case"thead":case"tbody":case"tfoot":return O(5,null);case"colgroup":return O(7,null);case"tr":return O(6,null)}return 4<=e.insertionMode||0===e.insertionMode?O(1,null):e}(c,r,i),_n(n,s,a),o.formatContext=c,r){case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"input":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":break;default:o.chunks.push(re,l(r),ie)}o.lastPushedText=!1}}function gn(e,n,s){if(n.node=s,"object"==typeof s&&null!==s){switch(s.$$typeof){case tt:return void pn(e,n,s.type,s.props,s.ref);case nt:throw Error(t(257));case dt:var r=s._init;return void gn(e,n,s=r(s._payload))}if(R(s))return void mn(e,n,s);if((r=null===s||"object"!=typeof s?null:"function"==typeof(r=_t&&s[_t]||s["@@iterator"])?r:null)&&(r=r.call(s))){if(!(s=r.next()).done){var i=[];do{i.push(s.value),s=r.next()}while(!s.done);mn(e,n,i)}return}throw e=Object.prototype.toString.call(s),Error(t(31,"[object Object]"===e?"object with keys {"+Object.keys(s).join(", ")+"}":e))}"string"==typeof s?(r=n.blockedSegment).lastPushedText=D(n.blockedSegment.chunks,s,e.responseState,r.lastPushedText):"number"==typeof s&&((r=n.blockedSegment).lastPushedText=D(n.blockedSegment.chunks,""+s,e.responseState,r.lastPushedText))}function mn(e,t,n){for(var s=n.length,r=0;r<s;r++){var i=t.treeContext;t.treeContext=It(i,s,r);try{_n(e,t,n[r])}finally{t.treeContext=i}}}function _n(e,t,n){var s=t.blockedSegment.formatContext,r=t.legacyContext,i=t.context;try{return gn(e,t,n)}catch(l){if(qt(),"object"!=typeof l||null===l||"function"!=typeof l.then)throw t.blockedSegment.formatContext=s,t.legacyContext=r,t.context=i,Rt(i),l;n=l;var o=t.blockedSegment,a=ln(0,o.chunks.length,null,o.formatContext,o.lastPushedText,!0);o.children.push(a),o.lastPushedText=!1,e=an(e,t.node,t.blockedBoundary,a,t.abortSet,t.legacyContext,t.context,t.treeContext).ping,n.then(e,e),t.blockedSegment.formatContext=s,t.legacyContext=r,t.context=i,Rt(i)}}function yn(e){var t=e.blockedBoundary;(e=e.blockedSegment).status=3,xn(this,t,e)}function bn(e,n,s){var r=e.blockedBoundary;e.blockedSegment.status=3,null===r?(n.allPendingTasks--,2!==n.status&&(n.status=2,null!==n.destination&&n.destination.close())):(r.pendingTasks--,r.forceClientRender||(r.forceClientRender=!0,e=void 0===s?Error(t(432)):s,r.errorDigest=n.onError(e),r.parentFlushed&&n.clientRenderedBoundaries.push(r)),r.fallbackAbortableTasks.forEach(function(e){return bn(e,n,s)}),r.fallbackAbortableTasks.clear(),n.allPendingTasks--,0===n.allPendingTasks&&(r=n.onAllReady)())}function vn(e,t){if(0===t.chunks.length&&1===t.children.length&&null===t.children[0].boundary){var n=t.children[0];n.id=t.id,n.parentFlushed=!0,1===n.status&&vn(e,n)}else e.completedSegments.push(t)}function xn(e,n,s){if(null===n){if(s.parentFlushed){if(null!==e.completedRootSegment)throw Error(t(389));e.completedRootSegment=s}e.pendingRootTasks--,0===e.pendingRootTasks&&(e.onShellError=on,(n=e.onShellReady)())}else n.pendingTasks--,n.forceClientRender||(0===n.pendingTasks?(s.parentFlushed&&1===s.status&&vn(n,s),n.parentFlushed&&e.completedBoundaries.push(n),n.fallbackAbortableTasks.forEach(yn,e),n.fallbackAbortableTasks.clear()):s.parentFlushed&&1===s.status&&(vn(n,s),1===n.completedSegments.length&&n.parentFlushed&&e.partialBoundaries.push(n)));e.allPendingTasks--,0===e.allPendingTasks&&(e=e.onAllReady)()}function wn(e){if(2!==e.status){var t=xt,n=sn.current;sn.current=tn;var s=nn;nn=e.responseState;try{var r,i=e.pingedTasks;for(r=0;r<i.length;r++){var o=i[r],a=e,l=o.blockedSegment;if(0===l.status){Rt(o.context);try{gn(a,o,o.node),l.lastPushedText&&l.textEmbedded&&l.chunks.push(F),o.abortSet.delete(o),l.status=1,xn(a,o.blockedBoundary,l)}catch(f){if(qt(),"object"==typeof f&&null!==f&&"function"==typeof f.then){var c=o.ping;f.then(c,c)}else{o.abortSet.delete(o),l.status=4;var u=o.blockedBoundary,h=f,d=cn(a,h);null===u?un(a,h):(u.pendingTasks--,u.forceClientRender||(u.forceClientRender=!0,u.errorDigest=d,u.parentFlushed&&a.clientRenderedBoundaries.push(u))),a.allPendingTasks--,0===a.allPendingTasks&&(0,a.onAllReady)()}}}}i.splice(0,r),null!==e.destination&&Cn(e,e.destination)}catch(f){cn(e,f),un(e,f)}finally{nn=s,sn.current=n,n===tn&&Rt(t)}}}function En(e,n,s){switch(s.parentFlushed=!0,s.status){case 0:var o=s.id=e.nextSegmentId++;return s.lastPushedText=!1,s.textEmbedded=!1,e=e.responseState,r(n,oe),r(n,e.placeholderPrefix),r(n,e=l(o.toString(16))),i(n,ae);case 1:s.status=2;var a=!0;o=s.chunks;var c=0;s=s.children;for(var u=0;u<s.length;u++){for(a=s[u];c<a.index;c++)r(n,o[c]);a=Tn(e,n,a)}for(;c<o.length-1;c++)r(n,o[c]);return c<o.length&&(a=i(n,o[c])),a;default:throw Error(t(390))}}function Tn(e,n,s){var o=s.boundary;if(null===o)return En(e,n,s);if(o.parentFlushed=!0,o.forceClientRender)o=o.errorDigest,i(n,he),r(n,fe),o&&(r(n,ge),r(n,l(T(o))),r(n,pe)),i(n,me),En(e,n,s);else if(0<o.pendingTasks){o.rootSegmentID=e.nextSegmentId++,0<o.completedSegments.length&&e.partialBoundaries.push(o);var a=e.responseState,u=a.nextSuspenseID++;a=c(a.boundaryPrefix+u.toString(16)),o=o.id=a,_e(n,e.responseState,o),En(e,n,s)}else if(o.byteSize>e.progressiveChunkSize)o.rootSegmentID=e.nextSegmentId++,e.completedBoundaries.push(o),_e(n,e.responseState,o.id),En(e,n,s);else{if(i(n,le),1!==(s=o.completedSegments).length)throw Error(t(391));Tn(e,n,s[0])}return i(n,de)}function Sn(e,n,s){return function(e,n,s,o){switch(s.insertionMode){case 0:case 1:return r(e,ye),r(e,n.segmentPrefix),r(e,l(o.toString(16))),i(e,be);case 2:return r(e,xe),r(e,n.segmentPrefix),r(e,l(o.toString(16))),i(e,we);case 3:return r(e,Te),r(e,n.segmentPrefix),r(e,l(o.toString(16))),i(e,Se);case 4:return r(e,Re),r(e,n.segmentPrefix),r(e,l(o.toString(16))),i(e,Ce);case 5:return r(e,ke),r(e,n.segmentPrefix),r(e,l(o.toString(16))),i(e,Ie);case 6:return r(e,Le),r(e,n.segmentPrefix),r(e,l(o.toString(16))),i(e,Ne);case 7:return r(e,Fe),r(e,n.segmentPrefix),r(e,l(o.toString(16))),i(e,De);default:throw Error(t(397))}}(n,e.responseState,s.formatContext,s.id),Tn(e,n,s),function(e,n){switch(n.insertionMode){case 0:case 1:return i(e,ve);case 2:return i(e,Ee);case 3:return i(e,Ae);case 4:return i(e,Pe);case 5:return i(e,Me);case 6:return i(e,Oe);case 7:return i(e,Be);default:throw Error(t(397))}}(n,s.formatContext)}function An(e,n,s){for(var o=s.completedSegments,a=0;a<o.length;a++)Rn(e,n,s,o[a]);if(o.length=0,e=e.responseState,o=s.id,s=s.rootSegmentID,r(n,e.startInlineScript),e.sentCompleteBoundaryFunction?r(n,We):(e.sentCompleteBoundaryFunction=!0,r(n,ze)),null===o)throw Error(t(395));return s=l(s.toString(16)),r(n,o),r(n,He),r(n,e.segmentPrefix),r(n,s),i(n,$e)}function Rn(e,n,s,o){if(2===o.status)return!0;var a=o.id;if(-1===a){if(-1===(o.id=s.rootSegmentID))throw Error(t(392));return Sn(e,n,o)}return Sn(e,n,o),r(n,(e=e.responseState).startInlineScript),e.sentCompleteSegmentFunction?r(n,je):(e.sentCompleteSegmentFunction=!0,r(n,Ue)),r(n,e.segmentPrefix),r(n,a=l(a.toString(16))),r(n,Ge),r(n,e.placeholderPrefix),r(n,a),i(n,Ve)}function Cn(e,a){n=new Uint8Array(512),s=0;try{var c=e.completedRootSegment;if(null!==c&&0===e.pendingRootTasks){Tn(e,a,c),e.completedRootSegment=null;var u=e.responseState.bootstrapChunks;for(c=0;c<u.length-1;c++)r(a,u[c]);c<u.length&&i(a,u[c])}var h,d=e.clientRenderedBoundaries;for(h=0;h<d.length;h++){var f=d[h];u=a;var p=e.responseState,g=f.id,m=f.errorDigest,_=f.errorMessage,y=f.errorComponentStack;if(r(u,p.startInlineScript),p.sentClientRenderFunction?r(u,qe):(p.sentClientRenderFunction=!0,r(u,Xe)),null===g)throw Error(t(395));r(u,g),r(u,Ye),(m||_||y)&&(r(u,Ze),r(u,l(Je(m||"")))),(_||y)&&(r(u,Ze),r(u,l(Je(_||"")))),y&&(r(u,Ze),r(u,l(Je(y)))),i(u,Ke)}d.splice(0,h);var b=e.completedBoundaries;for(h=0;h<b.length;h++)An(e,a,b[h]);b.splice(0,h),o(a),n=new Uint8Array(512),s=0;var v=e.partialBoundaries;for(h=0;h<v.length;h++){var x=v[h];e:{d=e,f=a;var w=x.completedSegments;for(p=0;p<w.length;p++)if(!Rn(d,f,x,w[p])){p++,w.splice(0,p);var E=!1;break e}w.splice(0,p),E=!0}if(!E)return e.destination=null,h++,void v.splice(0,h)}v.splice(0,h);var T=e.completedBoundaries;for(h=0;h<T.length;h++)An(e,a,T[h]);T.splice(0,h)}finally{o(a),0===e.allPendingTasks&&0===e.pingedTasks.length&&0===e.clientRenderedBoundaries.length&&0===e.completedBoundaries.length&&a.close()}}function Pn(e,t){try{var n=e.abortableTasks;n.forEach(function(n){return bn(n,e,t)}),n.clear(),null!==e.destination&&Cn(e,e.destination)}catch(s){cn(e,s),un(e,s)}}return e_.renderToReadableStream=function(e,t){return new Promise(function(n,s){var r,i,o=new Promise(function(e,t){i=e,r=t}),a=function(e,t,n,s,r,i,o,a,l){var c=[],u=new Set;return(n=ln(t={destination:null,responseState:t,progressiveChunkSize:void 0===s?12800:s,status:0,fatalError:null,nextSegmentId:0,allPendingTasks:0,pendingRootTasks:0,completedRootSegment:null,abortableTasks:u,pingedTasks:c,clientRenderedBoundaries:[],completedBoundaries:[],partialBoundaries:[],onError:void 0===r?rn:r,onAllReady:void 0===i?on:i,onShellReady:void 0===o?on:o,onShellError:void 0===a?on:a,onFatalError:void 0===l?on:l},0,null,n,!1,!1)).parentFlushed=!0,e=an(t,e,null,n,u,bt,null,kt),c.push(e),t}(e,function(e,t,n,s,r){e=void 0===e?"":e,t=void 0===t?C:c('<script nonce="'+T(t)+'">');var i=[];if(void 0!==n&&i.push(t,l((""+n).replace(L,N)),P),void 0!==s)for(n=0;n<s.length;n++)i.push(k,l(T(s[n])),M);if(void 0!==r)for(s=0;s<r.length;s++)i.push(I,l(T(r[s])),M);return{bootstrapChunks:i,startInlineScript:t,placeholderPrefix:c(e+"P:"),segmentPrefix:c(e+"S:"),boundaryPrefix:e+"B:",idPrefix:e,nextSuspenseID:0,sentCompleteSegmentFunction:!1,sentCompleteBoundaryFunction:!1,sentClientRenderFunction:!1}}(t?t.identifierPrefix:void 0,t?t.nonce:void 0,t?t.bootstrapScriptContent:void 0,t?t.bootstrapScripts:void 0,t?t.bootstrapModules:void 0),function(e){return O("http://www.w3.org/2000/svg"===e?2:"http://www.w3.org/1998/Math/MathML"===e?3:0,null)}(t?t.namespaceURI:void 0),t?t.progressiveChunkSize:void 0,t?t.onError:void 0,i,function(){var e=new ReadableStream({type:"bytes",pull:function(e){if(1===a.status)a.status=2,u(e,a.fatalError);else if(2!==a.status&&null===a.destination){a.destination=e;try{Cn(a,e)}catch(t){cn(a,t),un(a,t)}}},cancel:function(){Pn(a)}},{highWaterMark:0});e.allReady=o,n(e)},function(e){o.catch(function(){}),s(e)},r);if(t&&t.signal){var h=t.signal,d=function(){Pn(a,h.reason),h.removeEventListener("abort",d)};h.addEventListener("abort",d)}wn(a)})},e_.version="18.3.1",e_}(),Km.version=t_.version,Km.renderToString=t_.renderToString,Km.renderToStaticMarkup=t_.renderToStaticMarkup,Km.renderToNodeStream=t_.renderToNodeStream,Km.renderToStaticNodeStream=t_.renderToStaticNodeStream,Km.renderToReadableStream=n_.renderToReadableStream),Km);const r_=new Map;function i_(e,t){const n=r_.get(e);if(n)return n;if(r_.size>=200){const e=r_.keys().next().value;e&&r_.delete(e)}const s=t();return r_.set(e,s),s}const o_=s_.renderToStaticMarkup(i.jsx(N,{size:16,color:ee,strokeWidth:2.5,fill:"none"})),a_=s_.renderToStaticMarkup(i.jsx(C,{size:16,color:se,strokeWidth:2.5,fill:"none"}));function l_(e=te,t=1,n=!1,s=!1){return i_(`filled:${e}:${t}:${n}:${s}`,()=>{const r=n?1.25:1;if(s){const n=18,s=n+2,i=(s-14)/2,o=(s-n)/2;return`<div style="\n        position: relative;\n        width: ${s}px;\n        height: ${s}px;\n        opacity: ${t};\n        filter: brightness(${r});\n        transition: filter 0s ease-in, filter 150ms ease-out;\n      ">\n        \x3c!-- Yellow inner stroke ring --\x3e\n        <div style="\n          position: absolute;\n          top: ${o}px;\n          left: ${o}px;\n          width: ${n}px;\n          height: ${n}px;\n          background: transparent;\n          border-radius: 50%;\n          border: 2px solid ${re};\n          box-sizing: border-box;\n          opacity: 0.85;\n        "></div>\n        \x3c!-- Inner filled dot --\x3e\n        <div style="\n          position: absolute;\n          top: ${i}px;\n          left: ${i}px;\n          width: 14px;\n          height: 14px;\n          background-color: ${e};\n          border-radius: 50%;\n          box-sizing: border-box;\n        "></div>\n      </div>`}return`<div style="\n      width: 14px;\n      height: 14px;\n      background-color: ${e};\n      border-radius: 50%;\n      box-sizing: border-box;\n      opacity: ${t};\n      filter: brightness(${r});\n      transition: filter 0s ease-in, filter 150ms ease-out;\n    "></div>`})}function c_(e){var t;const n=null==(t=e.contact_type)?void 0:t.toLowerCase();return"room server"===n||"room_server"===n||"room"===n||"server"===n}function u_(e){return e.startsWith("0x")?e.slice(2,4).toUpperCase():e.slice(0,2).toUpperCase()}function h_({hash:e,neighbor:t,isZeroHop:n,isHub:s,isGateway:r,isMobile:o,isRoomServer:a,centrality:l,lastHopData:c,affinity:u,txDelayRec:h,nodeOpacity:d,isHovered:p,onHover:g,onRequestRemove:m,isPopupOpen:_,onOpenPopup:v,onClosePopup:x,pulseIntensity:w=0}){const E=t.node_name||t.name||"Unknown",T=u_(e),S=(null==c?void 0:c.avgSnr)??void 0,A=(null==c?void 0:c.avgRssi)??void 0,R="stale"===(null==c?void 0:c.status),C=(null==c?void 0:c.lastSeen)??void 0,P=R?Math.min(d,.5):d,k=Math.round(20*P)/20,I=f.useMemo(()=>a?function(e=1,t=!1,n=!1){return i_(`roomserver:${e}:${t}:${n}`,()=>{const s=t?1.25:1;if(n){const t=16,n=t+4,r=n+2,i=(r-t)/2,o=(r-n)/2;return`<div style="\n        position: relative;\n        width: ${r}px;\n        height: ${r}px;\n        opacity: ${e};\n        filter: drop-shadow(0 1px 2px rgba(0,0,0,0.4)) brightness(${s});\n        transition: filter 0s ease-in, filter 150ms ease-out;\n      ">\n        \x3c!-- Yellow inner stroke ring --\x3e\n        <div style="\n          position: absolute;\n          top: ${o}px;\n          left: ${o}px;\n          width: ${n}px;\n          height: ${n}px;\n          background: transparent;\n          border-radius: 50%;\n          border: 2px solid ${re};\n          box-sizing: border-box;\n          opacity: 0.85;\n        "></div>\n        \x3c!-- Icon --\x3e\n        <div style="\n          position: absolute;\n          top: ${i}px;\n          left: ${i}px;\n          width: ${t}px;\n          height: ${t}px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        ">${a_}</div>\n      </div>`}return`<div style="\n      width: 16px;\n      height: 16px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      opacity: ${e};\n      filter: drop-shadow(0 1px 2px rgba(0,0,0,0.4)) brightness(${s});\n      transition: filter 0s ease-in, filter 150ms ease-out;\n    ">${a_}</div>`})}(k,p,n):s?l_(te,k,p,n):r?l_(J,k,p,n):function(e=J,t=1,n=!1,s=!1){return i_(`ring:${e}:${t}:${n}:${s}`,()=>{const r=n?1.25:1;if(s){const n=18,s=n+2,i=(s-14)/2,o=(s-n)/2;return`<div style="\n        position: relative;\n        width: ${s}px;\n        height: ${s}px;\n        opacity: ${t};\n        filter: brightness(${r});\n        transition: filter 0s ease-in, filter 150ms ease-out;\n      ">\n        \x3c!-- Yellow inner stroke ring --\x3e\n        <div style="\n          position: absolute;\n          top: ${o}px;\n          left: ${o}px;\n          width: ${n}px;\n          height: ${n}px;\n          background: transparent;\n          border-radius: 50%;\n          border: 2px solid ${re};\n          box-sizing: border-box;\n          opacity: 0.85;\n        "></div>\n        \x3c!-- Inner colored ring --\x3e\n        <div style="\n          position: absolute;\n          top: ${i}px;\n          left: ${i}px;\n          width: 14px;\n          height: 14px;\n          background: transparent;\n          border-radius: 50%;\n          border: 5px solid ${e};\n          box-sizing: border-box;\n        "></div>\n      </div>`}return`<div style="\n      width: 14px;\n      height: 14px;\n      background: transparent;\n      border-radius: 50%;\n      border: 5px solid ${e};\n      box-sizing: border-box;\n      opacity: ${t};\n      filter: brightness(${r});\n      transition: filter 0s ease-in, filter 150ms ease-out;\n    "></div>`})}(o?ne:J,k,p,n),[a,s,r,o,n,k,p]),M=n?20:14,L=f.useCallback(()=>g(e),[e,g]),N=f.useCallback(()=>g(null),[g]),O=f.useCallback(t=>{t.stopPropagation(),v(e)},[e,v]);return t.latitude&&t.longitude?i.jsxs(i.Fragment,{children:[i.jsx(y,{longitude:t.longitude,latitude:t.latitude,anchor:"center",children:i.jsx("div",{role:"button",tabIndex:0,"aria-label":`Node ${E}`,style:{width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",touchAction:"manipulation",WebkitTapHighlightColor:"transparent"},onClick:O,onTouchEnd:O,onMouseEnter:L,onMouseLeave:N,onKeyDown:t=>"Enter"===t.key&&v(e),children:i.jsx("div",{style:{pointerEvents:"none",filter:w>0?"brightness(1.5)":void 0,transition:"filter 1000ms ease-out"},dangerouslySetInnerHTML:{__html:I}})})}),_&&i.jsx(b,{longitude:t.longitude,latitude:t.latitude,anchor:"bottom",offset:[0,-M/2],closeOnClick:!0,onClose:x,className:"maplibre-popup",children:i.jsx(me,{hash:e,hashPrefix:T,name:E,isHub:s,isZeroHop:n,isMobile:o,isRoomServer:a,isStale:R,lastSeenTimestamp:C,centrality:l,affinity:u,meanSnr:S,meanRssi:A,neighbor:t,txDelayRec:h,onRemove:m?()=>m(e,E):void 0})})]}):null}function d_({localNode:e,localHash:t,isHovered:n,onHover:s,isPopupOpen:r,onOpenPopup:o,onClosePopup:a,pulseIntensity:l=0}){const c=f.useMemo(()=>function(e=!1){return i_(`local:${e}`,()=>`<div style="\n      width: 16px;\n      height: 16px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      filter: drop-shadow(0 1px 2px rgba(0,0,0,0.4)) brightness(${e?1.25:1});\n      transition: filter 0s ease-in, filter 150ms ease-out;\n    ">${o_}</div>`)}(n),[n]),u=f.useCallback(()=>s("local"),[s]),h=f.useCallback(()=>s(null),[s]),d=f.useCallback(e=>{e.stopPropagation(),o()},[o]);return e.latitude&&e.longitude?i.jsxs(i.Fragment,{children:[i.jsx(y,{longitude:e.longitude,latitude:e.latitude,anchor:"center",children:i.jsx("div",{role:"button",tabIndex:0,"aria-label":`Local node ${e.name}`,style:{width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",touchAction:"manipulation",WebkitTapHighlightColor:"transparent"},onClick:d,onTouchEnd:d,onMouseEnter:u,onMouseLeave:h,onKeyDown:e=>"Enter"===e.key&&o(),children:i.jsx("div",{style:{pointerEvents:"none",filter:l>0?"brightness(1.5)":void 0,transition:"filter 1000ms ease-out"},dangerouslySetInnerHTML:{__html:c}})})}),r&&i.jsx(b,{longitude:e.longitude,latitude:e.latitude,anchor:"bottom",offset:[0,-8],closeOnClick:!0,onClose:a,className:"maplibre-popup",children:i.jsxs("div",{className:"text-sm",children:[i.jsx("strong",{className:"text-base",children:e.name}),t&&i.jsx("span",{className:"ml-2 font-mono text-xs text-text-muted bg-surface-elevated px-1.5 py-0.5 rounded",children:u_(t)}),i.jsx("br",{}),i.jsx("span",{style:{color:ee},className:"font-medium",children:"This Node (Local)"}),i.jsx("br",{}),i.jsxs("span",{className:"text-xs text-text-muted",children:[e.latitude.toFixed(5),", ",e.longitude.toFixed(5)]})]})})]}):null}function f_({neighborsWithLocation:e,localNode:t,localHash:n,zeroHopNeighbors:s,lastHopNeighborMap:r,meshTopology:o,hoveredMarker:a,onMarkerHover:l,getNodeOpacity:c,shouldShowNode:u,onRequestRemove:h,localPulseIntensity:d=0,neighborPulseHashes:p,neighborPulseIntensity:g=0}){const[m,_]=f.useState(null),y=f.useCallback(e=>{_(e)},[]),b=f.useCallback(()=>{_(null)},[]),v=f.useMemo(()=>[...e].sort(([e,t],[n,r])=>{const i=(e,t)=>c_(t)?5e3:s.has(e)?3e3:o.hubNodes.includes(e)?2e3:o.gatewayNodes.includes(e)?1e3:0;return i(e,t)-i(n,r)}),[e,s,o.hubNodes,o.gatewayNodes]);return i.jsxs(i.Fragment,{children:[v.map(([e,t])=>{if(!t.latitude||!t.longitude)return null;const n=u(e),d=c(e,n);if(d<=.01)return null;const f=s.has(e),_=o.hubNodes.includes(e),v=o.gatewayNodes.includes(e),x=o.mobileNodes.includes(e),w=c_(t),E=o.centrality.get(e)||0,T=r.get(e)??null,S=o.fullAffinity.get(e),A=o.txDelayRecommendations.get(e),R=(null==p?void 0:p.has(e))?g:0;return i.jsx(h_,{hash:e,neighbor:t,isZeroHop:f,isHub:_,isGateway:v,isMobile:x,isRoomServer:w,centrality:E,lastHopData:T,affinity:S,txDelayRec:A,nodeOpacity:d,isHovered:a===e,onHover:l,onRequestRemove:h,isPopupOpen:m===e,onOpenPopup:y,onClosePopup:b,pulseIntensity:R},e)}),t&&t.latitude&&t.longitude&&i.jsx(d_,{localNode:t,localHash:n,isHovered:"local"===a,onHover:l,isPopupOpen:"local"===m,onOpenPopup:()=>y("local"),onClosePopup:b,pulseIntensity:d})]})}function p_(e,t=!1,n=!1,s=!1,r=.7){return e?t?le:n?ce:ue:s?r>=.75?oe:ie:r>=.85?ie:r>=.7?ae:"#1F2937"}function g_(e,t,n){const s=t[1]-e[1],r=t[0]-e[0],i=Math.sqrt(s*s+r*r);if(0===i)return{line1:[e,t],line2:[e,t]};const o=2e-5*n,a=-r/i*o,l=s/i*o;return{line1:[[e[0]+a,e[1]+l],[t[0]+a,t[1]+l]],line2:[[e[0]-a,e[1]-l],[t[0]-a,t[1]-l]]}}function m_(e){return[e[1],e[0]]}const __={id:"topology-weak-edges",type:"line",paint:{"line-color":["get","color"],"line-width":["get","width"],"line-opacity":["get","opacity"]},layout:{"line-cap":"round","line-join":"round"}},y_={id:"topology-validated-edges",type:"line",paint:{"line-color":["get","color"],"line-width":["get","width"],"line-opacity":["get","opacity"]},layout:{"line-cap":"round","line-join":"round"}},b_={id:"topology-validated-edges-hitarea",type:"line",paint:{"line-color":"transparent","line-width":16,"line-opacity":0},layout:{"line-cap":"round","line-join":"round"}};function v_({showTopology:e,isExiting:t,validatedPolylines:n,weakPolylines:s,edgeAnimProgress:r,weightAnimProgress:o,animStartWeights:a,animTargetWeights:l,maxCertainCount:c,loopEdgeKeys:u,backboneEdgeKeys:h,hoveredEdgeKey:d,onEdgeHover:p,highlightedEdgeKey:g,neighbors:m}){const _=e||t,y=f.useMemo(()=>_?function(e,t){const n=[];for(const{from:s,to:r,edge:i}of e){const e=t.get(i.key)??0;if(e<=0)continue;const o=[s[0]+(r[0]-s[0])*e,s[1]+(r[1]-s[1])*e];n.push({type:"Feature",properties:{key:i.key,color:ae,width:1.5,opacity:.5*e,isLoopEdge:!1,isBackbone:!1,isDirectPath:!1,isHubConnection:!1,certainCount:i.certainCount,confidence:i.avgConfidence??.7,symmetryRatio:i.symmetryRatio??1,dominantDirection:i.dominantDirection??"balanced",fromName:"",toName:""},geometry:{type:"LineString",coordinates:[m_(s),m_(o)]}})}return{type:"FeatureCollection",features:n}}(s,r):{type:"FeatureCollection",features:[]},[s,r,_]),b=f.useMemo(()=>_?function(e,t,n,s,r,i,o,a,l,c,u){const h=[];for(const{from:d,to:f,edge:p}of e){const e=t.get(p.key)??0;if(e<=0)continue;const i=r.get(p.key)??Y(p.certainCount),g=s.get(p.key)??i,m=g+(i-g)*n,_=o.has(p.key),y=a.has(p.key),b=p.avgConfidence??.7,v=l===p.key,x=null!==l,w=c===p.key,E=u[p.fromHash],T=u[p.toHash],S=(null==E?void 0:E.node_name)||(null==E?void 0:E.name)||p.fromHash.slice(0,8),A=(null==T?void 0:T.node_name)||(null==T?void 0:T.name)||p.toHash.slice(0,8),R=[d[0]+(f[0]-d[0])*e,d[1]+(f[1]-d[1])*e],C=.82*Math.min(1.5*e,1),P=x?v?1.25:.4:1;if(_){const{line1:e,line2:t}=g_(d,R,1.5*m),n=v?ce:ie,s=1.1*C*P,r=v?Math.max(2.5,.8*m):Math.max(1.5,.6*m);h.push({type:"Feature",properties:{key:`${p.key}-loop1`,color:n,width:r,opacity:s,isLoopEdge:!0,isBackbone:!1,isDirectPath:p.isDirectPathEdge??!1,isHubConnection:p.isHubConnection??!1,certainCount:p.certainCount,confidence:b,symmetryRatio:p.symmetryRatio??1,dominantDirection:p.dominantDirection??"balanced",fromName:S,toName:A},geometry:{type:"LineString",coordinates:[m_(e[0]),m_(e[1])]}}),h.push({type:"Feature",properties:{key:`${p.key}-loop2`,color:n,width:r,opacity:s,isLoopEdge:!0,isBackbone:!1,isDirectPath:p.isDirectPathEdge??!1,isHubConnection:p.isHubConnection??!1,certainCount:p.certainCount,confidence:b,symmetryRatio:p.symmetryRatio??1,dominantDirection:p.dominantDirection??"balanced",fromName:S,toName:A},geometry:{type:"LineString",coordinates:[m_(t[0]),m_(t[1])]}});continue}const k=w?"#FFD700":p_(v,p.isDirectPathEdge??!1,!1,y,b);let I=w?Math.max(1.6*m,4.5):y?1.3*m:m;v&&!w&&(I=Math.max(1.2*I,3));let M=w?.95:y?1.15*C:C;M*=P,h.push({type:"Feature",properties:{key:p.key,color:k,width:I,opacity:M,isLoopEdge:!1,isBackbone:y,isDirectPath:p.isDirectPathEdge??!1,isHubConnection:p.isHubConnection??!1,certainCount:p.certainCount,confidence:b,symmetryRatio:p.symmetryRatio??1,dominantDirection:p.dominantDirection??"balanced",fromName:S,toName:A},geometry:{type:"LineString",coordinates:[m_(d),m_(R)]}})}return{type:"FeatureCollection",features:h}}(n,r,o,a,l,0,u,h,d,g,m):{type:"FeatureCollection",features:[]},[n,r,o,a,l,c,u,h,d,g,m,_]);return _?i.jsxs(i.Fragment,{children:[i.jsx(v,{id:"weak-edges",type:"geojson",data:y,children:i.jsx(x,{...__})}),i.jsxs(v,{id:"validated-edges",type:"geojson",data:b,children:[i.jsx(x,{...b_}),i.jsx(x,{...y_})]})]}):null}const x_=["topology-validated-edges-hitarea","topology-validated-edges"];function w_(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[128,128,128]}const E_=w_(he),T_=w_(de),S_=w_(de),A_=[...E_,153],R_=[...T_,255],C_=[0,0,0,0];function P_(e,t,n,s,r){return[t+(s-t)*r,e+(n-e)*r,2e4*r*(1-r)]}function k_(e,t){const[n,s]=e,[r,i]=t,o=function(e,t,n,s){const r=(n-e)*Math.PI/180,i=(s-t)*Math.PI/180,o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(e*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))*6371}(n,s,r,i),a=Math.min(1.5/o,.5),l=a+Math.min(1.5/o,.5),c=[];let u=0;for(;u<1;){const e=Math.min(u+a,1),t=[],o=Math.max(2,Math.ceil(32*(e-u)));for(let a=0;a<=o;a++){const l=u+a/o*(e-u);t.push(P_(n,s,r,i,l))}c.push(t),u+=l}return{segments:c,totalSegments:c.length}}function I_({neighborPolylines:e,hoveredEdgeKey:t,onEdgeHover:n}){const{current:s}=_(),r=f.useRef(null),i=f.useRef(null),o=f.useRef(-1),a=f.useRef([]),l=f.useRef(null);f.useEffect(()=>{l.current=t},[t]),f.useEffect(()=>{const t=[];for(const{from:n,to:s,hash:r,neighbor:i,lastHopData:o}of e){const e=i.node_name||i.name||r.slice(0,8),a=(null==o?void 0:o.avgSnr)??i.snr,l=(null==o?void 0:o.avgRssi)??i.rssi,c=`neighbor-${r}`,{segments:u,totalSegments:h}=k_(n,s);u.forEach((n,s)=>{t.push({path:n,parentKey:c,segmentIndex:s,totalSegments:h,hash:r,name:e,prefix:null==o?void 0:o.prefix,rssi:l,snr:a,packetCount:null==o?void 0:o.count,confidence:null==o?void 0:o.confidence,hasAvgRssi:void 0!==(null==o?void 0:o.avgRssi),hasAvgSnr:void 0!==(null==o?void 0:o.avgSnr)})})}a.current=t},[e]);const c=f.useCallback((e,t,n)=>{if(e.parentKey===n)return R_;if(t<0)return A_;const s=(e.segmentIndex+.5)/e.totalSegments,r=Math.abs(s-t),i=Math.max(0,1-r/.15);return 0===i?A_:(C_[0]=E_[0]+(S_[0]-E_[0])*i|0,C_[1]=E_[1]+(S_[1]-E_[1])*i|0,C_[2]=E_[2]+(S_[2]-E_[2])*i|0,C_[3]=153+102*i|0,C_)},[]),u=f.useCallback((e,t)=>new Dm({id:"neighbor-arcs",data:a.current,pickable:!0,getPath:e=>e.path,getColor:n=>c(n,e,t),getWidth:e=>e.parentKey===t?3:1.875,widthUnits:"pixels",widthMinPixels:1,capRounded:!0,jointRounded:!0,onHover:e=>{e.object?n(e.object.parentKey):n(null)},updateTriggers:{getColor:[t,e],getWidth:[t]}}),[c,n]);return f.useEffect(()=>{const e=null==s?void 0:s.getMap();if(e)return r.current||(r.current=new mm({interleaved:!0,layers:[]}),e.addControl(r.current)),()=>{if(r.current&&e){try{e.removeControl(r.current)}catch{}r.current=null}}},[s]),f.useEffect(()=>{if(0===e.length)return;let t=!0,n=performance.now(),s=null;const a=()=>{t&&(n=performance.now(),o.current=0,i.current=requestAnimationFrame(c))},c=e=>{if(!t||!r.current)return;const h=e-n;if(h<1500){const e=1.15*(d=h/1500,1-Math.pow(1-d,3));o.current=e;const t=u(e,l.current);r.current.setProps({layers:[t]}),i.current=requestAnimationFrame(c)}else{o.current=-1;const e=u(-1,l.current);r.current.setProps({layers:[e]}),s=setTimeout(a,7e3)}var d};return a(),()=>{t=!1,null!==i.current&&cancelAnimationFrame(i.current),null!==s&&clearTimeout(s)}},[e,u]),f.useEffect(()=>{if(!r.current||0===e.length)return;const n=u(o.current,t);r.current.setProps({layers:[n]})},[t,u,e.length]),null}const M_=["neighbor-arcs"];function L_({positions:e}){const{current:t}=_(),n=f.useRef(!1);return f.useEffect(()=>{if(t&&0!==e.length&&!n.current)if(n.current=!0,1===e.length)t.flyTo({center:[e[0][1],e[0][0]],zoom:14,duration:1e3});else{const n=e.map(([e,t])=>[t,e]);let s=1/0,r=-1/0,i=1/0,o=-1/0;for(const[e,t]of n)s=Math.min(s,e),r=Math.max(r,e),i=Math.min(i,t),o=Math.max(o,t);const a=[[s,i],[r,o]];t.fitBounds(a,{padding:{top:15,bottom:15,left:15,right:15},maxZoom:16,duration:1e3})}},[t,e]),null}function N_({targetHash:e,nodeCoordinates:t,onComplete:n}){const{current:s}=_(),r=f.useRef(null);return f.useEffect(()=>{if(!s||!e||e===r.current)return;const i=t.get(e);if(!i)return;r.current=e;const[o,a]=i;s.flyTo({center:[a,o],zoom:15,duration:2500,essential:!0}),setTimeout(()=>{null==n||n()},2600)},[e,t,s,n]),null}function O_({highlightedEdgeKey:e,validatedPolylines:t,weakPolylines:n,onEnsureTopology:s}){const{current:r}=_();return f.useEffect(()=>{if(!r||!e)return;s();const i=t.find(t=>t.edge.key===e)||n.find(t=>t.edge.key===e);if(!i)return;const o=(i.from[0]+i.to[0])/2,a=(i.from[1]+i.to[1])/2,l=r.getZoom(),c=Math.max(l,11);r.flyTo({center:[a,o],zoom:c,duration:500,essential:!0})},[e,t,n,r,s]),null}const F_={longitude:0,latitude:0,zoom:2};function D_({type:e,properties:t,maxCertainCount:n}){if("neighbor"===e){const e=t;return i.jsxs("div",{className:"text-xs",children:[i.jsxs("div",{className:"font-medium text-text-primary",children:[i.jsx("span",{className:"text-amber-400",children:"â—"})," ",e.name,e.prefix&&i.jsxs("span",{className:"ml-1 text-text-muted font-mono text-[10px]",children:["(",e.prefix,")"]})]}),i.jsxs("div",{className:"text-text-secondary flex gap-2",children:[void 0!==e.rssi&&null!==e.rssi&&i.jsxs("span",{children:["RSSI: ",Math.round(e.rssi)," dBm",e.hasAvgRssi&&" avg"]}),void 0!==e.snr&&null!==e.snr&&i.jsxs("span",{children:["SNR: ",Number(e.snr).toFixed(1)," dB",e.hasAvgSnr&&" avg"]})]}),void 0!==e.packetCount&&i.jsxs("div",{className:"text-text-muted text-[10px]",children:[Number(e.packetCount).toLocaleString()," packets",void 0!==e.confidence&&` â€¢ ${Math.round(100*Number(e.confidence))}% conf`]}),i.jsx("div",{className:"text-amber-400 text-[10px] mt-0.5",children:"Direct RF neighbor"})]})}const s=t,r=n>0?Number(s.certainCount)/n:0;return i.jsxs("div",{className:"text-xs",children:[i.jsxs("div",{className:"font-medium text-text-primary",children:[s.fromName," â†” ",s.toName]}),i.jsxs("div",{className:"text-text-secondary",children:[s.certainCount," validations (",Math.round(100*r),"%) â€¢ ",Math.round(100*Number(s.confidence)),"% conf"]}),s.isBackbone&&i.jsx("div",{className:"text-gray-300 font-semibold",children:"Backbone"}),s.isLoopEdge&&i.jsx("div",{className:"text-indigo-400 text-[10px] mt-0.5",children:"Redundant path"}),s.isDirectPath&&i.jsx("div",{className:"text-teal-400 text-[10px]",children:"Direct path"})]})}function B_({neighbors:e,localNode:t,localHash:n,onRemoveNode:s,selectedNodeHash:r,onNodeSelected:o,highlightedEdgeKey:a}){const l=f.useRef(null),p=c(),g=u(),m=h(),_=d(),[y,v]=f.useState(F_),[x,S]=f.useState(!1),[A,R]=f.useState(!1),[C,k]=f.useState(!1),[I,M]=f.useState(!1),[L,N]=f.useState(null),[O,F]=f.useState(null),[D,B]=f.useState(null),[U,j]=f.useState(""),[G,V]=f.useState(!1),[z,W]=f.useState("fetching"),[H,$]=f.useState(!1),[X,q]=f.useState(0),K=function(){const[e,t]=f.useState(!1),[n,s]=f.useState("idle"),[r,i]=f.useState(()=>"undefined"!=typeof localStorage&&"true"===localStorage.getItem(Wm)),[o,a]=f.useState([]),[l,c]=f.useState([]),[u,h]=f.useState(null),[d,p]=f.useState(()=>"undefined"==typeof localStorage?"":localStorage.getItem(zm)||""),[g,m]=f.useState({coverageCount:0,repeaterCount:0,lastUpdated:null}),_="connecting"===n||"loading"===n||"processing"===n,y=o.length>0&&r,b=f.useCallback(()=>{t(!0)},[]),v=f.useCallback(()=>{t(!1)},[]),x=f.useCallback(e=>{p(e)},[]),w=f.useCallback(async e=>{if(!e.trim())return h("Please enter a URL"),s("error"),!1;try{new URL(e.trim())}catch{return h("Invalid URL format"),s("error"),!1}h(null),s("connecting");try{s("loading");const t=await async function(e){const t=e.replace(/\/+$/,""),n=await fetch(t,{headers:{Accept:"application/json"}});if(!n.ok)throw new Error(`Failed to fetch wardriving data: ${n.status} ${n.statusText}`);return n.json()}(e.trim());if(!t||"object"!=typeof t)throw new Error("Invalid response from server");if(!Array.isArray(t.coverage)&&!Array.isArray(t.samples))throw new Error("No coverage data found in response");s("processing");const n=function(e){const t=[],n=new Map;for(const s of e.coverage){const e=n.get(s.id)||{rcv:0,lost:0,time:0,repeaters:new Set};if(e.rcv+=s.rcv||0,e.lost+=s.lost||0,s.time&&s.time>e.time&&(e.time=s.time),s.rptr)for(const t of s.rptr)e.repeaters.add(t.toLowerCase());void 0!==s.snr&&(e.snr=s.snr),void 0!==s.rssi&&(e.rssi=s.rssi),n.set(s.id,e)}for(const s of e.samples){const e=s.id.substring(0,6),t=n.get(e)||{rcv:0,lost:0,time:0,repeaters:new Set};t.rcv+=s.heard||0,t.lost+=s.lost||0,s.time&&s.time>t.time&&(t.time=s.time);const r=s.path||s.rptr;if(r)for(const n of r)t.repeaters.add(n.toLowerCase());n.set(e,t)}for(const[s,r]of n){const{lat:e,lon:n}=jm(s),i=r.rcv+r.lost;if(0===i)continue;const o=r.rcv/i,a=r.time?Gm(r.time):30,l=o*Vm(a);t.push({lat:e,lon:n,successRate:o,weight:l,totalSamples:i,ageDays:a,geohash:s,repeaters:Array.from(r.repeaters)})}return t.length>0&&(t[0],t.map(e=>e.lat),t.map(e=>e.lon)),{coveragePoints:t,repeaters:e.repeaters.filter(e=>0!==e.lat&&0!==e.lon).map(e=>{const t=e.time?Gm(e.time):30;return{id:e.id,name:e.name,lat:e.lat,lon:e.lon,elev:e.elev,ageDays:t,isStale:t>2,isDead:t>8}})}}(t);if(0===n.coveragePoints.length)throw new Error("No valid coverage points found");return a(n.coveragePoints),c(n.repeaters),m({coverageCount:n.coveragePoints.length,repeaterCount:n.repeaters.length,lastUpdated:new Date}),s("success"),i(!0),Hm(e.trim()),$m(!0),p(e.trim()),!0}catch(t){const e=t instanceof Error?t.message:"Failed to load coverage data";let n=e;return e.includes("Failed to fetch")||e.includes("NetworkError")?n="Could not connect to server. Check the URL and try again.":e.includes("CORS")?n="Server does not allow cross-origin requests.":e.includes("404")&&(n="Coverage endpoint not found. Check the URL."),h(n),s("error"),!1}},[]);return{state:{status:n,isVisible:r,coveragePoints:o,repeaters:l,error:u,stats:g,url:d},actions:{openModal:b,closeModal:v,loadCoverage:w,clearCoverage:f.useCallback(()=>{a([]),c([]),m({coverageCount:0,repeaterCount:0,lastUpdated:null}),s("idle"),h(null),i(!1),p(""),Hm(""),$m(!1)},[]),toggleVisibility:f.useCallback(()=>{i(e=>{const t=!e;return $m(t),t})},[]),setUrl:x},isModalOpen:e,isLoading:_,isActive:y}}(),[Z,J]=f.useState(null),ee=f.useMemo(()=>Object.entries(e).filter(([,e])=>e.latitude&&e.longitude),[e]),te=f.useMemo(()=>{const e=[];(null==t?void 0:t.latitude)&&(null==t?void 0:t.longitude)&&e.push([t.latitude,t.longitude]);for(const[,t]of ee)t.latitude&&t.longitude&&e.push([t.latitude,t.longitude]);return e},[t,ee]),ne=f.useMemo(()=>{const e=new Map;n&&(null==t?void 0:t.latitude)&&(null==t?void 0:t.longitude)&&e.set(n,[t.latitude,t.longitude]);for(const[t,n]of ee)n.latitude&&n.longitude&&e.set(t,[n.latitude,n.longitude]);return e},[n,t,ee]),se=f.useMemo(()=>{const e=new Map;for(const t of m)"expired"!==t.status&&e.set(t.hash,{hash:t.hash,prefix:t.prefix,count:t.count,avgRssi:t.avgRssi,avgSnr:t.avgSnr,lastSeen:t.lastSeen,confidence:1,status:t.status});return e},[m]),re=f.useMemo(()=>{var t,n;const s=new Set;for(const r of se.keys())(null==(t=e[r])?void 0:t.latitude)&&(null==(n=e[r])?void 0:n.longitude)&&s.add(r);return s},[se,e]),ie=f.useMemo(()=>{const e=[];for(const t of p.validatedEdges){const n=ne.get(t.fromHash),s=ne.get(t.toHash);n&&s&&e.push({from:n,to:s,edge:t})}return e},[p.validatedEdges,ne]),oe=f.useMemo(()=>{const e=[];for(const t of p.weakEdges){const n=ne.get(t.fromHash),s=ne.get(t.toHash);n&&s&&e.push({from:n,to:s,edge:t})}return e},[p.weakEdges,ne]),ae=f.useMemo(()=>{if(!(null==t?void 0:t.latitude)||!(null==t?void 0:t.longitude))return[];const n=[],s=[t.latitude,t.longitude];for(const t of re){const r=e[t];(null==r?void 0:r.latitude)&&(null==r?void 0:r.longitude)&&n.push({from:s,to:[r.latitude,r.longitude],hash:t,neighbor:r,lastHopData:se.get(t)??null})}return n},[t,re,e,se]),le=f.useMemo(()=>new Set(p.loopEdgeKeys),[p.loopEdgeKeys]),ce=f.useMemo(()=>new Set(p.backboneEdges),[p.backboneEdges]),ue=f.useMemo(()=>{let e=0;for(const t of p.validatedEdges)t.certainCount>e&&(e=t.certainCount);return e||1},[p.validatedEdges]),{edgeAnimProgress:he,weightAnimProgress:de,animStartWeights:pe,animTargetWeights:ge,isExiting:me,resetAnimationState:ye}=function({showTopology:e,polylines:t,weakPolylines:n,maxCertainCount:s,getWeight:r}){const[i,o]=f.useState(new Map),[a,l]=f.useState(1),[c,u]=f.useState(!1),h=f.useRef(e),d=f.useRef(new Set),p=f.useRef(""),[g,m]=f.useState(new Map),[_,y]=f.useState(new Map),b=f.useRef(new Map),v=f.useRef(new Map);f.useEffect(()=>{v.current=i},[i]);const x=f.useCallback(()=>{o(new Map),d.current=new Set,p.current="",m(new Map),y(new Map)},[]);return f.useEffect(()=>{const t=h.current,n=e;if(h.current=e,t&&!n&&!c){u(!0);const e=new Map(v.current);let t=null;const n=s=>{t||(t=s);const r=s-t,i=Math.min(r/500,1),a=(l=i,1-Math.pow(1-l,3));var l;o(()=>{const t=new Map;for(const[n,s]of e)t.set(n,s*(1-a));return t}),i<1?requestAnimationFrame(n):(u(!1),o(new Map),d.current=new Set,p.current="",m(new Map),y(new Map))};requestAnimationFrame(n)}!t&&n&&(o(new Map),d.current=new Set,p.current="")},[e,c]),f.useEffect(()=>{if(!e||c)return;const i=[...t,...n],a=i.map(e=>`${e.edge.key}:${e.edge.certainCount}`).sort().join(","),u=0===d.current.size,h=""!==p.current&&p.current!==a;if(u||h){const e=[],n=[];for(const{edge:t}of i)d.current.has(t.key)?n.push(t.key):e.push(t.key);if(h&&n.length>0){const e=new Map;for(const t of n){const n=b.current.get(t);void 0!==n&&e.set(t,n)}m(e),l(0)}const a=new Map;for(const{edge:i}of t){const e=r(i.certainCount,s);a.set(i.key,e)}if(y(a),o(t=>{const s=new Map(t);for(const n of e)s.set(n,0);for(const e of n)s.has(e)||s.set(e,1);return s}),e.length>0){let t=null;const n=Math.min(100,fe/e.length/2),s=r=>{t||(t=r);const i=r-t;o(t=>{const s=new Map(t);return e.forEach((e,t)=>{const r=t*n,o=Math.max(0,i-r),a=Xm(Math.min(o/fe,1));s.set(e,a)}),s});const a=fe+(e.length-1)*n;i<a&&requestAnimationFrame(s)};requestAnimationFrame(s)}if(h&&n.length>0){let e=null;const t=n=>{e||(e=n);const s=n-e,r=Math.min(s/fe,1),i=Xm(r);l(i),r<1&&requestAnimationFrame(t)};requestAnimationFrame(t)}for(const t of e)d.current.add(t)}for(const{edge:e}of t){const t=r(e.certainCount,s);b.current.set(e.key,t)}p.current=a},[e,c,t,n,s,r]),{edgeAnimProgress:i,weightAnimProgress:a,isExiting:c,animStartWeights:g,animTargetWeights:_,resetAnimationState:x}}({showTopology:A,polylines:ie,weakPolylines:oe,maxCertainCount:ue,getWeight:Y}),be=f.useMemo(()=>{const e=new Set;for(const t of p.hubNodes){e.add(t);for(const n of p.validatedEdges)n.fromHash===t&&e.add(n.toHash),n.toHash===t&&e.add(n.fromHash)}return e},[p.hubNodes,p.validatedEdges]),xe=f.useMemo(()=>{const e=new Set;if(!n)return e;for(const t of p.validatedEdges)t.fromHash===n&&e.add(t.toHash),t.toHash===n&&e.add(t.fromHash);return e},[n,p.validatedEdges]),{getNodeOpacity:we}=function({soloDirect:e,soloHubs:t,neighborHashes:n,hubConnectedNodes:s,directNodeSet:r,localConnectedNodes:i,showTopology:o}){const[a,l]=f.useState(new Map),c=f.useRef(e),u=f.useRef(t),h=f.useRef(new Map),d=f.useRef(null),p=f.useRef(s),g=f.useRef(r),m=f.useRef(i),_=f.useRef(o);return f.useEffect(()=>{p.current=s,g.current=r,m.current=i,_.current=o},[s,r,i,o]),f.useEffect(()=>{const s=c.current,r=u.current,i=e,o=t;if(c.current=e,u.current=t,s===i&&r===o)return;d.current&&(cancelAnimationFrame(d.current),d.current=null);const a=p.current,f=g.current,y=m.current,b=_.current;for(const e of n)h.current.has(e)||h.current.set(e,Math.random());const v=(e,t,n)=>{const s=a.has(e),r=f.has(e),i=b&&y.has(e);return!t&&!n||(t&&n?s||r||i:n?s:!t||r||i)},x=[];for(const e of n){const t=v(e,s,r),n=v(e,i,o);t!==n&&x.push({hash:e,startOpacity:t?1:0,targetOpacity:n?1:0})}if(0===x.length)return;l(e=>{const t=new Map(e);for(const{hash:n,startOpacity:s}of x)t.set(n,s);return t});const w=x;let E=null;const T=e=>{E||(E=e);const t=e-E;let n=!0;l(()=>{const e=new Map;for(const{hash:s,startOpacity:r,targetOpacity:i}of w){const o=250*(h.current.get(s)??0),a=Math.max(0,t-o),l=Math.min(a/500,1),c=r+(i-r)*qm(l);e.set(s,c),l<1&&(n=!1)}return e}),t<750&&!n?d.current=requestAnimationFrame(T):(d.current=null,l(new Map))};return d.current=requestAnimationFrame(T),()=>{d.current&&(cancelAnimationFrame(d.current),d.current=null)}},[e,t,n]),{nodeOpacities:a,getNodeOpacity:(e,t)=>a.has(e)?a.get(e):t?1:0}}({soloDirect:C,soloHubs:I,neighborHashes:ee.map(([e])=>e),hubConnectedNodes:be,directNodeSet:re,localConnectedNodes:xe,showTopology:A}),Te=f.useCallback(e=>{if(!C&&!I)return!0;if(C)return re.has(e);if(I){if(p.hubNodes.includes(e))return!0;for(const t of p.validatedEdges){if(t.fromHash===e&&p.hubNodes.includes(t.toHash))return!0;if(t.toHash===e&&p.hubNodes.includes(t.fromHash))return!0}return!1}return!0},[C,I,re,p.hubNodes,p.validatedEdges]),Ae=f.useCallback(async()=>{$(!0),V(!0),W("fetching"),q(0),await g(),q(_.packetCount),W("analyzing"),await new Promise(e=>setTimeout(e,200)),W("building");const e=Date.now(),t=Date.now()-e;t<1700&&await new Promise(e=>setTimeout(e,1700-t)),W("complete"),await new Promise(e=>setTimeout(e,1e3)),V(!1),$(!1),ye(),setTimeout(()=>{R(!0)},150)},[g,ye,_.packetCount]),Re=f.useCallback(e=>{v(e.viewState)},[]),Ce=f.useCallback(()=>{S(e=>!e)},[]),Pe=f.useCallback(()=>{R(e=>!e)},[]),ke=f.useCallback(()=>{k(e=>!e)},[]),Ie=f.useCallback(()=>{M(e=>!e)},[]),Me=f.useCallback(()=>{A||R(!0)},[A]),Le=f.useCallback((e,t)=>{B(e),j(t)},[]),Ne=f.useCallback(()=>{D&&s&&s(D),B(null),j("")},[D,s]),Oe=f.useMemo(()=>[...x_,...M_],[]),Fe=f.useCallback(e=>{var t;if(!e.features||0===e.features.length)return;const n=e.features[0],s=null==(t=n.layer)?void 0:t.id,r=n.properties;if(!(null==r?void 0:r.key))return;const i=null==s?void 0:s.startsWith("topology-"),o=null==s?void 0:s.startsWith("neighbor-");if(i||o){const t=r.key.replace(/-loop[12]$/,"");F(t),e.lngLat&&J({longitude:e.lngLat.lng,latitude:e.lngLat.lat,type:i?"topology":"neighbor",properties:r})}l.current&&(l.current.getCanvas().style.cursor="pointer")},[]),De=f.useCallback(()=>{F(null),J(null),l.current&&(l.current.getCanvas().style.cursor="")},[]),Be=x?"h-screen":"h-[500px]",Ue=x?"fixed inset-0 z-50 bg-surface":"glass-card overflow-hidden";return i.jsxs("div",{className:`${Ue} ${Be}`,children:[i.jsxs("div",{className:"relative w-full h-full",children:[i.jsxs(w,{ref:l,...y,onMove:Re,mapStyle:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",style:{width:"100%",height:"100%"},attributionControl:!1,interactiveLayerIds:Oe,onMouseMove:Fe,onMouseLeave:De,onLoad:e=>{const t=e.target,n=t.getStyle();if(null==n?void 0:n.layers)for(const s of n.layers)"symbol"===s.type&&(t.setPaintProperty(s.id,"text-color","rgba(50, 52, 58, 1)"),t.setPaintProperty(s.id,"text-halo-color","rgba(8, 9, 11, 0.9)"),t.setPaintProperty(s.id,"text-halo-width",1),t.setLayoutProperty(s.id,"text-font",["Inter","Open Sans Regular","Arial Unicode MS Regular"]))},children:[i.jsx(E,{position:"top-left",style:{marginTop:"1rem",marginLeft:"1rem"}}),i.jsx(T,{position:"bottom-right"}),i.jsx(L_,{positions:te}),i.jsx(Um,{coveragePoints:K.state.coveragePoints,visible:K.isActive}),r&&i.jsx(N_,{targetHash:r,nodeCoordinates:ne,onComplete:o}),a&&i.jsx(O_,{highlightedEdgeKey:a,validatedPolylines:ie,weakPolylines:oe,onEnsureTopology:Me}),i.jsx(v_,{showTopology:A,isExiting:me,validatedPolylines:ie,weakPolylines:oe,edgeAnimProgress:he,weightAnimProgress:de,animStartWeights:pe,animTargetWeights:ge,maxCertainCount:ue,loopEdgeKeys:le,backboneEdgeKeys:ce,hoveredEdgeKey:O,onEdgeHover:F,highlightedEdgeKey:a,neighbors:e}),i.jsx(f_,{neighborsWithLocation:ee,localNode:t,localHash:n,zeroHopNeighbors:re,lastHopNeighborMap:se,meshTopology:p,hoveredMarker:L,onMarkerHover:N,getNodeOpacity:we,shouldShowNode:Te,onRequestRemove:s?Le:void 0}),i.jsx(I_,{neighborPolylines:ae,hoveredEdgeKey:O,onEdgeHover:F}),Z&&i.jsx(b,{longitude:Z.longitude,latitude:Z.latitude,anchor:"bottom",offset:[0,-20],closeButton:!1,closeOnClick:!1,className:"maplibre-popup",children:i.jsx(D_,{type:Z.type,properties:Z.properties,maxCertainCount:ue})})]}),i.jsx(ve,{isDeepLoading:H,showDeepAnalysisModal:G,onDeepAnalysis:Ae,showTopology:A,onToggleTopology:Pe,hasValidatedPolylines:ie.length>0,soloHubs:I,onToggleSoloHubs:Ie,hasHubNodes:p.hubNodes.length>0,soloDirect:C,onToggleSoloDirect:ke,hasZeroHopNeighbors:re.size>0,isFullscreen:x,onToggleFullscreen:Ce}),i.jsx(_e,{showTopology:A,validatedPolylineCount:ie.length,filteredNeighborCount:ee.length,hasLocalNode:!(!(null==t?void 0:t.latitude)||!(null==t?void 0:t.longitude)),meshTopology:p,zeroHopNeighbors:re,neighborsWithLocation:ee}),i.jsx(Ee,{isActive:K.isActive,onClick:K.actions.openModal})]}),!x&&i.jsxs("div",{className:"absolute inset-0 pointer-events-none rounded-[1.125rem] overflow-hidden",children:[i.jsx("div",{className:"absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-white/20 to-transparent"}),i.jsx("div",{className:"absolute top-0 left-0 w-24 h-24 bg-gradient-to-br from-white/[0.03] to-transparent"}),i.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-gradient-to-bl from-white/[0.03] to-transparent"}),i.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-16 bg-gradient-to-t from-black/20 to-transparent"})]}),i.jsx(P,{isOpen:null!==D,onCancel:()=>B(null),onConfirm:Ne,title:"Remove Node?",message:`Remove "${U}" from the contacts list? This will hide the node until it sends a new packet.`,confirmLabel:"Remove",cancelLabel:"Cancel",variant:"danger"}),i.jsx(Q,{isOpen:G,currentStep:z,packetCount:X}),i.jsx(Se,{isOpen:K.isModalOpen,onClose:K.actions.closeModal,state:K.state,isLoading:K.isLoading,isActive:K.isActive,onLoadCoverage:K.actions.loadCoverage,onClearCoverage:K.actions.clearCoverage,onToggleVisibility:K.actions.toggleVisibility,onSetUrl:K.actions.setUrl})]})}export{B_ as default};
