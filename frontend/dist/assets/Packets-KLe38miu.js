import{r as e,j as s,$ as t,E as a,_ as l,a0 as r,a1 as i,D as c,a2 as n,a3 as o,p as d,X as x}from"./vendor-react-C0qkT9dV.js";import{c as m}from"./recharts-DRDKmvXb.js";import{u as p,b as u,r as h,t as b,R as j}from"./index-DrUSC4Ks.js";import{g,P as v,a as f,b as y}from"./PacketDetailModal-D1jT4M4x.js";import{P as N,b as w,a as k,c as S}from"./PageLayout-DAadOF4d.js";import"./vendor-core-WoOfkQwm.js";import"./deckgl-DTsmDcfs.js";import"./SignalIndicator-C1cW0knK.js";import"./HashBadge-CAy9V6Vn.js";function R({icon:e,label:t,value:a,color:l,percentage:r}){return s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:m("p-1.5 rounded-md",l),children:e}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-sm font-semibold text-text-primary",children:a.toLocaleString()}),s.jsxs("span",{className:"text-[10px] text-text-muted leading-tight",children:[t,void 0!==r&&s.jsxs("span",{className:"ml-1 opacity-70",children:["(",r,"%)"]})]})]})]})}const _=e.memo(function({packets:c}){const n=e.useMemo(()=>{let e=0,s=0,t=0;const a=new Set;let l=0,r=0;for(const o of c){switch(g(o)){case"forward":e++;break;case"dropped":s++;break;case"duplicate":t++}o.src_hash&&a.add(o.src_hash),o.rssi&&(l+=o.rssi,r++)}const i=c.length,n=r>0?Math.round(l/r):0;return{total:i,rx:i,fwd:e,dropped:s,duplicate:t,uniqueSources:a.size,avgRssi:n,rxPercent:100,fwdPercent:i>0?Math.round(e/i*100):0,droppedPercent:i>0?Math.round(s/i*100):0}},[c]);return 0===c.length?null:s.jsx("div",{className:"glass-card p-3 pr-4",children:s.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:flex sm:items-center sm:justify-between sm:gap-6",children:[s.jsx(R,{icon:s.jsx(t,{className:"w-3.5 h-3.5 text-accent-primary"}),label:"Received",value:n.rx,color:"bg-accent-primary/10",percentage:n.rxPercent}),s.jsx(R,{icon:s.jsx(a,{className:"w-3.5 h-3.5 text-accent-success"}),label:"Forwarded",value:n.fwd,color:"bg-accent-success/10",percentage:n.fwdPercent}),s.jsx(R,{icon:s.jsx(l,{className:"w-3.5 h-3.5 text-accent-danger"}),label:"Dropped",value:n.dropped,color:"bg-accent-danger/10",percentage:n.droppedPercent}),s.jsx(R,{icon:s.jsx(r,{className:"w-3.5 h-3.5 text-text-muted"}),label:"Duplicates",value:n.duplicate,color:"bg-white/5"}),s.jsxs("div",{className:"hidden sm:flex items-center gap-6 ml-auto",children:[s.jsx(R,{icon:s.jsx(i,{className:"w-3.5 h-3.5 text-accent-secondary"}),label:"Sources",value:n.uniqueSources,color:"bg-accent-secondary/10"}),s.jsxs("div",{className:"flex flex-col items-end pr-1",children:[s.jsxs("span",{className:"text-sm font-mono text-text-secondary",children:[n.avgRssi," dBm"]}),s.jsx("span",{className:"text-[10px] text-text-muted",children:"Avg Signal"})]})]})]})})});function M(){const t=p(),a=u(),l=h(),[r,i]=e.useState(null),[R,M]=e.useState(!1),[P,C]=e.useState({limit:100,status:"all"}),[L,D]=e.useState(Date.now);e.useEffect(()=>{P.timeRange&&P.timeRange>0&&queueMicrotask(()=>D(Date.now()))},[P.timeRange,t]);const T=e.useMemo(()=>{const e=P.limit??100;return[...t.length<=e?t:t.slice(-e)].sort((e,s)=>(s.timestamp??0)-(e.timestamp??0))},[t,P.limit]),$=0===t.length,A=e.useMemo(()=>{let e=T;if(void 0!==P.type){const s=b[P.type];e=e.filter(e=>{const t=e.type??e.payload_type,a=e.payload_type_name;return t===P.type||a===s})}if(void 0!==P.route){const s=j[P.route];e=e.filter(e=>{const t=e.route??e.route_type,a=e.route_type_name;return t===P.route||a===s})}if(P.status&&"all"!==P.status&&(e=e.filter(e=>g(e)===P.status)),void 0!==P.signalMin&&(e=e.filter(e=>e.rssi>=P.signalMin)),P.timeRange&&P.timeRange>0){const s=L/1e3-3600*P.timeRange;e=e.filter(e=>e.timestamp>=s)}return e},[T,P.type,P.route,P.status,P.signalMin,P.timeRange,L]),F=(e,s)=>C(t=>({...t,[e]:s})),q=void 0!==P.type||void 0!==P.route||P.status&&"all"!==P.status||void 0!==P.signalMin||P.timeRange&&P.timeRange>0;return s.jsxs(N,{children:[s.jsx(w,{title:"Packet History",icon:s.jsx(d,{}),controls:s.jsxs(s.Fragment,{children:[a&&s.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[s.jsx(c,{className:"w-1.5 h-1.5 fill-accent-success text-accent-success animate-pulse"}),s.jsx("span",{className:"text-text-muted hidden xs:inline",children:"Live"})]}),s.jsxs("button",{onClick:()=>M(!R),className:m("sm:hidden px-3 py-1.5 rounded-lg text-sm font-medium transition-all","flex items-center gap-1.5 border",q?"bg-accent-primary/20 text-accent-primary border-accent-primary/30":"bg-bg-subtle text-text-muted border-border-subtle"),children:[s.jsx(n,{className:"w-4 h-4"}),q&&s.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-accent-primary"})]}),s.jsxs("button",{onClick:()=>l(!a),className:m("px-3 py-1.5 rounded-lg text-sm font-medium transition-all duration-200","flex items-center gap-1.5 border",a?"bg-accent-success/20 text-accent-success border-accent-success/30":"bg-bg-subtle text-text-muted border-border-subtle hover:bg-bg-elevated"),children:[s.jsx(o,{className:m("w-4 h-4",a&&"animate-spin")}),s.jsx("span",{className:"hidden xs:inline",children:a?"Live":"Paused"})]})]})}),s.jsxs(k,{noPadding:!0,className:m("overflow-hidden transition-all duration-200",R?"max-h-96 opacity-100":"max-h-0 opacity-0 sm:max-h-96 sm:opacity-100"),children:[s.jsx(S,{listHeader:!0,icon:s.jsx(n,{className:"icon-sm"}),title:"Filters",actions:q?s.jsxs("button",{onClick:()=>C({limit:P.limit,status:"all"}),className:"type-data-xs text-text-muted hover:text-text-primary flex items-center gap-1",children:[s.jsx(x,{className:"w-3 h-3"})," Clear"]}):void 0}),s.jsx("div",{className:"p-3 sm:p-4",children:s.jsxs("div",{className:"grid grid-cols-2 sm:flex sm:flex-wrap gap-3",children:[s.jsxs("div",{className:"flex-1 min-w-[120px]",children:[s.jsx("label",{className:"type-micro block mb-1",children:"Type"}),s.jsxs("select",{value:P.type??"",onChange:e=>F("type",e.target.value?Number(e.target.value):void 0),className:"w-full bg-bg-subtle border border-border-subtle rounded-lg px-2.5 py-1.5 text-sm text-text-primary focus:outline-none focus:border-accent-primary/50",children:[s.jsx("option",{value:"",children:"All Types"}),Object.entries(b).map(([e,t])=>s.jsx("option",{value:e,children:t},e))]})]}),s.jsxs("div",{className:"flex-1 min-w-[120px]",children:[s.jsx("label",{className:"type-micro block mb-1",children:"Route"}),s.jsxs("select",{value:P.route??"",onChange:e=>F("route",e.target.value?Number(e.target.value):void 0),className:"w-full bg-bg-subtle border border-border-subtle rounded-lg px-2.5 py-1.5 text-sm text-text-primary focus:outline-none focus:border-accent-primary/50",children:[s.jsx("option",{value:"",children:"All Routes"}),Object.entries(j).map(([e,t])=>s.jsx("option",{value:e,children:t},e))]})]}),s.jsxs("div",{className:"flex-1 min-w-[120px]",children:[s.jsx("label",{className:"type-micro block mb-1",children:"Status"}),s.jsxs("select",{value:P.status??"all",onChange:e=>F("status",e.target.value),className:"w-full bg-bg-subtle border border-border-subtle rounded-lg px-2.5 py-1.5 text-sm text-text-primary focus:outline-none focus:border-accent-primary/50",children:[s.jsx("option",{value:"all",children:"All Status"}),s.jsx("option",{value:"rx",children:"Received"}),s.jsx("option",{value:"forward",children:"Forwarded"}),s.jsx("option",{value:"dropped",children:"Dropped"}),s.jsx("option",{value:"duplicate",children:"Duplicate"})]})]}),s.jsxs("div",{className:"flex-1 min-w-[100px]",children:[s.jsx("label",{className:"type-micro block mb-1",children:"Time"}),s.jsxs("select",{value:P.timeRange??0,onChange:e=>F("timeRange",Number(e.target.value)||void 0),className:"w-full bg-bg-subtle border border-border-subtle rounded-lg px-2.5 py-1.5 text-sm text-text-primary focus:outline-none focus:border-accent-primary/50",children:[s.jsx("option",{value:0,children:"All Time"}),s.jsx("option",{value:1,children:"Last 1h"}),s.jsx("option",{value:6,children:"Last 6h"}),s.jsx("option",{value:24,children:"Last 24h"}),s.jsx("option",{value:168,children:"Last 7d"})]})]}),s.jsxs("div",{className:"flex-1 min-w-[100px]",children:[s.jsx("label",{className:"type-micro block mb-1",children:"Signal"}),s.jsxs("select",{value:P.signalMin??"",onChange:e=>F("signalMin",e.target.value?Number(e.target.value):void 0),className:"w-full bg-bg-subtle border border-border-subtle rounded-lg px-2.5 py-1.5 text-sm text-text-primary focus:outline-none focus:border-accent-primary/50",children:[s.jsx("option",{value:"",children:"Any Signal"}),s.jsx("option",{value:-90,children:"Strong (≥-90)"}),s.jsx("option",{value:-100,children:"Good (≥-100)"}),s.jsx("option",{value:-110,children:"Fair (≥-110)"}),s.jsx("option",{value:-120,children:"Weak (≥-120)"})]})]}),s.jsxs("div",{className:"flex-1 min-w-[80px]",children:[s.jsx("label",{className:"type-micro block mb-1",children:"Limit"}),s.jsxs("select",{value:P.limit??100,onChange:e=>F("limit",Number(e.target.value)),className:"w-full bg-bg-subtle border border-border-subtle rounded-lg px-2.5 py-1.5 text-sm text-text-primary focus:outline-none focus:border-accent-primary/50",children:[s.jsx("option",{value:50,children:"50"}),s.jsx("option",{value:100,children:"100"}),s.jsx("option",{value:200,children:"200"}),s.jsx("option",{value:500,children:"500"})]})]})]})})]}),s.jsx(_,{packets:A}),s.jsxs(k,{noPadding:!0,children:[s.jsxs("div",{className:"sm:hidden flex items-center gap-1.5 px-3 py-2 border-b border-border-subtle bg-bg-elevated/30",children:[s.jsx("span",{className:"type-micro w-14 flex-shrink-0",children:"Dir"}),s.jsx("span",{className:"type-micro w-7 flex-shrink-0",children:"Time"}),s.jsx("span",{className:"type-micro w-9 flex-shrink-0",children:"Src"}),s.jsx("span",{className:"type-micro flex-1 min-w-0",children:"Type"}),s.jsx("span",{className:"type-micro w-14 flex-shrink-0",children:"Route"}),s.jsx("span",{className:"type-micro w-12 flex-shrink-0",children:"Signal"})]}),s.jsx("div",{className:"hidden sm:block overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-border-subtle bg-bg-elevated/30",children:[s.jsx("th",{className:"text-left py-2.5 px-3 type-micro w-16",children:"Dir"}),s.jsx("th",{className:"text-left py-2.5 px-3 type-micro",children:"Time"}),s.jsx("th",{className:"text-left py-2.5 px-3 type-micro",children:"Source"}),s.jsx("th",{className:"text-left py-2.5 px-3 type-micro",children:"Type"}),s.jsx("th",{className:"text-left py-2.5 px-3 type-micro",children:"Route"}),s.jsx("th",{className:"text-right py-2.5 px-3 pr-4 type-micro",children:"Signal"})]})}),s.jsx("tbody",{className:"divide-y divide-border-subtle/30",children:$&&0===T.length?s.jsx("tr",{children:s.jsx("td",{colSpan:6,className:"text-center py-12 text-text-muted",children:"Loading packets..."})}):0===A.length?s.jsx("tr",{children:s.jsx("td",{colSpan:6,className:"text-center py-12 text-text-muted",children:"No packets found"})}):A.map((e,t)=>s.jsx(v,{packet:e,onClick:i},`${e.packet_hash}_${e.timestamp}_${t}`))})]})}),s.jsx("div",{className:"sm:hidden divide-y divide-border-subtle/30",children:$&&0===T.length?s.jsx("div",{className:"p-8 text-center text-text-muted",children:"Loading packets..."}):0===A.length?s.jsx("div",{className:"p-8 text-center text-text-muted",children:"No packets found"}):A.map((e,t)=>s.jsx(f,{packet:e,onClick:i},`${e.packet_hash}_${e.timestamp}_${t}`))}),s.jsxs("div",{className:"px-3 py-2 border-t border-border-subtle type-data-xs text-text-muted bg-bg-elevated/20 sm:text-left text-center",children:["Showing ",A.length," of ",T.length," packets"]})]}),r&&s.jsx(y,{packet:r,onClose:()=>i(null)})]})}export{M as default};
