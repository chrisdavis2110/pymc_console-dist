var e=Object.defineProperty,t=(t,s,a)=>((t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a)(t,"symbol"!=typeof s?s+"":s,a);import{r as s,j as a,R as n,m as l,g as i,C as r,n as o,Y as c,T as m,i as d}from"./vendor-react-Cwum97tW.js";import{c as h,aw as u,ax as x,ay as p,a7 as g,az as f,aA as y,a as b,aB as j,aC as v,aD as N,ak as k,aE as w,aF as M,al as C,f as S,j as T,h as A,b as F,au as P,I as D,k as L,z as $,aG as R,n as z,aH as B,K as H,R as _,aI as E}from"./index-D22MpaCY.js";import{u as O}from"./usePolling-XMUhKpB6.js";import{a as q,b as W,u as G,c as I,d as K,e as X,s as V}from"./useThemeColors-S-uaxvPT.js";import{L as Y,H as Q,R as U}from"./route-ExVvvUtv.js";import{C as Z}from"./compass-Bsfx4e84.js";import{E as J,A as ee,T as te}from"./TimeRangeSelector-C89_yLwH.js";import{a as se,P as ae,b as ne,B as le}from"./PageLayout-B53JpmK1.js";import{D as ie}from"./DataBox-Bl0vntck.js";import{C as re}from"./CollisionExplorerModal-BmT8XQYy.js";import{C as oe,a as ce}from"./Card-CCBguhJs.js";import{I as me}from"./info-BojcGhYE.js";import{T as de}from"./triangle-alert-TfoZuZfW.js";import{G as he}from"./git-branch-Cev-c9BQ.js";import{R as ue,C as xe}from"./Grid-BVGRgue6.js";import{N as pe}from"./network-Dz5VqBhN.js";import"./deckgl-DTsmDcfs.js";import"./vendor-core-CDrKesoV.js";import"./index-bDa2a9Y2.js";import"./BasemapLayer-C9wiTbJT.js";import"./maplibre-gl-Bk5DsYkB.js";import"./map-pin-kiJDSdn0.js";const ge=h("chart-line",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]),fe=h("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),ye=h("columns-2",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]]),be=h("columns-3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),je=h("columns-4",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7.5 3v18",key:"w0wo6v"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M16.5 3v18",key:"10tjh1"}]]),ve=h("grid-3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),Ne=h("grip",[["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"19",cy:"5",r:"1",key:"w8mnmm"}],["circle",{cx:"5",cy:"5",r:"1",key:"lttvr7"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}],["circle",{cx:"19",cy:"19",r:"1",key:"shf9b7"}],["circle",{cx:"5",cy:"19",r:"1",key:"bfqh0e"}]]),ke=h("id-card",[["path",{d:"M16 10h2",key:"8sgtl7"}],["path",{d:"M16 14h2",key:"epxaof"}],["path",{d:"M6.17 15a3 3 0 0 1 5.66 0",key:"n6f512"}],["circle",{cx:"9",cy:"11",r:"2",key:"yxgjnd"}],["rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",key:"qneu4z"}]]),we=h("radar",[["path",{d:"M19.07 4.93A10 10 0 0 0 6.99 3.34",key:"z3du51"}],["path",{d:"M4 6h.01",key:"oypzma"}],["path",{d:"M2.29 9.62A10 10 0 1 0 21.31 8.35",key:"qzzz0"}],["path",{d:"M16.24 7.76A6 6 0 1 0 8.23 16.67",key:"1yjesh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M17.99 11.66A6 6 0 0 1 15.77 16.67",key:"1u2y91"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"m13.41 10.59 5.66-5.66",key:"mhq4k0"}]]),Me=h("settings-2",[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),Ce=h("sparkle",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}]]),Se=h("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),Te=h("waves",[["path",{d:"M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"knzxuh"}],["path",{d:"M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"2jd2cc"}],["path",{d:"M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"rd2r6e"}]]),Ae={useAbsoluteThresholds:!0,baselinePercentile:6,spikePercentile:50,baselineDbm:-107,spikeDbm:-100,mergeGapSeconds:45,minSequenceLength:16,similarityToleranceDbm:5};function Fe(e,t){if(0===e.length)return 0;const s=t/100*(e.length-1),a=Math.floor(s),n=Math.ceil(s);return a===n?e[a]:e[a]+(e[n]-e[a])*(s-a)}function Pe(e){if(0===e.length)return{median:0,p90:0,p95:0,p99:0,max:0,min:0};const t=[...e].sort((e,t)=>e-t);return{median:Fe(t,50),p90:Fe(t,90),p95:Fe(t,95),p99:Fe(t,99),max:t[t.length-1],min:t[0]}}function De(e,t,s){const a=s-t;if(0===a)return"moderate";const n=(e-t)/a;return n>.66?"critical":n>.33?"severe":"moderate"}const Le=u;function $e({sortedTypes:e,highlightedType:t,onTypeHover:n,aggregateShares:l,hoverData:i}){const r=s.useMemo(()=>{if(!i)return null;const e=new Map;for(const t of i.items)e.set(t.key,t.value);return e},[i]),o=null!==r;return a.jsx("div",{className:"flex-shrink-0 pt-3 mt-2",children:a.jsx("div",{className:"grid ml-9 gap-y-0.5",style:{gridTemplateColumns:"repeat(auto-fill, minmax(105px, 1fr))"},onMouseLeave:()=>n(null),children:e.map(e=>{const s=Le(e.typeNum),i=(null==r?void 0:r.get(e.key))??0,c=l.get(e.key)??0,m=o?i:c,d=m>1e-4,h=t===e.key,u=["legend-item",h&&"legend-item-active",(t&&!h||o&&i<=1e-4)&&"legend-item-dimmed",!t&&o&&i>1e-4&&"legend-item-chart-active"].filter(Boolean).join(" ");return a.jsxs("div",{className:u,onMouseEnter:()=>n(e.key),children:[a.jsx("div",{className:"flex-shrink-0",style:{backgroundColor:s,width:9,height:16,borderRadius:1}}),a.jsx("span",{className:"legend-label",children:e.label}),d&&a.jsxs("span",{className:"legend-value "+(o?"legend-value-live":""),children:[(100*m).toFixed(1),"%"]})]},e.key)})})})}const Re='ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace';function ze({x:e,y:t,width:s,height:n,name:l,size:i,index:r,depth:o,hoveredIndex:c,onHover:m,total:d,typeNum:h}){if(1!==o)return null;const u=null!==c&&!(c===r),x=Le(h),p=d>0?i/d*100:0,g=s>36&&n>20,f=s>36&&n>32;return a.jsxs("g",{onMouseEnter:e=>m(r,e),onMouseLeave:()=>m(null),style:{cursor:"default"},children:[a.jsx("rect",{x:e,y:t,width:s,height:n,fill:x,opacity:u?.4:1,stroke:"rgba(0,0,0,0.2)",strokeWidth:1,rx:3,style:{transition:"opacity 150ms ease"}}),g&&a.jsxs(a.Fragment,{children:[f&&a.jsxs("text",{x:e+4,y:t+n-4-11,textAnchor:"start",dominantBaseline:"auto",fill:"rgba(0,0,0,0.6)",fontSize:8,fontFamily:Re,fontWeight:500,style:{pointerEvents:"none"},children:[p.toFixed(1),"%"]}),a.jsx("text",{x:e+4,y:t+n-4,textAnchor:"start",dominantBaseline:"auto",fill:"rgba(0,0,0,0.85)",fontSize:9,fontFamily:Re,fontWeight:600,style:{pointerEvents:"none"},children:l})]})]})}function Be({data:e,total:t,color:s,position:n,containerWidth:l}){if(!e||!n)return null;const i=(e.value/t*100).toFixed(1),r=l-n.x<184?Math.max(8,n.x-160-8):n.x+16;return a.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:r,top:Math.max(8,n.y-60)},children:a.jsxs("div",{className:"bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 shadow-xl min-w-[140px]",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("span",{className:"w-2.5 h-2.5 rounded-sm flex-shrink-0",style:{backgroundColor:s}}),a.jsx("span",{className:"type-data-sm font-semibold text-text-primary",children:e.name})]}),a.jsxs("div",{className:"space-y-0.5 type-data-xs text-text-muted",children:[a.jsxs("div",{className:"flex justify-between gap-4",children:[a.jsx("span",{children:"Count"}),a.jsx("span",{className:"text-text-primary tabular-nums font-medium",children:e.value.toLocaleString()})]}),a.jsxs("div",{className:"flex justify-between gap-4",children:[a.jsx("span",{children:"Share"}),a.jsxs("span",{className:"text-text-primary tabular-nums font-medium",children:[i,"%"]})]}),a.jsxs("div",{className:"flex justify-between gap-4",children:[a.jsx("span",{children:"Total"}),a.jsx("span",{className:"text-text-primary tabular-nums font-medium",children:t.toLocaleString()})]})]})]})})}function He({sortedTypes:e,aggregateShares:t}){var i,r,o;const[c,m]=s.useState(null),[d,h]=s.useState(null),[u,x]=s.useState(0),[p,g]=s.useState(null),f=s.useRef(null),y=s.useMemo(()=>e.reduce((e,t)=>e+t.totalCount,0),[e]),b=s.useMemo(()=>e.map((e,t)=>({name:e.label,size:e.totalCount,index:t,typeNum:e.typeNum,key:e.key})),[e]),j=s.useCallback((e,t)=>{if(m(e),t&&null!==e){const e=f.current;if(e){const s=e.getBoundingClientRect();x(s.width),h({x:t.clientX-s.left,y:t.clientY-s.top})}}else h(null)},[]),v=s.useCallback(e=>{if(g(e),e){const t=b.findIndex(t=>t.key===e);m(t>=0?t:null)}else m(null)},[b]),N=null!==c?{name:(null==(i=b[c])?void 0:i.name)??"",value:(null==(r=b[c])?void 0:r.size)??0}:null,k=null!==c?Le(null==(o=b[c])?void 0:o.typeNum):"";return 0===e.length||0===y?a.jsxs("div",{className:"h-full flex items-center justify-center text-text-muted",children:[a.jsx(Y,{className:"w-6 h-6 mr-2 opacity-50"}),a.jsx("span",{children:"No packet type data available"})]}):a.jsxs("div",{className:"flex flex-col",children:[a.jsxs("div",{className:"analyzer-chart-height relative flex-shrink-0",ref:f,children:[a.jsx(n,{width:"100%",height:"100%",children:a.jsx(l,{data:b,dataKey:"size",aspectRatio:4/3,stroke:"none",isAnimationActive:!1,content:a.jsx(ze,{x:0,y:0,width:0,height:0,name:"",size:0,index:0,depth:0,hoveredIndex:c,onHover:j,total:y,typeNum:0})})}),a.jsx(Be,{data:N,total:y,color:k,position:d,containerWidth:u})]}),a.jsx($e,{sortedTypes:e,highlightedType:p,onTypeHover:v,aggregateShares:t})]})}function _e(e){return e>=1e9?`${(e/1e9).toFixed(1)} Gb`:e>=1e6?`${(e/1e6).toFixed(1)} Mb`:e>=1e3?`${(e/1e3).toFixed(1)} Kb`:`${e.toFixed(0)} B`}function Ee({active:e,payload:t,label:s,mode:n}){if(!e||!t||0===t.length)return null;const l=t.filter(e=>null!==e.value&&void 0!==e.value);if(0===l.length)return null;const i=s?new Date(1e3*s).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}):"";return a.jsxs("div",{className:"bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 text-sm shadow-xl",children:[a.jsx("div",{className:"font-medium text-text-primary mb-1 font-mono",children:i}),l.map((e,t)=>a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-3 h-0.5",style:{backgroundColor:e.color}}),a.jsxs("span",{className:"text-text-muted",children:[e.name,":"]}),a.jsx("span",{className:"text-text-primary tabular-nums font-mono",children:"share"===n?`${Number(e.value).toLocaleString()} B`:`${Number(e.value).toFixed(2)}%`})]},t))]})}function Oe({packets:e,mode:t,startTs:l,endTs:h,radioConfig:u,bucketCount:f}){const y=q(),b=W(),j=y.primary,v=y.tertiary,[N,k]=s.useState(null),{trendData:w,totals:M}=s.useMemo(()=>{if(0===e.length)return{trendData:[],totals:{rxBytes:0,txBytes:0,rxAirtime:0,txAirtime:0}};const s=h-l,a=Math.min(Math.ceil(s/300),f),n=s/a,i=[];let r=0,o=0,c=0,m=0;for(const t of e){const e=t.timestamp;if(e<l||e>=h)continue;const s=x(t),a=p(t,{spreadingFactor:u.sf,bandwidthHz:u.bw,codingRate:u.cr,preambleLength:u.preamble}),n={timestamp:e,rxAirtime:0,txAirtime:0,rxBytes:0,txBytes:0};t.transmitted?(n.txAirtime=a,n.txBytes=s,o+=s,m+=a):(n.rxAirtime=a,n.rxBytes=s,r+=s,c+=a),i.push(n)}i.sort((e,t)=>e.timestamp-t.timestamp);const d=new Float64Array(i.length+1),g=new Float64Array(i.length+1),y=new Float64Array(i.length+1),b=new Float64Array(i.length+1),j=new Float64Array(i.length);for(let e=0;e<i.length;e++)d[e+1]=d[e]+i[e].rxAirtime,g[e+1]=g[e]+i[e].txAirtime,y[e+1]=y[e]+i[e].rxBytes,b[e+1]=b[e]+i[e].txBytes,j[e]=i[e].timestamp;const v=e=>{let t=0,s=j.length;for(;t<s;){const a=t+s>>>1;j[a]<e?t=a+1:s=a}return t},N=[],k=3e5;for(let e=0;e<a;e++){const s=l+e*n,a=s+n,i=v(s),r=v(a);if("share"===t){const e=y[r]-y[i],t=b[r]-b[i];N.push({timestamp:s,rx:e>0?e:null,tx:t>0?t:null})}else{const e=(d[r]-d[i])/k*100,t=(g[r]-g[i])/k*100;N.push({timestamp:s,rx:e>0?e:null,tx:t>0?t:null})}}const w=2/31;let M=null;return{trendData:N.map(e=>{const t=e.rx;return null!==t&&t>0&&(M=null===M?t:w*t+(1-w)*M),{...e,rxSmooth:null!==M&&M>0?M:null}}),totals:{rxBytes:r,txBytes:o,rxAirtime:c,txAirtime:m}}},[e,l,h,f,t,u]),C=s.useMemo(()=>{if(0===w.length)return"share"===t?100:10;let e=0;for(const t of w){const s=t.rx??0,a=t.tx??0;s>e&&(e=s),a>e&&(e=a)}const s=1.1*e;return"share"===t?s<=100?100:s<=500?100*Math.ceil(s/100):s<=1e3?200*Math.ceil(s/200):s<=5e3?500*Math.ceil(s/500):s<=1e4?1e3*Math.ceil(s/1e3):5e3*Math.ceil(s/5e3):Math.max(1,Math.ceil(s))},[w,t]),S=s.useMemo(()=>{if(null!==N&&w[N]){const e=w[N],s=e.rx??0,a=e.tx??0;return"share"===t?{rx:_e(s),tx:_e(a),total:_e(s+a),isHovered:!0}:{rx:`${s.toFixed(2)}%`,tx:`${a.toFixed(2)}%`,total:`${(s+a).toFixed(2)}%`,isHovered:!0}}if("share"===t)return{rx:_e(M.rxBytes),tx:_e(M.txBytes),total:_e(M.rxBytes+M.txBytes),isHovered:!1};{let e=0,t=0,s=0;for(const l of w)null===l.rx&&null===l.tx||(e+=l.rx??0,t+=l.tx??0,s++);const a=s>0?e/s:0,n=s>0?t/s:0;return{rx:`${a.toFixed(2)}%`,tx:`${n.toFixed(2)}%`,total:`${(a+n).toFixed(2)}%`,isHovered:!1}}},[N,w,M,t]),T=s.useMemo(()=>{const e=h-l,t=e/3600;return[0,.25,.5,.75,1].map(s=>{const a=new Date(1e3*(l+e*s)),n=a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),i=a.toLocaleDateString([],{weekday:"short"});return{pct:s,label:t>24?`${i} ${n}`:n,mobileHidden:.25===s||.75===s}})},[l,h]),A=s.useCallback(e=>{const t=null==e?void 0:e.activeTooltipIndex;k("number"==typeof t?t:null)},[]),F=s.useCallback(e=>"share"===t?e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(0)}K`:e.toFixed(0):`${e.toFixed(0)}%`,[t]);return 0===w.length?a.jsxs("div",{className:"h-full flex items-center justify-center text-text-muted",children:[a.jsx(Y,{className:"w-6 h-6 mr-2 opacity-50"}),a.jsx("span",{children:"No packet data available"})]}):a.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[a.jsx("div",{className:"flex items-center flex-shrink-0 text-text-secondary",style:{height:20,paddingLeft:44,paddingRight:8},children:a.jsx("div",{className:"relative w-full h-full flex items-center",children:T.map((e,t)=>a.jsxs("div",{className:"absolute flex items-center gap-0.5 sm:gap-1 type-data-xs "+(e.mobileHidden?"hidden sm:flex":""),style:{left:100*e.pct+"%",transform:0===e.pct?"translateX(0)":1===e.pct?"translateX(-100%)":"translateX(-50%)"},children:[a.jsx(g,{className:"w-2.5 h-2.5 opacity-60 hidden sm:block"}),a.jsx("span",{className:"tabular-nums",children:e.label})]},t))})}),a.jsx("div",{className:"flex-1 min-h-0 relative overflow-hidden",children:a.jsx(n,{width:"100%",height:"100%",minWidth:1,minHeight:1,children:a.jsxs(i,{data:w,margin:{top:4,right:8,bottom:4,left:0},onMouseMove:A,onMouseLeave:()=>k(null),children:[a.jsx(r,{strokeDasharray:"3 3",stroke:b.secondary,strokeOpacity:.3,vertical:!1}),a.jsx(o,{dataKey:"timestamp",type:"number",domain:[l,h],axisLine:!1,tickLine:!1,tick:!1,height:0}),a.jsx(c,{axisLine:!1,tickLine:!1,tick:{fill:b.secondary,fontSize:10,fontFamily:'ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace'},dx:-8,width:44,tickFormatter:F,domain:[0,C]}),a.jsx(m,{content:a.jsx(Ee,{mode:t})}),a.jsx(d,{type:"linear",dataKey:"rx",name:"RX",stroke:j,strokeWidth:2.5,strokeOpacity:.9,dot:!1,connectNulls:!1,isAnimationActive:!1}),a.jsx(d,{type:"linear",dataKey:"tx",name:"TX",stroke:v,strokeWidth:2.5,strokeOpacity:.9,dot:!1,connectNulls:!1,isAnimationActive:!1}),a.jsx(d,{type:"basis",dataKey:"rxSmooth",name:"RX Avg",stroke:"var(--sys-brown)",strokeWidth:2,strokeOpacity:1,dot:!1,connectNulls:!0,isAnimationActive:!1})]})})}),a.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between mt-1.5 sm:mt-2",children:[a.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 text-xs font-mono pl-2 sm:pl-11",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("div",{className:"w-3 sm:w-4 h-0.5",style:{backgroundColor:j}}),a.jsx("span",{className:"text-text-secondary",children:"RX"})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("div",{className:"w-3 sm:w-4 h-0.5",style:{backgroundColor:v}}),a.jsx("span",{className:"text-text-secondary",children:"TX"})]}),a.jsxs("div",{className:"hidden sm:flex items-center gap-1.5",children:[a.jsx("div",{className:"w-4 h-0.5",style:{backgroundColor:"var(--sys-brown)"}}),a.jsx("span",{className:"text-text-secondary",children:"Avg"})]})]}),a.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 text-right pr-1 sm:pr-2 font-mono",children:[a.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5",children:[a.jsx("span",{className:"text-xs font-medium",style:{color:j},children:"RX"}),a.jsx("span",{className:"font-bold text-lg sm:text-xl text-text-primary",children:S.rx})]}),a.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5",children:[a.jsx("span",{className:"text-xs font-medium",style:{color:v},children:"TX"}),a.jsx("span",{className:"font-bold text-lg sm:text-xl text-text-primary",children:S.tx})]}),S.isHovered&&a.jsx("span",{className:"text-xs text-text-muted hidden sm:inline",children:"bucket"})]})]})]})}function qe(e){const{values:t,sum:s}=e;if(0===t.length)return{min:0,mean:0,median:0,p75:0,p95:0,p99:0,max:0};const a=[...t].sort((e,t)=>e-t),n=a.length,l=s/n,i=a[0],r=a[n-1],o=e=>{const t=Math.min(Math.ceil(e*n)-1,n-1);return a[Math.max(0,t)]};return{min:i,mean:l,median:n%2==0?(a[n/2-1]+a[n/2])/2:a[Math.floor(n/2)],p75:o(.75),p95:o(.95),p99:o(.99),max:r}}function We({statsBuckets:e,mode:t,packets:n,startTs:l,endTs:i,radioConfig:r,sortedTypes:o,aggregateShares:c,noiseFloorAnomalies:m,showNoiseFloorOverlay:d,overlayOpacity:h=.5}){const[u,g]=s.useState(null),[y,b]=s.useState(null),j=s.useMemo(()=>(i-l)/3600,[l,i]),v=s.useCallback(e=>{b(e)},[]),N=function(e,t,a,n,l){return s.useMemo(()=>{if(0===e.length||!l)return null;const s=e.filter(e=>e.timestamp>=t&&e.timestamp<=a);if(0===s.length)return null;const i=[],r=new Map;for(const e of s){const s=e.type??e.payload_type??-1,a=x(e);let o;if(o="airtime"===n?p(e,{spreadingFactor:l.sf,bandwidthHz:l.bw,codingRate:l.cr,preambleLength:l.preamble}):1,a<=0)continue;const c=Math.floor((e.timestamp-t)/300),m={timestamp:e.timestamp,airtimeMs:o,byteSize:a,packetType:s,bucketIndex:c};i.push(m),r.has(c)||r.set(c,[]),r.get(c).push(m)}if(0===i.length)return null;const o=[],c=[],m=[],d=new Map;if("share"===n)for(const[,e]of r)for(const t of e)d.set(t,t.byteSize);else for(const[,e]of r){const t=e.reduce((e,t)=>e+t.airtimeMs,0)/3e5*100;let s=0;for(const a of e)a.airtimeMs>s&&(s=a.airtimeMs);for(const a of e){const e=a.airtimeMs/s*t;d.set(a,e)}}for(const e of i){const t=d.get(e);void 0!==t&&(o.push(t),c.push(e.timestamp),m.push(e.packetType))}let h=c[0],u=c[0];for(let e=1;e<c.length;e++)c[e]<h&&(h=c[e]),c[e]>u&&(u=c[e]);const g=u-h||1,f=[...o].sort((e,t)=>e-t),y=f[0],b=f[f.length-1],j=Math.floor(.05*f.length),v=Math.floor(.5*f.length),N=Math.min(Math.ceil(.95*f.length),f.length-1),k=f[j],w=f[v],M=f[N],C=new Map;for(const e of o){const t=Math.round(100*e)/100;C.set(t,(C.get(t)??0)+1)}const S=C.size,T=[...C.entries()].sort((e,t)=>t[1]-e[1]).slice(0,5).map(([e,t])=>({value:e,count:t,percent:t/o.length*100}));let A;if("share"===n)A=200;else{const e=5,t=Math.ceil(b/e)*e;A=t<=10?10:t+e}const F=new Float32Array(2*o.length),P=new Float32Array(o.length),D=new Uint8Array(o.length),L=new Float32Array(o.length);for(let e=0;e<o.length;e++){const t=(c[e]-h)/g,s=1-Math.max(0,Math.min(A,o[e]))/A;F[2*e]=t,F[2*e+1]=s,P[e]=o[e],D[e]=m[e]>=0?m[e]:255,L[e]=c[e]}return{points:F,rawValues:P,packetTypes:D,timestamps:L,count:o.length,minTime:h,maxTime:u,minValue:0,maxValue:A,rawMinValue:y,rawMaxValue:b,unit:"%",stats:{p5:k,p50:w,p95:M,uniqueValues:S,topValues:T}}},[e,t,a,n,l])}(n,l,i,"share"===t?"share":"airtime",r),{data:k}=s.useMemo(()=>function(e,t){var s;const a=e.length;if(0===a)return{data:[],windowSize:0,windowDurationMs:0};const n=(null==(s=e[0])?void 0:s.bucketDurationMs)??1e3,l=Math.min(Math.max(5,Math.round(3e5/n)),a),i=Math.floor(l/2),r=[];let o=0,c=0;for(let m=0;m<a;m++){const s=e[m],n=Math.max(0,m-i),l=Math.min(a,m+i+1),d=[];let h,u=0;for(let a=n;a<l;a++){const s=e[a];let n;n="share"===t?s.total/Math.max(1,s.bucketDurationMs/1e3):s.totalAirtime/s.bucketDurationMs*100,d.push(n),u+=n}h="share"===t?s.total/Math.max(1,s.bucketDurationMs/1e3):s.totalAirtime/s.bucketDurationMs*100,o+=h,c++;const x=qe({values:d,sum:u}),p=(x.min+x.max)/2;r.push({timestamp:s.timestamp,time:s.time,min:x.min,max:x.max,p75:x.p75,p95:x.p95,p99:x.p99,mean:x.mean,median:x.median,average:o/c,midpoint:p})}return{data:r,windowSize:l,windowDurationMs:l*n}}(e,t),[e,t]),w=s.useMemo(()=>k.map(e=>({timestamp:e.timestamp,min:e.min,max:e.max,p75:e.p75,p95:e.p95,p99:e.p99,mean:e.mean,median:e.median,average:e.average,midpoint:e.midpoint})),[k]),M=s.useMemo(()=>(null==N?void 0:N.maxValue)?N.maxValue:"share"===t?200:10,[N,t]),C=s.useCallback(e=>{g(e)},[]),S=s.useMemo(()=>{if(null===u||!k[u])return null;const e=k[u];let t;t=j>=168?75:j>=72?35:j>=24?15:j>=3?10:5;const s=60*t/2,a=e.timestamp;return{start:a-s,end:a+s}},[u,k,j]),T=s.useMemo(()=>{if(null===u||!k[u]||!S)return null;const e=k[u].time,{start:s,end:a}=S,l=n.filter(e=>e.timestamp>=s&&e.timestamp<a);if(0===l.length)return{timestamp:k[u].timestamp,timeLabel:e,items:o.map(e=>({key:e.key,label:e.label,value:0,color:Le(e.typeNum)}))};const i=new Map,c=new Map;let m=0,d=0;for(const t of l){const e=`TYPE_${t.type??t.payload_type??-1}`;if(i.set(e,(i.get(e)??0)+1),m++,r){const s=p(t,{spreadingFactor:r.sf,bandwidthHz:r.bw,codingRate:r.cr,preambleLength:r.preamble});c.set(e,(c.get(e)??0)+s),d+=s}}const h=o.map(e=>{let s;return s="airtime"===t?d>0?(c.get(e.key)??0)/d:0:m>0?(i.get(e.key)??0)/m:0,{key:e.key,label:e.label,value:s,color:Le(e.typeNum)}});return{timestamp:k[u].timestamp,timeLabel:e,items:h}},[u,k,S,n,o,t,r]);if(0===k.length)return a.jsxs("div",{className:"h-full flex items-center justify-center text-text-muted",children:[a.jsx(Y,{className:"w-6 h-6 mr-2 opacity-50"}),a.jsx("span",{children:"No packet data available"})]});const A=(null==T?void 0:T.timeLabel)??null;return a.jsxs("div",{className:"flex flex-col",children:[a.jsxs("div",{className:"analyzer-chart-height relative flex-shrink-0",children:[a.jsx("div",{className:"absolute inset-0 rounded-lg overflow-hidden",children:a.jsx(f,{data:w,maxValue:M,onHover:C,scatterData:N,noiseFloorAnomalies:m,showNoiseFloorOverlay:d,overlayOpacity:h,highlightedType:y,hoveredTimeRange:S,timeRangeHours:j,yAxisMode:"share"===t?"share":"airtime"})}),A&&a.jsx("div",{className:"absolute top-1 right-1 px-2 py-0.5 bg-bg-elevated/90 rounded text-xs text-accent-secondary font-mono pointer-events-none",children:A})]}),a.jsx($e,{sortedTypes:o,highlightedType:y,onTypeHover:v,aggregateShares:c,hoverData:T})]})}const Ge=new class{constructor(){t(this,"buckets",new Map),t(this,"lastProcessedTimestamp",0),t(this,"processedPacketCount",0),t(this,"cacheKey",null),t(this,"bucketDuration",60),t(this,"bucketDurationMs",6e4)}getBuckets(e,t,s,a){const n={startTs:t,endTs:s,radioConfigHash:this.hashRadioConfig(a)};return this.isCacheValid(n)?this.processPackets(e,t,s,a,!1):(this.invalidate(n),this.processPackets(e,t,s,a,!0)),this.toBucketDataArray(t,s)}processPackets(e,t,s,a,n){const l=Math.ceil((s-t)/this.bucketDuration);let i=0;for(const r of e){const e=r.timestamp;if(e<t||e>=s)continue;if(!n&&e<=this.lastProcessedTimestamp)continue;const o=Math.min(Math.floor((e-t)/this.bucketDuration),l-1),c=this.buckets.get(o)??{total:0,totalAirtime:0};c.total+=1,c.totalAirtime+=p(r,{spreadingFactor:a.sf,bandwidthHz:a.bw,codingRate:a.cr,preambleLength:a.preamble}),this.buckets.set(o,c),e>this.lastProcessedTimestamp&&(this.lastProcessedTimestamp=e),i++}this.processedPacketCount+=i}toBucketDataArray(e,t){const s=t-e,a=Math.ceil(s/this.bucketDuration),n=s/3600,l=[];for(let i=0;i<a;i++){const t=e+i*this.bucketDuration,s=new Date(1e3*t),a=n>24?s.toLocaleDateString([],{weekday:"short",hour:"2-digit",minute:"2-digit",hour12:!1}):s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),r=this.buckets.get(i)??{total:0,totalAirtime:0};l.push({timestamp:t,time:a,total:r.total,totalAirtime:r.totalAirtime,bucketDurationMs:this.bucketDurationMs})}return l}isCacheValid(e){return!!this.cacheKey&&this.cacheKey.startTs===e.startTs&&this.cacheKey.endTs===e.endTs&&this.cacheKey.radioConfigHash===e.radioConfigHash}invalidate(e){this.buckets.clear(),this.lastProcessedTimestamp=0,this.processedPacketCount=0,this.cacheKey=e}hashRadioConfig(e){return`${e.sf}-${e.bw}-${e.cr}-${e.preamble}`}clear(){this.buckets.clear(),this.lastProcessedTimestamp=0,this.processedPacketCount=0,this.cacheKey=null}getStats(){return{bucketCount:this.buckets.size,processedPackets:this.processedPacketCount,lastTimestamp:this.lastProcessedTimestamp,cacheKey:this.cacheKey}}};function Ie({mode:e,onChange:t}){return a.jsxs("div",{className:"toggle-group toggle-group-sm",children:[a.jsx("button",{onClick:()=>t("share"),className:"toggle-group-item "+("share"===e?"active":""),children:"Total"}),a.jsx("button",{onClick:()=>t("airtime"),className:"toggle-group-item "+("airtime"===e?"active":""),children:"Airtime"})]})}function Ke({smoothing:e,onChange:t}){return a.jsxs("div",{className:"toggle-group toggle-group-sm",children:[a.jsx("button",{onClick:()=>t("stats"),className:"toggle-group-item "+("stats"===e?"active":""),title:"Statistics view (scatter plot)",children:a.jsx(Ne,{className:"w-3.5 h-3.5"})}),a.jsx("button",{onClick:()=>t("trend"),className:"toggle-group-item "+("trend"===e?"active":""),title:"Trend line chart",children:a.jsx(ge,{className:"w-3.5 h-3.5"})}),a.jsx("button",{onClick:()=>t("raw"),className:"toggle-group-item "+("raw"===e?"active":""),title:"No smoothing (raw values)",children:a.jsx(je,{className:"w-3.5 h-3.5"})}),a.jsx("button",{onClick:()=>t("zlema"),className:"toggle-group-item "+("zlema"===e?"active":""),title:"Light smoothing",children:a.jsx(be,{className:"w-3.5 h-3.5"})}),a.jsx("button",{onClick:()=>t("ema"),className:"toggle-group-item "+("ema"===e?"active":""),title:"Moderate smoothing",children:a.jsx(ye,{className:"w-3.5 h-3.5"})}),a.jsx("button",{onClick:()=>t("smooth"),className:"toggle-group-item "+("smooth"===e?"active":""),title:"Heavy smoothing",children:a.jsx(Se,{className:"w-3.5 h-3.5"})}),a.jsx("button",{onClick:()=>t("ultra"),className:"toggle-group-item "+("ultra"===e?"active":""),title:"Ultra smoothing",children:a.jsx(Te,{className:"w-3.5 h-3.5"})}),a.jsx("button",{onClick:()=>t("mosaic"),className:"toggle-group-item "+("mosaic"===e?"active":""),title:"Mosaic view (treemap)",children:a.jsx(ve,{className:"w-3.5 h-3.5"})})]})}function Xe({enabled:e,onChange:t,anomalyCount:s=0,showTuning:n=!1,onTuningChange:l}){return a.jsxs("div",{className:"relative inline-flex items-center gap-1",children:[e&&l&&a.jsx("button",{onClick:()=>l(!n),className:"toggle-group toggle-group-sm "+(n?"active":""),title:n?"Hide tuning panel":"Show tuning panel",children:a.jsx("span",{className:"toggle-group-item "+(n?"active":""),children:a.jsx(Me,{className:"w-3.5 h-3.5"})})}),a.jsx("button",{onClick:()=>t(!e),className:"toggle-group toggle-group-sm "+(e?"active":""),title:e?"Hide noise floor anomalies":"Show noise floor anomalies",children:a.jsx("span",{className:"toggle-group-item "+(e?"active":""),children:a.jsx(J,{className:"w-3.5 h-3.5"})})}),s>0&&a.jsx("span",{className:"absolute -top-2 -right-2 min-w-[18px] h-[18px] px-1 rounded-full bg-accent-danger text-white text-[10px] font-bold flex items-center justify-center pointer-events-none z-10",children:s>99?"99+":s})]})}const Ve={sf:10,bw:25e4,cr:5,preamble:8};function Ye(e){return b[e]??`TYPE_${e.toString(16).toUpperCase()}`}function Qe(e,t){if(0===e.length)return[];const s=Math.floor((t-1)/2),a=[];for(let n=0;n<e.length;n++){const t=n>=s?e[n-s]:e[0];a.push(e[n]+(e[n]-t))}return function(e,t){if(0===e.length)return[];const s=2/(t+1),a=[e[0]];for(let n=1;n<e.length;n++)a.push(s*e[n]+(1-s)*a[n-1]);return a}(a,t)}const Ue=s.memo(function({packets:e,startTs:t,endTs:n,bucketCount:l,radioConfig:i=Ve,mode:r="share",smoothing:o="raw",noiseFloorAnomalies:c=null,showNoiseFloorOverlay:m=!1,overlayOpacity:d=.5}){const h=G(),[u,x]=s.useState(null),[g,f]=s.useState(null),[b,j]=s.useState([]),v=s.useRef(null),N=s.useRef(0);s.useEffect(()=>{const t=Math.abs(e.length-N.current);if(0===t&&b.length>0)return;v.current&&clearTimeout(v.current);const s=t>100?50:500;return v.current=setTimeout(()=>{N.current=e.length,j(e)},s),()=>{v.current&&clearTimeout(v.current)}},[e,b.length]);const k=s.useMemo(()=>function(e,t){const s=new Map;for(const n of e){const e=n.type??n.payload_type??-1,a=p(n,{spreadingFactor:t.sf,bandwidthHz:t.bw,codingRate:t.cr,preambleLength:t.preamble}),l=s.get(e)??{count:0,airtime:0};s.set(e,{count:l.count+1,airtime:l.airtime+a})}const a=[];for(const[n,l]of s)a.push({typeNum:n,key:`TYPE_${n}`,label:Ye(n),totalCount:l.count,totalAirtime:l.airtime});return a.sort((e,t)=>t.totalCount-e.totalCount)}(b,i),[b,i]),w=s.useMemo(()=>function(e,t,s,a,n,l){const i=s-t,r=i/a,o=1e3*r,c=i/3600,m=[];for(let d=0;d<a;d++){const e=t+d*r,s=new Date(1e3*e),a={timestamp:e,time:c>24?s.toLocaleDateString([],{weekday:"short",hour:"2-digit",minute:"2-digit",hour12:!1}):s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),counts:{},shares:{},airtimes:{},total:0,totalAirtime:0,bucketDurationMs:o};for(const t of l)a.counts[t.key]=0,a.airtimes[t.key]=0;m.push(a)}for(const d of e){const e=d.timestamp;if(e<t||e>=s)continue;const l=Math.min(Math.floor((e-t)/r),a-1),i=`TYPE_${d.type??d.payload_type??-1}`;m[l].counts[i]=(m[l].counts[i]??0)+1,m[l].total++;const o=p(d,{spreadingFactor:n.sf,bandwidthHz:n.bw,codingRate:n.cr,preambleLength:n.preamble});m[l].airtimes[i]=(m[l].airtimes[i]??0)+o,m[l].totalAirtime+=o}for(const d of m)for(const e of l)d.shares[e.key]=d.total>0?d.counts[e.key]/d.total*100:0;return m}(b,t,n,l,i,k),[b,t,n,l,i,k]),M=s.useMemo(()=>Ge.getBuckets(b,t,n,i),[b,t,n,i]),C=s.useMemo(()=>k.reduce((e,t)=>e+t.totalCount,0),[k]),S=s.useMemo(()=>k.reduce((e,t)=>e+t.totalAirtime,0),[k]),{sortedTypes:T,aggregateShares:A}=s.useMemo(()=>{const e=new Map,t="share"===r?C:S;if(t>0)for(const s of k){const a="share"===r?s.totalCount:s.totalAirtime;e.set(s.key,a/t)}return{sortedTypes:[...k].sort((t,s)=>(e.get(s.key)??0)-(e.get(t.key)??0)),aggregateShares:e}},[k,C,S,r]),F=s.useMemo(()=>function(e,t,s,a="raw"){const n=function(e,t,s){if(e.length<=360)return e;const a=Math.ceil(e.length/360),n=[];for(let l=0;l<e.length;l+=a){const t=e.slice(l,Math.min(l+a,e.length));if(0===t.length)continue;const i={timestamp:t[0].timestamp,time:t[0].time,counts:{},shares:{},airtimes:{},total:0,totalAirtime:0,bucketDurationMs:t[0].bucketDurationMs*t.length};for(const e of t){i.total+=e.total,i.totalAirtime+=e.totalAirtime;for(const t of s)i.counts[t.key]=(i.counts[t.key]??0)+(e.counts[t.key]??0),i.airtimes[t.key]=(i.airtimes[t.key]??0)+(e.airtimes[t.key]??0)}for(const e of s)i.shares[e.key]=i.total>0?i.counts[e.key]/i.total*100:0;n.push(i)}return n}(e,0,s),l=n.length,i=s.length,r=Array.from({length:i},()=>new Array(l).fill(0));for(let h=0;h<l;h++){const e=n[h];if("share"===t)for(let t=0;t<i;t++)r[t][h]=e.total>0?(e.counts[s[t].key]??0)/e.total:0;else{let t=0;for(let a=0;a<i;a++)t+=e.airtimes[s[a].key]??0;for(let a=0;a<i;a++)r[a][h]=t>0?(e.airtimes[s[a].key]??0)/t:0}}const o=Array.from({length:i},()=>new Array(l).fill(0));for(let h=0;h<i;h++)for(let e=0;e<l;e++){let t=0;for(let s=0;s<=h;s++)t+=r[s][e];o[h][e]=t}const c=o.map(e=>function(e,t){switch(t){case"zlema":return Qe(e,6);case"ema":return Qe(e,12);case"smooth":return Qe(e,24);case"ultra":return Qe(e,96);default:return e}}(e,a)),m=Array.from({length:i},()=>new Array(l).fill(0));for(let h=0;h<i;h++)for(let e=0;e<l;e++){const t=h>0?c[h-1][e]:0;m[h][e]=Math.min(1,Math.max(0,c[h][e]-t))}for(let h=0;h<l;h++){let e=0;for(let t=0;t<i;t++)e+=m[t][h];if(e>0&&Math.abs(e-1)>1e-6){const t=1/e;for(let e=0;e<i;e++)m[e][h]*=t}}const d=[];for(let h=0;h<l;h++){const e={timestamp:n[h].timestamp,time:n[h].time};for(let t=0;t<i;t++)e[s[t].key]=m[t][h];d.push(e)}return d}(w,r,T,o),[w,r,T,o]),P=s.useCallback(e=>x(e),[]),D=s.useCallback(e=>f(e),[]),L=s.useMemo(()=>{if(null===g||!F[g])return null;const e=F[g];return{timestamp:e.timestamp,timeLabel:e.time,items:T.map(t=>({key:t.key,label:t.label,value:e[t.key]??0,color:Le(t.typeNum)}))}},[g,F,T]),$=s.useMemo(()=>({timestamps:F.map(e=>e.timestamp),series:T.map(e=>({key:e.key,label:e.label,color:Le(e.typeNum),values:F.map(t=>t[e.key]??0)}))}),[F,T]);return 0===b.length?0===e.length?a.jsxs("div",{className:"h-full flex items-center justify-center text-text-muted",children:[a.jsx(Y,{className:"w-6 h-6 mr-2 opacity-50"}),a.jsx("span",{children:"No packet data available"})]}):null:"mosaic"===o?a.jsx(He,{sortedTypes:T,aggregateShares:A}):"stats"===o?a.jsx(We,{statsBuckets:M,mode:r,packets:b,startTs:t,endTs:n,radioConfig:i,sortedTypes:T,aggregateShares:A,noiseFloorAnomalies:c,showNoiseFloorOverlay:m,overlayOpacity:d}):"trend"===o?a.jsx(Oe,{packets:b,mode:r,startTs:t,endTs:n,radioConfig:i,bucketCount:l}):a.jsxs("div",{className:"flex flex-col",children:[a.jsx("div",{className:"analyzer-chart-height relative flex-shrink-0",children:a.jsx("div",{className:"absolute inset-0 rounded-lg overflow-hidden",children:a.jsx(y,{timestamps:$.timestamps,series:$.series,highlightedKey:u,cursorColor:h.cursor,onHover:D})})}),a.jsx($e,{sortedTypes:T,highlightedType:u,onTypeHover:P,aggregateShares:A,hoverData:L})]})}),Ze={"1x":1,"2x":2,"4x":4,"8x":8,"16x":16,"36x":36},Je=[1,5,10,25,50,100,150];function et(e,t,s,a){const n=Math.PI/180,l=(a-t)*n,i=e*n,r=s*n,o=Math.sin(l)*Math.cos(r),c=Math.cos(i)*Math.sin(r)-Math.sin(i)*Math.cos(r)*Math.cos(l);return(180*Math.atan2(o,c)/Math.PI+360)%360}function tt(e,t,s,a){const n=Math.PI/180,l=(s-e)*n,i=(a-t)*n,r=Math.sin(l/2)**2+Math.cos(e*n)*Math.cos(s*n)*Math.sin(i/2)**2;return 12742*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))}const st=[{min:10,label:"Excellent"},{min:7,label:"Very Good"},{min:4,label:"Good"},{min:1,label:"Fair+"},{min:-2,label:"Fair"},{min:-5,label:"Fair-"},{min:-8,label:"Poor"},{min:-11,label:"Bad"},{min:-1/0,label:"Critical"}];function at(e,t){return t[V(e)]||"#808080"}const nt=s.memo(function({neighbors:e,quickNeighbors:t,localLat:n,localLon:l,onStatsChange:i}){const[r,o]=s.useState(null),[c,m]=s.useState(new Set),[d,h]=s.useState({width:0,height:0}),[u,x]=s.useState("1x"),[p,g]=s.useState(1),f=s.useRef(null),y=s.useRef({}),b=s.useRef(null),v=s.useRef(null),N=s.useRef(p);N.current=p;const k=I(),w=q(),M=K(),C=W(),S=X(),T=S?C.secondary:C.primary,A=S?.4:.15,F=S?.25:.08,P=S?C.primary:w.primary;s.useEffect(()=>{const e=v.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e){const{width:e,height:s}=t.contentRect;e>0&&s>0&&h({width:e,height:s})}});t.observe(e);const s=e.getBoundingClientRect();return s.width>0&&s.height>0&&h({width:s.width,height:s.height}),()=>t.disconnect()},[]);const D=s.useMemo(()=>{const e=new Set;if(t)for(const s of t)e.add(s.hash);return e},[t]),L=s.useMemo(()=>{const e=new Map;if(t)for(const s of t)e.set(s.hash,{snr:s.avgSnr,rssi:s.avgRssi});return e},[t]),{processedNeighbors:$,maxDistance:R,totalNeighbors:z,zeroHopCount:B}=s.useMemo(()=>{const t=[];for(const[a,i]of Object.entries(e)){if(!i.latitude||!i.longitude||0===i.latitude||0===i.longitude)continue;if(!D.has(a))continue;const e=et(n,l,i.latitude,i.longitude),s=tt(n,l,i.latitude,i.longitude),r=L.get(a);t.push({hash:a.slice(0,8),name:i.node_name||i.name||"Unknown",snr:(null==r?void 0:r.snr)??i.snr??null,rssi:(null==r?void 0:r.rssi)??i.rssi??null,bearing:e,distance:s,normalizedDistance:0,lastSeen:i.last_seen,isZeroHop:!0})}const s=1.08*(t.length>0?Math.max(...t.map(e=>e.distance)):0);return t.sort((e,t)=>(e.snr??-1/0)-(t.snr??-1/0)),{processedNeighbors:t,maxDistance:s,totalNeighbors:t.length,zeroHopCount:t.length}},[e,n,l,D,L]);s.useEffect(()=>{null==i||i({zeroHopCount:B,totalCount:z,maxDistanceKm:R})},[B,z,R]),s.useEffect(()=>{const e=Ze[u],t=N.current;f.current&&cancelAnimationFrame(f.current);const s=performance.now(),a=n=>{const l=n-s,i=Math.min(l/400,1),r=(o=i)<.5?8*o*o*o*o:1-Math.pow(-2*o+2,4)/2;var o;g(t+(e-t)*r),f.current=i<1?requestAnimationFrame(a):null};return f.current=requestAnimationFrame(a),()=>{f.current&&cancelAnimationFrame(f.current)}},[u]);const H=R/p,_=s.useMemo(()=>Je.filter(e=>e<=1.1*H),[H]);s.useEffect(()=>{const e=[];for(const s of $){const t=y.current[s.hash];void 0!==t&&t!==s.lastSeen&&e.push(s.hash),y.current[s.hash]=s.lastSeen}if(0===e.length)return;queueMicrotask(()=>{m(t=>new Set([...t,...e]))});const t=setTimeout(()=>{m(t=>{const s=new Set(t);return e.forEach(e=>s.delete(e)),s})},600);return()=>clearTimeout(t)},[$]);const E=0!==n&&0!==l,O=s.useMemo(()=>{const{width:e,height:t}=d,s=e/2,a=t/2,n=Math.max(10,e/2-12),l=Math.max(10,t/2-12),i=Math.max(10,n-16),r=Math.max(10,l-16);return{width:e,height:t,centerX:s,centerY:a,maxRadiusX:i,maxRadiusY:r,labelRadiusX:n,labelRadiusY:l,cornerRadius:.2*Math.min(i,r)}},[d]),{width:G,height:V,centerX:Y,centerY:Q,maxRadiusX:U,maxRadiusY:J,labelRadiusX:ee,labelRadiusY:te,cornerRadius:se}=O,ae=s.useCallback((e,t=1)=>{const s=U*t,a=J*t,n=Math.min(se*t,s,a),l=(e%360+360)%360,i=l*Math.PI/180,r=180*Math.atan2(a-n,s-n)/Math.PI;let o,c;if(l<=45-r||l>315+r){const e=Math.tan(i);o=Math.max(Y-s+n,Math.min(Y+s-n,Y+a*e*(s/a))),c=Q-a}else if(l>45-r&&l<=45+r)o=Y+s-n+n*Math.sin(i),c=Q-a+n-n*Math.cos(i);else if(l>45+r&&l<=135-r){const e=1/Math.tan(i);c=Math.max(Q-a+n,Math.min(Q+a-n,Q-s*e*(a/s))),o=Y+s}else if(l>135-r&&l<=135+r)o=Y+s-n+n*Math.sin(i),c=Q+a-n-n*Math.cos(i);else if(l>135+r&&l<=225-r){const e=Math.tan(i);o=Math.max(Y-s+n,Math.min(Y+s-n,Y-a*e*(s/a))),c=Q+a}else if(l>225-r&&l<=225+r)o=Y-s+n+n*Math.sin(i),c=Q+a-n-n*Math.cos(i);else if(l>225+r&&l<=315-r){const e=1/Math.tan(i);c=Math.max(Q-a+n,Math.min(Q+a-n,Q-s*e*(a/s))),o=Y-s}else o=Y-s+n+n*Math.sin(i),c=Q-a+n-n*Math.cos(i);return{x:o,y:c}},[Y,Q,U,J,se]),ne=s.useCallback((e,t)=>{const s=ae(e,1);return{x:Y+(s.x-Y)*t,y:Q+(s.y-Q)*t}},[ae,Y,Q]),le=s.useCallback(e=>({N:{x:Y,y:Q-te},S:{x:Y,y:Q+te},E:{x:Y+ee,y:Q},W:{x:Y-ee,y:Q},NE:{x:Y+ee,y:Q-te},SE:{x:Y+ee,y:Q+te},SW:{x:Y-ee,y:Q+te},NW:{x:Y-ee,y:Q-te}}[e]),[Y,Q,ee,te]),ie=s.useCallback(e=>{const t=U*e,s=J*e,a=Math.min(se*e,t,s),n=Y-t,l=Y+t,i=Q-s,r=Q+s;return[`M ${n+a} ${i}`,`L ${l-a} ${i}`,`Q ${l} ${i} ${l} ${i+a}`,`L ${l} ${r-a}`,`Q ${l} ${r} ${l-a} ${r}`,`L ${n+a} ${r}`,`Q ${n} ${r} ${n} ${r-a}`,`L ${n} ${i+a}`,`Q ${n} ${i} ${n+a} ${i}`,"Z"].join(" ")},[Y,Q,U,J,se]),re=s.useCallback(e=>{o(e)},[]),oe=s.useCallback(e=>{x(e)},[]),ce=s.useCallback(e=>R<=0?0:e/R*p,[R,p]),me=e=>`${e}km`,de=s.useMemo(()=>{const e=_.map(e=>{const t=e/R*p;return{km:e,scale:t,labelY:Q-J*t*.71}}).filter(e=>e.scale<=1.05&&e.scale>=.02).sort((e,t)=>t.km-e.km),t=[];for(const s of e)t.some(e=>Math.abs(e.labelY-s.labelY)<28)||t.push(s);return t},[_,R,p,Q,J]),he=d.width>0&&d.height>0;return E?0===z?a.jsxs("div",{ref:b,className:"flex flex-col items-center justify-center h-full text-text-secondary",children:[a.jsx(Z,{className:"w-8 h-8 mb-2 opacity-50"}),a.jsx("p",{children:"No nodes with location data"})]}):a.jsxs("div",{ref:b,className:"relative h-full w-full flex overflow-hidden",children:[a.jsx("div",{ref:v,className:"relative flex-1 min-w-0 h-full",children:he&&a.jsxs("svg",{width:G,height:V,className:"absolute inset-0 z-0",children:[a.jsxs("defs",{children:[a.jsx("style",{children:"\n                @keyframes neighbor-blink-scale {\n                  0%, 100% {\n                    transform: scale(1);\n                    opacity: 0;\n                  }\n                  50% {\n                    transform: scale(1.3);\n                    opacity: 0.8;\n                  }\n                }\n                .neighbor-blink-ring {\n                  transform-origin: center;\n                  animation: neighbor-blink-scale 600ms ease-out forwards;\n                }\n              "}),a.jsx("clipPath",{id:"radar-clip",children:a.jsx("path",{d:ie(1)})})]}),_.map(e=>{const t=ce(e);if(t>1.05||t<.02)return null;const s=de.some(t=>t.km===e),n=Y+U*t*.71,l=Q-J*t*.71;return a.jsxs("g",{children:[a.jsx("path",{d:ie(t),fill:"none",stroke:T,strokeOpacity:A,strokeWidth:1}),s&&a.jsx("text",{x:n+4,y:l-2,textAnchor:"start",dominantBaseline:"auto",className:"fill-text-secondary",fontSize:10,fontFamily:j,children:me(e)})]},`ring-${e}`)}),["N","E","S","W"].map(e=>{const t="N"===e||"S"===e,s=t?Y:"E"===e?Y+U:Y-U,n=t?"N"===e?Q-J:Q+J:Q;return a.jsx("line",{x1:Y,y1:Q,x2:s,y2:n,stroke:T,strokeOpacity:A,strokeWidth:1,strokeDasharray:"4 4"},e)}),["NE","SE","SW","NW"].map(e=>{const t=le(e);return a.jsx("line",{x1:Y,y1:Q,x2:t.x,y2:t.y,stroke:T,strokeOpacity:F,strokeWidth:1,strokeDasharray:"4 4"},`diag-${e}`)}),["N","E","S","W"].map(e=>{const t=le(e),s="E"===e?"end":"W"===e?"start":"middle",n="N"===e?"hanging":"S"===e?"auto":"middle";return a.jsx("text",{x:t.x,y:t.y,textAnchor:s,dominantBaseline:n,fill:P,fontSize:16,fontWeight:600,fontFamily:j,"aria-hidden":"true",children:e},e)}),["NE","SE","SW","NW"].map(e=>{const t=le(e),s="NE"===e||"SE"===e?"end":"start",n="NE"===e||"NW"===e?"hanging":"auto";return a.jsx("text",{x:t.x,y:t.y,textAnchor:s,dominantBaseline:n,fill:P,fontSize:16,fontWeight:600,fontFamily:j,"aria-hidden":"true",children:e},e)}),a.jsx("circle",{cx:Y,cy:Q,r:5,fill:M.chart6,stroke:"rgba(255,255,255,0.3)",strokeWidth:1,role:"img","aria-label":"Local node"}),a.jsx("g",{clipPath:"url(#radar-clip)",children:$.map(e=>{const t=R>0?e.distance/R*p:0;if(t>1)return null;const{x:s,y:n}=ne(e.bearing,t),l=null!==e.snr?at(e.snr,k):"#808080",i=(null==r?void 0:r.hash)===e.hash,o=c.has(e.hash);return a.jsxs("g",{role:"img","aria-label":`${e.name}: ${e.distance.toFixed(1)}km ${e.bearing.toFixed(0)}°`,children:[o&&a.jsx("circle",{cx:s,cy:n,r:10.5,fill:"none",stroke:"rgba(255,255,255,0.9)",strokeWidth:2,className:"neighbor-blink-ring"}),i&&a.jsx("circle",{cx:s,cy:n,r:10.5,fill:l,opacity:.3}),a.jsx("circle",{cx:s,cy:n,r:i?7:5,fill:l,stroke:"rgba(0,0,0,0.5)",strokeWidth:1,style:{cursor:"pointer",transition:"r 0.15s"},onMouseEnter:()=>re(e),onMouseLeave:()=>re(null)})]},e.hash)})})]})}),a.jsx("div",{className:"flex flex-col h-full items-stretch gap-1 py-2 pl-2 flex-shrink-0",role:"group","aria-label":"Zoom level",children:["1x","2x","4x","8x","16x","36x"].map(e=>a.jsx("button",{onClick:()=>oe(e),"aria-pressed":u===e,className:"flex flex-1 items-center justify-center px-1.5 text-xs font-medium rounded transition-colors "+(u===e?"bg-accent-primary/20 text-accent-primary":"bg-white/5 text-text-secondary hover:bg-white/10 hover:text-text-primary"),children:e},e))}),r&&a.jsxs("div",{className:"absolute bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 text-sm pointer-events-none z-10 shadow-xl",style:{left:"50%",bottom:8,transform:"translateX(-50%)"},children:[a.jsx("div",{className:"font-medium text-text-primary",children:r.name}),a.jsx("div",{className:"text-text-secondary text-xs font-mono",children:r.hash}),null!==r.snr?a.jsx("div",{className:"flex gap-3 mt-1 text-xs",children:a.jsxs("span",{children:[a.jsx("span",{className:"text-text-secondary",children:"SNR:"})," ",a.jsxs("span",{className:"tabular-nums",style:{color:at(r.snr,k)},children:[r.snr.toFixed(1)," dB"]}),a.jsxs("span",{className:"text-text-secondary ml-1",children:["(",(ue=r.snr,(null==(xe=st.find(e=>ue>=e.min))?void 0:xe.label)??"Critical"),")"]})]})}):a.jsx("div",{className:"text-xs text-text-secondary mt-1",children:"No SNR data"}),a.jsxs("div",{className:"flex gap-3 text-xs",children:[a.jsxs("span",{children:[a.jsx("span",{className:"text-text-secondary",children:"Distance:"})," ",a.jsxs("span",{className:"tabular-nums text-text-primary",children:[r.distance.toFixed(2)," km"]})]}),a.jsxs("span",{children:[a.jsx("span",{className:"text-text-secondary",children:"Bearing:"})," ",a.jsxs("span",{className:"tabular-nums text-text-primary",children:[r.bearing.toFixed(0),"°"]})]})]})]})]}):a.jsxs("div",{ref:b,className:"flex flex-col items-center justify-center h-full text-text-secondary",children:[a.jsx(Z,{className:"w-8 h-8 mb-2 opacity-50"}),a.jsx("p",{children:"Local node coordinates not configured"}),a.jsx("p",{className:"text-xs mt-1",children:"Set latitude/longitude in config to enable"})]});var ue,xe}),lt={repeater:"var(--accent-primary)",companion:"var(--accent-tertiary)",room_server:"var(--accent-secondary)"};function it(e){if(e.contact_type){const t=e.contact_type.toLowerCase();if("repeater"===t||"rep"===t)return"repeater";if("room server"===t||"room_server"===t||"room"===t||"server"===t)return"room_server";if("companion"===t||"client"===t||"cli"===t)return"companion"}return e.is_repeater?"repeater":"companion"}const rt=s.memo(function({neighbors:e}){const t=s.useMemo(()=>{const t={repeater:0,companion:0,room_server:0};for(const a of Object.values(e)){const e=it(a);t[e]=(t[e]||0)+1}const s=Object.values(t).reduce((e,t)=>e+t,0);return{items:[{label:"Repeaters",count:t.repeater,percent:0,color:lt.repeater},{label:"Companions",count:t.companion,percent:0,color:lt.companion},{label:"Room Servers",count:t.room_server,percent:0,color:lt.room_server}].map(e=>({...e,percent:s>0?e.count/s*100:0})).filter(e=>e.count>0).sort((e,t)=>t.count-e.count),total:s}},[e]);return 0===t.total?a.jsx("div",{className:"h-full flex items-center justify-center text-text-muted type-body-sm",children:"No neighbors discovered yet"}):a.jsxs("div",{className:"h-full flex flex-col",children:[a.jsx("div",{className:"flex-1 flex flex-col justify-evenly",children:t.items.map(e=>a.jsxs("div",{className:"flex flex-col gap-1.5",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"type-data-sm text-text-secondary",children:e.label}),a.jsxs("span",{className:"type-data-sm text-text-secondary tabular-nums",children:[e.count," ",a.jsxs("span",{className:"text-text-secondary/60",children:["(",e.percent.toFixed(0),"%)"]})]})]}),a.jsx("div",{className:"h-2.5 bg-bg-elevated overflow-hidden",children:a.jsx("div",{className:"h-full transition-all duration-500 ease-out",style:{width:`${e.percent}%`,backgroundColor:e.color,minWidth:e.count>0?"4px":"0"}})})]},e.label))}),a.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border-subtle",children:[a.jsx("span",{className:"type-data-xs text-text-secondary",children:"Total Nodes"}),a.jsx("span",{className:"type-data-sm text-text-primary font-medium tabular-nums",children:t.total})]})]})});function ot({children:e,minHeight:t="100%",rootMargin:n="200px 0px",keepMounted:l=!0,className:i=""}){const r=s.useRef(null),[o,c]=s.useState(!1),[m,d]=s.useState(!1);s.useEffect(()=>{const e=r.current;if(!e)return;const t=new IntersectionObserver(([e])=>{const t=e.isIntersecting;d(t),t&&c(!0)},{rootMargin:n,threshold:0});return t.observe(e),()=>{t.disconnect()}},[n]);const h=m||l&&o;return a.jsx("div",{ref:r,className:`h-full w-full ${i}`,style:{minHeight:t},children:h?e:a.jsx("div",{className:"h-full w-full flex items-center justify-center text-text-muted/50",children:a.jsx("div",{className:"animate-pulse text-xs",children:"Loading chart..."})})})}const ct={excellent:"text-signal-excellent",good:"text-signal-good",fair:"text-signal-fair",poor:"text-accent-primary"},mt={excellent:"bg-signal-excellent/10",good:"bg-signal-good/10",fair:"bg-signal-fair/10",poor:"bg-accent-primary/10"};function dt(){const e=v(),t=N(),[n,l]=s.useState(null),i=s.useCallback((e,t)=>{l({prefix:e,candidateHashes:t})},[]),r=s.useCallback(()=>{l(null)},[]);if(!t)return a.jsxs(se,{children:[a.jsx(oe,{icon:a.jsx(Q,{}),title:"Prefix Conflicts",largeTitle:!0}),a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"text-center text-text-secondary",children:[a.jsx(me,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),a.jsx("p",{className:"type-data-xs",children:"No topology data available"}),a.jsx("p",{className:"type-data-xs opacity-70",children:"Run deep analysis to see stats"})]})})]});const o=(c=e.avgConfidence)>=.9?"excellent":c>=.7?"good":c>=.5?"fair":"poor";var c;const m=(d=e.collisionRate)<=10?"excellent":d<=25?"good":"poor";var d;const h="poor"===o||"poor"===m?"poor":"fair"===o||"fair"===m?"fair":"good"===o||"good"===m?"good":"excellent",u="excellent"===h||"good"===h?fe:de;return a.jsxs(se,{className:"flex flex-col overflow-hidden",children:[a.jsx(oe,{icon:a.jsx(Q,{}),title:"Prefix Conflicts",largeTitle:!0,actions:a.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1 rounded-full ${mt[h]}`,children:[a.jsx(u,{className:`w-3.5 h-3.5 ${ct[h]}`}),a.jsx("span",{className:`type-data-xs font-medium ${ct[h]}`,children:"excellent"===h?"Excellent":"good"===h?"Good":"fair"===h?"Fair":"Needs Attention"})]})}),a.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[a.jsxs("div",{className:"grid grid-cols-3 gap-1.5 sm:gap-2 py-3 sm:py-4",children:[a.jsxs("div",{className:"flex flex-col items-center cursor-help bg-white/5 radius-inner sm:radius-inset py-2 sm:py-3 px-1.5 sm:px-2",title:"Total unique 2-character prefixes observed in packet paths.",children:[a.jsx(ee,{value:e.totalPrefixes,className:"font-mono text-2xl sm:text-3xl font-semibold tabular-nums text-text-primary",priority:"low"}),a.jsx("span",{className:"type-data-xs sm:type-data-sm text-text-secondary mt-0.5 sm:mt-1",children:"Prefixes"})]}),a.jsxs("div",{className:"flex flex-col items-center cursor-help bg-white/5 radius-inner sm:radius-inset py-2 sm:py-3 px-1.5 sm:px-2",title:"Prefixes that map to exactly one known node. No disambiguation needed.",children:[a.jsx(ee,{value:e.unambiguousPrefixes,className:"font-mono text-2xl sm:text-3xl font-semibold tabular-nums text-text-primary",priority:"low"}),a.jsx("span",{className:"type-data-xs sm:type-data-sm text-text-secondary mt-0.5 sm:mt-1",children:"Unique"})]}),a.jsxs("div",{className:"flex flex-col items-center cursor-help radius-inner sm:radius-inset py-2 sm:py-3 px-1.5 sm:px-2 "+(e.collisionPrefixes>0?"bg-accent-primary/15":"bg-white/5"),title:"Prefixes matching multiple known nodes. Click a prefix below to explore candidates.",children:[a.jsx(ee,{value:e.collisionPrefixes,className:"font-mono text-2xl sm:text-3xl font-semibold tabular-nums "+(e.collisionPrefixes>0?"text-accent-primary":"text-text-primary"),priority:"low"}),a.jsx("span",{className:"type-data-xs sm:type-data-sm mt-0.5 sm:mt-1 "+(e.collisionPrefixes>0?"text-accent-primary":"text-text-secondary"),children:"Conflicts"})]})]}),e.highCollisionPrefixes.length>0&&a.jsxs("div",{children:[a.jsx("div",{className:"type-data-xs text-text-secondary mb-1.5",children:"Problem Prefixes"}),a.jsx("div",{className:"flex flex-wrap gap-1.5 content-start",children:e.highCollisionPrefixes.map(({prefix:e,candidateCount:t,candidateHashes:s})=>a.jsxs("button",{type:"button",onClick:()=>i(e,s),className:"inline-flex items-center gap-0.5 group",title:`${t} candidates - click to explore`,children:[a.jsx(ie,{children:e}),a.jsxs("span",{className:"text-text-muted type-data-xs group-hover:text-text-secondary transition-colors",children:["×",t]})]},e))})]}),0===e.lowConfidencePrefixes.length&&0===e.collisionPrefixes&&a.jsx("div",{className:"flex-1 flex items-center",children:a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx(fe,{className:"w-3.5 h-3.5 text-signal-excellent"}),a.jsx("span",{className:"type-data-xs text-signal-excellent",children:"All prefixes uniquely identified"})]})}),a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 mt-auto pt-3",children:[a.jsxs("div",{className:"flex items-center gap-2 cursor-help",title:"Average confidence score across all disambiguated prefixes. Higher = more certain node identification.",children:[a.jsx("span",{className:"type-data-xs text-text-secondary",children:"Confidence"}),a.jsxs("span",{className:`data-box ${ct[o]}`,children:[(100*e.avgConfidence).toFixed(1),"%"]})]}),a.jsxs("div",{className:"flex items-center gap-2 cursor-help",title:"Percentage of 2-character prefixes that match multiple known nodes. Lower is better.",children:[a.jsx("span",{className:"type-data-xs text-text-secondary",children:"Collisions"}),a.jsxs("span",{className:`data-box ${ct[m]}`,children:[e.collisionRate.toFixed(1),"%"]})]})]})]}),a.jsx(re,{isOpen:!!n,prefix:(null==n?void 0:n.prefix)||"",candidateHashes:(null==n?void 0:n.candidateHashes)||[],onClose:r})]})}function ht({icon:e,label:t,value:s,sublabel:n,highlight:l,tooltip:i}){return a.jsxs("div",{className:"flex items-center justify-between gap-2 py-1.5 "+(i?"cursor-help":""),title:i,children:[a.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 min-w-0",children:[a.jsx("span",{className:"icon-xs text-icon-widget flex-shrink-0",children:e}),a.jsx("span",{className:"type-body-sm text-text-secondary truncate",children:t})]}),a.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5 flex-shrink-0",children:[a.jsx("span",{className:"data-box",style:l?{"--data-box-color":"var(--accent-primary)"}:void 0,children:s}),n&&a.jsx("span",{className:"type-data-xs text-text-secondary hidden sm:inline",children:n})]})]})}function ut(){const e=k(),t=w().length;if(!e||0===e.totalPaths)return null;const{totalPaths:s,pathsWithGhosts:n,observationOverrideCount:l,tracePacketsProcessed:i,pathPacketsProcessed:r,distantEdgesDiscovered:o,duplicateGroupsFound:c,duplicatePathsUnique:m,echolocationEdgesInferred:d}=e,h=s>0?((s-n)/s*100).toFixed(1):"0",u=s>0?(l/s*100).toFixed(1):"0",x=i+r,p=x>0||o>0,g=c>0||d>0;return a.jsxs(se,{children:[a.jsx(oe,{title:"Path Decoder",icon:a.jsx(U,{}),largeTitle:!0,badge:t>0?`${t} hidden`:void 0}),a.jsxs(ce,{children:[a.jsxs("div",{children:[a.jsx(ht,{icon:a.jsx(ke,{className:"w-3.5 h-3.5"}),label:"Traceable",value:`${h}%`,sublabel:`of ${s.toLocaleString()} paths`,tooltip:"Percentage of packet journeys where every hop was identified. Higher = better visibility into how traffic flows through your mesh."}),a.jsx(ht,{icon:a.jsx(Ce,{className:"w-3.5 h-3.5"}),label:"Learning Rate",value:`${u}%`,sublabel:"adapted",tooltip:"How often real traffic patterns improved our predictions over geography alone. Higher values mean the decoder is learning your mesh's actual behavior — which routes are preferred, which nodes are most active."})]}),p&&a.jsxs("div",{className:"mt-3",children:[a.jsx("p",{className:"type-micro mb-2",children:"Beyond Line-of-Sight"}),a.jsxs("div",{children:[a.jsx(ht,{icon:a.jsx(we,{className:"w-3.5 h-3.5"}),label:"Route Reports",value:x.toLocaleString(),sublabel:i>0?`(${i} TRACE)`:void 0,tooltip:"TRACE/PATH packets from distant nodes share their routing tables. This reveals connections we can't directly observe — mapping parts of the mesh we don't touch."}),a.jsx(ht,{icon:a.jsx(he,{className:"w-3.5 h-3.5"}),label:"Remote Links",value:o.toLocaleString(),highlight:o>0,tooltip:"Node-to-node connections discovered from route reports. These links exist outside our RF range but help complete the topology picture."})]})]}),g&&a.jsx(ht,{icon:a.jsx(M,{className:"w-3.5 h-3.5"}),label:"Multi-Path Packets",value:c.toLocaleString(),sublabel:m>0?`(${m} routes)`:void 0,tooltip:"Packets received via multiple paths simultaneously. Like sonar, these 'echoes' reveal redundant routes — important for understanding mesh resilience."}),t>0&&a.jsx(ht,{icon:a.jsx(C,{className:"w-3.5 h-3.5 text-accent-primary"}),label:"Ghost Repeaters",value:t,highlight:!0,tooltip:"High-confidence hidden repeaters: appear in 10+ paths, have 2+ known neighbors, ≥30% confidence, and plausible location. View them on the Contacts map."})]})]})}function xt(){var e,t,n,l,i,r,o,c,m,d,h,u,x,p,g,f,y;const b=S(),j=T(),v=A(),N=F(),k=P(),w=D(),M=L(),C=$(),[q,W]=s.useState([]),[G,I]=s.useState(null),[K,X]=s.useState(null),[V,Q]=s.useState(!0),[U,J]=s.useState(null),[ee,ie]=s.useState(()=>{const e=localStorage.getItem("statistics-view-mode");return"share"===e||"airtime"===e?e:"airtime"});s.useEffect(()=>{localStorage.setItem("statistics-view-mode",ee)},[ee]);const[re,ce]=s.useState(()=>{const e=localStorage.getItem("statistics-smoothing-mode");return["raw","ema","zlema","smooth","ultra","mosaic","stats","trend"].includes(e)?e:"trend"});s.useEffect(()=>{localStorage.setItem("statistics-smoothing-mode",re)},[re]);const[me,de]=s.useState(!1),[he,ge]=s.useState(!1),[fe,ye]=s.useState(Ae),[be,je]=s.useState(.5),ve=s.useMemo(()=>({0:0,1:0,2:1,3:2,4:3,5:4,6:5,7:6}[M]??3),[M]),Ne=R[ve].hours,ke=60*Ne,we=R[ve],Me=B(Ne),Ce=w.isBackgroundLoading,Se=s.useCallback(e=>{C({0:1,1:2,2:3,3:4,4:5,5:6,6:7}[e]??4)},[C]),Te=s.useMemo(()=>{var e;if(!(null==(e=null==b?void 0:b.config)?void 0:e.radio))return null;const t=b.config.radio;return{sf:t.spreading_factor??10,bw:t.bandwidth??25e4,cr:t.coding_rate??5,preamble:t.preamble_length??8}},[null==(t=null==(e=null==b?void 0:b.config)?void 0:e.radio)?void 0:t.spreading_factor,null==(l=null==(n=null==b?void 0:b.config)?void 0:n.radio)?void 0:l.bandwidth,null==(r=null==(i=null==b?void 0:b.config)?void 0:i.radio)?void 0:r.coding_rate,null==(c=null==(o=null==b?void 0:b.config)?void 0:o.radio)?void 0:c.preamble_length]);s.useEffect(()=>{!async function(){var e;J(null);try{const t=await z(Ne);t.success&&(null==(e=t.data)?void 0:e.history)&&W(t.data.history)}catch(t){J(t instanceof Error?t.message:"Failed to load chart data")}finally{Q(!1)}}()},[Ne]);const Le=s.useMemo(()=>72===Ne?6e5:168===Ne?18e5:336===Ne?36e5:3e5,[Ne]),$e=s.useCallback(async()=>{var e;try{const t=await z(Ne);t.success&&(null==(e=t.data)?void 0:e.history)&&W(t.data.history)}catch{}},[Ne]);O($e,Le,!0,!0);const Re=s.useMemo(()=>0===q.length?{timestamps:[],values:[]}:{timestamps:q.map(e=>e.timestamp),values:q.map(e=>e.noise_floor_dbm)},[q]),ze=s.useMemo(()=>{if(q.length<10)return{anomalies:[],debug:void 0};const e=function(e,t={}){const s={...Ae,...t};if(e.length<10)return{anomalies:[],thresholds:Pe([]),totalSamples:e.length,anomalySamples:0};const a=e.map(e=>e.noise_floor_dbm),n=Pe(a),l=[...a].sort((e,t)=>e-t);let i,r;s.useAbsoluteThresholds?(i=s.baselineDbm,r=s.spikeDbm):(i=Fe(l,s.baselinePercentile),r=Fe(l,s.spikePercentile));const o=[...e].sort((e,t)=>e.timestamp-t.timestamp),c=[];let m=null,d=0;for(const h of o)if(h.noise_floor_dbm>i&&h.noise_floor_dbm<r)if(d++,m){const e=Math.abs(h.noise_floor_dbm-m.rollingAvg)<=s.similarityToleranceDbm,t=h.timestamp-m.endTs<=s.mergeGapSeconds;e&&t?(m.endTs=h.timestamp,m.values.push(h.noise_floor_dbm),m.timestamps.push(h.timestamp),m.rollingAvg=m.values.reduce((e,t)=>e+t,0)/m.values.length):(m.values.length>=s.minSequenceLength&&c.push(m),m={startTs:h.timestamp,endTs:h.timestamp,values:[h.noise_floor_dbm],timestamps:[h.timestamp],rollingAvg:h.noise_floor_dbm})}else m={startTs:h.timestamp,endTs:h.timestamp,values:[h.noise_floor_dbm],timestamps:[h.timestamp],rollingAvg:h.noise_floor_dbm};else m&&m.values.length>=s.minSequenceLength&&c.push(m),m=null;return m&&m.values.length>=s.minSequenceLength&&c.push(m),0===c.length?{anomalies:[],thresholds:n,totalSamples:e.length,anomalySamples:d,debug:{baselineCutoff:i,spikeCutoff:r,midBandSamples:d}}:{anomalies:c.map(e=>{const t=Math.max(...e.values),s=e.values.reduce((e,t)=>e+t,0)/e.values.length;return{startTs:e.startTs,endTs:e.endTs,peakValue:t,avgValue:s,severity:De(s,i,r),sampleCount:e.values.length}}),thresholds:n,totalSamples:e.length,anomalySamples:d,debug:{baselineCutoff:i,spikeCutoff:r,midBandSamples:d}}}(q,fe);return{anomalies:e.anomalies,debug:e.debug}},[q,fe]),Be=ze.anomalies,He=s.useMemo(()=>{const e=(null==b?void 0:b.neighbors)??{};return Object.fromEntries(Object.entries(e).filter(([e])=>!j.has(e)))},[null==b?void 0:b.neighbors,j]),_e=s.useMemo(()=>{const e=Date.now()/1e3-3600*Ne;return Object.fromEntries(Object.entries(He).filter(([,t])=>t.last_seen>=e))},[He,Ne]),Ee=s.useMemo(()=>{const e=60*ke/Me,t=Math.floor(Date.now()/1e3),s=Math.floor(t/e)*e;return{start:s-60*ke,end:s}},[ke,Me]);return a.jsxs(ae,{children:[a.jsx(ne,{title:"Statistics",icon:a.jsx(H,{}),controls:a.jsx(te,{ranges:R,selectedIndex:ve,onSelect:Se,isPending:Ce})}),U&&a.jsx(se,{className:"border border-accent-red/50 bg-accent-red/10",children:a.jsx("p",{className:"text-accent-red",children:U})}),me&&he&&a.jsxs(se,{className:"border border-accent-purple/30 bg-glass-surface/50",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"type-label",children:"Anomaly Detection Tuning"}),a.jsxs("span",{className:"type-data-xs text-text-muted",children:["(",we.label,")"]})]}),a.jsx("button",{onClick:()=>ye(e=>({...e,useAbsoluteThresholds:!e.useAbsoluteThresholds})),className:"type-data-xs px-2 py-1 rounded transition-colors "+(fe.useAbsoluteThresholds?"bg-accent-purple/30 text-accent-purple":"bg-glass-elevated text-text-muted hover:text-text-secondary"),children:fe.useAbsoluteThresholds?"Absolute dBm":"Percentile"})]}),a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[a.jsxs("div",{children:[a.jsx("span",{className:"type-micro",children:"Baseline"}),a.jsxs("span",{className:"ml-2 type-data-sm text-status-warning",children:[(null==(d=null==(m=ze.debug)?void 0:m.baselineCutoff)?void 0:d.toFixed(1))??"—"," dBm"]})]}),a.jsxs("div",{children:[a.jsx("span",{className:"type-micro",children:"Spike"}),a.jsxs("span",{className:"ml-2 type-data-sm text-status-warning",children:[(null==(u=null==(h=ze.debug)?void 0:h.spikeCutoff)?void 0:u.toFixed(1))??"—"," dBm"]})]}),a.jsxs("div",{children:[a.jsx("span",{className:"type-micro",children:"Mid-band"}),a.jsx("span",{className:"ml-2 type-data-sm text-accent-purple",children:(null==(x=ze.debug)?void 0:x.midBandSamples)??0})]}),a.jsxs("div",{children:[a.jsx("span",{className:"type-micro",children:"Anomalies"}),a.jsx("span",{className:"ml-2 type-data-sm text-status-danger",children:Be.length})]})]}),a.jsxs("div",{className:"mt-4 pt-4 border-t border-border-subtle space-y-4",children:[fe.useAbsoluteThresholds?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Baseline (",fe.baselineDbm," dBm)"]}),a.jsx("input",{type:"range",min:"-120",max:"-60",value:fe.baselineDbm,onChange:e=>ye(t=>({...t,baselineDbm:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Spike (",fe.spikeDbm," dBm)"]}),a.jsx("input",{type:"range",min:"-100",max:"-20",value:fe.spikeDbm,onChange:e=>ye(t=>({...t,spikeDbm:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Merge Gap (",fe.mergeGapSeconds,"s)"]}),a.jsx("input",{type:"range",min:"5",max:"120",step:"5",value:fe.mergeGapSeconds,onChange:e=>ye(t=>({...t,mergeGapSeconds:Number(e.target.value)})),className:"w-full accent-accent-purple"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Min Sequence (",fe.minSequenceLength,")"]}),a.jsx("input",{type:"range",min:"2",max:"20",value:fe.minSequenceLength,onChange:e=>ye(t=>({...t,minSequenceLength:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Similarity (±",fe.similarityToleranceDbm," dBm)"]}),a.jsx("input",{type:"range",min:"1",max:"15",value:fe.similarityToleranceDbm,onChange:e=>ye(t=>({...t,similarityToleranceDbm:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Opacity (",Math.round(100*be),"%)"]}),a.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.05",value:be,onChange:e=>je(Number(e.target.value)),className:"w-full accent-accent-purple"})]})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Baseline (P",fe.baselinePercentile,")"]}),a.jsx("input",{type:"range",min:"1",max:"50",value:fe.baselinePercentile,onChange:e=>ye(t=>({...t,baselinePercentile:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Spike (P",fe.spikePercentile,")"]}),a.jsx("input",{type:"range",min:"50",max:"99",value:fe.spikePercentile,onChange:e=>ye(t=>({...t,spikePercentile:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Merge Gap (",fe.mergeGapSeconds,"s)"]}),a.jsx("input",{type:"range",min:"5",max:"120",step:"5",value:fe.mergeGapSeconds,onChange:e=>ye(t=>({...t,mergeGapSeconds:Number(e.target.value)})),className:"w-full accent-accent-purple"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Min Sequence (",fe.minSequenceLength,")"]}),a.jsx("input",{type:"range",min:"2",max:"20",value:fe.minSequenceLength,onChange:e=>ye(t=>({...t,minSequenceLength:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Similarity (±",fe.similarityToleranceDbm," dBm)"]}),a.jsx("input",{type:"range",min:"1",max:"15",value:fe.similarityToleranceDbm,onChange:e=>ye(t=>({...t,similarityToleranceDbm:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Opacity (",Math.round(100*be),"%)"]}),a.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.05",value:be,onChange:e=>je(Number(e.target.value)),className:"w-full accent-accent-purple"})]})]})]}),a.jsxs("div",{className:"mt-4 p-3 bg-glass-elevated radius-inner",children:[a.jsx("div",{className:"type-micro mb-1",children:"Config output"}),a.jsxs("div",{className:"type-data-sm text-status-success",children:[fe.useAbsoluteThresholds?`useAbsoluteThresholds: true, baselineDbm: ${fe.baselineDbm}, spikeDbm: ${fe.spikeDbm}`:`useAbsoluteThresholds: false, baselinePercentile: ${fe.baselinePercentile}, spikePercentile: ${fe.spikePercentile}`,", mergeGapSeconds: ",fe.mergeGapSeconds,", minSequenceLength: ",fe.minSequenceLength,", similarityToleranceDbm: ",fe.similarityToleranceDbm]})]})]})]}),a.jsxs(le,{children:[Ce&&a.jsx(ue,{template:"auto",children:a.jsx(se,{className:"border border-accent-primary/30 bg-accent-primary/5",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"relative flex h-3 w-3",children:[a.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-accent-primary opacity-75"}),a.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-accent-primary"})]}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("p",{className:"type-body-sm text-text-primary",children:["Loading ",we.label," data..."]}),w.loadProgress&&a.jsxs("p",{className:"type-data-xs text-text-muted mt-0.5",children:[w.loadProgress.loaded.toLocaleString()," packets (",w.loadProgress.percent,"%)"]})]})]})})}),V?a.jsx(ue,{template:"auto",children:a.jsx(se,{className:"text-center py-12",children:a.jsx("div",{className:"animate-pulse text-text-muted",children:"Loading statistics..."})})}):a.jsxs(a.Fragment,{children:[a.jsx(ue,{template:"hero-auto",children:a.jsx(se,{isLoaded:k,skeletonType:"chart",children:k&&a.jsxs(a.Fragment,{children:[a.jsx(oe,{icon:a.jsx(Y,{}),title:"Packet Analyzer",badge:we.label,largeTitle:!0,stackActionsOnMobile:!0,actions:a.jsxs("div",{className:"flex flex-wrap items-center gap-2 justify-end",children:["stats"===re&&a.jsx(Xe,{enabled:me,onChange:de,anomalyCount:Be.length,showTuning:he,onTuningChange:ge}),a.jsx(Ke,{smoothing:re,onChange:ce}),a.jsx(Ie,{mode:ee,onChange:ie})]})}),a.jsx("div",{className:"flex-1 min-h-0",children:a.jsx(Ue,{packets:N,startTs:Ee.start,endTs:Ee.end,bucketCount:Me,radioConfig:Te??void 0,mode:ee,smoothing:re,noiseFloorAnomalies:Be,showNoiseFloorOverlay:me,overlayOpacity:be})})]})})}),a.jsxs(ue,{template:"panel",children:[a.jsx(xe,{span:12,md:6,children:a.jsx(se,{isLoaded:k,skeletonType:"chart",children:k&&a.jsxs(a.Fragment,{children:[a.jsx(oe,{icon:a.jsx(Z,{}),title:"Link Quality",badge:we.label,largeTitle:!0,actions:K?a.jsxs("div",{className:"flex items-center gap-3 type-data-xs text-text-muted",children:[a.jsxs("span",{children:[a.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:K.zeroHopCount})," nbr"]}),a.jsxs("span",{children:[a.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:K.totalCount})," obs"]}),a.jsxs("span",{children:[a.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:K.maxDistanceKm.toFixed(0)})," km"]})]}):null}),a.jsx("div",{className:"flex-1 min-h-0",children:a.jsx(ot,{children:a.jsx(nt,{neighbors:_e,quickNeighbors:v,localLat:(null==(g=null==(p=null==b?void 0:b.config)?void 0:p.repeater)?void 0:g.latitude)??0,localLon:(null==(y=null==(f=null==b?void 0:b.config)?void 0:f.repeater)?void 0:y.longitude)??0,onStatsChange:X})})})]})})}),a.jsx(xe,{span:12,md:6,children:a.jsx(se,{isLoaded:k,skeletonType:"chart",children:k&&a.jsxs(a.Fragment,{children:[a.jsx(oe,{icon:a.jsx(pe,{}),title:"Network Composition",badge:we.label,largeTitle:!0}),a.jsx("div",{className:"flex-1 min-h-0",children:a.jsx(ot,{children:a.jsx(rt,{neighbors:_e})})})]})})})]}),a.jsxs(ue,{template:"panel",children:[a.jsx(xe,{span:12,md:6,children:a.jsx(dt,{})}),a.jsx(xe,{span:12,md:6,children:a.jsx(ut,{})})]}),a.jsx(ue,{template:"panel",children:a.jsx(xe,{span:12,children:a.jsx(se,{isLoaded:k,skeletonType:"chart",children:k&&a.jsxs(a.Fragment,{children:[a.jsx(oe,{icon:a.jsx(_,{}),title:"RF Noise Floor",largeTitle:!0,stackActionsOnMobile:!0,actions:G?a.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[a.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["min ",a.jsx("span",{className:"text-text-secondary tabular-nums",children:G.min.toFixed(0)})]}),a.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["avg ",a.jsx("span",{className:"text-text-secondary tabular-nums",children:G.avg.toFixed(0)})]}),a.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["max ",a.jsx("span",{className:"text-text-secondary tabular-nums",children:G.max.toFixed(0)})]}),a.jsx("span",{className:"type-data-xs text-text-muted",children:"dBm"})]}):a.jsx("span",{className:"type-data-xs text-text-muted",children:"dBm"})}),a.jsx("div",{className:"flex-1 min-h-0",children:a.jsx(ot,{children:a.jsx(E,{timestamps:Re.timestamps,values:Re.values,onStatsChange:I})})})]})})})})]})]})]})}export{xt as default};
